<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/ayanami.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/ayanami.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhsama.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="你是否跟笔者一样，有时在git commit时提交错文件，要撤销提交却不知道该如何合理操作的困惑？希望这篇讲解git reset命令的文章可以帮助到你。">
<meta property="og:type" content="article">
<meta property="og:title" content="WebSocket 原理及简单应用">
<meta property="og:url" content="https://zhsama.github.io/2022/03/18/WebSocket/index.html">
<meta property="og:site_name" content="zhsama&#39;s blog">
<meta property="og:description" content="你是否跟笔者一样，有时在git commit时提交错文件，要撤销提交却不知道该如何合理操作的困惑？希望这篇讲解git reset命令的文章可以帮助到你。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/6/169f1656159c8519~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp">
<meta property="og:image" content="https://user-images.githubusercontent.com/33454514/158771990-2812e406-c716-434f-ad24-07e0764550b7.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/33454514/158772037-7758c2d6-5751-4708-a02d-6d0df60062ef.png">
<meta property="og:image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/3/16ecac45c6f6fec3~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp">
<meta property="article:published_time" content="2022-03-18T02:46:22.000Z">
<meta property="article:modified_time" content="2022-04-30T09:43:34.000Z">
<meta property="article:author" content="zhsama">
<meta property="article:tag" content="git">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/6/169f1656159c8519~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp">

<link rel="canonical" href="https://zhsama.github.io/2022/03/18/WebSocket/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>WebSocket 原理及简单应用 | zhsama's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">zhsama's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zhsama.github.io/2022/03/18/WebSocket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ayanami2.png">
      <meta itemprop="name" content="zhsama">
      <meta itemprop="description" content="我没有敌人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhsama's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          WebSocket 原理及简单应用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-18 10:46:22" itemprop="dateCreated datePublished" datetime="2022-03-18T10:46:22+08:00">2022-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-30 17:43:34" itemprop="dateModified" datetime="2022-04-30T17:43:34+08:00">2022-04-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>7.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>7 分钟</span>
            </span>
            <div class="post-description">你是否跟笔者一样，有时在git commit时提交错文件，要撤销提交却不知道该如何合理操作的困惑？希望这篇讲解git reset命令的文章可以帮助到你。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="WebSocket-简介"><a href="#WebSocket-简介" class="headerlink" title="WebSocket 简介"></a>WebSocket 简介</h1><p><code>Websocket 定义</code>  <a href="https://link.juejin.cn/?target=https://tools.ietf.org/html/rfc6455">参考规范 rfc6455</a></p>
<p><strong>规范解释</strong> <code>Websocket</code> 是一种提供客户端(提供不可靠秘钥)与服务端(校验通过该秘钥)进行<strong>双向通信</strong>的协议。</p>
<p>在没有<code>websocket</code>协议之前，要提供客户端与服务端实时<strong>双向推送</strong>消息，就会使用<code>polling</code>技术，客户端通过<code>xhr</code>或<code>jsonp</code> <strong>发送</strong>消息给服务端，并通过事件回调来<strong>接收</strong>服务端消息。</p>
<p>这种技术虽然也能保证双向通信，但是有一个不可避免的问题，就是<strong>性能问题</strong>。客户端不断向服务端发送请求，如果客户端并发数过大，无疑导致服务端压力剧增。因此，<code>websocket</code>就是解决这一痛点而诞生的。</p>
<span id="more"></span>

<p>这里再延伸一些名词:</p>
<ul>
<li><strong>长轮询</strong> 客户端向服务端发送<code>xhr</code>请求,服务端接收并<code>hold</code>该请求，直到有新消息<code>push</code>到客户端，才会主动断开该连接。然后，客户端处理该<code>response</code>后再向服务端发起新的请求。以此类推。</li>
</ul>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP1.1`默认使用长连接，使用长连接的`HTTP`协议，会在响应头中加入下面这行信息: `Connection:keep-alive</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><strong>短轮询</strong>:</li>
</ul>
<p>客户端不管是否收到服务端的<code>response</code>数据，都会定时想服务端发送请求，查询是否有数据更新。</p>
<ul>
<li><strong>长连接</strong> 指在一个<code>TCP</code>连接上可以发送多个数据包，在<code>TCP</code>连接保持期间，如果没有数据包发送，则双方就需要发送<code>心跳包</code>来维持此连接。</li>
</ul>
<blockquote>
<p>连接过程: 建立连接——数据传输——…——(发送心跳包，维持连接)——…——数据传输——关闭连接</p>
</blockquote>
<ul>
<li><strong>短连接</strong> 指通信双方有数据交互时，建立一个<code>TCP</code>连接，数据发送完成之后，则断开此连接。</li>
</ul>
<blockquote>
<p>连接过程: 建立连接——数据传输——断开连接——…——建立连接——数据传输——断开连接</p>
</blockquote>
<p><strong>Tips</strong></p>
<blockquote>
<p>这里有一个<strong>误解</strong>，长连接和短连接的概念本质上指的是传输层的<code>TCP</code>连接，因为<code>HTTP1.1</code>协议以后，连接默认都是长连接。没有短连接说法(<code>HTTP1.0</code>默认使用短连接)，网上大多数指的长短连接实质上说的就是<code>TCP</code>连接。 <code>http</code>使用长连接的好处: 当我们请求一个网页资源的时候，会带有很多<code>js</code>、<code>css</code>等资源文件，如果使用的时短连接的话，就会打开很多<code>tcp</code>连接，如果客户端请求数过大，导致<code>tcp</code>连接数量过多，对服务端造成压力也就可想而知了。</p>
</blockquote>
<ul>
<li><strong>单工</strong> 数据传输的方向唯一，只能由发送方向接收方的单一固定方向传输数据。</li>
<li><strong>半双工</strong> 即通信双方既是接收方也是发送方，不过，在某一时刻只能允许向一个方向传输数据。</li>
<li><strong>全双工</strong>: 即通信双方既是接收方也是发送方，两端设备可以同时发送和接收数据。</li>
</ul>
<p><strong>Tips</strong></p>
<blockquote>
<p><strong>单工</strong>、<strong>半双工</strong>和<strong>全双工</strong> 这三者都是建立在    <code>TCP</code>协议(传输层上)的概念，不要与应用层进行混淆。</p>
</blockquote>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>支持浏览器/Nodejs环境</li>
<li>支持双向通信</li>
<li>API简单易用</li>
<li>支持二进制传输</li>
<li>减少传输数据量</li>
</ul>
<h2 id="建立连接过程"><a href="#建立连接过程" class="headerlink" title="建立连接过程"></a>建立连接过程</h2><p><code>Websocket</code>复用了<code>HTTP</code>的握手通道。指的是，客户端发送<code>HTTP</code>请求，并在请求头中带上<code>Connection: Upgrade</code> 、<code>Upgrade: websocket</code>，服务端识别该header之后，进行协议升级，使用<code>Websocket</code>协议进行数据通信。</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/6/169f1656159c8519~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="在这里插入图片描述"></p>
<h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><ul>
<li><code>Request URL</code> 请求服务端地址</li>
<li><code>Request Method</code> 请求方式 (支持get/post/option)</li>
<li><code>Status Code</code> 101 Switching Protocols</li>
</ul>
<p><a href="https://link.juejin.cn/?target=https://tools.ietf.org/html/rfc7231%23section-6.2.2">RFC 7231 规范定义</a></p>
<blockquote>
<p>规范解释: 当收到101请求状态码时，表明服务端理解并同意客户端请求，更改<code>Upgrade</code> header字段。服务端也必须在<code>response</code>中，生成对应的<code>Upgrade</code>值。</p>
</blockquote>
<ul>
<li><code>Connection</code> 设置<code>upgrade</code> header,通知服务端，该<code>request</code>类型需要进行升级为<code>websocket</code>。 <a href="https://link.juejin.cn/?target=https://developer.mozilla.org/en-US/docs/Web/HTTP/Protocol_upgrade_mechanism">upgrade_mechanism 规范</a></li>
<li><code>Host</code> 服务端 hostname</li>
<li><code>Origin</code> 客户端 hostname:port</li>
<li><code>Sec-WebSocket-Extensions</code> 客户端向服务端发起请求扩展列表(list)，供服务端选择并在响应中返回</li>
<li><code>Sec-WebSocket-Key</code> 秘钥的值是通过规范中定义的算法进行计算得出，因此是不安全的，但是可以阻止一些误操作的websocket请求。</li>
<li><code>Sec-WebSocket-Accept</code> 计算公式:       1. 获取客户端请求header的值: <code>Sec-WebSocket-Key</code> 2. 使用魔数magic = ‘258EAFA5-E914-47DA-95CA-C5AB0DC85B11’ 3. 通过<code>SHA1</code>进行加密计算, sha1(Sec-WebSocket-Key + magic) 4. 将值转换为base64</li>
<li><code>Sec-WebSocket-Protocol</code>  指定有限使用的Websocket协议，可以是一个协议列表(list)。服务端在<code>response</code>中返回列表中支持的第一个值。</li>
<li><code>Sec-WebSocket-Version</code>  指定通信时使用的Websocket协议版本。最新版本:13,<a href="https://link.juejin.cn/?target=https://www.iana.org/assignments/websocket/websocket.xml%23version-number">历史版本</a></li>
<li><code>Upgrade</code> 通知服务端，指定升级协议类型为<code>websocket</code></li>
</ul>
<h3 id="数据帧格式"><a href="#数据帧格式" class="headerlink" title="数据帧格式"></a>数据帧格式</h3><p>数据格式定义参考：<a href="https://link.juejin.cn/?target=https://tools.ietf.org/html/rfc6455%23section-5.2">规范 RFC6455</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  0                   1                   2                   3</span><br><span class="line">  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line"> +-+-+-+-+-------+-+-------------+-------------------------------+</span><br><span class="line"> |F|R|R|R| opcode|M| Payload len |    Extended payload length    |</span><br><span class="line"> |I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |</span><br><span class="line"> |N|V|V|V|       |S|             |   (if payload len==126/127)   |</span><br><span class="line"> | |1|2|3|       |K|             |                               |</span><br><span class="line"> +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</span><br><span class="line"> |     Extended payload length continued, if payload len == 127  |</span><br><span class="line"> + - - - - - - - - - - - - - - - +-------------------------------+</span><br><span class="line"> |                               |Masking-key, if MASK set to 1  |</span><br><span class="line"> +-------------------------------+-------------------------------+</span><br><span class="line"> | Masking-key (continued)       |          Payload Data         |</span><br><span class="line"> +-------------------------------- - - - - - - - - - - - - - - - +</span><br><span class="line"> :                     Payload Data continued ...                :</span><br><span class="line"> + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line"> |                     Payload Data continued ...                |</span><br><span class="line"> +---------------------------------------------------------------+</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<ul>
<li><code>FIN</code>: 1 bit 如果该位值为1，表示这是<code>message</code>的最终片段(<code>fragment</code>)，如果为0，表示这是一个<code>message</code>的第一个片段。</li>
<li><code>RSV1, RSV2, RSV3</code>: 各占1 bit 一般默认值是0，除非协商扩展，为非零值进行定义，否则收到非零值，并且没有进行协商扩展定义，则<code>websocket</code>连接失败。</li>
<li><code>Opcode</code>: 4 bits 根据操作码(<code>Opcode</code>),解析有效载荷数据(<code>Payload data</code>).如果接受到未定义操作码，则应该断开<code>websocket</code>连接。</li>
<li><code>Mask</code>: 1 bit 定义是否需要的载荷数据(``Payload data)，进行掩码操作。如果设置值为1，那么在<code>Masking-key</code>中会定义一个掩码key,并用这个key对载荷数据进行反掩码(<code>unmask</code>)操作。所有从客户端发送到服务端的数据帧(<code>frame</code>),mask都被设置为1.</li>
<li><code>Payload length</code>: 7 bits, 7+16 bits, or 7+64 bits 载荷数据的长度。</li>
<li><code>Masking-key</code>: 0 or 4 bytes 所有从客户端传送到服务端的数据帧，数据载荷都进行了掩码操作，Mask为1，且携带了4字节的Masking-key。如果Mask为0，则没有Masking-key。</li>
<li><code>Payload data</code>:  (x+y) bytes</li>
</ul>
<h2 id="心跳检测"><a href="#心跳检测" class="headerlink" title="心跳检测"></a>心跳检测</h2><p>为了确保客户端与服务端的长连接正常，有时即使客户端连接中断，但是服务端未触发<code>onclose</code>事件，这就有可能导致无效连接占用。所以需要一种机制，确保两端的连接处于正常状态，<strong>心跳检测</strong>就是这种机制。客户端每隔一段时间，会向服务端发送<strong>心跳</strong>(数据包)，服务端也会返回<code>response</code>进行反馈连接正常。</p>
<h1 id="WebSocket-优点"><a href="#WebSocket-优点" class="headerlink" title="WebSocket 优点"></a>WebSocket 优点</h1><p>比起传统的轮询方式，WebSocket 可以更好的节省服务器资源和带宽，并且能够进行更加实时地通讯，优势如下：</p>
<ul>
<li><strong>减小带宽开销</strong>。服务器和客户端在连接建立后，相比起 HTTP 请求，交换数据时用于协议控制的数据包头部相对较小，一般只有 2 字节；</li>
<li><strong>增强实时性</strong>。服务器可以随时主动给客户端下发数据，相对于 HTTP 请求需要等待客户端发起请求服务端才能响应，延迟明显更少，和传统的轮询比较，WebSocket 也可以在短时间内更有效率地传递数据；</li>
<li><strong>维持连接状态</strong>。在一些需要身份认证的场景下， HTTP 请求可能需要在每个请求都携带状态信息（服务器不记录每次的请求和响应信息），而 WebSocket 一次连接建立后就会保持住会话状态，这就使其成为一种有状态的协议，后续通信时就可以省略部分状态信息；</li>
<li><strong>更灵活的扩展支持</strong>。根据 RFC6455 协议[2]，开发者可以对 WebSocket 自定义二进制帧，相对 HTTP，可以更轻松地处理二进制内容，此外开发者也自行扩展协议、实现部分自定义的子协议。</li>
<li><strong>更好的压缩效果</strong>。WebSocket 在适当的扩展支持下，可以沿用之前内容的上下文，在传递类似的数据时，可以显著地提高压缩率。</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/33454514/158771990-2812e406-c716-434f-ad24-07e0764550b7.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/33454514/158772037-7758c2d6-5751-4708-a02d-6d0df60062ef.png" alt="image"></p>
<h1 id="WebSocket-使用场景"><a href="#WebSocket-使用场景" class="headerlink" title="WebSocket 使用场景"></a>WebSocket 使用场景</h1><p>WebSocket 有这么多优势，那么它适用于哪些场景呢？下面来简单了解下：</p>
<ul>
<li><strong>需要及时响应的场景</strong>。当客户端需要对服务端发生的改变做出快速响应（尤其是客户端无法预测的响应）时，WebSocket 是非常适合的。例如开发一个客服系统，这往往要求实现多个用户实时沟通。如果使用 WebSocket，则每个对话都可以实时发送和接收消息。与 HTTP 相比，WebSocket 不需要考虑发送和接收的每个消息的 HTTP 请求/响应导致的开销，从而会有更高的执行效率。</li>
<li><strong>需要实时查询的场景</strong>。例如一名篮球迷想要查询比赛结果，如果比赛是上周结束的，那么比赛结果是固定的，HTTP 在这种情况下就非常适合。但是，如果是当前正在进行的比赛，得分会不断变化，并且更新频繁，在这种情况下，WebSocket 就是更好的选择。</li>
<li><strong>小负载的高频消息传递</strong>。如今越来越多的开发人员正在通过移动设备的 GPS 功能来记录 Web 应用程序的方位感知。如果我们需要记录一段时间内用户的位置信息，高频率发送更加细粒度的位置数据，从而起到实时分享功能（例如运动类 APP），WebSocket 所使用的 TCP 连接会让数据交换飞起来。</li>
<li><strong>多人协同的场景</strong>。例如近几年发展迅速的在线教育，学生可以足不出户，即可与老师以及其他同学一起进行实时沟通与交流，诸如布置作业、师生互动、问题讨论等等强实时交互类的场景都可交由 WebSocket 协议支撑完成，从而满足低延迟，高及时的场景要求。</li>
</ul>
<h1 id="WebSocket-API"><a href="#WebSocket-API" class="headerlink" title="WebSocket API"></a>WebSocket API</h1><h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket#%E5%B8%B8%E9%87%8F">常量</a></h2><table>
<thead>
<tr>
<th><strong>Constant</strong></th>
<th><strong>Value</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>WebSocket.CONNECTING</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>WebSocket.OPEN</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>WebSocket.CLOSING</code></td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>WebSocket.CLOSED</code></td>
<td><code>3</code></td>
</tr>
</tbody></table>
<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket#%E5%B1%9E%E6%80%A7">属性</a></h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/binaryType"><code>WebSocket.binaryType</code></a></p>
<p>使用二进制的数据类型连接。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/bufferedAmount"><code>WebSocket.bufferedAmount</code></a> 只读</p>
<p>未发送至服务器的字节数。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/extensions"><code>WebSocket.extensions</code></a> 只读</p>
<p>服务器选择的扩展。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/close_event"><code>WebSocket.onclose</code></a></p>
<p>用于指定连接关闭后的回调函数。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/conflicting/Web/API/WebSocket/error_event"><code>WebSocket.onerror</code></a></p>
<p>用于指定连接失败后的回调函数。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/conflicting/Web/API/WebSocket/message_event"><code>WebSocket.onmessage</code></a></p>
<p>用于指定当从服务器接受到信息时的回调函数。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/open_event"><code>WebSocket.onopen</code></a></p>
<p>用于指定连接成功后的回调函数。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/protocol"><code>WebSocket.protocol</code></a> 只读</p>
<p>服务器选择的下属协议。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/readyState"><code>WebSocket.readyState</code></a> 只读</p>
<p>当前的链接状态。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/url"><code>WebSocket.url</code></a> 只读</p>
<p>WebSocket 的绝对路径。</p>
</li>
</ul>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket#method_overview">方法</a></h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/close"><code>WebSocket.close([code[, reason]])</code></a></p>
<p>关闭当前链接。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/send"><code>WebSocket.send(data)</code></a></p>
<p>对要传输的数据进行排队。</p>
</li>
</ul>
<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket#%E4%BA%8B%E4%BB%B6">事件</a></h2><p>使用 <code>addEventListener()</code> 或将一个事件监听器赋值给本接口的 <code>on*eventname*</code> 属性，来监听下面的事件。</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/close_event"><code>close</code></a></p>
<p>当一个 <code>WebSocket</code> 连接被关闭时触发。 也可以通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/close_event"><code>onclose</code></a> 属性来设置。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/error_event"><code>error</code></a></p>
<p>当一个 <code>WebSocket</code> 连接因错误而关闭时触发，例如无法发送数据时。 也可以通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/conflicting/Web/API/WebSocket/error_event"><code>onerror</code></a> 属性来设置.</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/message_event"><code>message</code></a></p>
<p>当通过 <code>WebSocket</code> 收到数据时触发。 也可以通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/conflicting/Web/API/WebSocket/message_event"><code>onmessage</code></a> 属性来设置。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/open_event"><code>open</code></a></p>
<p>当一个 <code>WebSocket</code> 连接成功时触发。 也可以通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/open_event"><code>onopen</code></a> 属性来设置。</p>
</li>
</ul>
<h2 id="WebSocket-API-兼容性"><a href="#WebSocket-API-兼容性" class="headerlink" title="WebSocket API 兼容性"></a>WebSocket API 兼容性</h2><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/3/16ecac45c6f6fec3~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="在这里插入图片描述"></p>
<h1 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h1><h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> heartbeat = <span class="string">&#x27;HEARTBEAT&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> net.<span class="title class_">Socket</span>();</span><br><span class="line">client.<span class="title function_">connect</span>(<span class="number">9000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> content = chunk.<span class="title function_">toString</span>();</span><br><span class="line">  <span class="keyword">if</span> (content === heartbeat) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到心跳包：&#x27;</span>, content);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到数据：&#x27;</span>, content);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 定时发送数据</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发送数据&#x27;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toUTCString</span>());</span><br><span class="line">  client.<span class="title function_">write</span>(<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toUTCString</span>());</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">// 定时发送心跳包</span></span><br><span class="line">  client.<span class="title function_">write</span>(heartbeat);</span><br><span class="line">&#125;, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clientList = [];</span><br><span class="line"><span class="keyword">const</span> heartBeat = <span class="string">&#x27;HEART&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>();</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">(<span class="params">client</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;client connect:&#x27;</span>, client.<span class="property">remoteAddress</span> + <span class="string">&#x27;:&#x27;</span> + client.<span class="property">remotePort</span>);</span><br><span class="line">  clientList.<span class="title function_">push</span>(client);</span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">pack</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> content = pack.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">if</span> (content === heartBeat) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get heartBeat from client&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get data from client&#x27;</span>, content);</span><br><span class="line">      client.<span class="title function_">write</span>(<span class="string">&#x27;server:&#x27;</span> + content);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;client end&#x27;</span>);</span><br><span class="line">    clientList.<span class="title function_">splice</span>(clientList.<span class="title function_">indexOf</span>(client), <span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> index = clientList.<span class="title function_">indexOf</span>(client);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;client&#x27;</span> + index + <span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    clientList.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">broadcast</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;broadcast heartbeat&#x27;</span>, clientList.<span class="property">length</span>);</span><br><span class="line">  <span class="keyword">const</span> cleanup = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; clientList.<span class="property">length</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (clientList[i].<span class="property">writable</span>) &#123; <span class="comment">// 先检查 sockets 是否可写</span></span><br><span class="line">      clientList[i].<span class="title function_">write</span>(heartBeat);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;一个无效的客户端&#x27;</span>);</span><br><span class="line">      cleanup.<span class="title function_">push</span>(clientList[i]); <span class="comment">// 如果不可写，收集起来销毁。销毁之前要 Socket.destroy() 用 API 的方法销毁。</span></span><br><span class="line">      clientList[i].<span class="title function_">destroy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Remove dead Nodes out of write loop to avoid trashing loop index</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cleanup.<span class="property">length</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除无效的客户端:&#x27;</span>, cleanup[i].<span class="property">name</span>);</span><br><span class="line">    clientList.<span class="title function_">splice</span>(clientList.<span class="title function_">indexOf</span>(cleanup[i]), <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(broadcast, <span class="number">10000</span>); <span class="comment">// 定时发送心跳包</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>zhsama
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://zhsama.github.io/2022/03/18/WebSocket/" title="WebSocket 原理及简单应用">https://zhsama.github.io/2022/03/18/WebSocket/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/git/" rel="tag"># git</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/03/16/%E5%B8%B8%E8%A7%81HTTP%E7%8A%B6%E6%80%81%E7%A0%81/" rel="prev" title="常见 HTTP 状态码">
      <i class="fa fa-chevron-left"></i> 常见 HTTP 状态码
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/03/18/git%20%E5%91%BD%E4%BB%A4%E4%B9%8B%20reset%20%E4%B8%8E%20revert/" rel="next" title="Git 命令之 Reset 与 Revert">
      Git 命令之 Reset 与 Revert <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#WebSocket-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">WebSocket 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E7%82%B9"><span class="nav-number">1.1.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B"><span class="nav-number">1.2.</span> <span class="nav-text">建立连接过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="nav-number">1.2.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%B8%A7%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.2.2.</span> <span class="nav-text">数据帧格式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%83%E8%B7%B3%E6%A3%80%E6%B5%8B"><span class="nav-number">1.3.</span> <span class="nav-text">心跳检测</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebSocket-%E4%BC%98%E7%82%B9"><span class="nav-number">2.</span> <span class="nav-text">WebSocket 优点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebSocket-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">3.</span> <span class="nav-text">WebSocket 使用场景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WebSocket-API"><span class="nav-number">4.</span> <span class="nav-text">WebSocket API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E9%87%8F"><span class="nav-number">4.1.</span> <span class="nav-text">常量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7"><span class="nav-number">4.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95"><span class="nav-number">4.3.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6"><span class="nav-number">4.4.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebSocket-API-%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="nav-number">4.5.</span> <span class="nav-text">WebSocket API 兼容性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="nav-number">5.</span> <span class="nav-text">代码示例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Client"><span class="nav-number">5.1.</span> <span class="nav-text">Client</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Server"><span class="nav-number">5.2.</span> <span class="nav-text">Server</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhsama"
      src="/images/ayanami2.png">
  <p class="site-author-name" itemprop="name">zhsama</p>
  <div class="site-description" itemprop="description">我没有敌人</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhsama" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhsama" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:a602693793@gmail.com" title="E-Mail → mailto:a602693793@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhsama</span>
</div>

<br />
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("09/20/2021 10:54:40");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
