<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Android 12 åˆ·å…¥ Magisk æ¨¡å—åæ— æ³•å¼€æœºçš„è§£å†³æ–¹æ³•</title>
    <url>/2022/03/15/Android%2012%20%E5%88%B7%E5%85%A5%20Magisk%20%E6%A8%A1%E5%9D%97%E5%90%8E%E6%97%A0%E6%B3%95%E5%BC%80%E6%9C%BA%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h1 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h1><p>ç¬”è€…çš„æœºå™¨æ˜¯ OnePlus 8 T, è¿™å‡ å¤©æ›´æ–°äº†Color OS 12å…¬æµ‹ç‰ˆï¼ˆBased Android 12ï¼‰ï¼Œä½œä¸ºä¸€ä¸ªé…·å®‰æœºä½¬ï¼Œè‡ªç„¶æ˜¯å¿ä¸ä½åˆ·æœºçš„å†²åŠ¨ã€‚</p>
<p>æœ¬åœ°å‡çº§ä¹‹åä½¿ç”¨ä½“éªŒæ¯”æ°¢æ°§å¥½å¾—å¤šï¼Œåªæ˜¯è€—ç”µé‡é™¡å¢ã€‚çœ‹é…·å®‰çš„æœºå‹è¯´ï¼Œä»H2OSæ›´æ–°åˆ°é¢œè‰²ç³»ç»Ÿï¼Œæœ€å¥½æ˜¯è¿›è¡Œä¸€æ¬¡åŒæ¸…ã€‚ä¿ºå¯»æ€ä»å°åˆ°å¤§åˆ·æœºè¿™ä¹ˆä¸ƒå…«å¹´äº†ï¼Œä»€ä¹ˆå¤§é£å¤§æµªæ²¡è§è¿‡ï¼Ÿæ•°æ®å¤‡ä»½å®Œæˆä¹‹åå°±æ˜¯ä¸€æŠŠæ¢­ç›´æ¥é‡å¯åˆ° REC æ¨¡å¼åŒæ¸…æ•°æ®ã€‚</p>
<p>ç„¶åå°±æ˜¯å¤§å®¶å–œé—»ä¹è§çš„ç¯èŠ‚ï¼šæå– boot.img æ–‡ä»¶ï¼Œå†™å…¥ Magiskï¼Œè¿›å…¥ fastboot æ¨¡å¼åˆ·å…¥ boot.img è·å– root æƒé™ã€‚</p>
<p>ç”±äº Android 12 æ²¡æœ‰å¯ç”¨çš„ TWRPï¼Œè¿™å¯¹äºéœ€è¦æŠ˜è…¾ Magisk å’Œ Xposed çš„æœºå‹æ¥è¯´å®åœ¨æ˜¯ä¸å¤ªå‹å¥½ï¼Œä¸€ä¸ªå¤±è¯¯æ“ä½œç›´æ¥å¡ç¬¬ä¸€å±ï¼Œå°±å¯ä»¥å‡†å¤‡åäº‹å“¦ä¸é«˜é€š9008äº†ã€‚ï¼ˆ<strong>æ¯”å¦‚æˆ‘ï¼Œé—·å£°ä½œå¤§æ­»ï¼Œç¬¬äºŒå¤©è¦æ‰“å·¥è¿˜åˆ·æœºï¼Œç›´æ¥ç»™æˆ‘æ•´åˆ°å‡Œæ™¨å››ç‚¹ã€‚</strong>ï¼‰</p>
<p>ç”±äº Magisk åªæ˜¯ä¿®æ”¹äº†ç³»ç»Ÿçš„ boot åˆ†åŒºï¼Œå¯ä»¥é€šè¿‡é‡æ–°åˆ·å…¥å®˜æ–¹ ROM çš„ boot.img é‡æ–°å¼€æœºï¼Œä½†æ˜¯è¿™æ ·å¼€æœºä¹‹åï¼Œæ˜¯æ²¡æœ‰ root æƒé™çš„ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•åˆ é™¤ Magisk é‡Œé¢ä¸å…¼å®¹çš„ Moduleã€‚ä¹‹åå¦‚æœç„¶åæ‰‹åŠ¨é‡æ–°ç»™ boot.img æ‰“ä¸Š root è¡¥ä¸ï¼Œåˆä¼šé™·å…¥æ— æ³•å¼€æœºçš„æ­»å¾ªç¯ä¸­ã€‚æœ€åæ²¡åŠæ³•åªèƒ½åŒæ¸…é‡åˆ·ï¼Œéå¸¸éš¾å—ã€‚</p>
<h1 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h1><p>ä½†æ˜¯ï¼ä½†æ˜¯ï¼ä½†æ˜¯ï¼å¯å–œå¯è´ºçš„æ˜¯ï¼Œåœ¨ Android 12 ä¸‹çš„ Magisk æ›´æ–°äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼ˆå‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯åœ¨ Magisk 23 ä¹‹åçš„ç‰ˆæœ¬å¼•å…¥çš„ç‰¹æ€§åŠŸèƒ½ï¼‰ï¼š<strong>å¦‚æœ Magisk æ£€æµ‹åˆ°æ‰‹æœºè¿›å…¥å®‰å…¨æ¨¡å¼ä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨ç¦ç”¨æ‰€æœ‰æ¨¡å—ï¼ˆå¹¶ä¸ä¼šåˆ é™¤ï¼‰</strong>ã€‚è¿™ç®€ç›´å°±æ˜¯æ²¡æœ‰ TWRP æœºå‹çš„ç¦éŸ³ï¼</p>
<h2 id="å®‰å…¨æ¨¡å¼æ•‘ç –ï¼š"><a href="#å®‰å…¨æ¨¡å¼æ•‘ç –ï¼š" class="headerlink" title="å®‰å…¨æ¨¡å¼æ•‘ç –ï¼š"></a>å®‰å…¨æ¨¡å¼æ•‘ç –ï¼š</h2><p>å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯å¦‚æœåˆ·å…¥äº†ä¸å…¼å®¹çš„ Moduleï¼Œç„¶åå¼€æœºå¡ç¬¬ä¸€å±ï¼Œé‚£ä¹ˆå¯ä»¥å¼ºåˆ¶å…³æœºï¼Œç„¶ååœ¨å…³æœºçŠ¶æ€ä¸‹ï¼Œç›´æ¥è¿›å…¥å®‰å…¨æ¨¡å¼ï¼ŒMagisk å°±ä¼šç¦ç”¨æ‰€æœ‰çš„ Modulesï¼Œç„¶åå†æ¬¡é‡å¯æœºå™¨è¿›å…¥æ­£å¸¸æ¨¡å¼ï¼Œè¿™ä¸ªæ—¶å€™å› ä¸ºæ‰€æœ‰çš„ Modules éƒ½æ˜¯ç¦ç”¨çŠ¶æ€ï¼Œæ‰€ä»¥å¯ä»¥æ­£å¸¸å¼€æœºï¼Œå¼€æœºä¹‹åæœºå™¨è¿˜æ˜¯ root çŠ¶æ€ï¼Œè¿™æ—¶å€™ç›´æ¥åˆ æ‰ä¸å…¼å®¹çš„ Module å°±è¡Œäº†ã€‚</p>
<ol>
<li>è®¾å¤‡å…³æœºçŠ¶æ€ä¸‹ï¼ŒæŒ‰ç”µæºé”®å¼€æœº</li>
<li>å¾…å‡ºç° bootloader å·²è§£é”çš„å®‰å…¨æç¤ºåï¼Œç›´æ¥æŒ‰ä½â€œéŸ³é‡å‡â€é”®ï¼Œç›´åˆ°è¿›å…¥æ¡Œé¢</li>
<li>å±å¹•å·¦ä¸‹æ–¹æ˜¾ç¤ºâ€œå®‰å…¨æ¨¡å¼â€å³è¡¨ç¤ºæˆåŠŸ</li>
</ol>
<p>PSï¼š ä¸Šé¢ä»‹ç»çš„æ˜¯ Android å®˜æ–¹çš„é€šç”¨æ–¹å¼ï¼Œå¦‚æœä½ çš„è®¾å¤‡æ¯”è¾ƒç‰¹åˆ«çš„è¯ï¼Œå¯èƒ½éœ€è¦è‡ªå·± Google ä¸€ä¸‹å¦‚ä½•è¿›å…¥å®‰å…¨æ¨¡å¼ã€‚</p>
<p>PPSï¼šå¦å¤–å†è¯´ä¸€ç§æœ‰ç‚¹æš´åŠ›å’Œå±€é™æ€§çš„æ–¹æ³•ï¼Œä½†æ˜¯æ¯”ä¸Šé¢è¿™ä¸ªæ›´å½»åº•ï¼Œå¼€æœºä¹‹å Magisk ä¼šåˆ æ‰æ‰€æœ‰ Modulesï¼Œå½“ç„¶ä¹Ÿä¼šä¸¢å¤± root æƒé™ï¼Œéœ€è¦é‡æ–°ç»™ boot.img æ‰“è¡¥ä¸æ¥ root è®¾å¤‡ï¼Œä½†æ˜¯æ€»æ¯”å˜ç –æˆ–è€…çº¿åˆ·è¦å¥½å§ã€‚</p>
<h2 id="å…¶ä»–æ•‘ç –æ–¹æ³•"><a href="#å…¶ä»–æ•‘ç –æ–¹æ³•" class="headerlink" title="å…¶ä»–æ•‘ç –æ–¹æ³•"></a>å…¶ä»–æ•‘ç –æ–¹æ³•</h2><p>è¿™ä¸ªæ–¹æ³•ä»æ˜¯è®© ADB ç­‰å¾…è®¾å¤‡è¿›å…¥å¼•å¯¼å±å¹•ï¼Œç„¶å ADB å¼€å§‹å·¥ä½œï¼Œ ADB ä¼šåˆ é™¤æ‰€æœ‰å·²å®‰è£…çš„ Magisk Modules æ¥ç¡®ä¿æœºå™¨èƒ½å¤Ÿè¿›å…¥ç³»ç»Ÿã€‚</p>
<ol>
<li><p>ç¡®ä¿è®¾å¤‡åœ¨å…³æœºçŠ¶æ€ä¸‹</p>
</li>
<li><p>ä½¿ç”¨æ•°æ®çº¿å°†æ‰‹æœºè¿æ¥åˆ°å·²ç»å®‰è£…äº† ADB çš„ç”µè„‘ä¸Š</p>
</li>
<li><p>ç”µè„‘è¿›å…¥ ADB æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adb wait-for-device shell magisk --remove-modules</span><br></pre></td></tr></table></figure></li>
<li><p>æŒ‰ä½ç”µæºé”®å¼€æœºï¼Œå¹¶ä¸”ä¸æ¾å¼€ï¼Œç›´åˆ°è¿›å…¥æ¡Œé¢</p>
</li>
</ol>
<p>å¦‚æœä¸Šé¢è¿™ä¸¤ç§æ–¹æ³•éƒ½æ— æ³•æ‹¯æ•‘ä½ çš„çˆ±æœºçš„è¯ï¼Œå°±åªèƒ½9008äº†ã€‚å…·ä½“è§<a href="https://yun.daxiaamu.com/OnePlus_Roms/">å¤§ä¾ é˜¿æœ¨çš„åšå®¢</a>ï¼Œå¦å¤–ï¼Œå¼ºæ¨é˜¿æœ¨å¤§ä½¬çš„ä¸€åŠ å…¨èƒ½ç›’å­ï¼</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ–°çš„ä¸€å¹´æ²¡å•¥å¥½ç¥ç¦å¤§ğŸ”¥çš„ï¼Œåªå¥½ç¥å¤§å®¶åˆ·æœºå¿…å¡ç±³ï¼Œ9008ä¸€è·¯é¡ºç•…ï¼</p>
]]></content>
      <categories>
        <category>Android 12</category>
        <category>Color OS</category>
        <category>åˆ·æœº</category>
        <category>ä¸€åŠ </category>
      </categories>
      <tags>
        <tag>Android 12</tag>
        <tag>Color OS</tag>
        <tag>åˆ·æœº</tag>
        <tag>ä¸€åŠ </tag>
      </tags>
  </entry>
  <entry>
    <title>Composition API</title>
    <url>/2022/03/25/Composition%20API/</url>
    <content><![CDATA[<h1 id="Composition-API"><a href="#Composition-API" class="headerlink" title="Composition API"></a>Composition API</h1><p><a href="https://v3.cn.vuejs.org/guide/composition-api-introduction.html">å®˜æ–¹ç½‘ç«™</a></p>
<h2 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h2><p>setupå‡½æ•°æ˜¯ä¸€ä¸ªæ–°çš„ç»„ä»¶é€‰é¡¹ã€‚ä½œä¸ºç»„ä»¶å†…ä½¿ç”¨Composition APIçš„å…¥å£ç‚¹</p>
<p>åˆ›å»ºç»„ä»¶å®ä¾‹ï¼Œç„¶ååˆå§‹åŒ–propsï¼Œç´§æ¥ç€è°ƒç”¨<code>setup</code>å‡½æ•°ã€‚å®ƒä¼šåœ¨<code>beforeCreate</code>é’©å­ä¹‹å‰è°ƒç”¨ã€‚</p>
<p>setupè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚åˆ™å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼ˆ<strong>å®ƒæ˜¯å“åº”å¼çš„æ•°æ®</strong>ï¼‰éƒ½å¯ä»¥ç›´æ¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚ç›¸å½“äºvue2.0ä¸­dataå‡½æ•°è¿”å›çš„å¯¹è±¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  setup () &#123;</span><br><span class="line">    return &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="å“åº”å¼æ•°æ®"><a href="#å“åº”å¼æ•°æ®" class="headerlink" title="å“åº”å¼æ•°æ®"></a>å“åº”å¼æ•°æ®</h2><p>ç®€è€Œè¨€ä¹‹ï¼Œreactiveè´Ÿè´£å¤æ‚æ•°æ®ç»“æ„ï¼Œrefå¯ä»¥æŠŠåŸºæœ¬çš„æ•°æ®ç»“æ„åŒ…è£…æˆå“åº”å¼ï¼š</p>
<ul>
<li>refï¼šå¯ä¼ å…¥ä»»æ„ç±»å‹çš„å€¼å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼ä¸”å¯æ”¹å˜çš„refå¯¹è±¡ã€‚refå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªæŒ‡å‘å†…éƒ¨å€¼çš„å•ä¸€å±æ€§<code>.value</code>ï¼Œæ”¹å˜å€¼çš„æ—¶å€™å¿…é¡»ä½¿ç”¨å…¶valueå±æ€§</li>
<li>reactiveï¼šæ¥å—ä¸€ä¸ªæ™®é€šå¯¹è±¡ç„¶åè¿”å›è¯¥æ™®é€šå¯¹è±¡çš„å“åº”å¼ä»£ç†ã€‚ç­‰åŒäº2.xçš„<code>Vue.obserable()</code></li>
</ul>
<h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123;state.count&#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123;num&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;add&quot;&gt;è®¡ç®—&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; reactive, ref &#125; from &quot;vue&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line"></span><br><span class="line">  setup()&#123;</span><br><span class="line">    const state = reactive(&#123;</span><br><span class="line">      count: 1</span><br><span class="line">    &#125;);</span><br><span class="line">    const num = ref(0);</span><br><span class="line">    function add() &#123;</span><br><span class="line">      state.count++;</span><br><span class="line">      num.value+=2</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123; state, add, num &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>refåŒ…è£…çš„num,æ¨¡æ¿é‡Œå¯ä»¥ç›´æ¥ç”¨ï¼Œä½†jsä¸­ä¿®æ”¹çš„æ—¶å€™æ“ä½œ<code>.value</code>å±æ€§ã€‚</p>
<h3 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;state.count&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>è®¡ç®—<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// å“åº”å¼å˜é‡å£°æ˜ reactiveè´Ÿè´£å¤æ‚æ•°æ®ç»“æ„ï¼Œ</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">count</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      state.<span class="property">count</span>++;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123; state, add&#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="toRefs"><a href="#toRefs" class="headerlink" title="toRefs"></a>toRefs</h3><p>å°†å“åº”å¼å¯¹è±¡è½¬æ¢ä¸ºæ™®é€šå¯¹è±¡ï¼Œå…¶ä¸­ç»“æœå¯¹è±¡çš„æ¯ä¸ªpropertyéƒ½æ˜¯æŒ‡å‘åŸå§‹å¯¹è±¡ç›¸åº”çš„propertyã€‚</p>
<p>ä»åˆæˆå‡½æ•°è¿”å›å“åº”å¼å¯¹è±¡æ—¶ï¼ŒtoRefséå¸¸æœ‰ç”¨ï¼Œè¿™æ ·æ¶ˆè´¹ç»„ä»¶å°±å¯ä»¥åœ¨ä¸ä¸¢å¤±å“åº”å¼çš„æƒ…å†µä¸‹å¯¹è¿”å›çš„å¯¹è±¡è¿›è¡Œåˆ†è§£/æ‰©æ•£ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// useFeatureX.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;reactive&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">userFeatureX</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">bar</span>: <span class="number">2</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// é€»è¾‘è¿è¡ŒçŠ¶æ€</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// è¿”å›æ—¶è½¬æ¢ä¸ºref</span></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.vue</span></span><br><span class="line"><span class="keyword">import</span> &#123;toRefs&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> state = <span class="title function_">useFeatureX</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...<span class="title function_">toRefs</span>(state)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h3><p>ä¼ å…¥ä¸€ä¸ª getter å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤ä¸å¯æ‰‹åŠ¨ä¿®æ”¹çš„ ref å¯¹è±¡ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, ref, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 1.å“åº”å¼å˜é‡å£°æ˜ reactiveè´Ÿè´£å¤æ‚æ•°æ®ç»“æ„ï¼Œ</span></span><br><span class="line">    <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 2.refå¯ä»¥æŠŠåŸºæœ¬çš„æ•°æ®ç»“æ„åŒ…è£…æˆå“åº”å¼</span></span><br><span class="line">    <span class="keyword">const</span> num = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 3.åˆ›å»ºåªè¯»çš„è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> computedEven1 = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> state.<span class="property">count</span> % <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 4.åˆ›å»ºå¯è¯»å¯å†™çš„è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">const</span> computedEven2 = <span class="title function_">computed</span>(&#123;</span><br><span class="line">      <span class="attr">get</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state.<span class="property">count</span> % <span class="number">2</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">set</span>: <span class="function"><span class="params">newVal</span>=&gt;</span>&#123;</span><br><span class="line">        state.<span class="property">count</span> = newVal;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº‹ä»¶çš„å£°æ˜</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">      state.<span class="property">count</span>++;</span><br><span class="line">      num.<span class="property">value</span> += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">      computedEven2.<span class="property">value</span> = <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; state, add, num, computedEven1,computedEven2,handleClick &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect"></a>watchEffect</h3><p>ç«‹å³æ‰§è¡Œä¼ å…¥çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å“åº”å¼è¿½è¸ªå…¶ä¾èµ–ï¼Œå¹¶åœ¨å…¶ä¾èµ–å˜æ›´æ—¶é‡æ–°è¿è¡Œè¯¥å‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> num = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>))</span><br><span class="line"><span class="comment">// -&gt; æ‰“å°å‡º 0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  count.<span class="property">value</span>++</span><br><span class="line">  <span class="comment">// -&gt; æ‰“å°å‡º 1</span></span><br><span class="line">&#125;, <span class="number">100</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>åœæ­¢ç›‘å¬</p>
<ul>
<li>éšå¼åœæ­¢</li>
</ul>
<p>å½“ <code>watchEffect</code> åœ¨ç»„ä»¶çš„ <code>setup()</code> å‡½æ•°æˆ–ç”Ÿå‘½å‘¨æœŸé’©å­è¢«è°ƒç”¨æ—¶ï¼Œ ä¾¦å¬å™¨ä¼šè¢«é“¾æ¥åˆ°è¯¥ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨åœæ­¢</p>
<ul>
<li>æ˜¾ç¤ºåœæ­¢</li>
</ul>
<p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºè°ƒç”¨è¿”å›å€¼æ¥åœæ­¢ä¾¦å¬</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watchEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//åœæ­¢ä¾¦å¬</span></span><br><span class="line"><span class="title function_">stop</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>æ¸…é™¤å‰¯ä½œç”¨</p>
<p>æœ‰æ—¶å€™å‰¯ä½œç”¨å‡½æ•°ä¼šæ‰§è¡Œä¸€äº›å¼‚æ­¥çš„å‰¯ä½œç”¨ï¼Œè¿™äº›å“åº”éœ€è¦åœ¨å…¶å¤±æ•ˆæ—¶æ¥æ¸…é™¤(å³å®Œæˆä¹‹å‰çŠ¶æ€å·²æ”¹å˜äº†)ã€‚å¯ä»¥åœ¨ä¾¦å¬å‰¯ä½œç”¨ä¼ å…¥çš„å‡½æ•°ä¸­æ¥å—ä¸€ä¸ª<code>onInvalidate</code>å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç”¨æ¥æ³¨å†Œæ¸…ç†å¤±æ•ˆæ—¶çš„å›è°ƒã€‚å½“ä»¥ä¸‹æƒ…å†µå‘ç”Ÿæ—¶ï¼Œè¿™ä¸ª<strong>å¤±æ•ˆå›è°ƒ</strong>ä¼šè¢«è§¦å‘ï¼š</p>
<ul>
<li>å‰¯ä½œç”¨å³å°†é‡æ–°æ‰§è¡Œæ—¶</li>
<li>ä¾¦å¬å™¨è¢«åœæ­¢(å¦‚æœåœ¨<code>setup()</code>æˆ–ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸­ä½¿ç”¨äº†<code>watchEffect</code>,åˆ™åœ¨å¸è½½ç»„ä»¶æ—¶)</li>
</ul>
<p>å®˜ç½‘çš„ä¾‹å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">watchEffect</span>(<span class="function">(<span class="params">onInvalidate</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="title function_">performAsyncOperation</span>(id.<span class="property">value</span>)</span><br><span class="line">  <span class="title function_">onInvalidate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// id æ”¹å˜æ—¶ æˆ– åœæ­¢ä¾¦å¬æ—¶</span></span><br><span class="line">    <span class="comment">// å–æ¶ˆä¹‹å‰çš„å¼‚æ­¥æ“ä½œ</span></span><br><span class="line">    token.<span class="title function_">cancel</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>æ¡ˆä¾‹ï¼šå®ç°å¯¹ç”¨æˆ·è¾“å…¥â€œé˜²æŠ–â€æ•ˆæœ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">v-model</span>=<span class="string">&quot;keyword&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> keyword = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> <span class="title function_">asyncPrint</span> = val =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;user input: &#x27;</span>, val)</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">watchEffect</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="function"><span class="params">onInvalidate</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//ç”¨æˆ·è¾“å…¥çš„æ—¶é—´é—´éš”å°äº1ç§’ï¼Œéƒ½ä¼šç«‹åˆ»æ¸…é™¤æ‰å®šæ—¶ï¼Œä¸è¾“å…¥ç»“æœã€‚æ­£å› ä¸ºè¿™ä¸ªï¼Œå®ç°äº†ç”¨æˆ·é˜²æŠ–çš„åŠŸèƒ½ï¼Œåªåœ¨ç”¨æˆ·è¾“å…¥æ—¶é—´é—´éš”å¤§äº1ç§’ï¼Œæ‰åšæ‰“å°</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> timer = <span class="title function_">asyncPrint</span>(keyword.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">onInvalidate</span>(<span class="function">() =&gt;</span> <span class="built_in">clearTimeout</span>(timer))</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;keyword change: &#x27;</span>, keyword.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// flush: &#x27;pre&#x27;  watch() å’Œ watchEffect() åœ¨ DOM æŒ‚è½½æˆ–æ›´æ–°ä¹‹å‰è¿è¡Œå‰¯ä½œç”¨ï¼Œæ‰€ä»¥å½“ä¾¦å¬å™¨è¿è¡Œæ—¶ï¼Œæ¨¡æ¿å¼•ç”¨è¿˜æœªè¢«æ›´æ–°ã€‚</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//flush: &#x27;post&#x27; é€‰é¡¹æ¥å®šä¹‰ï¼Œè¿™å°†åœ¨ DOM æ›´æ–°åè¿è¡Œå‰¯ä½œç”¨ï¼Œç¡®ä¿æ¨¡æ¿å¼•ç”¨ä¸ DOM ä¿æŒåŒæ­¥ï¼Œå¹¶å¼•ç”¨æ­£ç¡®çš„å…ƒç´ ã€‚</span></span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">flush</span>: <span class="string">&#x27;post&#x27;</span> <span class="comment">// é»˜è®¤&#x27;pre&#x27;ï¼ŒåŒæ­¥&#x27;sync&#x27;ï¼Œ&#x27;pre&#x27;ç»„ä»¶æ›´æ–°ä¹‹å‰</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        keyword</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// å®ç°å¯¹ç”¨æˆ·è¾“å…¥â€œé˜²æŠ–â€æ•ˆæœ</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><p><code>watch</code> API å®Œå…¨ç­‰æ•ˆäº 2.x <code>this.$watch</code> ï¼ˆä»¥åŠ <code>watch</code> ä¸­ç›¸åº”çš„é€‰é¡¹ï¼‰ã€‚<code>watch</code> éœ€è¦ä¾¦å¬ç‰¹å®šçš„æ•°æ®æºï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œå‰¯ä½œç”¨ã€‚é»˜è®¤æƒ…å†µæ˜¯æ‡’æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»…åœ¨ä¾¦å¬çš„æºå˜æ›´æ—¶æ‰æ‰§è¡Œå›è°ƒã€‚</p>
<p>watch()æ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•°è¢«ç§°ä½œâ€æ•°æ®æºâ€,å®ƒå¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>ä¸€ä¸ªè¿”å›ä»»æ„å€¼çš„getterå‡½æ•°</li>
<li>ä¸€ä¸ªåŒ…è£…å¯¹è±¡(å¯ä»¥æ˜¯refä¹Ÿå¯ä»¥æ˜¯reactiveåŒ…è£…çš„å¯¹è±¡)</li>
<li>ä¸€ä¸ªåŒ…å«ä¸Šè¿°ä¸¤ç§æ•°æ®æºçš„æ•°ç»„</li>
</ul>
<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°åªæœ‰å½“æ•°æ®æºå‘ç”Ÿå˜åŠ¨æ—¶æ‰ä¼šè¢«è§¦å‘ï¼š</p>
<ol>
<li><p>ä¾¦å¬å•ä¸ªæ•°æ®æº</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;<span class="attr">count</span>: <span class="number">1</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¾¦å¬ä¸€ä¸ªreactiveå®šä¹‰çš„æ•°æ®,ä¿®æ”¹countå€¼æ—¶ä¼šè§¦å‘ watchçš„å›è°ƒ</span></span><br><span class="line"><span class="title function_">watch</span>(<span class="function">()=&gt;</span>state.<span class="property">count</span>,<span class="function">(<span class="params">newCount,oldCount</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;newCount:&#x27;</span>,newCount);  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;oldCount:&#x27;</span>,oldCount);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//ä¾¦å¬ä¸€ä¸ªref</span></span><br><span class="line"><span class="keyword">const</span> num = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_">watch</span>(num,<span class="function">(<span class="params">newNum,oldNum</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;newNum:&#x27;</span>,newNum);  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;oldNum:&#x27;</span>,oldNum);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>ä¾¦å¬å¤šä¸ªæ•°æ®æº(æ•°ç»„)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;<span class="attr">count</span>: <span class="number">1</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> num = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// ç›‘å¬ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="title function_">watch</span>([<span class="function">()=&gt;</span>state.<span class="property">count</span>,num],<span class="function">(<span class="params">[newCount,newNum],[oldCount,oldNum]</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;new:&#x27;</span>,newCount,newNum);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;old:&#x27;</span>,oldCount,oldNum);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>ä¾¦å¬å¤æ‚çš„åµŒå¥—å¯¹è±¡</p>
<p>æˆ‘ä»¬å®é™…å¼€å‘ä¸­ï¼Œå¤æ‚æ•°æ®éšå¤„å¯è§ï¼Œ æ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">person</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;å¼ ä¸‰&#x27;</span>,</span><br><span class="line">    <span class="attr">fav</span>: [<span class="string">&#x27;å¸…å“¥&#x27;</span>,<span class="string">&#x27;ç¾å¥³&#x27;</span>,<span class="string">&#x27;éŸ³ä¹&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> state.<span class="property">person</span>,</span><br><span class="line">  <span class="function">(<span class="params">newType, oldType</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ–°å€¼:&quot;</span>, newType, <span class="string">&quot;è€å€¼:&quot;</span>, oldType);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;, <span class="comment">// ç«‹å³ç›‘å¬</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>å¦‚æœä¸ä½¿ç”¨ç¬¬ä¸‰ä¸ªå‚æ•°<code>deep:true</code>ï¼Œ æ˜¯æ— æ³•ç›‘å¬åˆ°æ•°æ®å˜åŒ–çš„ã€‚ å‰é¢æˆ‘ä»¬æåˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œwatch æ˜¯<strong>æƒ°æ€§çš„</strong>ï¼Œé‚£ä»€ä¹ˆæƒ…å†µä¸‹ä¸æ˜¯æƒ°æ€§çš„ï¼Œ å¯ä»¥ç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°å‘¢ï¼Ÿå…¶å®ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œ ç»™ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­è®¾ç½®<code>immediate: true</code>å³å¯</p>
<p>åŒæ—¶ï¼Œwatchå’ŒwatchEffectåœ¨åœæ­¢ä¾¦å¬ï¼Œæ¸…é™¤å‰¯ä½œç”¨ï¼ˆç›¸åº”åœ°onInvalidateä¼šä½œä¸ºå›è°ƒçš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ï¼‰ç­‰æ–¹é¢è¡Œä¸ºä¸€è‡´ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;keyword&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; ref, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> keyword = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> <span class="title function_">asyncPrint</span> = val =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;user input: &#x27;</span>, val)</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">watch</span>(</span></span><br><span class="line"><span class="language-javascript">      keyword,</span></span><br><span class="line"><span class="language-javascript">      <span class="function">(<span class="params">newVal, oldVal, onCleanUp</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> timer = <span class="title function_">asyncPrint</span>(keyword)</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onCleanUp</span>(<span class="function">() =&gt;</span> <span class="built_in">clearTimeout</span>(timer))</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">lazy</span>: <span class="literal">true</span> <span class="comment">// é»˜è®¤falseï¼Œå³åˆå§‹ç›‘å¬å›è°ƒå‡½æ•°æ‰§è¡Œäº†</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    )</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      keyword</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ç”Ÿå‘½å‘¨æœŸé’©å­"><a href="#ç”Ÿå‘½å‘¨æœŸé’©å­" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸé’©å­"></a>ç”Ÿå‘½å‘¨æœŸé’©å­</h2><p>ä¸2.xç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸç›¸å¯¹åº”çš„ç»„åˆå¼API</p>
<table>
<thead>
<tr>
<th>é€‰é¡¹å¼ API</th>
<th>Hook inside <code>setup</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>beforeCreate</code></td>
<td>Not needed*</td>
</tr>
<tr>
<td><code>created</code></td>
<td>Not needed*</td>
</tr>
<tr>
<td><code>beforeMount</code></td>
<td><code>onBeforeMount</code></td>
</tr>
<tr>
<td><code>mounted</code></td>
<td><code>onMounted</code></td>
</tr>
<tr>
<td><code>beforeUpdate</code></td>
<td><code>onBeforeUpdate</code></td>
</tr>
<tr>
<td><code>updated</code></td>
<td><code>onUpdated</code></td>
</tr>
<tr>
<td><code>beforeUnmount</code></td>
<td><code>onBeforeUnmount</code></td>
</tr>
<tr>
<td><code>unmounted</code></td>
<td><code>onUnmounted</code></td>
</tr>
<tr>
<td><code>errorCaptured</code></td>
<td><code>onErrorCaptured</code></td>
</tr>
<tr>
<td><code>renderTracked</code></td>
<td><code>onRenderTracked</code></td>
</tr>
<tr>
<td><code>renderTriggered</code></td>
<td><code>onRenderTriggered</code></td>
</tr>
<tr>
<td><code>activated</code></td>
<td><code>onActivated</code></td>
</tr>
<tr>
<td><code>deactivated</code></td>
<td><code>onDeactivated</code></td>
</tr>
</tbody></table>
<p>æ–°å»ºæµ‹è¯•ç»„ä»¶<code>/components/Test.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;test&quot;&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123;a&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;handleClick&quot;&gt;æ›´æ”¹&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  ref,</span><br><span class="line">  onMounted,</span><br><span class="line">  onBeforeMount,</span><br><span class="line">  onBeforeUpdate,</span><br><span class="line">  onUpdated,</span><br><span class="line">  onBeforeUnmount,</span><br><span class="line">  onUnmounted,</span><br><span class="line">&#125; from &quot;vue&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  // åˆå§‹åŒ–æ•°æ®é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸï¼Œä»‹äºbeforeCreateå’Œcreatedä¹‹é—´</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const a = ref(0);</span><br><span class="line">    console.log(&quot;ğŸ‘Œ&quot;);</span><br><span class="line">    function handleClick() &#123;</span><br><span class="line">      a.value += 1;</span><br><span class="line">    &#125;</span><br><span class="line">    onBeforeMount(() =&gt; &#123;</span><br><span class="line">      console.log(&quot;ç»„ä»¶æŒ‚è½½ä¹‹å‰&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      console.log(&quot;DOMæŒ‚è½½å®Œæˆ&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    onBeforeUpdate(() =&gt; &#123;</span><br><span class="line">      console.log(&quot;DOMæ›´æ–°ä¹‹å‰&quot;, document.getElementById(&quot;test&quot;).innerHTML);</span><br><span class="line">    &#125;);</span><br><span class="line">    onUpdated(() =&gt; &#123;</span><br><span class="line">      console.log(&quot;DOMæ›´æ–°å®Œæˆ&quot;, document.getElementById(&quot;test&quot;).innerHTML);</span><br><span class="line">    &#125;);</span><br><span class="line">    onBeforeUnmount(() =&gt; &#123;</span><br><span class="line">      console.log(&quot;å®ä¾‹å¸è½½ä¹‹å‰&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">      console.log(&quot;å®ä¾‹å¸è½½ä¹‹å&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    return &#123; a, handleClick &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§å®˜æ–¹ä¸Šè¯´çš„é‚£æ ·ï¼Œä½ ä¸éœ€è¦ç«‹é©¬å¼„æ˜ç™½æ‰€æœ‰çš„ä¸œè¥¿ï¼Œä¸è¿‡éšç€ä½ çš„ä¸æ–­å­¦ä¹ å’Œä½¿ç”¨ï¼Œå®ƒçš„å‚è€ƒä»·å€¼ä¼šè¶Šæ¥è¶Šé«˜ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/33454514/166104036-60b9ff1b-e0bc-4537-bb5e-bc92011e84a7.png" alt="image"></p>
<h2 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h2><p><code>provide</code>å’Œ<code>inject</code>æä¾›ä¾èµ–æ³¨å…¥ï¼ŒåŠŸèƒ½ç±»ä¼¼2.xçš„<code>provide/inject</code>ã€‚ä¸¤è€…éƒ½åªèƒ½åœ¨å½“å‰ç»„ä»¶çš„<code>setup()</code>ä¸­è°ƒç”¨</p>
<p><code>App.vue</code>provideæ•°æ®æº</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Article</span>&gt;</span><span class="tag">&lt;/<span class="name">Article</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  ref,</span></span><br><span class="line"><span class="language-javascript">  provide</span></span><br><span class="line"><span class="language-javascript">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Article</span> <span class="keyword">from</span> <span class="string">&quot;./components/Article&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> articleList = <span class="title function_">ref</span>([</span></span><br><span class="line"><span class="language-javascript">      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&quot;Vue3.0å­¦ä¹ &quot;</span>, <span class="attr">author</span>: <span class="string">&quot;å°é©¬å“¥&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&quot;componsition api&quot;</span>, <span class="attr">author</span>: <span class="string">&quot;å°¤å¤§å¤§&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">      &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">title</span>: <span class="string">&quot;Vue-routeræœ€æ–°&quot;</span>, <span class="attr">author</span>: <span class="string">&quot;vueå®˜æ–¹&quot;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">    ]);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/* </span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">      provide å‡½æ•°å…è®¸ä½ é€šè¿‡ä¸¤ä¸ªå‚æ•°å®šä¹‰ propertyï¼š</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">      property çš„ name (&lt;String&gt; ç±»å‹)</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">      property çš„ value</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">    */</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">provide</span>(<span class="string">&quot;list&quot;</span>,articleList);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      articleList</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Article</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>Article.vue</code>æ³¨å…¥æ•°æ®</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;articleList[0].title&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> articleList = <span class="title function_">inject</span>(<span class="string">&#x27;list&#x27;</span>,[]);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;articleList&#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="æ¨¡æ¿å¼•ç”¨refs"><a href="#æ¨¡æ¿å¼•ç”¨refs" class="headerlink" title="æ¨¡æ¿å¼•ç”¨refs"></a>æ¨¡æ¿å¼•ç”¨refs</h2><p>å½“ä½¿ç”¨ç»„åˆå¼APIæ—¶ï¼Œ<code>reactive refs</code>å’Œ<code>template refs</code>çš„æ¦‚å¿µå·²ç»æ˜¯ç»Ÿä¸€äº†ã€‚ä¸ºäº†è·å¾—å¯¹æ¨¡æ¿å†…å…ƒç´ æˆ–è€…ç»„ä»¶å®ä¾‹çš„å¼•ç”¨ï¼Œå¯ä»¥ç›´æ¥åœ¨<code>setup()</code>ä¸­å£°æ˜ä¸€ä¸ªrefå¹¶è¿”å›å®ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div ref=&#x27;wrap&#x27;&gt;hello vue3.0&lt;/div&gt;</span><br><span class="line">    &lt;Article ref=&#x27;articleComp&#x27;&gt;&lt;/Article&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  ref,</span><br><span class="line">  onMounted,</span><br><span class="line">  provide</span><br><span class="line">&#125; from &quot;vue&quot;;</span><br><span class="line">import Article from &quot;./components/Article&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const isShow = ref(true);</span><br><span class="line">    const wrap = ref(null);</span><br><span class="line">    const articleComp = ref(null);</span><br><span class="line"></span><br><span class="line">    const articleList = ref([</span><br><span class="line">      &#123; id: 1, title: &quot;Vue3.0å­¦ä¹ &quot;, author: &quot;å°é©¬å“¥&quot; &#125;,</span><br><span class="line">      &#123; id: 2, title: &quot;componsition api&quot;, author: &quot;å°¤å¤§å¤§&quot; &#125;,</span><br><span class="line">      &#123; id: 3, title: &quot;Vue-routeræœ€æ–°&quot;, author: &quot;vueå®˜æ–¹&quot; &#125;</span><br><span class="line">    ]);</span><br><span class="line">    /* </span><br><span class="line">      provide å‡½æ•°å…è®¸ä½ é€šè¿‡ä¸¤ä¸ªå‚æ•°å®šä¹‰ propertyï¼š</span><br><span class="line">      property çš„ name (&lt;String&gt; ç±»å‹)</span><br><span class="line">      property çš„ value</span><br><span class="line">    */</span><br><span class="line">    provide(&quot;list&quot;, articleList);</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      console.log(wrap.value); //è·å–divå…ƒç´ </span><br><span class="line">      console.log(articleComp.value); //è·å–çš„articleç»„ä»¶å®ä¾‹å¯¹è±¡</span><br><span class="line">      </span><br><span class="line">    &#125;);</span><br><span class="line">    return &#123;</span><br><span class="line">      articleList,</span><br><span class="line">      wrap,</span><br><span class="line">      articleComp</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line"></span><br><span class="line">    Article</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="ç»„ä»¶é€šä¿¡"><a href="#ç»„ä»¶é€šä¿¡" class="headerlink" title="ç»„ä»¶é€šä¿¡"></a>ç»„ä»¶é€šä¿¡</h2><ul>
<li>props</li>
<li>$emit</li>
<li>expose /ref</li>
<li>attrs</li>
<li>v-model</li>
<li>provide/inject</li>
<li>vuex</li>
<li>mitt</li>
</ul>
<h3 id="props"><a href="#props" class="headerlink" title="props"></a>props</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Parent.vue </span><br><span class="line">&lt;child :msg1=&quot;msg1&quot;</span><br><span class="line">       :msg2=&quot;msg2&quot;&gt;</span><br><span class="line">&lt;/child&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import child from &quot;./child.vue&quot;</span><br><span class="line">import &#123; ref, reactive &#125; from &quot;vue&quot;</span><br><span class="line">export default &#123;</span><br><span class="line">    setup()&#123;</span><br><span class="line">        const msg1 = ref(&quot;è¿™æ˜¯ä¼ çº§å­ç»„ä»¶çš„ä¿¡æ¯1&quot;);</span><br><span class="line">        const msg2 = reactive([&quot;è¿™æ˜¯ä¼ çº§å­ç»„ä»¶çš„ä¿¡æ¯2&quot;]);</span><br><span class="line">        return &#123;</span><br><span class="line">            msg1,</span><br><span class="line">            msg2</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">// Child.vue </span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: [&quot;msg1&quot;, &quot;msg2&quot;],// å¦‚æœè¿™è¡Œä¸å†™ï¼Œä¸‹é¢å°±æ¥æ”¶ä¸åˆ°</span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    console.log(props) // &#123; msg1:&quot;è¿™æ˜¯ä¼ ç»™å­ç»„ä»¶çš„ä¿¡æ¯1&quot;, msg2:&quot;è¿™æ˜¯ä¼ ç»™å­ç»„ä»¶çš„ä¿¡æ¯2&quot; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="emit"><a href="#emit" class="headerlink" title="$emit"></a>$emit</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Child.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;$emit(&#x27;myClick&#x27;,123)&quot;&gt;æŒ‰é’®&lt;/buttom&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt; </span><br><span class="line"> export default &#123;</span><br><span class="line">   emits:[&#x27;myClick&#x27;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">// Parent.vue </span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;child @myClick=&quot;onMyClick&quot;&gt;&lt;/child&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import child from &quot;./child.vue&quot;</span><br><span class="line"></span><br><span class="line">const onMyClick = (msg) =&gt; &#123;</span><br><span class="line">  console.log(msg)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>vue3</category>
      </categories>
      <tags>
        <tag>vue3</tag>
      </tags>
  </entry>
  <entry>
    <title>DIVå…ƒç´ ä¸­çš„æ–‡æœ¬å±…ä¸­</title>
    <url>/2022/02/24/DIV%E5%85%83%E7%B4%A0%E4%B8%AD%E7%9A%84%E6%96%87%E6%9C%AC%E5%B1%85%E4%B8%AD/</url>
    <content><![CDATA[<h1 id="DIVå…ƒç´ ä¸­çš„æ–‡æœ¬å±…ä¸­"><a href="#DIVå…ƒç´ ä¸­çš„æ–‡æœ¬å±…ä¸­" class="headerlink" title="DIVå…ƒç´ ä¸­çš„æ–‡æœ¬å±…ä¸­"></a>DIVå…ƒç´ ä¸­çš„æ–‡æœ¬å±…ä¸­</h1><p>åœ¨æ ·å¼å¸ƒå±€ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç¢°åˆ°éœ€è¦å°†å…ƒç´ å±…ä¸­ã€‚</p>
<p>é€šè¿‡csså®ç°å…ƒç´ çš„æ°´å¹³å±…ä¸­è¾ƒä¸ºç®€å•ï¼šå¯¹æ–‡æœ¬ï¼Œåªéœ€è¦å¯¹å…¶çˆ¶çº§å…ƒç´ è®¾ç½®<code>text-align: center;</code>ï¼Œè€Œå¯¹divç­‰å—çº§å…ƒç´ ï¼Œåªéœ€è¦è®¾ç½®å…¶ left å’Œ right çš„ <code>margin: auto;</code>ã€‚</p>
<p>è¦å®ç°å…ƒç´ çš„å‚ç›´å±…ä¸­ï¼Œå¾ˆå®¹æ˜“ä¾¿ä¼šæƒ³åˆ°<code>vertical-align</code>å±æ€§ï¼Œä½†æ˜¯è¯¥å±æ€§åªå¯¹æ‹¥æœ‰<code>valign</code>ç‰¹æ€§çš„å…ƒç´ æ‰ç”Ÿæ•ˆï¼Œä¾‹å¦‚è¡¨æ ¼å…ƒç´ ä¸­çš„<code>&lt;td&gt;</code>ã€<code>&lt;th&gt;</code>ã€<code>&lt;caption&gt;</code>ç­‰ã€‚è€Œåƒ<code>&lt;div&gt;</code>ã€<code>&lt;span&gt;</code>è¿™æ ·çš„å…ƒç´ æ˜¯æ²¡æœ‰<code>valign</code>ç‰¹æ€§çš„ï¼Œä½¿ç”¨è¯¥å±æ€§å¯¹è¿™äº›å…ƒç´ å¹¶ä¸èµ·ä½œç”¨ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡åˆ«çš„æ–¹æ³•å»å®ç°å…ƒç´ çš„å‚ç›´å±…ä¸­ï¼Œæˆ‘æ€»ç»“äº†å‡ ç§äº†å¸¸ç”¨å‚ç›´å±…ä¸­æ–¹æ³•åœ¨ä¸‹é¢ã€‚</p>
<h1 id="å•è¡Œæ–‡æœ¬å‚ç›´å±…ä¸­"><a href="#å•è¡Œæ–‡æœ¬å‚ç›´å±…ä¸­" class="headerlink" title="å•è¡Œæ–‡æœ¬å‚ç›´å±…ä¸­"></a>å•è¡Œæ–‡æœ¬å‚ç›´å±…ä¸­</h1><p>å¯¹äºå•è¡Œæ–‡æœ¬ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ–‡æœ¬è¡Œé«˜(line-height)å’Œæ‰€åœ¨åŒºåŸŸé«˜åº¦(height)è®¾ä¸ºä¸€è‡´å³å¯ï¼š</p>
   <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;div1&quot;</span>&gt;</span></span><br><span class="line">	è¿™æ˜¯å•è¡Œæ–‡æœ¬å‚ç›´å±…ä¸­</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.div1</span>&#123;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">margin</span>: <span class="number">50px</span> auto;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">border</span>: <span class="number">1px</span> solid red;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">line-height</span>: <span class="number">100px</span>; <span class="comment">/*è®¾ç½®line-heightä¸çˆ¶çº§å…ƒç´ çš„heightç›¸ç­‰*/</span></span></span><br><span class="line"><span class="language-css">	<span class="attribute">text-align</span>: center; <span class="comment">/*è®¾ç½®æ–‡æœ¬æ°´å¹³å±…ä¸­*/</span></span></span><br><span class="line"><span class="language-css">	<span class="attribute">overflow</span>: hidden; <span class="comment">/*é˜²æ­¢å†…å®¹è¶…å‡ºå®¹å™¨æˆ–è€…äº§ç”Ÿè‡ªåŠ¨æ¢è¡Œ*/</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­"><a href="#å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­" class="headerlink" title="å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­"></a>å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­</h1><p>å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>æ˜¯çˆ¶çº§å…ƒç´ é«˜åº¦ä¸å›ºå®šï¼Œéšç€å†…å®¹å˜åŒ–</li>
<li>çˆ¶çº§å…ƒç´ é«˜åº¦å›ºå®š</li>
</ol>
<h2 id="çˆ¶çº§å…ƒç´ é«˜åº¦ä¸å›ºå®š"><a href="#çˆ¶çº§å…ƒç´ é«˜åº¦ä¸å›ºå®š" class="headerlink" title="çˆ¶çº§å…ƒç´ é«˜åº¦ä¸å›ºå®š"></a>çˆ¶çº§å…ƒç´ é«˜åº¦ä¸å›ºå®š</h2><p>çˆ¶çº§é«˜åº¦ä¸å›ºå®šçš„æ—¶ï¼Œé«˜åº¦åªèƒ½é€šè¿‡å†…éƒ¨æ–‡æœ¬æ¥æ’‘å¼€ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®å†…å¡«å……ï¼ˆpaddingï¼‰çš„å€¼æ¥ä½¿æ–‡æœ¬çœ‹èµ·æ¥å‚ç›´å±…ä¸­ï¼Œåªéœ€è®¾ç½®<code>padding-top</code>å’Œ<code>padding-bottom</code>çš„å€¼ç›¸ç­‰ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;div1&quot;</span>&gt;</span></span><br><span class="line">	è¿™æ˜¯å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ï¼Œ</span><br><span class="line">	è¿™æ˜¯å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ï¼Œ</span><br><span class="line">	è¿™æ˜¯å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ï¼Œ</span><br><span class="line">	è¿™æ˜¯å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ã€‚</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.div1</span>&#123;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">margin</span>: <span class="number">50px</span> auto;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">border</span>: <span class="number">1px</span> solid red;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">text-align</span>: center; <span class="comment">/*è®¾ç½®æ–‡æœ¬æ°´å¹³å±…ä¸­*/</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">50px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="çˆ¶çº§å…ƒç´ é«˜åº¦å›ºå®š"><a href="#çˆ¶çº§å…ƒç´ é«˜åº¦å›ºå®š" class="headerlink" title="çˆ¶çº§å…ƒç´ é«˜åº¦å›ºå®š"></a>çˆ¶çº§å…ƒç´ é«˜åº¦å›ºå®š</h2><p>åœ¨æœ¬æ–‡ä¸€å¼€å§‹å°±æåˆ°äº†<code>vertical-align</code>å±æ€§åªå¯¹æ‹¥æœ‰ valign ç‰¹æ€§çš„å…ƒç´ æ‰ç”Ÿæ•ˆï¼Œæ‰€ä»¥å¯ä»¥ç»“åˆ<code>display: table;</code>ï¼Œä½¿å¾— div å…ƒç´ æ¨¡æ‹Ÿ table çš„å±æ€§ã€‚</p>
<p>å…·ä½“æ“ä½œä¸ºï¼šè®¾ç½®çˆ¶çº§divä¸º<code>display: table;</code>ï¼Œæ·»åŠ ä¸€ä¸ªå­ div ç”¨äºæ˜¾ç¤ºæ–‡æœ¬å†…å®¹ï¼Œå¹¶ç»™è¯¥å­ div å…ƒç´ è®¾ç½®<code>display: table-cell;</code>å’Œ<code>vertical-align: middle;</code>å±æ€§ã€‚</p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">        è¿™æ˜¯å›ºå®šé«˜åº¦å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ï¼Œ</span><br><span class="line">        è¿™æ˜¯å›ºå®šé«˜åº¦å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ï¼Œ</span><br><span class="line">        è¿™æ˜¯å›ºå®šé«˜åº¦å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ï¼Œ</span><br><span class="line">		è¿™æ˜¯å›ºå®šé«˜åº¦å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ã€‚</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-id">#outer</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">50px</span> auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span></span><br><span class="line"><span class="language-css"> 	<span class="attribute">display</span>: table;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-id">#middle</span>&#123; </span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>:table-cell; </span></span><br><span class="line"><span class="language-css">    <span class="attribute">vertical-align</span>:middle;  </span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center; <span class="comment">/*è®¾ç½®æ–‡æœ¬æ°´å¹³å±…ä¸­*/</span>  </span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>:<span class="number">100%</span>;   </span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="å­divå‚ç›´å±…ä¸­"><a href="#å­divå‚ç›´å±…ä¸­" class="headerlink" title="å­divå‚ç›´å±…ä¸­"></a>å­divå‚ç›´å±…ä¸­</h1><h2 id="1ã€æ ¹æ®å­divå…·ä½“å¤§å°è®¾ç½®åç§»"><a href="#1ã€æ ¹æ®å­divå…·ä½“å¤§å°è®¾ç½®åç§»" class="headerlink" title="1ã€æ ¹æ®å­divå…·ä½“å¤§å°è®¾ç½®åç§»"></a>1ã€æ ¹æ®å­divå…·ä½“å¤§å°è®¾ç½®åç§»</h2><p>å¦‚æœå­divå›ºå®šå¤§å°ï¼Œè®¾å®šæ°´å¹³å’Œå‚ç›´åç§»çˆ¶å…ƒç´ çš„50%ï¼Œå†æ ¹æ®å®é™…é•¿åº¦å°†å­å…ƒç´ å‘ä¸Šå’Œå‘å·¦æŒªå›ä¸€åŠå¤§å°</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">		å­div(å›ºå®šå¤§å°)å‚ç›´å±…ä¸­</span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span>          </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.outer</span>&#123;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">background-color</span>: <span class="number">#13CDF4</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.middle</span>&#123; </span></span><br><span class="line"><span class="language-css">	<span class="attribute">background-color</span>: <span class="number">#E41627</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">left</span>: <span class="number">50%</span>; </span></span><br><span class="line"><span class="language-css">    <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-left</span>: -<span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-top</span>: -<span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2ã€translate"><a href="#2ã€translate" class="headerlink" title="2ã€translate"></a>2ã€translate</h2><p>é’ˆå¯¹ç¬¬ä¸€ç§æ–¹æ³•ä¸­æ°´å¹³å’Œå‚ç›´åç§»çˆ¶å…ƒç´ çš„50%åï¼Œä¸è®¾ç½® margin å€¼ï¼Œè€Œæ˜¯åˆ©ç”¨é™¤css3ä¸­çš„ transform å±æ€§è®¾ç½® translate çš„å€¼ï¼Œcssä»£ç éƒ¨åˆ†æ”¹æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">middle&#123; </span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#E41627</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">left</span>: <span class="number">50%</span>; </span></span><br><span class="line"><span class="language-css">    <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>) <span class="built_in">translateY</span>(-<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">	-webkit-<span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>) <span class="built_in">translateY</span>(-<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹æ³•éœ€è¦æ³¨æ„transformæ˜¯css3ä¸­çš„å±æ€§ï¼Œä½¿ç”¨æ—¶æ³¨æ„æµè§ˆå™¨çš„å…¼å®¹æ€§ï¼ŒIE9ä¹‹å‰çš„ç‰ˆæœ¬ä¸æ”¯æŒã€‚</p>
<h2 id="3ã€absolute"><a href="#3ã€absolute" class="headerlink" title="3ã€absolute"></a>3ã€absolute</h2><p>åˆ©ç”¨ç»å¯¹å®šä½å®ç°å­ div å¤§å°ä¸å›ºå®šå‚ç›´å±…ä¸­ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">		ç»å¯¹å¸ƒå±€absoluteå‚ç›´å±…ä¸­</span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span>          </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.outer</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#13CDF4</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.middle</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#E41627</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100px</span>;   //å­<span class="selector-tag">div</span>å¤§å°å¯éšæ„è®¾ç½®</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">top</span>: <span class="number">0</span>;<span class="attribute">left</span>: <span class="number">0</span>;<span class="attribute">right</span>: <span class="number">0</span>;<span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•ä¸å…¼å®¹IE7ã€IE6</p>
<h2 id="4ã€vertical-align"><a href="#4ã€vertical-align" class="headerlink" title="4ã€vertical-align"></a>4ã€vertical-align</h2><p>åˆ©ç”¨<code>vertical-align</code>å±æ€§å®ç°å­divå¤§å°ä¸å›ºå®šå‚ç›´å±…ä¸­ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">    	åˆ©ç”¨vertical-alignå±æ€§å®ç°å­divå¤§å°ä¸å›ºå®šå‚ç›´å±…ä¸­</span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span>          </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.outer</span>&#123;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">background-color</span>: <span class="number">#13CDF4</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: table-cell; </span></span><br><span class="line"><span class="language-css">    <span class="attribute">vertical-align</span>: middle;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.middle</span>&#123; </span></span><br><span class="line"><span class="language-css">	<span class="attribute">background-color</span>: <span class="number">#E41627</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹æ³•æ˜¯å°†divè½¬å˜æˆtable-cellæ˜¾ç¤ºï¼Œç„¶åé€šè¿‡<code>vertical-align: middle;</code>å†è®¾ç½®å…¶å­å…ƒç´ å‚ç›´å±…ä¸­ï¼Œè¿™ç§æ–¹æ³•å’Œä¸Šé¢è®¾ç½®çˆ¶çº§å…ƒç´ é«˜åº¦å›ºå®šæ—¶å¤šè¡Œæ–‡æœ¬å±…ä¸­çš„æ–¹æ³•ä¸€æ ·ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•ä¹Ÿä¸èƒ½å…¼å®¹IE7ã€IE6ã€‚</p>
<h2 id="5ã€åˆ©ç”¨display-flex"><a href="#5ã€åˆ©ç”¨display-flex" class="headerlink" title="5ã€åˆ©ç”¨display: flex"></a>5ã€åˆ©ç”¨display: flex</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">        åˆ©ç”¨display: flexå®ç°å­divå¤§å°ä¸å›ºå®šå‚ç›´å±…ä¸­</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>          </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.outer</span>&#123;</span></span><br><span class="line"><span class="language-css">	<span class="attribute">background-color</span>: <span class="number">#13CDF4</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;<span class="comment">/*å®ç°æ°´å¹³å±…ä¸­*/</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>:center; <span class="comment">/*å®ç°å‚ç›´å±…ä¸­*/</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.middle</span>&#123; </span></span><br><span class="line"><span class="language-css">	<span class="attribute">background-color</span>: <span class="number">#E41627</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>è¿™ç§æ–¹æ³•åªéœ€è¦åœ¨çˆ¶çº§divä¸­åŠ ä¸Šè¿™ä¸‰å¥è¯å°±è¡Œï¼Œä½†æ˜¯åœ¨IEä¸­å…¼å®¹æ€§ä¸å¥½ï¼ŒIE9åŠä»¥ä¸‹IEæµè§ˆå™¨ç‰ˆæœ¬éƒ½ä¸æ”¯æŒã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸Šæ˜¯ç¬”è€…æ€»ç»“çš„ä¸€äº›å¸¸ç”¨åˆ°çš„å‚ç›´å±…ä¸­çš„å¸ƒå±€æ–¹æ³•ï¼Œè¯»è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©åˆé€‚çš„å¸ƒå±€æ–¹å¼ã€‚</p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>Flex å¸ƒå±€</title>
    <url>/2022/04/30/Flex%20%E5%B8%83%E5%B1%80/</url>
    <content><![CDATA[<h1 id="Flex-å¸ƒå±€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Flex-å¸ƒå±€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Flex å¸ƒå±€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Flex å¸ƒå±€æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>Flex æ˜¯ Flexible Box çš„ç¼©å†™ï¼Œæ„ä¸ºâ€å¼¹æ€§å¸ƒå±€â€ï¼Œç”¨æ¥ä¸ºç›’çŠ¶æ¨¡å‹æä¾›æœ€å¤§çš„çµæ´»æ€§ã€‚</p>
<p>ä»»ä½•ä¸€ä¸ªå®¹å™¨éƒ½å¯ä»¥æŒ‡å®šä¸º Flex å¸ƒå±€ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>è¡Œå†…å…ƒç´ ä¹Ÿå¯ä»¥ä½¿ç”¨ Flex å¸ƒå±€ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Webkit å†…æ ¸çš„æµè§ˆå™¨ï¼Œå¿…é¡»åŠ ä¸Š<code>-webkit</code>å‰ç¼€ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex; <span class="comment">/* Safari */</span></span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æ³¨æ„ï¼Œè®¾ä¸º Flex å¸ƒå±€ä»¥åï¼Œå­å…ƒç´ çš„<code>float</code>ã€<code>clear</code>å’Œ<code>vertical-align</code>å±æ€§å°†å¤±æ•ˆã€‚</p>
<h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><p>é‡‡ç”¨ Flex å¸ƒå±€çš„å…ƒç´ ï¼Œç§°ä¸º Flex å®¹å™¨ï¼ˆflex containerï¼‰ï¼Œç®€ç§°â€å®¹å™¨â€ã€‚å®ƒçš„æ‰€æœ‰å­å…ƒç´ è‡ªåŠ¨æˆä¸ºå®¹å™¨æˆå‘˜ï¼Œç§°ä¸º Flex é¡¹ç›®ï¼ˆflex itemï¼‰ï¼Œç®€ç§°â€é¡¹ç›®â€ã€‚</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071004.png" alt="img"></p>
<p>å®¹å™¨é»˜è®¤å­˜åœ¨ä¸¤æ ¹è½´ï¼šæ°´å¹³çš„ä¸»è½´ï¼ˆmain axisï¼‰å’Œå‚ç›´çš„äº¤å‰è½´ï¼ˆcross axisï¼‰ã€‚ä¸»è½´çš„å¼€å§‹ä½ç½®ï¼ˆä¸è¾¹æ¡†çš„äº¤å‰ç‚¹ï¼‰å«åš<code>main start</code>ï¼Œç»“æŸä½ç½®å«åš<code>main end</code>ï¼›äº¤å‰è½´çš„å¼€å§‹ä½ç½®å«åš<code>cross start</code>ï¼Œç»“æŸä½ç½®å«åš<code>cross end</code>ã€‚</p>
<p>é¡¹ç›®é»˜è®¤æ²¿ä¸»è½´æ’åˆ—ã€‚å•ä¸ªé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´å«åš<code>main size</code>ï¼Œå æ®çš„äº¤å‰è½´ç©ºé—´å«åš<code>cross size</code>ã€‚</p>
<h1 id="å®¹å™¨çš„å±æ€§"><a href="#å®¹å™¨çš„å±æ€§" class="headerlink" title="å®¹å™¨çš„å±æ€§"></a>å®¹å™¨çš„å±æ€§</h1><p>ä»¥ä¸‹6ä¸ªå±æ€§è®¾ç½®åœ¨å®¹å™¨ä¸Šã€‚</p>
<blockquote>
<ul>
<li>flex-direction</li>
<li>flex-wrap</li>
<li>flex-flow</li>
<li>justify-content</li>
<li>align-items</li>
<li>align-content</li>
</ul>
</blockquote>
<h2 id="flex-directionå±æ€§"><a href="#flex-directionå±æ€§" class="headerlink" title="flex-directionå±æ€§"></a>flex-directionå±æ€§</h2><p><code>flex-direction</code>å±æ€§å†³å®šä¸»è½´çš„æ–¹å‘ï¼ˆå³é¡¹ç›®çš„æ’åˆ—æ–¹å‘ï¼‰ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row | row-reverse | column | column-reverse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071005.png" alt="img"></p>
<p>å®ƒå¯èƒ½æœ‰4ä¸ªå€¼ã€‚</p>
<blockquote>
<ul>
<li><code>row</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å·¦ç«¯ã€‚</li>
<li><code>row-reverse</code>ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å³ç«¯ã€‚</li>
<li><code>column</code>ï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸Šæ²¿ã€‚</li>
<li><code>column-reverse</code>ï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸‹æ²¿ã€‚</li>
</ul>
</blockquote>
<h2 id="flex-wrapå±æ€§"><a href="#flex-wrapå±æ€§" class="headerlink" title="flex-wrapå±æ€§"></a>flex-wrapå±æ€§</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®éƒ½æ’åœ¨ä¸€æ¡çº¿ï¼ˆåˆç§°â€è½´çº¿â€ï¼‰ä¸Šã€‚<code>flex-wrap</code>å±æ€§å®šä¹‰ï¼Œå¦‚æœä¸€æ¡è½´çº¿æ’ä¸ä¸‹ï¼Œå¦‚ä½•æ¢è¡Œã€‚</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071006.png" alt="img"></p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: nowrap | wrap | wrap-reverse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>å®ƒå¯èƒ½å–ä¸‰ä¸ªå€¼ã€‚</p>
<p>ï¼ˆ1ï¼‰<code>nowrap</code>ï¼ˆé»˜è®¤ï¼‰ï¼šä¸æ¢è¡Œã€‚</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071007.png" alt="img"></p>
<p>ï¼ˆ2ï¼‰<code>wrap</code>ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸Šæ–¹ã€‚</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071008.jpg" alt="img"></p>
<p>ï¼ˆ3ï¼‰<code>wrap-reverse</code>ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸‹æ–¹ã€‚</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071009.jpg" alt="img"></p>
<h2 id="flex-flow"><a href="#flex-flow" class="headerlink" title="flex-flow"></a>flex-flow</h2><p><code>flex-flow</code>å±æ€§æ˜¯<code>flex-direction</code>å±æ€§å’Œ<code>flex-wrap</code>å±æ€§çš„ç®€å†™å½¢å¼ï¼Œé»˜è®¤å€¼ä¸º<code>row nowrap</code>ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">flex-flow</span>: &lt;flex-direction&gt; || &lt;flex-wrap&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="justify-contentå±æ€§"><a href="#justify-contentå±æ€§" class="headerlink" title="justify-contentå±æ€§"></a>justify-contentå±æ€§</h2><p><code>justify-content</code>å±æ€§å®šä¹‰äº†é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start | flex-end | center | space-between | space-around;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071010.png" alt="img"></p>
<p>å®ƒå¯èƒ½å–5ä¸ªå€¼ï¼Œå…·ä½“å¯¹é½æ–¹å¼ä¸è½´çš„æ–¹å‘æœ‰å…³ã€‚ä¸‹é¢å‡è®¾ä¸»è½´ä¸ºä»å·¦åˆ°å³ã€‚</p>
<blockquote>
<ul>
<li><code>flex-start</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå·¦å¯¹é½</li>
<li><code>flex-end</code>ï¼šå³å¯¹é½</li>
<li><code>center</code>ï¼š å±…ä¸­</li>
<li><code>space-between</code>ï¼šä¸¤ç«¯å¯¹é½ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”éƒ½ç›¸ç­‰ã€‚</li>
<li><code>space-around</code>ï¼šæ¯ä¸ªé¡¹ç›®ä¸¤ä¾§çš„é—´éš”ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</li>
</ul>
</blockquote>
<h2 id="align-itemså±æ€§"><a href="#align-itemså±æ€§" class="headerlink" title="align-itemså±æ€§"></a>align-itemså±æ€§</h2><p><code>align-items</code>å±æ€§å®šä¹‰é¡¹ç›®åœ¨äº¤å‰è½´ä¸Šå¦‚ä½•å¯¹é½ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">align-items</span>: flex-start | flex-end | center | baseline | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071011.png" alt="img"></p>
<p>å®ƒå¯èƒ½å–5ä¸ªå€¼ã€‚å…·ä½“çš„å¯¹é½æ–¹å¼ä¸äº¤å‰è½´çš„æ–¹å‘æœ‰å…³ï¼Œä¸‹é¢å‡è®¾äº¤å‰è½´ä»ä¸Šåˆ°ä¸‹ã€‚</p>
<blockquote>
<ul>
<li><code>flex-start</code>ï¼šäº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</li>
<li><code>flex-end</code>ï¼šäº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</li>
<li><code>center</code>ï¼šäº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</li>
<li><code>baseline</code>: é¡¹ç›®çš„ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½ã€‚</li>
<li><code>stretch</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è®¾ä¸ºautoï¼Œå°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ã€‚</li>
</ul>
</blockquote>
<h2 id="align-contentå±æ€§"><a href="#align-contentå±æ€§" class="headerlink" title="align-contentå±æ€§"></a>align-contentå±æ€§</h2><p><code>align-content</code>å±æ€§å®šä¹‰äº†å¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼ã€‚å¦‚æœé¡¹ç›®åªæœ‰ä¸€æ ¹è½´çº¿ï¼Œè¯¥å±æ€§ä¸èµ·ä½œç”¨ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">align-content</span>: flex-start | flex-end | center | space-between | space-around | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071012.png" alt="img"></p>
<p>è¯¥å±æ€§å¯èƒ½å–6ä¸ªå€¼ã€‚</p>
<blockquote>
<ul>
<li><code>flex-start</code>ï¼šä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</li>
<li><code>flex-end</code>ï¼šä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</li>
<li><code>center</code>ï¼šä¸äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</li>
<li><code>space-between</code>ï¼šä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”å¹³å‡åˆ†å¸ƒã€‚</li>
<li><code>space-around</code>ï¼šæ¯æ ¹è½´çº¿ä¸¤ä¾§çš„é—´éš”éƒ½ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”æ¯”è½´çº¿ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</li>
<li><code>stretch</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šè½´çº¿å æ»¡æ•´ä¸ªäº¤å‰è½´ã€‚</li>
</ul>
</blockquote>
<h1 id="é¡¹ç›®çš„å±æ€§"><a href="#é¡¹ç›®çš„å±æ€§" class="headerlink" title="é¡¹ç›®çš„å±æ€§"></a>é¡¹ç›®çš„å±æ€§</h1><p>ä»¥ä¸‹6ä¸ªå±æ€§è®¾ç½®åœ¨é¡¹ç›®ä¸Šã€‚</p>
<blockquote>
<ul>
<li><code>order</code></li>
<li><code>flex-grow</code></li>
<li><code>flex-shrink</code></li>
<li><code>flex-basis</code></li>
<li><code>flex</code></li>
<li><code>align-self</code></li>
</ul>
</blockquote>
<h2 id="orderå±æ€§"><a href="#orderå±æ€§" class="headerlink" title="orderå±æ€§"></a>orderå±æ€§</h2><p><code>order</code>å±æ€§å®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ï¼Œé»˜è®¤ä¸º0ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">order</span>: &lt;integer&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071013.png" alt="img"></p>
<h2 id="flex-growå±æ€§"><a href="#flex-growå±æ€§" class="headerlink" title="flex-growå±æ€§"></a>flex-growå±æ€§</h2><p><code>flex-grow</code>å±æ€§å®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º<code>0</code>ï¼Œå³å¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œä¹Ÿä¸æ”¾å¤§ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">flex-grow</span>: &lt;number&gt;; <span class="comment">/* default 0 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071014.png" alt="img"></p>
<p>å¦‚æœæ‰€æœ‰é¡¹ç›®çš„<code>flex-grow</code>å±æ€§éƒ½ä¸º1ï¼Œåˆ™å®ƒä»¬å°†ç­‰åˆ†å‰©ä½™ç©ºé—´ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„<code>flex-grow</code>å±æ€§ä¸º2ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™å‰è€…å æ®çš„å‰©ä½™ç©ºé—´å°†æ¯”å…¶ä»–é¡¹å¤šä¸€å€ã€‚</p>
<h2 id="flex-shrinkå±æ€§"><a href="#flex-shrinkå±æ€§" class="headerlink" title="flex-shrinkå±æ€§"></a>flex-shrinkå±æ€§</h2><p><code>flex-shrink</code>å±æ€§å®šä¹‰äº†é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œè¯¥é¡¹ç›®å°†ç¼©å°ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: &lt;number&gt;; <span class="comment">/* default 1 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071015.jpg" alt="img"></p>
<p>å¦‚æœæ‰€æœ‰é¡¹ç›®çš„<code>flex-shrink</code>å±æ€§éƒ½ä¸º1ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œéƒ½å°†ç­‰æ¯”ä¾‹ç¼©å°ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„<code>flex-shrink</code>å±æ€§ä¸º0ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™ç©ºé—´ä¸è¶³æ—¶ï¼Œå‰è€…ä¸ç¼©å°ã€‚</p>
<p>è´Ÿå€¼å¯¹è¯¥å±æ€§æ— æ•ˆã€‚</p>
<h2 id="flex-basiså±æ€§"><a href="#flex-basiså±æ€§" class="headerlink" title="flex-basiså±æ€§"></a>flex-basiså±æ€§</h2><p><code>flex-basis</code>å±æ€§å®šä¹‰äº†åœ¨åˆ†é…å¤šä½™ç©ºé—´ä¹‹å‰ï¼Œé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´ï¼ˆmain sizeï¼‰ã€‚æµè§ˆå™¨æ ¹æ®è¿™ä¸ªå±æ€§ï¼Œè®¡ç®—ä¸»è½´æ˜¯å¦æœ‰å¤šä½™ç©ºé—´ã€‚å®ƒçš„é»˜è®¤å€¼ä¸º<code>auto</code>ï¼Œå³é¡¹ç›®çš„æœ¬æ¥å¤§å°ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">flex-basis</span>: &lt;length&gt; | auto; <span class="comment">/* default auto */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>å®ƒå¯ä»¥è®¾ä¸ºè·Ÿ<code>width</code>æˆ–<code>height</code>å±æ€§ä¸€æ ·çš„å€¼ï¼ˆæ¯”å¦‚350pxï¼‰ï¼Œåˆ™é¡¹ç›®å°†å æ®å›ºå®šç©ºé—´ã€‚</p>
<h2 id="flexå±æ€§"><a href="#flexå±æ€§" class="headerlink" title="flexå±æ€§"></a>flexå±æ€§</h2><p><code>flex</code>å±æ€§æ˜¯<code>flex-grow</code>, <code>flex-shrink</code> å’Œ <code>flex-basis</code>çš„ç®€å†™ï¼Œé»˜è®¤å€¼ä¸º<code>0 1 auto</code>ã€‚åä¸¤ä¸ªå±æ€§å¯é€‰ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: none | [ &lt;<span class="string">&#x27;flex-grow&#x27;</span>&gt; &lt;<span class="string">&#x27;flex-shrink&#x27;</span>&gt;? || &lt;<span class="string">&#x27;flex-basis&#x27;</span>&gt; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>è¯¥å±æ€§æœ‰ä¸¤ä¸ªå¿«æ·å€¼ï¼š<code>auto</code> (<code>1 1 auto</code>) å’Œ none (<code>0 0 auto</code>)ã€‚</p>
<p>å»ºè®®ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯å•ç‹¬å†™ä¸‰ä¸ªåˆ†ç¦»çš„å±æ€§ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šæ¨ç®—ç›¸å…³å€¼ã€‚</p>
<h2 id="align-selfå±æ€§"><a href="#align-selfå±æ€§" class="headerlink" title="align-selfå±æ€§"></a>align-selfå±æ€§</h2><p><code>align-self</code>å±æ€§å…è®¸å•ä¸ªé¡¹ç›®æœ‰ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›–<code>align-items</code>å±æ€§ã€‚é»˜è®¤å€¼ä¸º<code>auto</code>ï¼Œè¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„<code>align-items</code>å±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäº<code>stretch</code>ã€‚</p>
<blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">align-self</span>: auto | flex-start | flex-end | center | baseline | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015071016.png" alt="img"></p>
<p>è¯¥å±æ€§å¯èƒ½å–6ä¸ªå€¼ï¼Œé™¤äº†autoï¼Œå…¶ä»–éƒ½ä¸align-itemså±æ€§å®Œå…¨ä¸€è‡´ã€‚</p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript æ¨¡å—çš„å¾ªç¯åŠ è½½</title>
    <url>/2022/03/18/JavaScript%20%E6%A8%A1%E5%9D%97%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%8A%A0%E8%BD%BD/</url>
    <content><![CDATA[<h1 id="JavaScript-æ¨¡å—çš„å¾ªç¯åŠ è½½"><a href="#JavaScript-æ¨¡å—çš„å¾ªç¯åŠ è½½" class="headerlink" title="JavaScript æ¨¡å—çš„å¾ªç¯åŠ è½½"></a>JavaScript æ¨¡å—çš„å¾ªç¯åŠ è½½</h1><p>â€œå¾ªç¯åŠ è½½â€ï¼ˆcircular dependencyï¼‰æŒ‡çš„æ˜¯ï¼Œ<code>a</code>è„šæœ¬çš„æ‰§è¡Œä¾èµ–<code>b</code>è„šæœ¬ï¼Œè€Œ<code>b</code>è„šæœ¬çš„æ‰§è¡Œåˆä¾èµ–<code>a</code>è„šæœ¬ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;a&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>é€šå¸¸ï¼Œâ€å¾ªç¯åŠ è½½â€è¡¨ç¤ºå­˜åœ¨å¼ºè€¦åˆï¼Œå¦‚æœå¤„ç†ä¸å¥½ï¼Œè¿˜å¯èƒ½å¯¼è‡´é€’å½’åŠ è½½ï¼Œä½¿å¾—ç¨‹åºæ— æ³•æ‰§è¡Œï¼Œå› æ­¤åº”è¯¥é¿å…å‡ºç°ã€‚</p>
<p>ä½†æ˜¯å®é™…ä¸Šï¼Œè¿™æ˜¯å¾ˆéš¾é¿å…çš„ï¼Œå°¤å…¶æ˜¯ä¾èµ–å…³ç³»å¤æ‚çš„å¤§é¡¹ç›®ï¼Œå¾ˆå®¹æ˜“å‡ºç°<code>a</code>ä¾èµ–bï¼Œ<code>b</code>ä¾èµ–<code>c</code>ï¼Œ<code>c</code>åˆä¾èµ–<code>a</code>è¿™æ ·çš„æƒ…å†µã€‚è¿™æ„å‘³ç€ï¼Œæ¨¡å—åŠ è½½æœºåˆ¶å¿…é¡»è€ƒè™‘â€å¾ªç¯åŠ è½½â€çš„æƒ…å†µã€‚</p>
<p>æœ¬æ–‡ä»‹ç»JavaScriptè¯­è¨€å¦‚ä½•å¤„ç†â€å¾ªç¯åŠ è½½â€ã€‚ç›®å‰ï¼Œæœ€å¸¸è§çš„ä¸¤ç§æ¨¡å—æ ¼å¼CommonJSå’ŒES6ï¼Œå¤„ç†æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿”å›çš„ç»“æœä¹Ÿä¸ä¸€æ ·ã€‚</p>
<h1 id="CommonJSæ¨¡å—çš„åŠ è½½åŸç†"><a href="#CommonJSæ¨¡å—çš„åŠ è½½åŸç†" class="headerlink" title="CommonJSæ¨¡å—çš„åŠ è½½åŸç†"></a>CommonJSæ¨¡å—çš„åŠ è½½åŸç†</h1><p>ä»‹ç»ES6å¦‚ä½•å¤„ç†â€å¾ªç¯åŠ è½½â€ä¹‹å‰ï¼Œå…ˆä»‹ç»ç›®å‰æœ€æµè¡Œçš„CommonJSæ¨¡å—æ ¼å¼çš„åŠ è½½åŸç†ã€‚</p>
<p>CommonJSçš„ä¸€ä¸ªæ¨¡å—ï¼Œå°±æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ã€‚<code>require</code>å‘½ä»¤ç¬¬ä¸€æ¬¡åŠ è½½è¯¥è„šæœ¬ï¼Œå°±ä¼šæ‰§è¡Œæ•´ä¸ªè„šæœ¬ï¼Œç„¶ååœ¨å†…å­˜ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">  <span class="attr">exports</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">loaded</span>: <span class="literal">true</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œè¯¥å¯¹è±¡çš„<code>id</code>å±æ€§æ˜¯æ¨¡å—åï¼Œ<code>exports</code>å±æ€§æ˜¯æ¨¡å—è¾“å‡ºçš„å„ä¸ªæ¥å£ï¼Œ<code>loaded</code>å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥æ¨¡å—çš„è„šæœ¬æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚å…¶ä»–è¿˜æœ‰å¾ˆå¤šå±æ€§ï¼Œè¿™é‡Œéƒ½çœç•¥äº†ã€‚ï¼ˆè¯¦ç»†ä»‹ç»æƒ…å‚è§<a href="https://www.ruanyifeng.com/blog/2015/05/require.html">ã€Šrequire() æºç è§£è¯»ã€‹</a>ã€‚ï¼‰</p>
<p>ä»¥åéœ€è¦ç”¨åˆ°è¿™ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œå°±ä¼šåˆ°<code>exports</code>å±æ€§ä¸Šé¢å–å€¼ã€‚å³ä½¿å†æ¬¡æ‰§è¡Œ<code>require</code>å‘½ä»¤ï¼Œä¹Ÿä¸ä¼šå†æ¬¡æ‰§è¡Œè¯¥æ¨¡å—ï¼Œè€Œæ˜¯åˆ°ç¼“å­˜ä¹‹ä¸­å–å€¼ã€‚</p>
<h1 id="CommonJSæ¨¡å—çš„å¾ªç¯åŠ è½½"><a href="#CommonJSæ¨¡å—çš„å¾ªç¯åŠ è½½" class="headerlink" title="CommonJSæ¨¡å—çš„å¾ªç¯åŠ è½½"></a>CommonJSæ¨¡å—çš„å¾ªç¯åŠ è½½</h1><p>CommonJSæ¨¡å—çš„é‡è¦ç‰¹æ€§æ˜¯åŠ è½½æ—¶æ‰§è¡Œï¼Œå³è„šæœ¬ä»£ç åœ¨<code>require</code>çš„æ—¶å€™ï¼Œå°±ä¼šå…¨éƒ¨æ‰§è¡Œã€‚<strong>CommonJSçš„åšæ³•æ˜¯ï¼Œä¸€æ—¦å‡ºç°æŸä¸ªæ¨¡å—è¢«â€å¾ªç¯åŠ è½½â€ï¼Œå°±åªè¾“å‡ºå·²ç»æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œè¿˜æœªæ‰§è¡Œçš„éƒ¨åˆ†ä¸ä¼šè¾“å‡ºã€‚</strong></p>
<p>è®©æˆ‘ä»¬æ¥çœ‹ï¼Œ<a href="https://nodejs.org/api/modules.html#modules_cycles">å®˜æ–¹æ–‡æ¡£</a>é‡Œé¢çš„ä¾‹å­ã€‚è„šæœ¬æ–‡ä»¶<code>a.js</code>ä»£ç å¦‚ä¸‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b.js&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åœ¨ a.js ä¹‹ä¸­ï¼Œb.done = %j&#x27;</span>, b.<span class="property">done</span>);</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a.js æ‰§è¡Œå®Œæ¯•&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¹‹ä¸­ï¼Œ<code>a.js</code>è„šæœ¬å…ˆè¾“å‡ºä¸€ä¸ª<code>done</code>å˜é‡ï¼Œç„¶ååŠ è½½å¦ä¸€ä¸ªè„šæœ¬æ–‡ä»¶<code>b.js</code>ã€‚æ³¨æ„ï¼Œæ­¤æ—¶<code>a.js</code>ä»£ç å°±åœåœ¨è¿™é‡Œï¼Œç­‰å¾…<code>b.js</code>æ‰§è¡Œå®Œæ¯•ï¼Œå†å¾€ä¸‹æ‰§è¡Œã€‚</p>
<p>å†çœ‹<code>b.js</code>çš„ä»£ç ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a.js&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åœ¨ b.js ä¹‹ä¸­ï¼Œa.done = %j&#x27;</span>, a.<span class="property">done</span>);</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b.js æ‰§è¡Œå®Œæ¯•&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¹‹ä¸­ï¼Œ<code>b.js</code>æ‰§è¡Œåˆ°ç¬¬äºŒè¡Œï¼Œå°±ä¼šå»åŠ è½½<code>a.js</code>ï¼Œè¿™æ—¶ï¼Œå°±å‘ç”Ÿäº†â€å¾ªç¯åŠ è½½â€ã€‚ç³»ç»Ÿä¼šå»<code>a.js</code>æ¨¡å—å¯¹åº”å¯¹è±¡çš„<code>exports</code>å±æ€§å–å€¼ï¼Œå¯æ˜¯å› ä¸º<code>a.js</code>è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä»<code>exports</code>å±æ€§åªèƒ½å–å›å·²ç»æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æœ€åçš„å€¼ã€‚</p>
<p><code>a.js</code>å·²ç»æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œåªæœ‰ä¸€è¡Œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exports.done = false;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œå¯¹äº<code>b.js</code>æ¥è¯´ï¼Œå®ƒä»<code>a.js</code>åªè¾“å…¥ä¸€ä¸ªå˜é‡<code>done</code>ï¼Œå€¼ä¸º<code>false</code>ã€‚</p>
<p>ç„¶åï¼Œ<code>b.js</code>æ¥ç€å¾€ä¸‹æ‰§è¡Œï¼Œç­‰åˆ°å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œå†æŠŠæ‰§è¡Œæƒäº¤è¿˜ç»™<code>a.js</code>ã€‚äºæ˜¯ï¼Œ<code>a.js</code>æ¥ç€å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°æ‰§è¡Œå®Œæ¯•ã€‚æˆ‘ä»¬å†™ä¸€ä¸ªè„šæœ¬<code>main.js</code>ï¼ŒéªŒè¯è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a.js&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b.js&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åœ¨ main.js ä¹‹ä¸­, a.done=%j, b.done=%j&#x27;</span>, a.<span class="property">done</span>, b.<span class="property">done</span>);</span><br></pre></td></tr></table></figure>



<p>æ‰§è¡Œ<code>main.js</code>ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ node main.js</span><br><span class="line"></span><br><span class="line">åœ¨ b.js ä¹‹ä¸­ï¼Œa.done = <span class="literal">false</span></span><br><span class="line">b.js æ‰§è¡Œå®Œæ¯•</span><br><span class="line">åœ¨ a.js ä¹‹ä¸­ï¼Œb.done = <span class="literal">true</span></span><br><span class="line">a.js æ‰§è¡Œå®Œæ¯•</span><br><span class="line">åœ¨ main.js ä¹‹ä¸­, a.done=<span class="literal">true</span>, b.done=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç è¯æ˜äº†ä¸¤ä»¶äº‹ã€‚ä¸€æ˜¯ï¼Œåœ¨<code>b.js</code>ä¹‹ä¸­ï¼Œ<code>a.js</code>æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œåªæ‰§è¡Œäº†ç¬¬ä¸€è¡Œã€‚äºŒæ˜¯ï¼Œ<code>main.js</code>æ‰§è¡Œåˆ°ç¬¬äºŒè¡Œæ—¶ï¼Œä¸ä¼šå†æ¬¡æ‰§è¡Œ<code>b.js</code>ï¼Œè€Œæ˜¯è¾“å‡ºç¼“å­˜çš„<code>b.js</code>çš„æ‰§è¡Œç»“æœï¼Œå³å®ƒçš„ç¬¬å››è¡Œã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h1 id="ES6æ¨¡å—çš„å¾ªç¯åŠ è½½"><a href="#ES6æ¨¡å—çš„å¾ªç¯åŠ è½½" class="headerlink" title="ES6æ¨¡å—çš„å¾ªç¯åŠ è½½"></a>ES6æ¨¡å—çš„å¾ªç¯åŠ è½½</h1><p>ES6æ¨¡å—çš„è¿è¡Œæœºåˆ¶ä¸CommonJSä¸ä¸€æ ·ï¼Œå®ƒé‡åˆ°æ¨¡å—åŠ è½½å‘½ä»¤<code>import</code>æ—¶ï¼Œä¸ä¼šå»æ‰§è¡Œæ¨¡å—ï¼Œè€Œæ˜¯åªç”Ÿæˆä¸€ä¸ªå¼•ç”¨ã€‚ç­‰åˆ°çœŸçš„éœ€è¦ç”¨åˆ°æ—¶ï¼Œå†åˆ°æ¨¡å—é‡Œé¢å»å–å€¼ã€‚</p>
<p>å› æ­¤ï¼ŒES6æ¨¡å—æ˜¯åŠ¨æ€å¼•ç”¨ï¼Œä¸å­˜åœ¨ç¼“å­˜å€¼çš„é—®é¢˜ï¼Œè€Œä¸”æ¨¡å—é‡Œé¢çš„å˜é‡ï¼Œç»‘å®šå…¶æ‰€åœ¨çš„æ¨¡å—ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// m1.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> foo = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> foo = <span class="string">&#x27;baz&#x27;</span>, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// m2.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;foo&#125; <span class="keyword">from</span> <span class="string">&#x27;./m1.js&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(foo), <span class="number">500</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>m1.js</code>çš„å˜é‡<code>foo</code>ï¼Œåœ¨åˆšåŠ è½½æ—¶ç­‰äº<code>bar</code>ï¼Œè¿‡äº†500æ¯«ç§’ï¼Œåˆå˜ä¸ºç­‰äº<code>baz</code>ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ï¼Œ<code>m2.js</code>èƒ½å¦æ­£ç¡®è¯»å–è¿™ä¸ªå˜åŒ–ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ babel-node m2.js</span><br><span class="line"></span><br><span class="line">bar</span><br><span class="line">baz</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç è¡¨æ˜ï¼ŒES6æ¨¡å—ä¸ä¼šç¼“å­˜è¿è¡Œç»“æœï¼Œè€Œæ˜¯åŠ¨æ€åœ°å»è¢«åŠ è½½çš„æ¨¡å—å–å€¼ï¼Œä»¥åŠå˜é‡æ€»æ˜¯ç»‘å®šå…¶æ‰€åœ¨çš„æ¨¡å—ã€‚</p>
<p>è¿™å¯¼è‡´ES6å¤„ç†â€å¾ªç¯åŠ è½½â€ä¸CommonJSæœ‰æœ¬è´¨çš„ä¸åŒã€‚<strong>ES6æ ¹æœ¬ä¸ä¼šå…³å¿ƒæ˜¯å¦å‘ç”Ÿäº†â€å¾ªç¯åŠ è½½â€ï¼Œåªæ˜¯ç”Ÿæˆä¸€ä¸ªæŒ‡å‘è¢«åŠ è½½æ¨¡å—çš„å¼•ç”¨ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±ä¿è¯ï¼ŒçœŸæ­£å–å€¼çš„æ—¶å€™èƒ½å¤Ÿå–åˆ°å€¼ã€‚</strong></p>
<p>è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;bar&#125; <span class="keyword">from</span> <span class="string">&#x27;./b.js&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">bar</span>();  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ‰§è¡Œå®Œæ¯•&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;foo&#125; <span class="keyword">from</span> <span class="string">&#x27;./a.js&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;  </span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">random</span>() &gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">    <span class="title function_">foo</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§CommonJSè§„èŒƒï¼Œä¸Šé¢çš„ä»£ç æ˜¯æ²¡æ³•æ‰§è¡Œçš„ã€‚<code>a</code>å…ˆåŠ è½½<code>b</code>ï¼Œç„¶å<code>b</code>åˆåŠ è½½<code>a</code>ï¼Œè¿™æ—¶<code>a</code>è¿˜æ²¡æœ‰ä»»ä½•æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥è¾“å‡ºç»“æœä¸º<code>null</code>ï¼Œå³å¯¹äº<code>b.js</code>æ¥è¯´ï¼Œå˜é‡<code>foo</code>çš„å€¼ç­‰äº<code>null</code>ï¼Œåé¢çš„<code>foo()</code>å°±ä¼šæŠ¥é”™ã€‚</p>
<p>ä½†æ˜¯ï¼ŒES6å¯ä»¥æ‰§è¡Œä¸Šé¢çš„ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ babel-node a.js</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œå®Œæ¯•</span><br></pre></td></tr></table></figure>

<p><code>a.js</code>ä¹‹æ‰€ä»¥èƒ½å¤Ÿæ‰§è¡Œï¼ŒåŸå› å°±åœ¨äºES6åŠ è½½çš„å˜é‡ï¼Œéƒ½æ˜¯åŠ¨æ€å¼•ç”¨å…¶æ‰€åœ¨çš„æ¨¡å—ã€‚åªè¦å¼•ç”¨æ˜¯å­˜åœ¨çš„ï¼Œä»£ç å°±èƒ½æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹ES6æ¨¡å—åŠ è½½å™¨<a href="https://github.com/ModuleLoader/es6-module-loader/blob/master/docs/circular-references-bindings.md">SystemJS</a>ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// even.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; odd &#125; <span class="keyword">from</span> <span class="string">&#x27;./odd&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">even</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  counter++;</span><br><span class="line">  <span class="keyword">return</span> n == <span class="number">0</span> || <span class="title function_">odd</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// odd.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; even &#125; <span class="keyword">from</span> <span class="string">&#x27;./even&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">odd</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n != <span class="number">0</span> &amp;&amp; <span class="title function_">even</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>even.js</code>é‡Œé¢çš„å‡½æ•°<code>foo</code>æœ‰ä¸€ä¸ªå‚æ•°<code>n</code>ï¼Œåªè¦ä¸ç­‰äº0ï¼Œå°±ä¼šå‡å»1ï¼Œä¼ å…¥åŠ è½½çš„<code>odd()</code>ã€‚<code>odd.js</code>ä¹Ÿä¼šåšç±»ä¼¼æ“ä½œã€‚</p>
<p>è¿è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œç»“æœå¦‚ä¸‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$ babel-node</span><br><span class="line">&gt; <span class="keyword">import</span> * <span class="keyword">as</span> m <span class="keyword">from</span> <span class="string">&#x27;./even.js&#x27;</span>;</span><br><span class="line">&gt; m.<span class="title function_">even</span>(<span class="number">10</span>);</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt; m.<span class="property">counter</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line">&gt; m.<span class="title function_">even</span>(<span class="number">20</span>)</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt; m.<span class="property">counter</span></span><br><span class="line"><span class="number">17</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå‚æ•°<code>n</code>ä»10å˜ä¸º0çš„è¿‡ç¨‹ä¸­ï¼Œ<code>foo()</code>ä¸€å…±ä¼šæ‰§è¡Œ6æ¬¡ï¼Œæ‰€ä»¥å˜é‡<code>counter</code>ç­‰äº6ã€‚ç¬¬äºŒæ¬¡è°ƒç”¨<code>evenï¼ˆï¼‰</code>æ—¶ï¼Œå‚æ•°<code>n</code>ä»20å˜ä¸º0ï¼Œ<code>foo()</code>ä¸€å…±ä¼šæ‰§è¡Œ11æ¬¡ï¼ŒåŠ ä¸Šå‰é¢çš„6æ¬¡ï¼Œæ‰€ä»¥å˜é‡<code>counter</code>ç­‰äº17ã€‚</p>
<p>è¿™ä¸ªä¾‹å­è¦æ˜¯æ”¹å†™æˆCommonJSï¼Œå°±æ ¹æœ¬æ— æ³•æ‰§è¡Œï¼Œä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// even.js</span></span><br><span class="line"><span class="keyword">var</span> odd = <span class="built_in">require</span>(<span class="string">&#x27;./odd&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">counter</span> = counter;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">even</span> = <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  counter++;</span><br><span class="line">  <span class="keyword">return</span> n == <span class="number">0</span> || <span class="title function_">odd</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// odd.js</span></span><br><span class="line"><span class="keyword">var</span> even = <span class="built_in">require</span>(<span class="string">&#x27;./even&#x27;</span>).<span class="property">even</span>;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n != <span class="number">0</span> &amp;&amp; <span class="title function_">even</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>even.js</code>åŠ è½½<code>odd.js</code>ï¼Œè€Œ<code>odd.js</code>åˆå»åŠ è½½<code>even.js</code>ï¼Œå½¢æˆâ€å¾ªç¯åŠ è½½â€ã€‚è¿™æ—¶ï¼Œæ‰§è¡Œå¼•æ“å°±ä¼šè¾“å‡º<code>even.js</code>å·²ç»æ‰§è¡Œçš„éƒ¨åˆ†ï¼ˆä¸å­˜åœ¨ä»»ä½•ç»“æœï¼‰ï¼Œæ‰€ä»¥åœ¨<code>odd.js</code>ä¹‹ä¸­ï¼Œå˜é‡<code>even</code>ç­‰äº<code>null</code>ï¼Œç­‰åˆ°åé¢è°ƒç”¨<code>even(n-1)</code>å°±ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ node</span><br><span class="line">&gt; var m = require(<span class="string">&#x27;./even&#x27;</span>);</span><br><span class="line">&gt; m.even(10)</span><br><span class="line">TypeError: even is not a <span class="keyword">function</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>Javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>Koaä¸­é—´ä»¶åŸç†</title>
    <url>/2022/02/28/Koa%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶"><a href="#ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶"></a>ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶</h1><p>ä¸­é—´ä»¶æ˜¯ä»‹äºåº”ç”¨ç³»ç»Ÿå’Œç³»ç»Ÿè½¯ä»¶ä¹‹é—´çš„ä¸€ç±»è½¯ä»¶ï¼Œå®ƒä½¿ç”¨ç³»ç»Ÿè½¯ä»¶æ‰€æä¾›çš„åŸºç¡€æœåŠ¡ï¼ˆåŠŸèƒ½ï¼‰ï¼Œè¡”æ¥ç½‘ç»œä¸Šåº”ç”¨ç³»ç»Ÿçš„å„ä¸ªéƒ¨åˆ†æˆ–ä¸åŒçš„åº”ç”¨ï¼Œèƒ½å¤Ÿè¾¾åˆ°èµ„æºå…±äº«ã€åŠŸèƒ½å…±äº«çš„ç›®çš„ã€‚</p>
<span id="more"></span>
<p>åœ¨ <code>Nodejs</code> ä¸­ï¼Œ<strong>ä¸­é—´ä»¶</strong>ä¸»è¦æ˜¯æŒ‡å°è£… <strong>http</strong> è¯·æ±‚ç»†èŠ‚å¤„ç†çš„æ–¹æ³•ã€‚æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ <strong>http</strong> è¯·æ±‚ä¸­å¾€å¾€ä¼šæ¶‰åŠå¾ˆå¤šåŠ¨ä½œï¼Œå¦‚ä¸‹:</p>
<ul>
<li>IP ç­›é€‰</li>
<li>æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’</li>
<li>è¯·æ±‚ä½“è§£æ</li>
<li>cookie ä¿¡æ¯å¤„ç†</li>
<li>æƒé™æ ¡éªŒ</li>
<li>æ—¥å¿—è®°å½•</li>
<li>ä¼šè¯ç®¡ç†ä¸­é—´ä»¶(session)</li>
<li>gzip å‹ç¼©ä¸­é—´ä»¶(å¦‚ compress)</li>
<li>é”™è¯¯å¤„ç†</li>
</ul>
<p>å½“ç„¶è¿˜æœ‰å¾ˆå¤šè‡ªå®šä¹‰çš„å¤„ç†åŠ¨ä½œ. å¯¹äº <strong>Web</strong> åº”ç”¨è€Œè¨€ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›äº†è§£æ¯ä¸€ä¸ªç»†èŠ‚æ€§çš„å¤„ç†å·¥ä½œï¼Œè€Œæ˜¯å¸Œæœ›èƒ½å¤ŸæŠŠä¸»è¦ç²¾åŠ›é›†ä¸­åœ¨ä¸šåŠ¡çš„å¼€å‘ä¸Šï¼Œä»¥è¾¾åˆ°æå‡å¼€å‘æ•ˆç‡çš„ç›®çš„ï¼Œæ‰€ä»¥å¼•å…¥äº† <strong>Node ä¸­é—´ä»¶</strong><br>æ¥ç®€åŒ–å’Œå°è£…è¿™äº›åŸºç¡€é€»è¾‘å¤„ç†ç»†èŠ‚.</p>
<p><strong>node ä¸­é—´ä»¶</strong>æœ¬è´¨ä¸Šå°±æ˜¯åœ¨è¿›å…¥å…·ä½“çš„ä¸šåŠ¡å¤„ç†ä¹‹å‰ï¼Œå…ˆè®©<strong>ç‰¹å®šè¿‡æ»¤å™¨</strong>å¤„ç†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="https://user-images.githubusercontent.com/33454514/156928218-c20afb06-df25-4dd1-b7d4-ff9a03a07084.png" alt="image"></p>
<p>æˆ‘ä»¬ç›®å‰çœ‹åˆ°çš„ä¸»æµ  <code>Nodejs</code> æ¡†æ¶ï¼Œæ¯”å¦‚ <code>koaï¼Œexpressï¼Œegg</code> ç­‰ï¼Œéƒ½ç¦»ä¸å¼€ä¸­é—´ä»¶çš„è®¾è®¡æ¦‚å¿µï¼Œæ‰€ä»¥ä¸ºäº†èƒ½è®©å¤§å®¶æ›´æ·±å…¥çš„çª¥æ¢  <code>Nodejs</code> ä¸–ç•Œï¼Œæˆ‘ä»¬å°±éå¸¸æœ‰æ¯”è¾ƒç ”ç©¶ä¸­é—´ä»¶çš„å®ç°åŸç†ã€‚</p>
<h1 id="node-ä¸­é—´ä»¶æ ¸å¿ƒåŸç†å®ç°"><a href="#node-ä¸­é—´ä»¶æ ¸å¿ƒåŸç†å®ç°" class="headerlink" title="node ä¸­é—´ä»¶æ ¸å¿ƒåŸç†å®ç°"></a>node ä¸­é—´ä»¶æ ¸å¿ƒåŸç†å®ç°</h1><p>ç”±ä¸Šæ–‡ä»‹ç»å¯çŸ¥ï¼Œä¸­é—´ä»¶æ˜¯ä» http è¯·æ±‚å¼€å§‹åˆ°å“åº”ç»“æŸè¿‡ç¨‹ä¸­çš„å¤„ç†é€»è¾‘ï¼Œé€šå¸¸éœ€è¦å¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œå¤„ç†ã€‚æˆ‘ä»¬åœ¨å®ç° node<br>ä¸­é—´ä»¶æ¨¡å¼æ—¶è¿˜éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤šä¸­é—´ä»¶å…±å­˜çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¦æ€è€ƒå¦‚ä½•å°†å¤šä¸ªä¸­é—´ä»¶çš„æ‰§è¡Œè‡ªåŠ¨åŒ–ï¼Œä¸ç„¶åœ¨è¯·æ±‚åˆ°å“åº”çš„è¿‡ç¨‹ä¸­åªä¼šæ‰§è¡Œæœ€å¼€å§‹çš„ä¸­é—´ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åŸºæœ¬çš„ä¸­é—´ä»¶å½¢å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">middleware</span> = (<span class="params">req, res, next</span>) =&gt; &#123;  <span class="comment">// è¯·æ±‚å¤„ç†é€»è¾‘ </span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆå†™ä¸ªç®€å•çš„æ¡ˆä¾‹æ¥çœ‹çœ‹ä¸­é—´ä»¶æ˜¯å¦‚ä½•å®ç°çš„.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å‡ ä¸ªä¸­é—´é—´å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">m1</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;m1 run&#x27;</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">m2</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;m2 run&#x27;</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">m3</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;m3 run&#x27;</span>)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸­é—´ä»¶é›†åˆconst middlewares = [m1, m2, m3]</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useApp</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">next</span> = (<span class="params"></span>) =&gt; &#123;    <span class="comment">// è·å–ç¬¬ä¸€ä¸ªä¸­é—´ä»¶</span></span><br><span class="line">    <span class="keyword">const</span> middleware = middlewares.<span class="title function_">shift</span>();</span><br><span class="line">    <span class="keyword">if</span> (middleware) &#123;</span><br><span class="line">      <span class="title function_">middleware</span>(req, res, next);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡è¯·æ±‚æµè¿›å…¥</span></span><br><span class="line"><span class="title function_">useApp</span>();</span><br></pre></td></tr></table></figure>

<p>ç”±ä»¥ä¸Šä»£ç æˆ‘ä»¬å°±ä¸éš¾å‘ç° <strong>next</strong> çš„ä½œç”¨äº†ï¼Œä¹Ÿå°±æ˜¯å®ç°è‡ªåŠ¨è°ƒç”¨ä¸­é—´ä»¶é“¾çš„å…³é”®å‚æ•°. æ‰“å°ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">m1 run</span><br><span class="line">m2 runm3</span><br><span class="line">run </span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå³å®ç°äº†åŸºæœ¬ä¸­é—´ä»¶çš„æ‰§è¡Œæ¨¡å¼ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å¼‚æ­¥çš„é—®é¢˜ï¼Œå¦‚æœä¸­é—´ä»¶è¿˜ä¾èµ–ç¬¬ä¸‰å‘æ¨¡å—æˆ–è€… api çš„æ”¯æŒï¼Œæ¯”å¦‚éªŒè¯ï¼Œè¯†åˆ«ç­‰æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¯¥å¼‚æ­¥ä¸­é—´ä»¶çš„å›è°ƒé‡Œæ‰§è¡Œ nextï¼Œæ‰èƒ½ä¿è¯æ­£å¸¸çš„è°ƒç”¨æ‰§è¡Œé¡ºåºï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">m2</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/xxxxx&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ç§ä¸­é—´ä»¶åœºæ™¯ï¼Œæ¯”å¦‚è¯´æ—¥å¿—ä¸­é—´ä»¶ï¼Œè¯·æ±‚ç›‘æ§ä¸­é—´ä»¶ï¼Œå®ƒä»¬ä¼šåœ¨ä¸šåŠ¡å¤„ç†å‰å’Œå¤„ç†åéƒ½ä¼šæ‰§è¡Œç›¸å…³é€»è¾‘ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦æ±‚æˆ‘ä»¬éœ€è¦èƒ½å¯¹ <strong>next</strong> å‡½æ•°è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å°† next çš„è¿”å›å€¼åŒ…è£…æˆ <strong>promise</strong><br>ï¼Œä½¿å¾—å…¶åœ¨ä¸šåŠ¡å¤„ç†å®Œæˆä¹‹åé€šè¿‡ <strong>then</strong> å›è°ƒæ¥ç»§ç»­å¤„ç†ä¸­é—´ä»¶é€»è¾‘. å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useApp</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">next</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> middleware = middlewares.<span class="title function_">shift</span>();</span><br><span class="line">    <span class="keyword">if</span> (middleware) &#123;      <span class="comment">// å°†è¿”å›å€¼åŒ…è£…ä¸ºPromiseå¯¹è±¡</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">middleware</span>(req, res, next));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æˆ‘ä»¬å°±èƒ½ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è°ƒç”¨äº†:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">m1</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;m1 start&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">next</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;m1 end&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ªåŸºæœ¬å¯ä»¥çš„ä¸­é—´ä»¶è®¾è®¡æ¨¡å¼ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ async å’Œ await å®ç°ï¼Œå†™æ³•ä¼šæ›´ä¼˜é›…å’Œç®€å•ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">m1</span> = <span class="keyword">async</span> (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// something...</span></span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">m2</span> = <span class="keyword">async</span> (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// something... </span></span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">m3</span> = <span class="keyword">async</span> (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// something... </span></span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> middlewares = [m1, m2, m3]</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useApp</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">next</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> middleware = middlewares.<span class="title function_">shift</span>();</span><br><span class="line">    <span class="keyword">if</span> (middleware) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">middleware</span>(req, res, next));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨ä¸­é—´ä»¶useApp() </span></span><br></pre></td></tr></table></figure>

<p>åœ¨ koa2 æ¡†æ¶ä¸­ï¼Œä¸­é—´ä»¶çš„å®ç°æ–¹å¼ä¹Ÿæ˜¯å°† <code>next()</code> æ–¹æ³•è¿”å›å€¼å°è£…ä¸º Promise å¯¹è±¡ï¼Œå®ç°äº†å…¶æå‡ºçš„æ´‹è‘±åœˆæ¨¡å‹ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/156928188-db25c072-6697-49eb-a099-d940a69dd147.png" alt="image"></p>
<h1 id="koa-ä¸­é—´ä»¶å®ç°æ–¹å¼"><a href="#koa-ä¸­é—´ä»¶å®ç°æ–¹å¼" class="headerlink" title="koa ä¸­é—´ä»¶å®ç°æ–¹å¼"></a>koa ä¸­é—´ä»¶å®ç°æ–¹å¼</h1><p>koa2 æ¡†æ¶çš„ä¸­é—´ä»¶å®ç°åŸç†å¾ˆä¼˜é›…ï¼Œè¿™é‡Œè´´ä¸Šæºç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">middleware</span>) &#123;  <span class="comment">// æå‰åˆ¤æ–­ä¸­é—´ä»¶ç±»å‹,é˜²æ­¢åç»­é”™è¯¯</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(middleware)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Middleware stack must be an array!&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> fn <span class="keyword">of</span> middleware) &#123;    <span class="comment">// ä¸­é—´ä»¶å¿…é¡»ä¸ºå‡½æ•°ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Middleware must be composed of functions!&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">context, next</span>) &#123;    <span class="comment">// é‡‡ç”¨é—­åŒ…å°†ç´¢å¼•ç¼“å­˜,æ¥å®ç°è°ƒç”¨è®¡æ•°</span></span><br><span class="line">    <span class="keyword">let</span> index = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatch</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">i</span>) &#123;      <span class="comment">// é˜²æ­¢next()æ–¹æ³•é‡å¤è°ƒç”¨  </span></span><br><span class="line">      <span class="keyword">if</span> (i &lt;= index) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;next() called multiple times&#x27;</span>))</span><br><span class="line">      &#125;</span><br><span class="line">      index = i;</span><br><span class="line">      <span class="keyword">let</span> fn = middleware[i];</span><br><span class="line">      <span class="keyword">if</span> (i === middleware.<span class="property">length</span>) &#123;</span><br><span class="line">        fn = next;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!fn) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;        <span class="comment">// åŒ…è£…next()è¿”å›å€¼ä¸ºPromiseå¯¹è±¡  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>(context, dispatch.<span class="title function_">bind</span>(<span class="literal">null</span>, i + <span class="number">1</span>)));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;        <span class="comment">// å¼‚å¸¸å¤„ç† </span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å®ç°ä¸€ä¸ªè‡ªå·±çš„-koa-ä¸­é—´ä»¶"><a href="#å®ç°ä¸€ä¸ªè‡ªå·±çš„-koa-ä¸­é—´ä»¶" class="headerlink" title="å®ç°ä¸€ä¸ªè‡ªå·±çš„ koa ä¸­é—´ä»¶"></a>å®ç°ä¸€ä¸ªè‡ªå·±çš„ koa ä¸­é—´ä»¶</h1><p>åœ¨æœåŠ¡ç«¯ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯¹ç”¨æˆ·ç™»å½•æƒé™è¿›è¡Œè¿‡æ»¤ï¼Œæ­¤æ—¶æˆ‘ä»¬æä¾›ç»Ÿä¸€ä¸ªä¸­é—´ä»¶æ¥å¤„ç†ç”¨æˆ·æƒé™ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œ</span></span><br><span class="line"><span class="keyword">const</span> token = db.<span class="title function_">user</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// routeræˆ–è€…koaçš„ä¸­é—´ä»¶ä¸€å®šè¦ç”¨awaitå¤„ç†nextï¼Œå¦åˆ™å°†ä¸èƒ½æ­£å¸¸å“åº”æ•°æ®</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> t = ctx.<span class="property">request</span>.<span class="property">header</span>.<span class="property">authorization</span>;</span><br><span class="line">  <span class="keyword">let</span> uid = ctx.<span class="property">request</span>.<span class="property">header</span>[<span class="string">&#x27;x-requested-with&#x27;</span>];</span><br><span class="line">  <span class="keyword">let</span> uidArr = uid.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (uidArr.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    uid = uidArr.<span class="title function_">pop</span>().<span class="title function_">trim</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (token[uid] &amp;&amp; token[uid][<span class="number">1</span>] === t) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ctx.<span class="property">status</span> = <span class="number">403</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = &#123;</span><br><span class="line">      <span class="attr">state</span>: <span class="number">403</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;æœªç™»å½•æˆ–æ²¡æœ‰æƒé™&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å³å®ç°ç”¨æˆ·ç™»å½•æ€å¤„ç†ï¼Œå¦‚æœç”¨æˆ·åœ¨æ²¡æœ‰ç™»å½•çš„æƒ…å†µä¸‹é˜²é—®ä»»ä½•éœ€è¦ç™»å½•çš„æ¥å£ï¼Œéƒ½å°†è¿”å›æƒé™ä¸è¶³æˆ–åˆ™åœ¨è¯·æ±‚åº“ä¸­è®©å…¶é‡å®šå‘åˆ°ç™»å½•é¡µé¢</p>
]]></content>
      <categories>
        <category>Koa</category>
        <category>NodeJS</category>
      </categories>
      <tags>
        <tag>Koa</tag>
        <tag>NodeJS</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCodeåˆ·é¢˜æŒ‡å—</title>
    <url>/2021/09/22/LeetCode%E5%88%B7%E9%A2%98%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h1 id="å›æº¯"><a href="#å›æº¯" class="headerlink" title="å›æº¯"></a>å›æº¯</h1><p>å¦‚ä½•åˆ¤æ–­è¯¥ä½¿ç”¨å›æº¯ï¼šæ„Ÿè§‰å¦‚æœä¸ç©·ä¸¾ä¸€ä¸‹å°±æ²¡æ³•çŸ¥é“ç­”æ¡ˆã€‚</p>
<p>ä¸€èˆ¬å›æº¯çš„é—®é¢˜æœ‰ä¸‰ç§ï¼š</p>
<ol>
<li> Find a path to success æœ‰æ²¡æœ‰è§£</li>
<li> Find all paths to success æ±‚æ‰€æœ‰è§£</li>
<li> æ±‚æ‰€æœ‰è§£çš„ä¸ªæ•°</li>
<li> æ±‚æ‰€æœ‰è§£çš„å…·ä½“ä¿¡æ¯</li>
<li> Find the best path to success æ±‚æœ€ä¼˜è§£</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">backtrack</span>(<span class="params">æ–°åŒºåŸŸ, res, path</span>):</span><br><span class="line">    <span class="keyword">if</span> ç»“æŸ:<span class="comment"># ä¸€èˆ¬æ˜¯æœ€å°å€¼æœ€å¤§å€¼</span></span><br><span class="line">        res.add(path) <span class="comment"># </span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> é€‰æ‹© <span class="keyword">in</span> æ–°åŒºåŸŸ:</span><br><span class="line">        <span class="keyword">if</span> ç¬¦åˆè¦æ±‚:</span><br><span class="line">            path.add(å½“å‰é€‰æ‹©)</span><br><span class="line">            backtrack(æ–°åŒºåŸŸ, res, path)</span><br><span class="line">            path.pop()</span><br></pre></td></tr></table></figure>


<h1 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h1><h3 id="æ€è·¯1ï¼š"><a href="#æ€è·¯1ï¼š" class="headerlink" title="æ€è·¯1ï¼š"></a>æ€è·¯1ï¼š</h3><ol>
<li> å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ left å’Œ right åˆ†åˆ«æŒ‡å‘åŒºé—´çš„å¼€å¤´å’Œç»“å°¾ï¼Œæ³¨æ„æ˜¯é—­åŒºé—´ï¼›å®šä¹‰ sums ç”¨æ¥ç»Ÿè®¡è¯¥åŒºé—´å†…çš„å„ä¸ªå­—ç¬¦å‡ºç°æ¬¡æ•°ï¼›</li>
<li> ç¬¬ä¸€é‡ while å¾ªç¯æ˜¯ä¸ºäº†åˆ¤æ–­ right æŒ‡é’ˆçš„ä½ç½®æ˜¯å¦è¶…å‡ºäº†æ•°ç»„è¾¹ç•Œï¼›å½“ right æ¯æ¬¡åˆ°äº†æ–°ä½ç½®ï¼Œéœ€è¦å¢åŠ  right æŒ‡é’ˆçš„æ±‚å’Œ/è®¡æ•°ï¼›</li>
<li>ç¬¬äºŒé‡ while å¾ªç¯æ˜¯è®© left æŒ‡é’ˆå‘å³ç§»åŠ¨åˆ° [left, right] åŒºé—´ç¬¦åˆé¢˜æ„çš„ä½ç½®ï¼›<br> å½“ left æ¯æ¬¡ç§»åŠ¨åˆ°äº†æ–°ä½ç½®ï¼Œéœ€è¦å‡å°‘ left æŒ‡é’ˆçš„æ±‚å’Œ/è®¡æ•°ï¼›</li>
<li>åœ¨ç¬¬äºŒé‡ while å¾ªç¯ä¹‹åï¼ŒæˆåŠŸæ‰¾åˆ°äº†ä¸€ä¸ªç¬¦åˆé¢˜æ„çš„ [left, right] åŒºé—´ï¼Œé¢˜ç›®è¦æ±‚<br> æœ€å¤§çš„åŒºé—´é•¿åº¦ï¼Œå› æ­¤æ›´æ–° res ä¸º max(res, å½“å‰åŒºé—´çš„é•¿åº¦) ã€‚</li>
<li> right æŒ‡é’ˆæ¯æ¬¡å‘å³ç§»åŠ¨ä¸€æ­¥ï¼Œå¼€å§‹æ¢ç´¢æ–°çš„åŒºé—´ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">findSubArray</span>(<span class="params">nums</span>):</span><br><span class="line">    N = <span class="built_in">len</span>(nums) <span class="comment"># æ•°ç»„/å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">    left, right = <span class="number">0</span>, <span class="number">0</span> <span class="comment"># åŒæŒ‡é’ˆï¼Œè¡¨ç¤ºå½“å‰éå†çš„åŒºé—´[left, right]ï¼Œé—­åŒºé—´</span></span><br><span class="line">    sums = <span class="number">0</span> <span class="comment"># ç”¨äºç»Ÿè®¡ å­æ•°ç»„/å­åŒºé—´ æ˜¯å¦æœ‰æ•ˆï¼Œæ ¹æ®é¢˜ç›®å¯èƒ½ä¼šæ”¹æˆæ±‚å’Œ/è®¡æ•°</span></span><br><span class="line">    res = <span class="number">0</span> <span class="comment"># ä¿å­˜æœ€å¤§çš„æ»¡è¶³é¢˜ç›®è¦æ±‚çš„ å­æ•°ç»„/å­ä¸² é•¿åº¦</span></span><br><span class="line">    <span class="keyword">while</span> right &lt; N: <span class="comment"># å½“å³è¾¹çš„æŒ‡é’ˆæ²¡æœ‰æœç´¢åˆ° æ•°ç»„/å­—ç¬¦ä¸² çš„ç»“å°¾</span></span><br><span class="line">        sums += nums[right] <span class="comment"># å¢åŠ å½“å‰å³è¾¹æŒ‡é’ˆçš„æ•°å­—/å­—ç¬¦çš„æ±‚å’Œ/è®¡æ•°</span></span><br><span class="line">        <span class="keyword">while</span> åŒºé—´[left, right]ä¸ç¬¦åˆé¢˜æ„ï¼š<span class="comment"># æ­¤æ—¶éœ€è¦ä¸€ç›´ç§»åŠ¨å·¦æŒ‡é’ˆï¼Œç›´è‡³æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆé¢˜æ„çš„åŒºé—´</span></span><br><span class="line">            sums -= nums[left] <span class="comment"># ç§»åŠ¨å·¦æŒ‡é’ˆå‰éœ€è¦ä»counterä¸­å‡å°‘leftä½ç½®å­—ç¬¦çš„æ±‚å’Œ/è®¡æ•°</span></span><br><span class="line">            left += <span class="number">1</span> <span class="comment"># çœŸæ­£çš„ç§»åŠ¨å·¦æŒ‡é’ˆï¼Œæ³¨æ„ä¸èƒ½è·Ÿä¸Šé¢ä¸€è¡Œä»£ç å†™å</span></span><br><span class="line">        <span class="comment"># åˆ° while ç»“æŸæ—¶ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªç¬¦åˆé¢˜æ„è¦æ±‚çš„ å­æ•°ç»„/å­ä¸²</span></span><br><span class="line">        res = <span class="built_in">max</span>(res, right - left + <span class="number">1</span>) <span class="comment"># éœ€è¦æ›´æ–°ç»“æœ</span></span><br><span class="line">        right += <span class="number">1</span> <span class="comment"># ç§»åŠ¨å³æŒ‡é’ˆï¼Œå»æ¢ç´¢æ–°çš„åŒºé—´</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>


<h3 id="æ€è·¯2ï¼š"><a href="#æ€è·¯2ï¼š" class="headerlink" title="æ€è·¯2ï¼š"></a>æ€è·¯2ï¼š</h3><ol>
<li> å½“ç§»åŠ¨ right æ‰©å¤§çª—å£ï¼Œå³åŠ å…¥å­—ç¬¦æ—¶ï¼Œåº”è¯¥æ›´æ–°å“ªäº›æ•°æ®ï¼Ÿ</li>
<li> ä»€ä¹ˆæ¡ä»¶ä¸‹ï¼Œçª—å£åº”è¯¥æš‚åœæ‰©å¤§ï¼Œå¼€å§‹ç§»åŠ¨ left ç¼©å°çª—å£ï¼Ÿ</li>
<li> å½“ç§»åŠ¨ left ç¼©å°çª—å£ï¼Œå³ç§»å‡ºå­—ç¬¦æ—¶ï¼Œåº”è¯¥æ›´æ–°å“ªäº›æ•°æ®ï¼Ÿ</li>
<li> æˆ‘ä»¬è¦çš„ç»“æœåº”è¯¥åœ¨æ‰©å¤§çª—å£æ—¶è¿˜æ˜¯ç¼©å°çª—å£æ—¶è¿›è¡Œæ›´æ–°ï¼Ÿ</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sä¸ºåŒ¹é…ä¸²ï¼Œtä¸ºæ¨¡å¼ä¸²</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slideWindow</span>(<span class="params">s, t</span>):</span><br><span class="line">    needs, window = collections.defaultdict(<span class="built_in">int</span>), collections.defaultdict(<span class="built_in">int</span>)</span><br><span class="line">    <span class="comment"># è®¡å½•æ¨¡å¼ä¸²ä¸­æ¯ä¸ªå­—ç¬¦åˆ†åˆ«æœ‰å¤šå°‘ä¸ª</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> t:</span><br><span class="line">        needs[i] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    left, right = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="comment"># è®°å½•çª—å£ä¸­æ»¡è¶³æ¨¡å¼ä¸²å­—ç¬¦çš„ä¸ªæ•°</span></span><br><span class="line">    valid = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> right &lt; <span class="built_in">len</span>(s):</span><br><span class="line">        <span class="comment"># è¿›å…¥çª—å£çš„å­—ç¬¦</span></span><br><span class="line">        c = s[right]</span><br><span class="line">        <span class="comment"># æ›´æ–°çª—å£å†…æ•°æ®</span></span><br><span class="line">        do something</span><br><span class="line"></span><br><span class="line">        <span class="comment"># debug ä½ç½®</span></span><br><span class="line">        <span class="built_in">print</span>(left, right)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># çª—å£æ”¶ç¼©æ“ä½œ</span></span><br><span class="line">        <span class="keyword">while</span> left need to shrink:</span><br><span class="line">            d = s[left]</span><br><span class="line">            left += <span class="number">1</span></span><br><span class="line">            <span class="comment"># æ›´æ–°çª—å£å†…æ•°æ®</span></span><br><span class="line">            do something</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># çª—å£å³ç§»</span></span><br><span class="line">        right += <span class="number">1</span></span><br></pre></td></tr></table></figure>


<h1 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h1><p>é—®é¢˜çš„æœ¬è´¨å°±æ˜¯è®©ä½ åœ¨ä¸€å¹…ã€Œå›¾ã€ä¸­æ‰¾åˆ°ä»èµ·ç‚¹ <em>start</em> åˆ°ç»ˆç‚¹ <em>target</em> çš„æœ€è¿‘è·ç¦»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bfs</span>(<span class="params">start, target</span>):</span><br><span class="line">    queue = collections.deque()</span><br><span class="line">    <span class="comment"># è®°å½•æ˜¯å¦ç»è¿‡è¯¥èŠ‚ç‚¹</span></span><br><span class="line">    visited = <span class="built_in">set</span>()</span><br><span class="line">    step = <span class="number">0</span></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    queue.apped(start)</span><br><span class="line">    visited.add(start)</span><br><span class="line">    <span class="keyword">while</span> queue:</span><br><span class="line">        <span class="comment"># ä»å½“å‰èŠ‚ç‚¹å‘å››å‘¨æ‰©æ•£</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(queue)):</span><br><span class="line">            temp = queue.popleft()</span><br><span class="line">            <span class="comment"># æ˜¯å¦åˆ°è¾¾ç»ˆç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> temp == target:</span><br><span class="line">                <span class="keyword">return</span> step</span><br><span class="line">            <span class="comment"># æ·»åŠ ç›¸é‚»èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">for</span> node <span class="keyword">in</span> temp.ç›¸é‚»èŠ‚ç‚¹:</span><br><span class="line">                <span class="keyword">if</span> node <span class="keyword">not</span> <span class="keyword">in</span> visited:</span><br><span class="line">                    queue.apped(node)</span><br><span class="line">                    visited.add(node)</span><br><span class="line">        step += <span class="number">1</span></span><br></pre></td></tr></table></figure>


<h1 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h1><p>äºŒåˆ†æŸ¥æ‰¾åœºæ™¯ï¼šå¯»æ‰¾ä¸€ä¸ªæ•°ã€å¯»æ‰¾å·¦ä¾§è¾¹ç•Œã€å¯»æ‰¾å³ä¾§è¾¹ç•Œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">binarySeaech</span>(<span class="params">nums</span>):</span><br><span class="line">    left, right = <span class="number">0</span>, <span class="built_in">len</span>(nums)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> condition:</span><br><span class="line">        mid = lefg + (right -left) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> nums[mid] == target:</span><br><span class="line">            do something</span><br><span class="line">        <span class="keyword">elif</span> nums[mid] &lt; target:</span><br><span class="line">            left = something</span><br><span class="line">        <span class="keyword">elif</span> nums[mid] &gt; target:</span><br><span class="line">            right = something</span><br><span class="line">    <span class="keyword">return</span> something</span><br></pre></td></tr></table></figure>


<h1 id="èƒŒåŒ…é—®é¢˜ï¼š"><a href="#èƒŒåŒ…é—®é¢˜ï¼š" class="headerlink" title="èƒŒåŒ…é—®é¢˜ï¼š"></a>èƒŒåŒ…é—®é¢˜ï¼š</h1><p>å®šä¹‰ dp æ•°ç»„çš„ä½œç”¨ååˆ†å…³é”®ï¼ï¼ï¼</p>
<p>å¿…é¡»æ˜ç¡®dp[i][j]ï¼Œiï¼Œjï¼Œåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Œå¹¶ä¸ºdpæ•°ç»„æ­£ç¡®åˆå§‹åŒ–ã€‚</p>
<p>ç„¶åæ˜¯å®šä¹‰çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œä¹‹åå°±å¯ä»¥æ„‰å¿«åœ°å¥—æ¨¡æ¿äº†~</p>
<h3 id="é€šç”¨è½¬ç§»æ–¹ç¨‹"><a href="#é€šç”¨è½¬ç§»æ–¹ç¨‹" class="headerlink" title="é€šç”¨è½¬ç§»æ–¹ç¨‹"></a>é€šç”¨è½¬ç§»æ–¹ç¨‹</h3><ol>
<li>æœ€å€¼é—®é¢˜:</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dp[i] = <span class="built_in">max</span>/<span class="built_in">min</span>(dp[i], dp[i - nums] + <span class="number">1</span>) æˆ–è€… dp[i] = <span class="built_in">max</span>/<span class="built_in">min</span>(dp[i], dp[i - num] + num)</span><br></pre></td></tr></table></figure>


<ol start="2">
<li>å­˜åœ¨é—®é¢˜(bool)ï¼š</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dp[i] = dp[i] <span class="keyword">or</span> dp[i - num]</span><br></pre></td></tr></table></figure>


<ol start="3">
<li>ç»„åˆé—®é¢˜ï¼š</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dp[i] += dp[i - num]</span><br></pre></td></tr></table></figure>


<h3 id="äºŒç»´dp"><a href="#äºŒç»´dp" class="headerlink" title="äºŒç»´dp"></a>äºŒç»´dp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bags</span>(<span class="params">nums, target</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(nums)</span><br><span class="line">    dp = [[<span class="number">0</span>] * (target + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n + <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n + <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># è®¾å®šæ‰€éœ€çš„åˆå§‹çŠ¶æ€</span></span><br><span class="line">        dp[i][<span class="number">0</span>] = [<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(target + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> condition:</span><br><span class="line">                è½¬ç§»æ–¹ç¨‹<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                è½¬ç§»æ–¹ç¨‹<span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[-<span class="number">1</span>][-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>


<h3 id="ä¸€ç»´dp"><a href="#ä¸€ç»´dp" class="headerlink" title="ä¸€ç»´dp"></a>ä¸€ç»´dp</h3><ol>
<li>å¦‚æœæ˜¯0-1èƒŒåŒ…ï¼Œå³æ•°ç»„ä¸­çš„å…ƒç´ ä¸å¯é‡å¤ä½¿ç”¨ï¼Œnumsæ”¾åœ¨å¤–å¾ªç¯ï¼Œtargetåœ¨å†…å¾ªç¯ï¼Œä¸”å†…å¾ªç¯å€’åºï¼›</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(target, num - <span class="number">1</span>, -<span class="number">1</span>):</span><br></pre></td></tr></table></figure>


<ol start="2">
<li>å¦‚æœæ˜¯å®Œå…¨èƒŒåŒ…ï¼Œå³æ•°ç»„ä¸­çš„å…ƒç´ å¯é‡å¤ä½¿ç”¨ï¼Œnumsæ”¾åœ¨å¤–å¾ªç¯ï¼Œtargetåœ¨å†…å¾ªç¯ã€‚ä¸”å†…å¾ªç¯æ­£åºã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num, target + <span class="number">1</span>):</span><br></pre></td></tr></table></figure>


<ol start="3">
<li>å¦‚æœç»„åˆé—®é¢˜éœ€è€ƒè™‘å…ƒç´ ä¹‹é—´çš„é¡ºåºï¼Œéœ€å°†targetæ”¾åœ¨å¤–å¾ªç¯ï¼Œå°†numsæ”¾åœ¨å†…å¾ªç¯ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, target+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br></pre></td></tr></table></figure>


<p>æ•´ä½“ä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bags</span>(<span class="params">nums, target</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(nums)</span><br><span class="line">    dp = [<span class="number">0</span>] * (target + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾å®šæ‰€éœ€çš„åˆå§‹çŠ¶æ€</span></span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(target, num - <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            è½¬ç§»æ–¹ç¨‹</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>


<h1 id="æ‰‹æ’¸LRU"><a href="#æ‰‹æ’¸LRU" class="headerlink" title="æ‰‹æ’¸LRU"></a>æ‰‹æ’¸LRU</h1><ol>
<li>æ–°åŠ å…¥çš„èŠ‚ç‚¹æ”¾åœ¨é“¾è¡¨æœ«å°¾ï¼Œ<code>addNodeToLast(node)</code></li>
<li>è‹¥å®¹é‡è¾¾åˆ°ä¸Šé™ï¼Œå»é™¤æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ï¼Œ<code>removeHeadNode(head.next)</code></li>
<li>è‹¥æ•°æ®æ–°è¢«è®¿é—®è¿‡ï¼Œæ¯”å¦‚è¢«<code>get</code>äº†æˆ–è¢«<code>put</code>äº†æ–°å€¼ï¼ŒæŠŠè¯¥èŠ‚ç‚¹æŒªåˆ°é“¾è¡¨æœ«å°¾ï¼Œ<code>moveNodeToLast(node)</code></li>
</ol>
<p>ä¸‹å›¾ä¸ºlruçš„åŸºæœ¬æ•°æ®ç»“æ„ï¼Œç”¨hashmapå­˜å‚¨<code>&#123;value: node&#125;</code></p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/1431305/1628497262413-769ddb04-b2b2-4d59-95ad-2e79bcc8d57f.jpeg#height=256&id=LiL9J&originHeight=511&originWidth=997&originalType=binary&ratio=1&status=done&style=none&width=499"></p>
<p><code>put</code>æ“ä½œçš„é€»è¾‘</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/1431305/1628497265751-aa1e3cc8-aefa-49ef-914b-d4094dd429a9.jpeg#height=406&id=BFC0S&originHeight=811&originWidth=955&originalType=binary&ratio=1&status=done&style=none&width=478"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key=<span class="number">0</span>, val=<span class="number">0</span></span>):</span><br><span class="line">        self.pre = <span class="literal">None</span></span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line">        self.key = key</span><br><span class="line">        self.val = val</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, capacity: <span class="built_in">int</span></span>):</span><br><span class="line">        self.capacity = capacity</span><br><span class="line">        self.hashmap = &#123;&#125;</span><br><span class="line">        self.head = TreeNode()</span><br><span class="line">        self.tail = TreeNode()</span><br><span class="line">        self.head.<span class="built_in">next</span> = self.tail</span><br><span class="line">        self.tail.pre = self.head</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove_node</span>(<span class="params">self, node</span>):</span><br><span class="line">        node.pre.<span class="built_in">next</span> = node.<span class="built_in">next</span></span><br><span class="line">        node.<span class="built_in">next</span>.pre = node.pre</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_node</span>(<span class="params">self, node</span>):</span><br><span class="line">        self.tail.pre.<span class="built_in">next</span> = node</span><br><span class="line">        node.pre = self.tail.pre</span><br><span class="line">        node.<span class="built_in">next</span> = self.tail</span><br><span class="line">        self.tail.pre = node</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">move_node_to_last</span>(<span class="params">self, node</span>):</span><br><span class="line">        self.remove_node(node)</span><br><span class="line">        self.add_node(node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self.hashmap:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        node = self.hashmap[key]</span><br><span class="line">        self.move_node_to_last(node)</span><br><span class="line">        <span class="keyword">return</span> node.val</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, key: <span class="built_in">int</span>, value: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.hashmap:</span><br><span class="line">            node = self.hashmap[key]</span><br><span class="line">            node.val = value</span><br><span class="line">            self.move_node_to_last(node)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.hashmap) == self.capacity:</span><br><span class="line">            self.hashmap.pop(self.head.<span class="built_in">next</span>.key)</span><br><span class="line">            self.remove_node(self.head.<span class="built_in">next</span>)</span><br><span class="line">        node = TreeNode(key, value)</span><br><span class="line">        self.add_node(node)</span><br><span class="line">        self.hashmap[key] = node</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Nodejså¸¸è§é—®é¢˜æ±‡æ€»</title>
    <url>/2022/02/24/Nodejs%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h1 id="windows-å’Œ-mac-ä¸‹è®¾ç½®-NODE-ENV-å˜é‡"><a href="#windows-å’Œ-mac-ä¸‹è®¾ç½®-NODE-ENV-å˜é‡" class="headerlink" title="windows å’Œ  mac ä¸‹è®¾ç½® NODE_ENV å˜é‡"></a>windows å’Œ  mac ä¸‹è®¾ç½® NODE_ENV å˜é‡</h1><p>åœ¨å‰ç«¯é¡¹ç›®ä¸­ä¼šæ ¹æ®ä¸åŒçš„ç¯å¢ƒå˜é‡æ¥å¤„ç†ä¸åŒçš„é€»è¾‘ï¼Œåœ¨<code>NodeJS</code>ä¸­ä¹Ÿä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒï¼Œçº¿ä¸Šç¯å¢ƒç­‰ï¼Œæ­¤æ—¶æœ‰ä¸€ç›´è®¾ç½®ç¯å¢ƒå˜é‡çš„æ–¹æ¡ˆæ˜¯åœ¨<code>package.json</code>ä¸­çš„<code>script</code>å±æ€§ä¸­è®¾ç½®ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;   </span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;export NODE_ENV=development &amp;&amp; nodemon -w src --exec \&quot;babel-node src\&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;babel src --out-dir dist&quot;</span>,</span><br><span class="line">    <span class="string">&quot;run-build&quot;</span>: <span class="string">&quot;node dist&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»<code>start</code>æŒ‡ä»¤ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°æˆ‘ä»¬ç”¨<code>export NODE_ENV=development</code>æ¥å®šä¹‰å¼€å‘ç¯å¢ƒçš„ç¯å¢ƒå˜é‡ï¼Œç”±äºç¬”è€…é‡‡ç”¨çš„æ˜¯<code>mac</code>ç”µè„‘ï¼Œæ‰€ä»¥å¯ä»¥ç”¨<code>export</code>æ¥å®šä¹‰ä¸€ä¸ª<code>node</code>ç¯å¢ƒå˜é‡ã€‚ ä½†æ˜¯åœ¨windowsç¯å¢ƒä¸‹å¼€å‘é¡¹ç›®æ—¶å‘ç°ï¼Œæ‰§è¡Œ<code>yarn start</code>åä¼šæŠ¥é”™ï¼Œåé¢çœ‹é”™è¯¯ä¿¡æ¯æ‰å‘ç°<code>windows</code>ä¸‹ä¸è¯†åˆ«<code>export</code>å‘½ä»¤ã€‚åœ¨<code>windows</code>huaçŸ­é¢ˆä¸‹å¯ä»¥ä½¿ç”¨<code>set</code>å®šä¹‰ç¯å¢ƒå˜é‡ã€‚æ‰€ä»¥å¯¹äº<code>windows</code>ç”¨æˆ·ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ä»¥ä¸Šæ–¹æ³•è®¾ç½®<code>NODE_ENV</code>ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;set NODE_ENV=development &amp;&amp; nodemon -w src --exec \&quot;babel-node src\&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ‰§è¡Œ-npm-install-å‘ç”Ÿ-node-gyp-æŠ¥é”™"><a href="#æ‰§è¡Œ-npm-install-å‘ç”Ÿ-node-gyp-æŠ¥é”™" class="headerlink" title="æ‰§è¡Œ npm install å‘ç”Ÿ node-gyp æŠ¥é”™"></a>æ‰§è¡Œ npm install å‘ç”Ÿ node-gyp æŠ¥é”™</h1><p>åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­æœ‰æ—¶å€™æ‹‰å–æ–°çš„<code>node</code>é¡¹ç›®ä»£ç åæ‰§è¡Œ<code>npm install</code>ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<p><img src="https://static001.geekbang.org/infoq/37/3706e8d2ca1325f2b0295f58ce49ed9a.png" alt="img"></p>
<p><code>node-gyp</code>å°±æ˜¯åœ¨<code>node</code>ç¯å¢ƒä¸­ä½¿ç”¨çš„ç”Ÿæˆä¸åŒå¹³å°ä¸åŒç¼–è¯‘å™¨çš„é¡¹ç›®æ–‡ä»¶ï¼Œå¦‚æœä½ é‡åˆ°äº†ç›¸åŒçš„é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹æ¡ˆ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install -g node-gyp</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ç›´æ¥åˆ é™¤<code>package-lock.json</code>æˆ–<code>yarn.lock</code>ï¼Œç„¶åé‡æ–°<code>yarn install</code>æˆ–è€…<code>npm install</code>å³å¯ã€‚</p>
<p>å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå¯ä»¥å°è¯•å…ˆæ¸…é™¤å…¨å±€ä¸‹çš„<code>npm cache</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm cache clean -f</span><br></pre></td></tr></table></figure>

<p>å†æ‰§è¡Œä¸Šè¿°æ“ä½œ</p>
<h1 id="node-koa2-é¡¹ç›®ä¸­åˆ é™¤å·²è®¾ç½®çš„-cookie"><a href="#node-koa2-é¡¹ç›®ä¸­åˆ é™¤å·²è®¾ç½®çš„-cookie" class="headerlink" title="node + koa2 é¡¹ç›®ä¸­åˆ é™¤å·²è®¾ç½®çš„ cookie"></a>node + koa2 é¡¹ç›®ä¸­åˆ é™¤å·²è®¾ç½®çš„ cookie</h1><p>ç”±äº HTTP æ˜¯æ— çŠ¶æ€åè®®ï¼Œæ‰€ä»¥éœ€è¦ cookie æ¥åŒºåˆ†ç”¨æˆ·ä¹‹é—´çš„èº«ä»½ã€‚ æˆ‘ä»¬å¯ä»¥æŠŠ cookie ä½œä¸ºæ˜¯ä¸€ä¸ªç”±æµè§ˆå™¨å’ŒæœåŠ¡å™¨å…±åŒåä½œå®ç°çš„è§„èŒƒã€‚</p>
<p><code>cookie</code>çš„å¤„ç†åˆ†ä¸ºä»¥ä¸‹ 3 æ­¥ï¼š</p>
<ol>
<li>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€<code>cookie</code></li>
<li>æµè§ˆå™¨å°†<code>cookie</code>ä¿å­˜ï¼ˆå¯ä»¥åœ¨åç«¯è®¾ç½® expires æˆ–è€… maxAgeï¼Œä»¥<code>session</code>å½¢å¼å­˜åœ¨ï¼‰</li>
<li>æ¯æ¬¡æµè§ˆå™¨éƒ½ä¼šå°†ä¹‹å‰è®¾ç½®å¥½çš„<code>cookie</code>å‘å‘æœåŠ¡å™¨</li>
</ol>
<p>åœ¨å¼€å‘<code>node</code>åå°é¡¹ç›®æ—¶æˆ‘ä»¬ç»å¸¸æ¶‰åŠç”¨æˆ·ç®¡ç†æ¨¡å—ï¼Œè¿™æ„å‘³æˆ‘ä»¬éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œ<strong>ç™»å½•æ€</strong>ç®¡ç†ï¼Œåœ¨ç”¨æˆ·é€€å‡ºæ—¶èƒ½åŠæ—¶åˆ é™¤ç”¨æˆ·çš„<code>cookie</code>ã€‚<code>koa2</code>è‡ªå¸¦äº†å¤„ç†<code>cookie</code>çš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼è®¾ç½®<code>cookie</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(api.<span class="property">validVip</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    ctx.<span class="property">cookies</span>.<span class="title function_">set</span>(<span class="string">&#x27;vid&#x27;</span>ï¼Œ<span class="string">&#x27;xuxiaoxi&#x27;</span>ï¼Œ&#123; <span class="attr">maxAge</span>: <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span> &#125;);  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ä¸­è®¾ç½®äº†ä¸€ä¸ªæœ‰æ•ˆæœŸä¸º 1 å¤©çš„<code>cookie</code>ï¼Œé‚£å¦‚æœä¸šåŠ¡æœ‰å˜åŠ¨ï¼Œéœ€è¦åœ¨æœ‰æ•ˆæœŸå†…æ¸…ç©ºæ­¤<code>cookie</code>ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†å‘¢? </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ctx.<span class="property">cookies</span>.<span class="title function_">set</span>(<span class="string">&#x27;vid&#x27;</span>ï¼Œ<span class="string">&#x27;&#x27;</span>ï¼Œ&#123; <span class="attr">maxAge</span>: <span class="number">0</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å®¢æˆ·ç«¯çš„<code>cookie</code>å°†åœ¨ä¸‹æ¬¡è¯·æ±‚æ—¶è‡ªåŠ¨å¤±æ•ˆã€‚</p>
<h1 id="socket-io-ä¸-koa-é…åˆä½¿ç”¨"><a href="#socket-io-ä¸-koa-é…åˆä½¿ç”¨" class="headerlink" title="socket.io ä¸ koa é…åˆä½¿ç”¨"></a>socket.io ä¸ koa é…åˆä½¿ç”¨</h1><p>æˆ‘ä»¬éƒ½çŸ¥é“å®Œæ•´çš„<code>socket.io</code>é€šä¿¡ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:</p>
<ol>
<li>ä¸ <strong>NodeJS HTTP</strong> æœåŠ¡å™¨é›†æˆï¼ˆæˆ–å®‰è£…åœ¨å…¶ä¸Šï¼‰çš„ <strong>socket.io</strong></li>
<li>åœ¨æµè§ˆå™¨ç«¯åŠ è½½çš„å®¢æˆ·ç«¯åº“ <strong>socket.io-client</strong></li>
</ol>
<p>å¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>koa</code>æˆ–è€…<code>egg</code>ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬å†…éƒ¨é›†æˆçš„<code>http</code>å’Œ<code>socket.io</code>åšå…¼å®¹ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è¿™æ ·å¤„ç†:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> koa <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;http&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title function_">koa</span>();</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(app.<span class="title function_">callback</span>());</span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>)(server);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£å¸¸çš„ä¸šåŠ¡å¤„ç†</span></span><br><span class="line"><span class="comment">// io</span></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a user connected&#x27;</span>);</span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;doc load&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;doc load&#x27;</span>, msg);</span><br><span class="line">        io.<span class="title function_">emit</span>(<span class="string">&#x27;getData&#x27;</span>, users);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä»¥ä¸Šçš„æ–¹å¼å°±å¯ä»¥æ­£å¸¸çš„å°†<code>koa</code>å’Œ<code>socket.io</code> åšå…¼å®¹. åé¢æˆ‘ä»¬å°±å¯ä»¥æ­£å¸¸çš„å¼€å‘<code>IM</code>åº”ç”¨å•¦~</p>
<h1 id="ç”±äº-NodeJS-ç¬¬ä¸‰æ–¹æ¨¡å—ä¾èµ–ç‰¹å®š-node-ç‰ˆæœ¬å¯¼è‡´æŠ¥é”™"><a href="#ç”±äº-NodeJS-ç¬¬ä¸‰æ–¹æ¨¡å—ä¾èµ–ç‰¹å®š-node-ç‰ˆæœ¬å¯¼è‡´æŠ¥é”™" class="headerlink" title="ç”±äº NodeJS ç¬¬ä¸‰æ–¹æ¨¡å—ä¾èµ–ç‰¹å®š node ç‰ˆæœ¬å¯¼è‡´æŠ¥é”™"></a>ç”±äº NodeJS ç¬¬ä¸‰æ–¹æ¨¡å—ä¾èµ–ç‰¹å®š node ç‰ˆæœ¬å¯¼è‡´æŠ¥é”™</h1><p>è¿™ä¸ªæƒ…å†µç¬”è€…ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡ï¼Œä¸»è¦åŸå› æ˜¯ç¬¬ä¸‰æ–¹æ²¡æœ‰å’Œ<code>node</code>ç‰ˆæœ¬åšåˆ°å¾ˆå¥½çš„å‘åå…¼å®¹ã€‚æ­¤æ—¶è§£å†³æ–¹æ¡ˆå°±æ˜¯æ›´æ–°æ­¤ç¬¬ä¸‰æ–¹åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œæˆ–è€…ä½¿ç”¨<code>node</code>åŒ…ç®¡ç†å·¥å…·<code>nvm</code> åˆ‡æ¢åˆ°é€‚é…çš„<code>node</code>ç‰ˆæœ¬ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// æ›´æ–°æœ€æ–°çš„åŒ…</span><br><span class="line">npm i xxx@latest</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·</span><br><span class="line">npm i -g nvm</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <a href="https://github.com/nvm-sh/nvm">nvm</a> å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç®¡ç†<code>node</code>ç‰ˆæœ¬</p>
<h1 id="NodeJSåˆ›å»ºå®šæ—¶ä»»åŠ¡"><a href="#NodeJSåˆ›å»ºå®šæ—¶ä»»åŠ¡" class="headerlink" title="NodeJSåˆ›å»ºå®šæ—¶ä»»åŠ¡"></a>NodeJSåˆ›å»ºå®šæ—¶ä»»åŠ¡</h1><p>å®šæ—¶ä»»åŠ¡åœ¨åç«¯å¼€å‘ä¸­æ˜¯å¾ˆå¸¸è§çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå…¶æœ¬è´¨æ˜¯<strong>æ ¹æ®æ—¶é—´è§„åˆ™ï¼Œç³»ç»Ÿåœ¨åå°è‡ªåŠ¨æ‰§è¡Œç›¸åº”çš„ä»»åŠ¡</strong>. åœ¨<code>java</code>ï¼Œ<code>PHP</code> ç­‰åå°è¯­è¨€ä¸­æœ‰å¾ˆä¸°å¯Œçš„å®šæ—¶ä»»åŠ¡çš„æ”¯æŒï¼Œå¯¹äº<code>NodeJS</code> è¿™ä¸ªå…´èµ·ä¹‹ç§€æ¥è¯´ï¼Œè™½ç„¶æ²¡æœ‰é‚£ä¹ˆæˆç†Ÿçš„ç”Ÿæ€ï¼Œä½†æ˜¯ä»ç„¶æœ‰å®šæ—¶ä»»åŠ¡çš„æ¨¡å—ï¼Œæ¯”å¦‚<code>node-schedule</code>.</p>
<blockquote>
<p><strong>Node Schedule</strong> æ˜¯ç”¨äº Node.js çš„çµæ´»çš„ cron ç±»å’Œé cron ç±»ä½œä¸šè°ƒåº¦ç¨‹åºã€‚å®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨å¯é€‰çš„é‡å¤è§„åˆ™æ¥å®‰æ’ä½œä¸šï¼ˆä»»æ„å‡½æ•°ï¼‰åœ¨ç‰¹å®šæ—¥æœŸæ‰§è¡Œã€‚å®ƒåœ¨ä»»ä½•ç»™å®šæ—¶é—´ä»…ä½¿ç”¨ä¸€ä¸ªè®¡æ—¶å™¨ï¼ˆè€Œä¸æ˜¯æ¯ç§’é’Ÿ/åˆ†é’Ÿé‡æ–°è¯„ä¼°å³å°†åˆ°æ¥çš„ä½œä¸šï¼‰ã€‚</p>
</blockquote>
<p>ä¸€ä¸ªå¾ˆå®ç”¨çš„åœºæ™¯æ˜¯æˆ‘ä»¬æƒ³åœ¨æ¯å¹´çš„åŒåä¸€æˆ–è€…åŒåäºŒè®©<code>node</code>ç¨‹åºè‡ªåŠ¨æŠ“å–æŸç”µå•†çš„â€œå•†å“ç¾Šæ¯›â€ï¼Œå¹¶æ¨é€åˆ°è‡ªå·±çš„é‚®ç®±ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨<code>Node Schedule</code>æ¥å¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥æ‰§è¡Œæˆ‘ä»¬çš„ä¸šåŠ¡æ“ä½œï¼Œç¬”è€…çš„å¾ˆå¤š<code>node</code>åº”ç”¨éƒ½é‡‡ç”¨äº†ç±»ä¼¼çš„æ¨¡å¼.æ„Ÿå…´è¶£å¯ä»¥äº’ç›¸äº¤æµä¸€ä¸‹</p>
<p>é‚£ä»€ä¹ˆæ˜¯<code>cron</code>é£æ ¼çš„ Scheduling å‘¢? å…¶<code>github</code>ä¸Šç»™å‡ºäº†ä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/156929120-6fbc9043-c9b6-4962-a2e5-d19d15b6bc8c.png" alt="image"></p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒå¦‚ä¸‹æ–¹å¼è¿™æ ·æ¥å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> schedule = <span class="built_in">require</span>(<span class="string">&#x27;node-schedule&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> testJob = schedule.<span class="title function_">scheduleJob</span>(<span class="string">&#x27;22 * * * *&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;  </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å°†åœ¨æœªæ¥çš„æ¯ä¸ªæ—¶åˆ»çš„22åˆ†æ—¶æ‰§è¡Œæ­¤ä»£ç &#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="åœ¨-NodeJS-é¡¹ç›®ä¸­ä½¿ç”¨-ES6-ä¹‹åçš„è¯­æ³•"><a href="#åœ¨-NodeJS-é¡¹ç›®ä¸­ä½¿ç”¨-ES6-ä¹‹åçš„è¯­æ³•" class="headerlink" title="åœ¨ NodeJS é¡¹ç›®ä¸­ä½¿ç”¨ ES6 ä¹‹åçš„è¯­æ³•"></a>åœ¨ NodeJS é¡¹ç›®ä¸­ä½¿ç”¨ ES6 ä¹‹åçš„è¯­æ³•</h1><p>æˆ‘ä»¬éƒ½çŸ¥é“ç°åœ¨<code>NodeJS</code>ç‰ˆæœ¬å·²ç»åˆ° 16.0+ç‰ˆæœ¬äº†ï¼Œå¯¹æœ€æ–°çš„ ES è¯­æ³•æ”¯æŒçš„ä¹Ÿè¶³å¤Ÿå¥½ï¼Œä½†æ˜¯ç›®å‰ä»ç„¶æœ‰ä¸€äº›è¯­æ³•ä¸æ”¯æŒï¼Œæ¯”å¦‚<code>import</code>ï¼Œ<code>export</code>ï¼Œ<code>@decorator</code>ç­‰ã€‚æ­¤æ—¶æˆ‘ä»¬è¦åœ¨<code>node</code>é¡¹ç›®ä¸­ä½¿ç”¨è¿™äº›æ–°ç‰¹æ€§ï¼Œå¯ä»¥é‡‡ç”¨<code>babel</code>æ¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [ </span><br><span class="line">        [    </span><br><span class="line">            <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">            &#123;       </span><br><span class="line">                <span class="string">&quot;targets&quot;</span>: &#123; </span><br><span class="line">                    <span class="string">&quot;node&quot;</span>: <span class="string">&quot;current&quot;</span> </span><br><span class="line">                &#125;      </span><br><span class="line">            &#125;   </span><br><span class="line">        ] </span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">&quot;@babel/plugin-proposal-decorators&quot;</span>,</span><br><span class="line">            &#123; <span class="string">&quot;legacy&quot;</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">            <span class="string">&quot;@babel/plugin-proposal-class-properties&quot;</span>,</span><br><span class="line">            &#123; <span class="string">&quot;loose&quot;</span> : <span class="literal">true</span> &#125;</span><br><span class="line">        ]  </span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> æˆ‘ä»¬åªéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•é‡Œæ–°å»ºå¹¶å†™å…¥å¦‚ä¸Šæ–‡ä»¶ï¼Œå¹¶å®‰è£…<code>babel</code>å¯¹åº”çš„æ¨¡å—å³å¯ï¼Œå¦‚ä¸‹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yarn add @babel/cli @babel/core @babel/node @babel/plugin-proposal-class-properties @babel/plugin-proposal-decorators @babel/preset-env</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨è¿™äº›æ–°è¯­æ³•ç‰¹æ€§äº†</p>
<h1 id="NodeJSä¸­ä¼˜é›…çš„å¤„ç†-json-æ–‡ä»¶ä»¥åŠæé«˜-json-è¯»å†™æ€§èƒ½"><a href="#NodeJSä¸­ä¼˜é›…çš„å¤„ç†-json-æ–‡ä»¶ä»¥åŠæé«˜-json-è¯»å†™æ€§èƒ½" class="headerlink" title="NodeJSä¸­ä¼˜é›…çš„å¤„ç† json æ–‡ä»¶ä»¥åŠæé«˜ json è¯»å†™æ€§èƒ½"></a>NodeJSä¸­ä¼˜é›…çš„å¤„ç† json æ–‡ä»¶ä»¥åŠæé«˜ json è¯»å†™æ€§èƒ½</h1><p>å¯¹äº<code>NodeJS</code>ä¼˜åŒ–æ–¹é¢å…¶å®æœ‰å¾ˆå¤šè¦èŠçš„ï¼Œè¿™é‡Œä¸»è¦æ¥è¯´è¯´<code>json</code>ç›¸å…³çš„ä¼˜åŒ–æ–¹æ¡ˆ.ã€‚ä¸»è¦ä»ä¸¤ä¸ªæ–¹é¢æ¥ä¼˜åŒ–ï¼š</p>
<ol>
<li><code>json</code>æ–‡ä»¶çš„è¯»å†™æ€§èƒ½ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>fast-json-stringify</code> æ¥å¤§å¤§æé«˜<code>json</code>çš„è¯»å†™é€Ÿåº¦ï¼Œå…¶æœ¬è´¨æ˜¯æä¾›äº†ä¸€å¥—<code>json-schema</code>çº¦æŸï¼Œè®©<code>json</code>ç»“æ„æ›´åŠ æœ‰åºï¼Œä»è€Œæé«˜<code>json</code>çš„è¯»å–æŸ¥è¯¢é€Ÿåº¦ï¼š</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fastJson = <span class="built_in">require</span>(<span class="string">&#x27;fast-json-stringify&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stringify = <span class="title function_">fastJson</span>(&#123;  </span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;demo&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">    <span class="attr">properties</span>: &#123;   </span><br><span class="line">        <span class="attr">firstName</span>: &#123;  </span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">lastName</span>: &#123; </span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">age</span>: &#123; </span><br><span class="line">            <span class="attr">description</span>: <span class="string">&#x27;Age in years&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;integer&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">reg</span>: &#123; </span><br><span class="line">        	<span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬åœ¨<code>node</code> ç«¯æ“ä½œ jsonï¼Œå¦‚æœç”¨åŸç”Ÿçš„å†™æ³•ä¼šéå¸¸éº»çƒ¦ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ€å¥½è‡ªå·±å¯¹ json è¯»å–è¿›è¡Œå°è£…æ¥æé«˜ä»£ç çš„ç®€çº¦æ€§ï¼Œæˆ–è€…æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“<code>jsonfile</code> æ¥è½»æ¾è¯»å†™<code>json</code>æ–‡ä»¶ï¼š</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> json = <span class="built_in">require</span>(<span class="string">&#x27;jsonfile&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fileName = <span class="string">&#x27;test.json&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> jsonData = jsonFile.<span class="title function_">readFileSync</span>(fileName);</span><br></pre></td></tr></table></figure>

<h1 id="NodeJSè¯»å–å¤§æ–‡ä»¶æŠ¥é”™"><a href="#NodeJSè¯»å–å¤§æ–‡ä»¶æŠ¥é”™" class="headerlink" title="NodeJSè¯»å–å¤§æ–‡ä»¶æŠ¥é”™"></a>NodeJSè¯»å–å¤§æ–‡ä»¶æŠ¥é”™</h1><p>åœ¨<code>NodeJS</code>ä¸­ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼æ¥è¯»å†™æ–‡ä»¶ï¼Œå¦‚ä¸‹:</p>
<ol>
<li><strong>fs.readFile()</strong> ä¸€æ¬¡æ€§å°†æ–‡ä»¶è¯»å–è¿›å†…å­˜ä¸­ï¼Œå¦‚æœæ–‡ä»¶è¿‡å¤§ä¼šå¯¼è‡´<code>node</code>å†…å­˜ä¸å¤Ÿè€ŒæŠ¥é”™</li>
<li><strong>fs.createReadStream()</strong> ä»¥æ–‡ä»¶æµçš„æ–¹å¼è¯»å–ï¼Œæ­¤æ—¶å¯ä»¥ä¸ç”¨æ‹…å¿ƒæ–‡ä»¶çš„å¤§å°</li>
</ol>
<p>ç”±ä»¥ä¸Šä»‹ç»å¯çŸ¥å¦‚æœæˆ‘ä»¬è¦è¯»å–çš„æ–‡ä»¶å¯èƒ½ä¼šå¾ˆå¤§(æ¯”å¦‚è§†é¢‘ç­‰å¤§æ–‡ä»¶)ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å°±è¦ä½¿ç”¨ **fs.createReadStream()**ï¼Œå…¶å®å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œè§£æï¼Œæ¯”å¦‚è¦å¯¹ç®€å†ç­‰æ–‡ä»¶è¿›è¡Œé€è¡Œè§£ææå–å…³é”®è¯­æ–™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>node</code>çš„<code>readline</code>æ¨¡å—ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œé€è¡Œè¯»å–å¹¶è§£æï¼Œå¦‚ä¸‹æ¡ˆä¾‹:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">&quot;readline&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> readlineTask = readline.<span class="title function_">createInterface</span>(&#123;</span><br><span class="line">    <span class="attr">input</span>: fs.<span class="title function_">createReadStream</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./lib&#x27;</span>)) </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">readlineTask.<span class="title function_">on</span>(<span class="string">&#x27;line&#x27;</span>, <span class="keyword">function</span>(<span class="params">chunk</span>) &#123; </span><br><span class="line">    <span class="comment">// è¯»å–æ¯ä¸€è¡Œæ•°æ®</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">readlineTask.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;  </span><br><span class="line">    <span class="comment">//æ–‡ä»¶è¯»å–ç»“æŸçš„é€»è¾‘</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="NodeJS-å¼€å¯-gzip-ä¼˜åŒ–ç½‘ç«™æ€§èƒ½"><a href="#NodeJS-å¼€å¯-gzip-ä¼˜åŒ–ç½‘ç«™æ€§èƒ½" class="headerlink" title="NodeJS å¼€å¯ gzip ä¼˜åŒ–ç½‘ç«™æ€§èƒ½"></a>NodeJS å¼€å¯ gzip ä¼˜åŒ–ç½‘ç«™æ€§èƒ½</h1><p>å¯¹äº<code>NodeJS</code>å¼€å¯<code>gzip</code> çš„æ“ä½œä¹Ÿå±äº node æ€§èƒ½ä¼˜åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œç»è¿‡è¿™æ ·çš„å¤„ç†å¯ä»¥è®©ç½‘ç«™åŠ è½½æ›´å¿«ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨<code>koa</code>çš„<code>koa-compress</code>ä¸­é—´ä»¶æ¥å®ç°<code>gzip</code> åŠŸèƒ½ã€‚ å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> koa <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> compress <span class="keyword">from</span> <span class="string">&#x27;koa-compress&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title function_">koa</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å¯gzip</span></span><br><span class="line"><span class="keyword">const</span> options = &#123; <span class="attr">threshold</span>: <span class="number">2048</span> &#125;;</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">compress</span>(options));</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶<code>koa-compress</code>è¿˜æœ‰å¾ˆå¤šè‡ªå®šä¹‰çš„é…ç½®é¡¹ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œé˜…è¯»å®˜æ–¹æ–‡æ¡£</p>
<h1 id="windows-å’Œ-linux-ç³»ç»Ÿä¸‹è·¯å¾„åˆ†éš”ç¬¦ä¸ä¸€è‡´"><a href="#windows-å’Œ-linux-ç³»ç»Ÿä¸‹è·¯å¾„åˆ†éš”ç¬¦ä¸ä¸€è‡´" class="headerlink" title="windows å’Œ linux ç³»ç»Ÿä¸‹è·¯å¾„åˆ†éš”ç¬¦ä¸ä¸€è‡´"></a>windows å’Œ linux ç³»ç»Ÿä¸‹è·¯å¾„åˆ†éš”ç¬¦ä¸ä¸€è‡´</h1><p>è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯ç³»ç»Ÿä¹‹é—´çš„å·®å¼‚å¯¼è‡´çš„ï¼Œä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“åœ¨<code>linux</code>ç³»ç»Ÿä¸‹è·¯å¾„çš„åˆ†éš”ç¬¦ä¸º<code>/</code>ï¼Œæ¯”å¦‚<code>lib/src/pages</code>ï¼Œä½†æ˜¯åœ¨<code>windows</code>ä¸‹è§£æçš„å¯èƒ½å°±æ˜¯<code>lib\\src\\pages</code>è¿™æ ·çš„è·¯å¾„ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦åšé€‚é…ï¼Œä¸ç„¶æˆ‘ä»¬éƒ¨ç½²åˆ°ä¸åŒç³»ç»Ÿä¸ŠæŠ¥é”™æ˜¯å¿…ç„¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…¨å±€é…ç½®è·¯å¾„é€šé…ç¬¦ï¼Œç¬”è€…çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os <span class="keyword">from</span> <span class="string">&#x27;os&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _$ = (os.<span class="title function_">platform</span>().<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;win32&#x27;</span>) ? <span class="string">&#x27;\\&#x27;</span> : <span class="string">&#x27;/&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æ¶‰åŠåˆ°å…·ä½“è·¯å¾„çš„åœ°æ–¹æˆ‘ä»¬ç”¨<code>_$</code> ä»£æ›¿å³å¯ï¼Œä»¥ä¸Šä»£ç æˆ‘ä»¬ç”¨åˆ°äº†<code>node</code>çš„<code>os</code>æ¨¡å—ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç ”ç©¶ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>os</code>æ¨¡å—å¤„ç†å¾ˆå¤šæœ‰æ„æ€çš„å› ä¸ºç³»ç»Ÿå·®å¼‚å¯¼è‡´çš„é—®é¢˜</p>
<h1 id="NodeJSå¦‚ä½•å®ç°çˆ¶å­è¿›ç¨‹é€šä¿¡"><a href="#NodeJSå¦‚ä½•å®ç°çˆ¶å­è¿›ç¨‹é€šä¿¡" class="headerlink" title="NodeJSå¦‚ä½•å®ç°çˆ¶å­è¿›ç¨‹é€šä¿¡"></a>NodeJSå¦‚ä½•å®ç°çˆ¶å­è¿›ç¨‹é€šä¿¡</h1><p>ç”±äº<code>NodeJS</code>æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ”¯æŒå¤„ç†å¤šä¸ªè¿›ç¨‹çš„ä¸šåŠ¡ï¼Œç›®å‰<code>NodeJS</code>å¯ä»¥é€šè¿‡ä½¿ç”¨<code>child_process</code>çˆ¶å­è¿›ç¨‹çš„æ¨¡å¼æ¥æ¨¡æ‹Ÿå¤šè¿›ç¨‹ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/156929152-89ff27b8-27b0-47e0-85d1-27ad3e06e42f.png" alt="image"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// child.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">computedTotal</span>(<span class="params">arr, cb</span>) &#123;   </span><br><span class="line">    <span class="comment">// è€—æ—¶è®¡ç®—ä»»åŠ¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸ä¸»è¿›ç¨‹é€šä¿¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ä¸»è¿›ç¨‹ä¿¡å·</span></span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="title function_">computedTotal</span>(bigDataArr, <span class="function">(<span class="params">flag</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å‘ä¸»è¿›ç¨‹å‘é€å®Œæˆä¿¡å·  </span></span><br><span class="line">        process.<span class="title function_">send</span>(flag);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; fork &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123; </span><br><span class="line">    <span class="keyword">if</span>(ctx.<span class="property">url</span> === <span class="string">&#x27;/fetch&#x27;</span>) &#123;  </span><br><span class="line">        <span class="keyword">const</span> data = ctx.<span class="property">request</span>.<span class="property">body</span>;    </span><br><span class="line">        <span class="comment">// é€šçŸ¥å­è¿›ç¨‹å¼€å§‹æ‰§è¡Œä»»åŠ¡,å¹¶ä¼ å…¥æ•°æ®</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">createPromisefork</span>(<span class="string">&#x27;./child.js&#x27;</span>, data); </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="comment">// åˆ›å»ºå¼‚æ­¥çº¿ç¨‹  </span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createPromisefork</span>(<span class="params">childUrl, data</span>) &#123; </span><br><span class="line">        <span class="comment">// åŠ è½½å­è¿›ç¨‹   </span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="title function_">fork</span>(childUrl);</span><br><span class="line">        <span class="comment">// é€šçŸ¥å­è¿›ç¨‹å¼€å§‹work </span></span><br><span class="line">        data &amp;&amp; res.<span class="title function_">send</span>(data);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">reslove</span> =&gt;</span> &#123;   </span><br><span class="line">            res.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">f</span> =&gt;</span> &#123;   </span><br><span class="line">                   <span class="title function_">reslove</span>(f);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="node-ç«¯å®ç°å›¾ç‰‡ç¼–è¾‘-å‹ç¼©"><a href="#node-ç«¯å®ç°å›¾ç‰‡ç¼–è¾‘-å‹ç¼©" class="headerlink" title="node ç«¯å®ç°å›¾ç‰‡ç¼–è¾‘ / å‹ç¼©"></a>node ç«¯å®ç°å›¾ç‰‡ç¼–è¾‘ / å‹ç¼©</h1><p>å›¾ç‰‡ç¼–è¾‘å‹ç¼©åœ¨å¾ˆå¤šåœºæ™¯ä¸­ç”¨å‰ç«¯çš„æŠ€æœ¯å®ç°æ¯”è¾ƒå¸¸è§ï¼Œå…¶å®åœ¨<code>node</code>ç«¯ä¹Ÿæœ‰å¾ˆå¤šéœ€è¦å¤„ç†çš„å›¾ç‰‡éœ€è¦ï¼Œæ¯•ç«Ÿå®¢æˆ·ç«¯å¤„ç†çš„è´¨é‡ä¸å¥½æ§åˆ¶ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>node-images</code>ï¼Œä»–æ˜¯ä¸€æ¬¾<code>node</code> ç«¯è½»é‡çº§è·¨å¹³å°å›¾åƒç¼–è§£ç åº“ï¼Œå…¶ä¸»è¦ç‰¹æ€§å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>è½»é‡çº§</strong>ï¼šæ— éœ€å®‰è£…ä»»ä½•å›¾åƒå¤„ç†åº“ã€‚</li>
<li><strong>è·¨å¹³å°</strong>ï¼šWindows ä¸‹å‘å¸ƒäº†ç¼–è¯‘å¥½çš„.node æ–‡ä»¶,ä¸‹è½½å°±èƒ½ç”¨ã€‚</li>
<li><strong>ä½¿ç”¨ç®€å•</strong>ï¼šjQuery é£æ ¼çš„ APIï¼Œç®€å•å¯ä¾èµ–</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥è£å‰ªï¼Œå‹ç¼©å›¾ç‰‡ï¼ŒåŸºæœ¬ä½¿ç”¨å¦‚ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> images = <span class="built_in">require</span>(<span class="string">&quot;images&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">images</span>(<span class="string">&quot;input.jpg&quot;</span>)  <span class="comment">// åŠ è½½å›¾åƒæ–‡ä»¶</span></span><br><span class="line">    .<span class="title function_">size</span>(<span class="number">400</span>)  <span class="comment">// ç­‰æ¯”ç¼©æ”¾å›¾åƒåˆ°400åƒç´ å®½</span></span><br><span class="line">    .<span class="title function_">draw</span>(<span class="title function_">images</span>(<span class="string">&quot;logo.png&quot;</span>), <span class="number">10</span>, <span class="number">10</span>)   <span class="comment">// åœ¨(10, 10)å¤„ç»˜åˆ¶Logo</span></span><br><span class="line">    .<span class="title function_">save</span>(<span class="string">&quot;output.jpg&quot;</span>, &#123;quality : <span class="number">50</span>&#125;);  <span class="comment">// ä¿å­˜å›¾ç‰‡åˆ°æ–‡ä»¶,å›¾ç‰‡è´¨é‡ä¸º50</span></span><br></pre></td></tr></table></figure>

<h1 id="node-åº”ç”¨è´Ÿè½½å‡è¡¡å’Œè¿›ç¨‹ç®¡ç†"><a href="#node-åº”ç”¨è´Ÿè½½å‡è¡¡å’Œè¿›ç¨‹ç®¡ç†" class="headerlink" title="node åº”ç”¨è´Ÿè½½å‡è¡¡å’Œè¿›ç¨‹ç®¡ç†"></a>node åº”ç”¨è´Ÿè½½å‡è¡¡å’Œè¿›ç¨‹ç®¡ç†</h1><p>è§£å†³æ­¤é—®é¢˜æœ€å¥½çš„æ–¹å¼å°±æ˜¯é‡‡ç”¨<code>pm2</code> æˆ–è€…<code>forever</code>ï¼Œå…¶æä¾›äº†å¼ºå¤§çš„<code>node</code>è¿›ç¨‹ç®¡ç†ï¼Œè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œå¹¶æä¾›äº†ä¸€å®šç¨‹åº¦çš„åº”ç”¨ç›‘æ§ï¼Œå»ºè®®åœ¨çº¿ä¸Šç¯å¢ƒä½¿ç”¨<code>pm2</code> æ¥ç®¡ç†<code>node</code>åº”ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>NodeJS</category>
      </categories>
      <tags>
        <tag>NodeJS</tag>
      </tags>
  </entry>
  <entry>
    <title>å…«è‚¡æ–‡ç³»åˆ—ï¼ˆå››ï¼‰â€”â€” RabbitMQ</title>
    <url>/2021/09/21/RabbitMQ/</url>
    <content><![CDATA[<p>è¿™æ˜¯å…«è‚¡æ–‡ç³»åˆ—çš„ç¬¬å››ç¯‡æ–‡ç« ï¼Œä¸»è¦æ˜¯å…³äºRabbitMQçš„é¢è¯•å¸¸é—®é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡ä»…ä»…åˆ—ä¸¾é—®é¢˜çš„éƒ¨åˆ†å¸¸è§è§£ç­”ï¼Œè¯¦ç»†å›ç­”éœ€ç»“åˆå®˜æ–¹æ–‡æ¡£å’Œæ—¥å¸¸å·¥ä½œä½¿ç”¨ç»éªŒã€‚ğŸ˜‰</p>
<span id="more"></span>

<h2 id="1-RabbitMQæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-RabbitMQæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.RabbitMQæ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.RabbitMQæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>RabbitMQæ˜¯å®ç°äº†é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAMQPï¼‰çš„å¼€æºæ¶ˆæ¯ä»£ç†è½¯ä»¶ï¼ˆäº¦ç§°é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼‰ã€‚RabbitMQæœåŠ¡å™¨æ˜¯ç”¨Erlangè¯­è¨€ç¼–å†™çš„ï¼Œè€Œç¾¤é›†å’Œæ•…éšœè½¬ç§»æ˜¯æ„å»ºåœ¨å¼€æ”¾ç”µä¿¡å¹³å°æ¡†æ¶ä¸Šçš„ã€‚æ‰€æœ‰ä¸»è¦çš„ç¼–ç¨‹è¯­è¨€å‡æœ‰ä¸ä»£ç†æ¥å£é€šè®¯çš„å®¢æˆ·ç«¯åº“ã€‚<br>PS:ä¹Ÿå¯èƒ½ç›´æ¥é—®ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—å°±æ˜¯ä¸€ä¸ªä½¿ç”¨é˜Ÿåˆ—æ¥é€šä¿¡çš„ç»„ä»¶</p>
<h2 id="2-RabbitMQç‰¹ç‚¹"><a href="#2-RabbitMQç‰¹ç‚¹" class="headerlink" title="2.RabbitMQç‰¹ç‚¹?"></a>2.RabbitMQç‰¹ç‚¹?</h2><p>å¯é æ€§: RabbitMQä½¿ç”¨ä¸€äº›æœºåˆ¶æ¥ä¿è¯å¯é æ€§ï¼Œ å¦‚æŒä¹…åŒ–ã€ä¼ è¾“ç¡®è®¤åŠå‘å¸ƒç¡®è®¤ç­‰ã€‚<br>çµæ´»çš„è·¯ç”± : åœ¨æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—ä¹‹å‰ï¼Œé€šè¿‡äº¤æ¢å™¨æ¥è·¯ç”±æ¶ˆæ¯ã€‚å¯¹äºå…¸å‹çš„è·¯ç”±åŠŸèƒ½ï¼Œ RabbitMQ å·±ç»æä¾›äº†ä¸€äº›å†…ç½®çš„äº¤æ¢å™¨æ¥å®ç°ã€‚é’ˆå¯¹æ›´å¤æ‚çš„è·¯ç”±åŠŸèƒ½ï¼Œå¯ä»¥å°†å¤šä¸ª äº¤æ¢å™¨ç»‘å®šåœ¨ä¸€èµ·ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶æœºåˆ¶æ¥å®ç°è‡ªå·±çš„äº¤æ¢å™¨ã€‚<br>æ‰©å±•æ€§: å¤šä¸ªRabbitMQèŠ‚ç‚¹å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µåŠ¨æ€åœ°æ‰©å±• é›†ç¾¤ä¸­èŠ‚ç‚¹ã€‚<br>é«˜å¯ç”¨æ€§ : é˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„æœºå™¨ä¸Šè®¾ç½®é•œåƒï¼Œä½¿å¾—åœ¨éƒ¨åˆ†èŠ‚ç‚¹å‡ºç°é—®é¢˜çš„æƒ…å†µä¸‹é˜Ÿ åˆ—ä»ç„¶å¯ç”¨ã€‚<br>å¤šç§åè®®: RabbitMQé™¤äº†åŸç”Ÿæ”¯æŒAMQPåè®®ï¼Œè¿˜æ”¯æŒSTOMPï¼Œ MQTTç­‰å¤šç§æ¶ˆæ¯ ä¸­é—´ä»¶åè®®ã€‚<br>å¤šè¯­è¨€å®¢æˆ·ç«¯ :RabbitMQ å‡ ä¹æ”¯æŒæ‰€æœ‰å¸¸ç”¨è¯­è¨€ï¼Œæ¯”å¦‚ Javaã€ Pythonã€ Rubyã€ PHPã€ C#ã€ JavaScript ç­‰ã€‚<br>ç®¡ç†ç•Œé¢ : RabbitMQ æä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„ç”¨æˆ·ç•Œé¢ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ç›‘æ§å’Œç®¡ç†æ¶ˆæ¯ã€é›† ç¾¤ä¸­çš„èŠ‚ç‚¹ç­‰ã€‚<br>ä»¤æ’ä»¶æœºåˆ¶ : RabbitMQ æä¾›äº†è®¸å¤šæ’ä»¶ ï¼Œ ä»¥å®ç°ä»å¤šæ–¹é¢è¿›è¡Œæ‰©å±•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç¼–å†™è‡ª å·±çš„æ’ä»¶ã€‚</p>
<h2 id="3-AMQPæ˜¯ä»€ä¹ˆ"><a href="#3-AMQPæ˜¯ä»€ä¹ˆ" class="headerlink" title="3.AMQPæ˜¯ä»€ä¹ˆ?"></a>3.AMQPæ˜¯ä»€ä¹ˆ?</h2><p>RabbitMQå°±æ˜¯ AMQP åè®®çš„ Erlang çš„å®ç°(å½“ç„¶ RabbitMQ è¿˜æ”¯æŒ STOMP2ã€ MQTT3 ç­‰åè®® ) AMQP çš„æ¨¡å‹æ¶æ„ å’Œ RabbitMQ çš„æ¨¡å‹æ¶æ„æ˜¯ä¸€æ ·çš„ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢å™¨ï¼Œäº¤æ¢å™¨å’Œé˜Ÿåˆ—ç»‘å®š ã€‚<br>RabbitMQ ä¸­çš„äº¤æ¢å™¨ã€äº¤æ¢å™¨ç±»å‹ã€é˜Ÿåˆ—ã€ç»‘å®šã€è·¯ç”±é”®ç­‰éƒ½æ˜¯éµå¾ªçš„ AMQP åè®®ä¸­ç›¸ åº”çš„æ¦‚å¿µã€‚ç›®å‰ RabbitMQ æœ€æ–°ç‰ˆæœ¬é»˜è®¤æ”¯æŒçš„æ˜¯ AMQP 0-9-1ã€‚</p>
<h2 id="4-AMQPåè®®3å±‚ï¼Ÿ"><a href="#4-AMQPåè®®3å±‚ï¼Ÿ" class="headerlink" title="4.AMQPåè®®3å±‚ï¼Ÿ"></a>4.AMQPåè®®3å±‚ï¼Ÿ</h2><p>Module Layer:åè®®æœ€é«˜å±‚ï¼Œä¸»è¦å®šä¹‰äº†ä¸€äº›å®¢æˆ·ç«¯è°ƒç”¨çš„å‘½ä»¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç”¨è¿™äº›å‘½ä»¤å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚<br>Session Layer:ä¸­é—´å±‚ï¼Œä¸»è¦è´Ÿè´£å®¢æˆ·ç«¯å‘½ä»¤å‘é€ç»™æœåŠ¡å™¨ï¼Œå†å°†æœåŠ¡ç«¯åº”ç­”è¿”å›å®¢æˆ·ç«¯ï¼Œæä¾›å¯é æ€§åŒæ­¥æœºåˆ¶å’Œé”™è¯¯å¤„ç†ã€‚<br>TransportLayer:æœ€åº•å±‚ï¼Œä¸»è¦ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®æµï¼Œæä¾›å¸§çš„å¤„ç†ã€ä¿¡é“æœç”¨ã€é”™è¯¯æ£€æµ‹å’Œæ•°æ®è¡¨ç¤ºç­‰ã€‚</p>
<h2 id="5-AMQPæ¨¡å‹çš„å‡ å¤§ç»„ä»¶ï¼Ÿ"><a href="#5-AMQPæ¨¡å‹çš„å‡ å¤§ç»„ä»¶ï¼Ÿ" class="headerlink" title="5.AMQPæ¨¡å‹çš„å‡ å¤§ç»„ä»¶ï¼Ÿ"></a>5.AMQPæ¨¡å‹çš„å‡ å¤§ç»„ä»¶ï¼Ÿ</h2><ul>
<li>äº¤æ¢å™¨ (Exchange)ï¼šæ¶ˆæ¯ä»£ç†æœåŠ¡å™¨ä¸­ç”¨äºæŠŠæ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—çš„ç»„ä»¶ã€‚</li>
<li>é˜Ÿåˆ— (Queue)ï¼šç”¨æ¥å­˜å‚¨æ¶ˆæ¯çš„æ•°æ®ç»“æ„ï¼Œä½äºç¡¬ç›˜æˆ–å†…å­˜ä¸­ã€‚</li>
<li>ç»‘å®š (Binding)ï¼šä¸€å¥—è§„åˆ™ï¼Œå‘ŠçŸ¥äº¤æ¢å™¨æ¶ˆæ¯åº”è¯¥å°†æ¶ˆæ¯æŠ•é€’ç»™å“ªä¸ªé˜Ÿåˆ—ã€‚</li>
</ul>
<h2 id="6-è¯´è¯´ç”Ÿäº§è€…Producerå’Œæ¶ˆè´¹è€…Consumer"><a href="#6-è¯´è¯´ç”Ÿäº§è€…Producerå’Œæ¶ˆè´¹è€…Consumer" class="headerlink" title="6.è¯´è¯´ç”Ÿäº§è€…Producerå’Œæ¶ˆè´¹è€…Consumer?"></a>6.è¯´è¯´ç”Ÿäº§è€…Producerå’Œæ¶ˆè´¹è€…Consumer?</h2><p>ç”Ÿäº§è€…</p>
<ul>
<li>æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯æŠ•é€’æ¶ˆæ¯çš„ä¸€æ–¹ã€‚</li>
<li>æ¶ˆæ¯ä¸€èˆ¬åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šæ¶ˆæ¯ä½“ï¼ˆpayload)å’Œæ ‡ç­¾(Label)ã€‚</li>
</ul>
<p>æ¶ˆè´¹è€…</p>
<ul>
<li>æ¶ˆè´¹æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶æ¶ˆæ¯çš„ä¸€æ–¹ã€‚</li>
<li>æ¶ˆè´¹è€…è¿æ¥åˆ°RabbitMQæœåŠ¡å™¨ï¼Œå¹¶è®¢é˜…åˆ°é˜Ÿåˆ—ä¸Šã€‚æ¶ˆè´¹æ¶ˆæ¯æ—¶åªæ¶ˆè´¹æ¶ˆæ¯ä½“ï¼Œä¸¢å¼ƒæ ‡ç­¾ã€‚</li>
</ul>
<h2 id="7-ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"><a href="#7-ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="7.ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"></a>7.ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</h2><p>ä»æœ¬è´¨ä¸Šæ¥è¯´æ˜¯å› ä¸ºäº’è”ç½‘çš„å¿«é€Ÿå‘å±•ï¼Œä¸šåŠ¡ä¸æ–­æ‰©å¼ ï¼Œä¿ƒä½¿æŠ€æœ¯æ¶æ„éœ€è¦ä¸æ–­çš„æ¼”è¿›ã€‚<br>ä»ä»¥å‰çš„å•ä½“æ¶æ„åˆ°ç°åœ¨çš„å¾®æœåŠ¡æ¶æ„ï¼Œæˆç™¾ä¸Šåƒçš„æœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨å’Œä¾èµ–ã€‚ä»äº’è”ç½‘åˆæœŸä¸€ä¸ªæœåŠ¡å™¨ä¸Šæœ‰ 100 ä¸ªåœ¨çº¿ç”¨æˆ·å·²ç»å¾ˆäº†ä¸å¾—ï¼Œåˆ°ç°åœ¨åæ‹¥10äº¿æ—¥æ´»çš„å¾®ä¿¡ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªã€Œå·¥å…·ã€æ¥è§£è€¦æœåŠ¡ä¹‹é—´çš„å…³ç³»ã€æ§åˆ¶èµ„æºåˆç†åˆæ—¶çš„ä½¿ç”¨ä»¥åŠç¼“å†²æµé‡æ´ªå³°ç­‰ç­‰ã€‚å› æ­¤ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å°±åº”è¿è€Œç”Ÿäº†ã€‚<br>å®ƒå¸¸ç”¨æ¥å®ç°ï¼šå¼‚æ­¥å¤„ç†ã€æœåŠ¡è§£è€¦ã€æµé‡æ§åˆ¶ï¼ˆå‰Šå³°ï¼‰ã€‚</p>
<h2 id="8-è¯´è¯´BrokeræœåŠ¡èŠ‚ç‚¹ã€Queueé˜Ÿåˆ—ã€Exchangeäº¤æ¢å™¨ï¼Ÿ"><a href="#8-è¯´è¯´BrokeræœåŠ¡èŠ‚ç‚¹ã€Queueé˜Ÿåˆ—ã€Exchangeäº¤æ¢å™¨ï¼Ÿ" class="headerlink" title="8.è¯´è¯´BrokeræœåŠ¡èŠ‚ç‚¹ã€Queueé˜Ÿåˆ—ã€Exchangeäº¤æ¢å™¨ï¼Ÿ"></a>8.è¯´è¯´BrokeræœåŠ¡èŠ‚ç‚¹ã€Queueé˜Ÿåˆ—ã€Exchangeäº¤æ¢å™¨ï¼Ÿ</h2><ul>
<li>Brokerå¯ä»¥çœ‹åšRabbitMQçš„æœåŠ¡èŠ‚ç‚¹ã€‚ä¸€èˆ¬è¯·ä¸‹ä¸€ä¸ªBrokerå¯ä»¥çœ‹åšä¸€ä¸ªRabbitMQæœåŠ¡å™¨ã€‚</li>
<li>Queue:RabbitMQçš„å†…éƒ¨å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨æ¶ˆæ¯ã€‚å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…åŒä¸€é˜Ÿåˆ—ï¼Œè¿™æ—¶é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šè¢«å¹³æ‘Šï¼ˆè½®è¯¢ï¼‰ç»™å¤šä¸ªæ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ã€‚</li>
<li>Exchange:ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°äº¤æ¢å™¨ï¼Œç”±äº¤æ¢å™¨å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªé˜Ÿåˆ—ä¸­ã€‚å½“è·¯ç”±ä¸åˆ°æ—¶ï¼Œæˆ–è¿”å›ç»™ç”Ÿäº§è€…æˆ–ç›´æ¥ä¸¢å¼ƒã€‚</li>
</ul>
<h2 id="9-æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹"><a href="#9-æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹" class="headerlink" title="9.æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹"></a>9.æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹ä¸Šé¢å·²ç»è¯´äº†ï¼Œå°±æ˜¯åœ¨ç‰¹æ®Šåœºæ™¯ä¸‹æœ‰å…¶å¯¹åº”çš„å¥½å¤„ï¼Œè§£è€¦ã€å¼‚æ­¥ã€å‰Šå³°ã€‚ç¼ºç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li>ç³»ç»Ÿå¯ç”¨æ€§é™ä½ ç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œè¶Šå®¹æ˜“æŒ‚æ‰ã€‚ä¸‡ä¸€ MQ æŒ‚äº†ï¼ŒMQ ä¸€æŒ‚ï¼Œæ•´å¥—ç³»ç»Ÿå´© æºƒï¼Œä½ ä¸å°±å®Œäº†ï¼Ÿ</li>
<li>ç³»ç»Ÿå¤æ‚åº¦æé«˜ ç¡¬ç”Ÿç”ŸåŠ ä¸ª MQ è¿›æ¥ï¼Œä½ æ€ä¹ˆä¿è¯æ¶ˆæ¯æ²¡æœ‰é‡å¤æ¶ˆè´¹ï¼Ÿæ€ä¹ˆå¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼Ÿ</li>
<li>æ€ä¹ˆä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼Ÿé—®é¢˜ä¸€å¤§å †ã€‚</li>
<li>ä¸€è‡´æ€§é—®é¢˜ A ç³»ç»Ÿå¤„ç†å®Œäº†ç›´æ¥è¿”å›æˆåŠŸäº†ï¼Œäººéƒ½ä»¥ä¸ºä½ è¿™ä¸ªè¯·æ±‚å°±æˆåŠŸäº†ï¼›ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œè¦æ˜¯ BCD ä¸‰ä¸ªç³»ç»Ÿé‚£é‡Œï¼ŒBD ä¸¤ä¸ªç³»ç»Ÿå†™åº“æˆåŠŸäº†ï¼Œç»“æœ C ç³»ç»Ÿå†™åº“å¤±è´¥äº†ï¼Œå’‹æ•´ï¼Ÿä½ è¿™æ•°æ®å°±ä¸ä¸€è‡´ äº†ã€‚</li>
</ul>
<h2 id="10-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ"><a href="#10-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ" class="headerlink" title="10.å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ"></a>10.å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ</h2><p>æ¶ˆæ¯åˆ°MQçš„è¿‡ç¨‹ä¸­æä¸¢ï¼ŒMQè‡ªå·±æä¸¢ï¼ŒMQåˆ°æ¶ˆè´¹è¿‡ç¨‹ä¸­æä¸¢ã€‚<br>ç”Ÿäº§è€…åˆ°RabbitMQï¼šäº‹åŠ¡æœºåˆ¶å’ŒConfirmæœºåˆ¶ï¼Œæ³¨æ„ï¼šäº‹åŠ¡æœºåˆ¶å’Œ Confirm æœºåˆ¶æ˜¯äº’æ–¥çš„ï¼Œä¸¤è€…ä¸èƒ½å…±å­˜ï¼Œä¼šå¯¼è‡´ RabbitMQ æŠ¥é”™ã€‚<br>RabbitMQè‡ªèº«ï¼šæŒä¹…åŒ–ã€é›†ç¾¤ã€æ™®é€šæ¨¡å¼ã€é•œåƒæ¨¡å¼ã€‚<br>RabbitMQåˆ°æ¶ˆè´¹è€…ï¼šbasicAckæœºåˆ¶ã€æ­»ä¿¡é˜Ÿåˆ—ã€æ¶ˆæ¯è¡¥å¿æœºåˆ¶ã€‚</p>
<h2 id="11-ä»€ä¹ˆæ˜¯RoutingKeyè·¯ç”±é”®ï¼Ÿ"><a href="#11-ä»€ä¹ˆæ˜¯RoutingKeyè·¯ç”±é”®ï¼Ÿ" class="headerlink" title="11.ä»€ä¹ˆæ˜¯RoutingKeyè·¯ç”±é”®ï¼Ÿ"></a>11.ä»€ä¹ˆæ˜¯RoutingKeyè·¯ç”±é”®ï¼Ÿ</h2><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢å™¨çš„æ—¶å€™ï¼Œä¼šæŒ‡å®šä¸€ä¸ªRoutingKey,ç”¨æ¥æŒ‡å®šè¿™ä¸ªæ¶ˆæ¯çš„è·¯ç”±è§„åˆ™ï¼Œè¿™ä¸ªRoutingKeyéœ€è¦ä¸äº¤æ¢å™¨ç±»å‹å’Œç»‘å®šé”®(BindingKey)è”åˆä½¿ç”¨æ‰èƒ½æœ€ç»ˆç”Ÿæ•ˆã€‚</p>
<h2 id="12-Bindingç»‘å®šï¼Ÿ"><a href="#12-Bindingç»‘å®šï¼Ÿ" class="headerlink" title="12.Bindingç»‘å®šï¼Ÿ"></a>12.Bindingç»‘å®šï¼Ÿ</h2><p>é€šè¿‡ç»‘å®šå°†äº¤æ¢å™¨å’Œé˜Ÿåˆ—å…³è”èµ·æ¥ï¼Œä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ªBindingKey,è¿™æ ·RabbitMqå°±çŸ¥é“å¦‚ä½•æ­£ç¡®è·¯ç”±æ¶ˆæ¯åˆ°é˜Ÿåˆ—äº†ã€‚</p>
<h2 id="13-äº¤æ¢å™¨4ç§ç±»å‹ï¼Ÿ"><a href="#13-äº¤æ¢å™¨4ç§ç±»å‹ï¼Ÿ" class="headerlink" title="13.äº¤æ¢å™¨4ç§ç±»å‹ï¼Ÿ"></a>13.äº¤æ¢å™¨4ç§ç±»å‹ï¼Ÿ</h2><p>ä¸»è¦æœ‰ä»¥ä¸‹4ç§ã€‚</p>
<ul>
<li>fanout:æŠŠæ‰€æœ‰å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯è·¯ç”±åˆ°æ‰€æœ‰ä¸è¯¥äº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—ä¸­ã€‚</li>
<li>direct:æŠŠæ¶ˆæ¯è·¯ç”±åˆ°BindingKeyå’ŒRoutingKeyå®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—ä¸­ã€‚</li>
<li>topic:</li>
<li>åŒ¹é…è§„åˆ™ï¼š <ul>
<li>RoutingKeyï¼šä¸ºä¸€ä¸ª ç‚¹å·â€™.â€™: åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚æ¯”å¦‚: java.xiaoka.show </li>
<li>BindingKeyï¼šå’ŒRoutingKeyä¸€æ ·ä¹Ÿæ˜¯ç‚¹å·â€œ.â€œåˆ†éš”çš„å­—ç¬¦ä¸²ã€‚BindingKeyå¯ä½¿ç”¨ * å’Œ # ç”¨äºåšæ¨¡ç³ŠåŒ¹é…ï¼Œ*åŒ¹é…ä¸€ä¸ªå•è¯ï¼Œ#åŒ¹é…å¤šä¸ªæˆ–è€…0ä¸ª </li>
<li>headersï¼šä¸ä¾èµ–è·¯ç”±é”®åŒ¹é…è§„åˆ™è·¯ç”±æ¶ˆæ¯ã€‚æ˜¯æ ¹æ®å‘é€æ¶ˆæ¯å†…å®¹ä¸­çš„headerså±æ€§è¿›è¡ŒåŒ¹é…ã€‚æ€§èƒ½å·®ï¼ŒåŸºæœ¬ç”¨ä¸åˆ°ã€‚</li>
</ul>
</li>
</ul>
<h2 id="14-ç”Ÿäº§è€…æ¶ˆæ¯è¿è½¬ï¼Ÿ"><a href="#14-ç”Ÿäº§è€…æ¶ˆæ¯è¿è½¬ï¼Ÿ" class="headerlink" title="14.ç”Ÿäº§è€…æ¶ˆæ¯è¿è½¬ï¼Ÿ"></a>14.ç”Ÿäº§è€…æ¶ˆæ¯è¿è½¬ï¼Ÿ</h2><ol>
<li>Producerå…ˆè¿æ¥åˆ°Broker,å»ºç«‹è¿æ¥Connection,å¼€å¯ä¸€ä¸ªä¿¡é“(Channel)ã€‚</li>
<li>Producerå£°æ˜ä¸€ä¸ªäº¤æ¢å™¨å¹¶è®¾ç½®å¥½ç›¸å…³å±æ€§ã€‚</li>
<li>Producerå£°æ˜ä¸€ä¸ªé˜Ÿåˆ—å¹¶è®¾ç½®å¥½ç›¸å…³å±æ€§ã€‚</li>
<li>Produceré€šè¿‡è·¯ç”±é”®å°†äº¤æ¢å™¨å’Œé˜Ÿåˆ—ç»‘å®šèµ·æ¥ã€‚</li>
<li>Producerå‘é€æ¶ˆæ¯åˆ°Broker,å…¶ä¸­åŒ…å«è·¯ç”±é”®ã€äº¤æ¢å™¨ç­‰ä¿¡æ¯ã€‚</li>
<li>ç›¸åº”çš„äº¤æ¢å™¨æ ¹æ®æ¥æ”¶åˆ°çš„è·¯ç”±é”®æŸ¥æ‰¾åŒ¹é…çš„é˜Ÿåˆ—ã€‚</li>
<li>å¦‚æœæ‰¾åˆ°ï¼Œå°†æ¶ˆæ¯å­˜å…¥å¯¹åº”çš„é˜Ÿåˆ—ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä¼šæ ¹æ®ç”Ÿäº§è€…çš„é…ç½®ä¸¢å¼ƒæˆ–è€…é€€å›ç»™ç”Ÿäº§è€…ã€‚</li>
<li>å…³é—­ä¿¡é“ã€‚</li>
<li>ç®¡ç†è¿æ¥ã€‚</li>
</ol>
<h2 id="15-æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯è¿‡ç¨‹ï¼Ÿ"><a href="#15-æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="15.æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯è¿‡ç¨‹ï¼Ÿ"></a>15.æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯è¿‡ç¨‹ï¼Ÿ</h2><ol>
<li>Producerå…ˆè¿æ¥åˆ°Broker,å»ºç«‹è¿æ¥Connection,å¼€å¯ä¸€ä¸ªä¿¡é“(Channel)ã€‚</li>
<li>å‘Brokerè¯·æ±‚æ¶ˆè´¹å“åº”çš„é˜Ÿåˆ—ä¸­æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šè®¾ç½®å“åº”çš„å›è°ƒå‡½æ•°ã€‚</li>
<li>ç­‰å¾…Brokerå›åº”å¹¶æŠ•é€’ç›¸åº”é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œæ¥æ”¶æ¶ˆæ¯ã€‚</li>
<li>æ¶ˆè´¹è€…ç¡®è®¤æ”¶åˆ°çš„æ¶ˆæ¯,ackã€‚</li>
<li>RabbitMqä»é˜Ÿåˆ—ä¸­åˆ é™¤å·²ç»ç¡®å®šçš„æ¶ˆæ¯ã€‚</li>
<li>å…³é—­ä¿¡é“ã€‚</li>
<li>å…³é—­è¿æ¥ã€‚</li>
</ol>
<h2 id="16-äº¤æ¢å™¨æ— æ³•æ ¹æ®è‡ªèº«ç±»å‹å’Œè·¯ç”±é”®æ‰¾åˆ°ç¬¦åˆæ¡ä»¶é˜Ÿåˆ—æ—¶ï¼Œæœ‰å“ªäº›å¤„ç†ï¼Ÿ"><a href="#16-äº¤æ¢å™¨æ— æ³•æ ¹æ®è‡ªèº«ç±»å‹å’Œè·¯ç”±é”®æ‰¾åˆ°ç¬¦åˆæ¡ä»¶é˜Ÿåˆ—æ—¶ï¼Œæœ‰å“ªäº›å¤„ç†ï¼Ÿ" class="headerlink" title="16.äº¤æ¢å™¨æ— æ³•æ ¹æ®è‡ªèº«ç±»å‹å’Œè·¯ç”±é”®æ‰¾åˆ°ç¬¦åˆæ¡ä»¶é˜Ÿåˆ—æ—¶ï¼Œæœ‰å“ªäº›å¤„ç†ï¼Ÿ"></a>16.äº¤æ¢å™¨æ— æ³•æ ¹æ®è‡ªèº«ç±»å‹å’Œè·¯ç”±é”®æ‰¾åˆ°ç¬¦åˆæ¡ä»¶é˜Ÿåˆ—æ—¶ï¼Œæœ‰å“ªäº›å¤„ç†ï¼Ÿ</h2><ul>
<li>mandatoryï¼štrue è¿”å›æ¶ˆæ¯ç»™ç”Ÿäº§è€…ã€‚</li>
<li>mandatory: false ç›´æ¥ä¸¢å¼ƒã€‚</li>
</ul>
<h2 id="17-æ­»ä¿¡é˜Ÿåˆ—ï¼Ÿ"><a href="#17-æ­»ä¿¡é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="17.æ­»ä¿¡é˜Ÿåˆ—ï¼Ÿ"></a>17.æ­»ä¿¡é˜Ÿåˆ—ï¼Ÿ</h2><p>DLXï¼Œå…¨ç§°ä¸º Dead-Letter-Exchangeï¼Œæ­»ä¿¡äº¤æ¢å™¨ï¼Œæ­»ä¿¡é‚®ç®±ã€‚å½“æ¶ˆæ¯åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å˜æˆæ­»ä¿¡ (dead message) ä¹‹åï¼Œå®ƒèƒ½è¢«é‡æ–°è¢«å‘é€åˆ°å¦ä¸€ä¸ªäº¤æ¢å™¨ä¸­ï¼Œè¿™ä¸ªäº¤æ¢å™¨å°±æ˜¯ DLXï¼Œç»‘å®š DLX çš„é˜Ÿåˆ—å°±ç§°ä¹‹ä¸ºæ­»ä¿¡é˜Ÿåˆ—ã€‚</p>
<h2 id="18-å¯¼è‡´çš„æ­»ä¿¡çš„å‡ ç§åŸå› ï¼Ÿ"><a href="#18-å¯¼è‡´çš„æ­»ä¿¡çš„å‡ ç§åŸå› ï¼Ÿ" class="headerlink" title="18.å¯¼è‡´çš„æ­»ä¿¡çš„å‡ ç§åŸå› ï¼Ÿ"></a>18.å¯¼è‡´çš„æ­»ä¿¡çš„å‡ ç§åŸå› ï¼Ÿ</h2><ul>
<li>æ¶ˆæ¯è¢«æ‹’ï¼ˆBasic.Reject /Basic.Nack) ä¸” requeue = falseã€‚</li>
<li>æ¶ˆæ¯TTLè¿‡æœŸã€‚</li>
<li>é˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ ã€‚</li>
</ul>
<h2 id="19-å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿ"><a href="#19-å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="19.å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿ"></a>19.å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿ</h2><p>å­˜å‚¨å¯¹åº”çš„å»¶è¿Ÿæ¶ˆæ¯ï¼ŒæŒ‡å½“æ¶ˆæ¯è¢«å‘é€ä»¥åï¼Œå¹¶ä¸æƒ³è®©æ¶ˆè´¹è€…ç«‹åˆ»æ‹¿åˆ°æ¶ˆæ¯ï¼Œè€Œæ˜¯ç­‰å¾…ç‰¹å®šæ—¶é—´åï¼Œæ¶ˆè´¹è€…æ‰èƒ½æ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚</p>
<h2 id="20-ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ"><a href="#20-ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="20.ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ"></a>20.ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ</h2><ul>
<li>ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—ä¼šå…ˆè¢«æ¶ˆè´¹ã€‚</li>
<li>å¯ä»¥é€šè¿‡x-max-priorityå‚æ•°æ¥å®ç°ã€‚</li>
<li>å½“æ¶ˆè´¹é€Ÿåº¦å¤§äºç”Ÿäº§é€Ÿåº¦ä¸”Brokeræ²¡æœ‰å †ç§¯çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆçº§æ˜¾å¾—æ²¡æœ‰æ„ä¹‰ã€‚</li>
</ul>
<h2 id="21-äº‹åŠ¡æœºåˆ¶ï¼Ÿ"><a href="#21-äº‹åŠ¡æœºåˆ¶ï¼Ÿ" class="headerlink" title="21.äº‹åŠ¡æœºåˆ¶ï¼Ÿ"></a>21.äº‹åŠ¡æœºåˆ¶ï¼Ÿ</h2><p>RabbitMQ å®¢æˆ·ç«¯ä¸­ä¸äº‹åŠ¡æœºåˆ¶ç›¸å…³çš„æ–¹æ³•æœ‰ä¸‰ä¸ª:</p>
<ol>
<li>channel.txSelect ç”¨äºå°†å½“å‰çš„ä¿¡é“è®¾ç½®æˆäº‹åŠ¡æ¨¡å¼ã€‚</li>
<li>channel . txCommit ç”¨äºæäº¤äº‹åŠ¡ ã€‚</li>
<li>channel . txRollback ç”¨äºäº‹åŠ¡å›æ»š,å¦‚æœåœ¨äº‹åŠ¡æäº¤æ‰§è¡Œä¹‹å‰ç”±äº RabbitMQ å¼‚å¸¸å´©æºƒæˆ–è€…å…¶ä»–åŸå› æŠ›å‡ºå¼‚å¸¸,é€šè¿‡txRollbackæ¥å›æ»šã€‚</li>
</ol>
<h2 id="22-å‘é€ç¡®è®¤æœºåˆ¶ï¼Ÿ"><a href="#22-å‘é€ç¡®è®¤æœºåˆ¶ï¼Ÿ" class="headerlink" title="22.å‘é€ç¡®è®¤æœºåˆ¶ï¼Ÿ"></a>22.å‘é€ç¡®è®¤æœºåˆ¶ï¼Ÿ</h2><p>ç”Ÿäº§è€…æŠŠä¿¡é“è®¾ç½®ä¸ºconfirmç¡®è®¤æ¨¡å¼,è®¾ç½®åï¼Œæ‰€æœ‰å†æ”¹ä¿¡é“å‘å¸ƒçš„æ¶ˆæ¯éƒ½ä¼šè¢«æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„IDï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼ŒRabbitMQå°±ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ï¼ˆBasic.Ack)ç»™ç”Ÿäº§è€…ï¼ˆåŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ID)ï¼Œè¿™æ ·ç”Ÿäº§è€…å°±çŸ¥é“æ¶ˆæ¯åˆ°è¾¾å¯¹åº”çš„ç›®çš„åœ°äº†ã€‚</p>
<h2 id="23-æ¶ˆè´¹è€…è·å–æ¶ˆæ¯çš„æ–¹å¼ï¼Ÿ"><a href="#23-æ¶ˆè´¹è€…è·å–æ¶ˆæ¯çš„æ–¹å¼ï¼Ÿ" class="headerlink" title="23.æ¶ˆè´¹è€…è·å–æ¶ˆæ¯çš„æ–¹å¼ï¼Ÿ"></a>23.æ¶ˆè´¹è€…è·å–æ¶ˆæ¯çš„æ–¹å¼ï¼Ÿ</h2><ul>
<li>æ¨</li>
<li>æ‹‰</li>
</ul>
<h2 id="24-æ¶ˆè´¹è€…æŸäº›åŸå› æ— æ³•å¤„ç†å½“å‰æ¥å—çš„æ¶ˆæ¯å¦‚ä½•æ¥æ‹’ç»ï¼Ÿ"><a href="#24-æ¶ˆè´¹è€…æŸäº›åŸå› æ— æ³•å¤„ç†å½“å‰æ¥å—çš„æ¶ˆæ¯å¦‚ä½•æ¥æ‹’ç»ï¼Ÿ" class="headerlink" title="24.æ¶ˆè´¹è€…æŸäº›åŸå› æ— æ³•å¤„ç†å½“å‰æ¥å—çš„æ¶ˆæ¯å¦‚ä½•æ¥æ‹’ç»ï¼Ÿ"></a>24.æ¶ˆè´¹è€…æŸäº›åŸå› æ— æ³•å¤„ç†å½“å‰æ¥å—çš„æ¶ˆæ¯å¦‚ä½•æ¥æ‹’ç»ï¼Ÿ</h2><p>channel .basicNack channel .basicReject</p>
<h2 id="25-æ¶ˆæ¯ä¼ è¾“ä¿è¯å±‚çº§ï¼Ÿ"><a href="#25-æ¶ˆæ¯ä¼ è¾“ä¿è¯å±‚çº§ï¼Ÿ" class="headerlink" title="25.æ¶ˆæ¯ä¼ è¾“ä¿è¯å±‚çº§ï¼Ÿ"></a>25.æ¶ˆæ¯ä¼ è¾“ä¿è¯å±‚çº§ï¼Ÿ</h2><p>At most once:æœ€å¤šä¸€æ¬¡ã€‚æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œä½†ä¸ä¼šé‡å¤ä¼ è¾“ã€‚<br>At least onceï¼šæœ€å°‘ä¸€æ¬¡ã€‚æ¶ˆæ¯ç»ä¸ä¼šä¸¢å¤±ï¼Œä½†å¯èƒ½ä¼šé‡å¤ä¼ è¾“ã€‚<br>Exactly once: æ°å¥½ä¸€æ¬¡ï¼Œæ¯æ¡æ¶ˆæ¯è‚¯å®šä»…ä¼ è¾“ä¸€æ¬¡ã€‚</p>
<h2 id="26-äº†è§£Virtual-Hostå—"><a href="#26-äº†è§£Virtual-Hostå—" class="headerlink" title="26.äº†è§£Virtual Hostå—?"></a>26.äº†è§£Virtual Hostå—?</h2><p>æ¯ä¸€ä¸ªRabbitMQæœåŠ¡å™¨éƒ½èƒ½åˆ›å»ºè™šæ‹Ÿçš„æ¶ˆæ¯æœåŠ¡å™¨ï¼Œä¹Ÿå«è™šæ‹Ÿä¸»æœº(virtual host)ï¼Œç®€ç§°vhostã€‚<br>é»˜è®¤ä¸ºâ€œ/â€ã€‚</p>
<h2 id="27-é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç±»å‹ï¼Ÿ"><a href="#27-é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç±»å‹ï¼Ÿ" class="headerlink" title="27.é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç±»å‹ï¼Ÿ"></a>27.é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç±»å‹ï¼Ÿ</h2><ol>
<li>å†…å­˜èŠ‚ç‚¹ï¼šram,å°†å˜æ›´å†™å…¥å†…å­˜ã€‚</li>
<li>ç£ç›˜èŠ‚ç‚¹ï¼šdisc,ç£ç›˜å†™å…¥æ“ä½œã€‚</li>
<li>RabbitMQè¦æ±‚æœ€å°‘æœ‰ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹ã€‚</li>
</ol>
<h2 id="28-é˜Ÿåˆ—ç»“æ„ï¼Ÿ"><a href="#28-é˜Ÿåˆ—ç»“æ„ï¼Ÿ" class="headerlink" title="28.é˜Ÿåˆ—ç»“æ„ï¼Ÿ"></a>28.é˜Ÿåˆ—ç»“æ„ï¼Ÿ</h2><p>é€šå¸¸ç”±ä»¥ä¸‹ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<ol>
<li>rabbit_amqqueue_process:è´Ÿè´£åè®®ç›¸å…³çš„æ¶ˆæ¯å¤„ç†ï¼Œå³æ¥æ”¶ç”Ÿäº§è€…å‘å¸ƒçš„æ¶ˆæ¯ã€å‘æ¶ˆè´¹è€…äº¤ä»˜æ¶ˆæ¯ã€å¤„ç†æ¶ˆæ¯çš„ç¡®è®¤(åŒ…æ‹¬ç”Ÿäº§ç«¯çš„ confirm å’Œæ¶ˆè´¹ç«¯çš„ ack) ç­‰ã€‚</li>
<li>backing_queue:æ˜¯æ¶ˆæ¯å­˜å‚¨çš„å…·ä½“å½¢å¼å’Œå¼•æ“ï¼Œå¹¶å‘ rabbit amqqueue processæä¾›ç›¸å…³çš„æ¥å£ä»¥ä¾›è°ƒç”¨ã€‚</li>
</ol>
<h2 id="29-RabbitMQä¸­æ¶ˆæ¯å¯èƒ½æœ‰çš„å‡ ç§çŠ¶æ€"><a href="#29-RabbitMQä¸­æ¶ˆæ¯å¯èƒ½æœ‰çš„å‡ ç§çŠ¶æ€" class="headerlink" title="29.RabbitMQä¸­æ¶ˆæ¯å¯èƒ½æœ‰çš„å‡ ç§çŠ¶æ€?"></a>29.RabbitMQä¸­æ¶ˆæ¯å¯èƒ½æœ‰çš„å‡ ç§çŠ¶æ€?</h2><ol>
<li>alpha: æ¶ˆæ¯å†…å®¹(åŒ…æ‹¬æ¶ˆæ¯ä½“ã€å±æ€§å’Œ headers) å’Œæ¶ˆæ¯ç´¢å¼•éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ ã€‚</li>
<li>beta: æ¶ˆæ¯å†…å®¹ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œæ¶ˆæ¯ç´¢å¼•ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚</li>
<li>gamma: æ¶ˆæ¯å†…å®¹ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œæ¶ˆæ¯ç´¢å¼•åœ¨ç£ç›˜å’Œå†…å­˜ä¸­éƒ½æœ‰ ã€‚</li>
<li>delta: æ¶ˆæ¯å†…å®¹å’Œç´¢å¼•éƒ½åœ¨ç£ç›˜ä¸­ ã€‚</li>
</ol>
<h2 id="30-åœ¨ä½•ç§åœºæ™¯ä¸‹ä½¿ç”¨äº†æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ"><a href="#30-åœ¨ä½•ç§åœºæ™¯ä¸‹ä½¿ç”¨äº†æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ" class="headerlink" title="30.åœ¨ä½•ç§åœºæ™¯ä¸‹ä½¿ç”¨äº†æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ"></a>30.åœ¨ä½•ç§åœºæ™¯ä¸‹ä½¿ç”¨äº†æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ</h2><ul>
<li>æ¥å£ä¹‹é—´è€¦åˆæ¯”è¾ƒä¸¥é‡</li>
<li>é¢å¯¹å¤§æµé‡å¹¶å‘æ—¶ï¼Œå®¹æ˜“è¢«å†²å®</li>
<li>å­˜åœ¨æ€§èƒ½é—®é¢˜</li>
</ul>
<h2 id="31-ç”Ÿäº§è€…å¦‚ä½•å°†æ¶ˆæ¯å¯é æŠ•é€’åˆ°MQï¼Ÿ"><a href="#31-ç”Ÿäº§è€…å¦‚ä½•å°†æ¶ˆæ¯å¯é æŠ•é€’åˆ°MQï¼Ÿ" class="headerlink" title="31.ç”Ÿäº§è€…å¦‚ä½•å°†æ¶ˆæ¯å¯é æŠ•é€’åˆ°MQï¼Ÿ"></a>31.ç”Ÿäº§è€…å¦‚ä½•å°†æ¶ˆæ¯å¯é æŠ•é€’åˆ°MQï¼Ÿ</h2><ol>
<li>Clientå‘é€æ¶ˆæ¯ç»™MQ</li>
<li>MQå°†æ¶ˆæ¯æŒä¹…åŒ–åï¼Œå‘é€Ackæ¶ˆæ¯ç»™Clientï¼Œæ­¤å¤„æœ‰å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´Ackæ¶ˆæ¯æ— æ³•å‘é€åˆ°Clientï¼Œé‚£ä¹ˆClientåœ¨ç­‰å¾…è¶…æ—¶åï¼Œä¼šé‡ä¼ æ¶ˆæ¯ï¼›</li>
<li>Clientæ”¶åˆ°Ackæ¶ˆæ¯åï¼Œè®¤ä¸ºæ¶ˆæ¯å·²ç»æŠ•é€’æˆåŠŸã€‚</li>
</ol>
<h2 id="32-MQå¦‚ä½•å°†æ¶ˆæ¯å¯é æŠ•é€’åˆ°æ¶ˆè´¹è€…ï¼Ÿ"><a href="#32-MQå¦‚ä½•å°†æ¶ˆæ¯å¯é æŠ•é€’åˆ°æ¶ˆè´¹è€…ï¼Ÿ" class="headerlink" title="32 . MQå¦‚ä½•å°†æ¶ˆæ¯å¯é æŠ•é€’åˆ°æ¶ˆè´¹è€…ï¼Ÿ"></a>32 . MQå¦‚ä½•å°†æ¶ˆæ¯å¯é æŠ•é€’åˆ°æ¶ˆè´¹è€…ï¼Ÿ</h2><ol>
<li>MQå°†æ¶ˆæ¯pushç»™Clientï¼ˆæˆ–Clientæ¥pullæ¶ˆæ¯ï¼‰</li>
<li>Clientå¾—åˆ°æ¶ˆæ¯å¹¶åšå®Œä¸šåŠ¡é€»è¾‘</li>
<li>Clientå‘é€Ackæ¶ˆæ¯ç»™MQï¼Œé€šçŸ¥MQåˆ é™¤è¯¥æ¶ˆæ¯ï¼Œæ­¤å¤„æœ‰å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´Ackå¤±è´¥ï¼Œé‚£ä¹ˆClientä¼šé‡å¤æ¶ˆæ¯ï¼Œè¿™é‡Œå°±å¼•å‡ºæ¶ˆè´¹å¹‚ç­‰çš„é—®é¢˜ï¼›</li>
<li>MQå°†å·²æ¶ˆè´¹çš„æ¶ˆæ¯åˆ é™¤</li>
</ol>
<h2 id="33-å¦‚ä½•ä¿è¯RabbitMQæ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨"><a href="#33-å¦‚ä½•ä¿è¯RabbitMQæ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨" class="headerlink" title="33.å¦‚ä½•ä¿è¯RabbitMQæ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨?"></a>33.å¦‚ä½•ä¿è¯RabbitMQæ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨?</h2><p>RabbitMQ æœ‰ä¸‰ç§æ¨¡å¼ï¼šå•æœºæ¨¡å¼ï¼Œæ™®é€šé›†ç¾¤æ¨¡å¼ï¼Œé•œåƒé›†ç¾¤æ¨¡å¼ã€‚</p>
<ol>
<li>å•æœºæ¨¡å¼ï¼šå°±æ˜¯demoçº§åˆ«çš„ï¼Œä¸€èˆ¬å°±æ˜¯ä½ æœ¬åœ°å¯åŠ¨äº†ç©ç©å„¿çš„ï¼Œæ²¡äººç”Ÿäº§ç”¨å•æœºæ¨¡å¼</li>
<li>æ™®é€šé›†ç¾¤æ¨¡å¼ï¼šæ„æ€å°±æ˜¯åœ¨å¤šå°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªRabbitMQå®ä¾‹ï¼Œæ¯ä¸ªæœºå™¨å¯åŠ¨ä¸€ä¸ªã€‚</li>
<li>é•œåƒé›†ç¾¤æ¨¡å¼ï¼šè¿™ç§æ¨¡å¼ï¼Œæ‰æ˜¯æ‰€è°“çš„RabbitMQçš„é«˜å¯ç”¨æ¨¡å¼ï¼Œè·Ÿæ™®é€šé›†ç¾¤æ¨¡å¼ä¸ä¸€æ ·çš„æ˜¯ï¼Œä½ åˆ›å»ºçš„queueï¼Œæ— è®ºå…ƒæ•°æ®(å…ƒæ•°æ®æŒ‡RabbitMQçš„é…ç½®æ•°æ®)è¿˜æ˜¯queueé‡Œçš„æ¶ˆæ¯éƒ½ä¼šå­˜åœ¨äºå¤šä¸ªå®ä¾‹ä¸Šï¼Œç„¶åæ¯æ¬¡ä½ å†™æ¶ˆæ¯åˆ°queueçš„æ—¶å€™ï¼Œéƒ½ä¼šè‡ªåŠ¨æŠŠæ¶ˆæ¯åˆ°å¤šä¸ªå®ä¾‹çš„queueé‡Œè¿›è¡Œæ¶ˆæ¯åŒæ­¥ã€‚</li>
</ol>
<h2 id="34-å¦‚ä½•å¿«é€Ÿå¤„ç†æŒ¤å‹è¿‡å¤šçš„æ¶ˆæ¯ï¼Ÿ"><a href="#34-å¦‚ä½•å¿«é€Ÿå¤„ç†æŒ¤å‹è¿‡å¤šçš„æ¶ˆæ¯ï¼Ÿ" class="headerlink" title="34.å¦‚ä½•å¿«é€Ÿå¤„ç†æŒ¤å‹è¿‡å¤šçš„æ¶ˆæ¯ï¼Ÿ"></a>34.å¦‚ä½•å¿«é€Ÿå¤„ç†æŒ¤å‹è¿‡å¤šçš„æ¶ˆæ¯ï¼Ÿ</h2><p>æƒ…æ™¯ï¼šæ¶ˆè´¹è€…æŒ‚æ‰åå†é‡å¯ï¼Œè¿™æ—¶ä¼šæœ‰å¾ˆå¤šå·²ç»æŒ¤å‹äº†çš„æ¶ˆæ¯åœ¨MQä¸­ï¼Œæ‰€ä»¥éœ€è¦å¿«é€Ÿçš„å¤„ç†ä¹‹å‰å·²ç»æŒ¤å‹äº†çš„æ¶ˆæ¯ã€‚<br>è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥å°†åŸç”±çš„æ¶ˆè´¹è€…è¿›è¡Œä¿®æ”¹ï¼Œä¸å†ç›´æ¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œåªå¯¹MQçš„æ•°æ®è¿›è¡Œå¹¶å°†å¤„ç†å¾—åˆ°çš„æ•°æ®å†å‘ç»™æ–°çš„partitionï¼ˆå¯ä»¥åˆ›å»ºå¾ˆå¤šæ¥è¿›è¡Œè¿‡åº¦ï¼‰ï¼Œç„¶åå†ç”±å¾ˆå¤šæ¶ˆè´¹è€…è¿›è¡ŒåŒæ—¶çš„æ¶ˆè´¹ï¼Œå¹¶å†™å…¥æ•°æ®åº“ã€‚è¿™æ˜¯å¤„ç†é€Ÿåº¦å°±ä¼šå¾ˆå¿«ã€‚å› ä¸ºç¬¬ä¸€æ¬¡çš„æ¶ˆè´¹è€…å¤„ç†ä¹‹åå¹¶ä¸ç”¨å†™å…¥æ•°æ®åº“å°±å¯ä»¥ç»™MQåé¦ˆå·²ç»æ¶ˆè´¹äº†ï¼›åç»­çš„æ¶ˆè´¹è€…ç»§ç»­å¤„ç†éœ€è¦æ¶ˆè´¹çš„æ•°æ®å¹¶ä¸ä¼šå½±å“ä¹‹å‰çš„æ¶ˆè´¹è€…å¤„ç†çš„é€Ÿåº¦ã€‚</p>
<h2 id="35-å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†æ€ä¹ˆå¤„ç†ï¼Ÿ"><a href="#35-å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†æ€ä¹ˆå¤„ç†ï¼Ÿ" class="headerlink" title="35.å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†æ€ä¹ˆå¤„ç†ï¼Ÿ"></a>35.å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†æ€ä¹ˆå¤„ç†ï¼Ÿ</h2><p>ç±»ä¼¼ä¸Šè¿°é—®é¢˜ï¼šä¿®æ”¹æ¶ˆè´¹è€…æ¶ˆè´¹æ–¹å¼ï¼ˆä¸ç›´æ¥è¿›è¡Œæ¶ˆè´¹ï¼Œè½¬å‘ç»™å¦å¤–çš„MQï¼‰ï¼Œç„¶åå†ç”±å…¶ä»–æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚</p>
<h2 id="36-å¦‚æœè®©ä½ å¼€å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œå¦‚ä½•æ¥è®¾è®¡ï¼Ÿ"><a href="#36-å¦‚æœè®©ä½ å¼€å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œå¦‚ä½•æ¥è®¾è®¡ï¼Ÿ" class="headerlink" title="36.å¦‚æœè®©ä½ å¼€å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œå¦‚ä½•æ¥è®¾è®¡ï¼Ÿ"></a>36.å¦‚æœè®©ä½ å¼€å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œå¦‚ä½•æ¥è®¾è®¡ï¼Ÿ</h2><ol>
<li>è€ƒè™‘mqçš„ä¼¸ç¼©æ€§ï¼Œå°±æ˜¯éœ€è¦çš„æ—¶å€™å¿«é€Ÿæ‰©å®¹ï¼Œå°±å¯ä»¥å¢åŠ ååé‡å’Œå®¹é‡ï¼Œé‚£æ€ä¹ˆæï¼Ÿè®¾è®¡ä¸ªåˆ†å¸ƒå¼çš„ç³»ç»Ÿå‘—ï¼Œå‚ç…§ä¸€ä¸‹kafkaçš„è®¾è®¡ç†å¿µï¼Œbroker -&gt; topic -&gt; partitionï¼Œæ¯ä¸ªpartitionæ”¾ä¸€ä¸ªæœºå™¨ï¼Œå°±å­˜ä¸€éƒ¨åˆ†æ•°æ®ã€‚å¦‚æœç°åœ¨èµ„æºä¸å¤Ÿäº†ï¼Œç®€å•å•Šï¼Œç»™topicå¢åŠ partitionï¼Œç„¶ååšæ•°æ®è¿ç§»ï¼Œå¢åŠ æœºå™¨ï¼Œè¿™æ ·å°±å¯ä»¥å­˜æ”¾æ›´å¤šæ•°æ®ï¼Œæä¾›æ›´é«˜çš„ååé‡äº†ã€‚</li>
<li>è€ƒè™‘mqæ•°æ®è¦ä¸è¦æŒä¹…åŒ–ï¼Ÿéœ€è¦å†™å…¥ç£ç›˜ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æŒ‚äº†ä¹‹åä¸ä¼šé€ æˆæ•°æ®çš„ä¸¢å¤±ã€‚å†™å…¥æ—¶æ€ä¹ˆè¿›è¡Œå†™å…¥ç£ç›˜ï¼Ÿé¡ºåºå†™å…¥ï¼Œè¿™æ ·æ—¢ä¿è¯äº†æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œè¿˜å‡å°‘äº†å¯»å€çš„å¼€é”€ï¼Œè¾¾åˆ°æé«˜æ€§èƒ½çš„ç›®çš„ã€‚</li>
<li>è€ƒè™‘mqçš„å¯ç”¨æ€§ï¼Ÿå‚è€ƒkafkaçš„é«˜å¯ç”¨çš„ä¿éšœæœºåˆ¶ã€‚å¤šå‰¯æœ¬â€“ã€‹leader&amp;follwerâ€“ã€‹brokeræŒ‚äº†é‡æ–°é€‰ä¸¾leaderå³å¯ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>rabbitmq</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>rabbitmq</tag>
        <tag>mq</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆTSçš„æ¥å£å’ŒæŠ½è±¡ç±»</title>
    <url>/2022/03/25/Typescript%E4%B9%8B%E6%8E%A5%E5%8F%A3%EF%BC%88interface%EF%BC%89%E5%92%8C%E6%8A%BD%E8%B1%A1%E7%B1%BB%EF%BC%88abstract%EF%BC%89/</url>
    <content><![CDATA[<p>æ¥å£å’ŒæŠ½è±¡ç±»çš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†æ·»åŠ å‚æ•°çš„é™åˆ¶ï¼Œæ¥è§„èŒƒä»£ç ã€‚</p>
<span id="more"></span>

<h1 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h1><p>TypeScriptçš„æ ¸å¿ƒåŸåˆ™ä¹‹ä¸€æ˜¯å¯¹å€¼æ‰€å…·æœ‰çš„ç»“æ„è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚ å®ƒæœ‰æ—¶è¢«ç§°åšâ€œé¸­å¼è¾¨å‹æ³•â€æˆ–â€œç»“æ„æ€§å­ç±»å‹åŒ–â€ã€‚ åœ¨TypeScripté‡Œï¼Œæ¥å£çš„ä½œç”¨å°±æ˜¯ä¸ºè¿™äº›ç±»å‹å‘½åå’Œä¸ºä½ çš„ä»£ç æˆ–ç¬¬ä¸‰æ–¹ä»£ç å®šä¹‰å¥‘çº¦ã€‚ </p>
<p>å…³é”®è¯<code>interface</code> å’ŒæŠ½è±¡ç±»æœ‰ä¸€å®šçš„ç›¸ä¼¼ä¹‹å¤„ï¼š</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Eg</span> &#123;</span><br><span class="line">	<span class="attr">a</span>: <span class="built_in">number</span>; <span class="comment">// å¿…é¡»å‚æ•°</span></span><br><span class="line">	b?: <span class="built_in">string</span>; <span class="comment">// å¯é€‰å‚æ•°</span></span><br><span class="line">    <span class="keyword">readonly</span> c?: <span class="built_in">string</span>; <span class="comment">// åªè¯»çš„å¯é€‰å‚æ•°</span></span><br><span class="line">    [<span class="attr">prop</span>:<span class="built_in">number</span>]:<span class="built_in">boolean</span> <span class="comment">// æ„æ€æ˜¯ç´¢å¼•å€¼çš„ç±»å‹è¦ä¸ºnumberç±»å‹ï¼Œå€¼ä¸ºå¸ƒå°”å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="attr">data</span>: <span class="title class_">Eg</span> = &#123; <span class="attr">a</span>: <span class="number">1</span> ,<span class="attr">b</span>:<span class="string">&quot;2&quot;</span>,<span class="attr">c</span>:<span class="string">&quot;3&quot;</span>,<span class="number">1</span>:<span class="literal">true</span>&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br></pre></td></tr></table></figure>

<h2 id="æ¥å£ä¸­è§„å®šå‡½æ•°"><a href="#æ¥å£ä¸­è§„å®šå‡½æ•°" class="headerlink" title="æ¥å£ä¸­è§„å®šå‡½æ•°"></a>æ¥å£ä¸­è§„å®šå‡½æ•°</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Eg</span> &#123;</span><br><span class="line">    (<span class="attr">x</span>:<span class="built_in">string</span>,<span class="attr">y</span>:<span class="built_in">string</span>): <span class="built_in">string</span> <span class="comment">// è§„å®šå‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">eg</span>: <span class="title class_">Eg</span>;</span><br><span class="line">eg = <span class="keyword">function</span> (<span class="params">x:<span class="built_in">string</span>,y:<span class="built_in">string</span></span>):<span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;eg&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ¥å£ç»§æ‰¿æ¥å£"><a href="#æ¥å£ç»§æ‰¿æ¥å£" class="headerlink" title="æ¥å£ç»§æ‰¿æ¥å£"></a>æ¥å£ç»§æ‰¿æ¥å£</h2><p>å…³é”®å­—ï¼š<code>extends</code></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PenStroke</span> &#123;</span><br><span class="line">    <span class="attr">penWidth</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_">Shape</span>, <span class="title class_">PenStroke</span> &#123;</span><br><span class="line">    <span class="attr">sideLength</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> square = &lt;<span class="title class_">Square</span>&gt;&#123;&#125;; </span><br><span class="line"><span class="keyword">let</span> <span class="attr">square</span>:<span class="title class_">Square</span> = &#123;&#125; <span class="comment">// error </span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä¸¤è€…æ„æ€éƒ½æ˜¯ä½¿ç”¨Squareè¿™ä¸ªæ¥å£ï¼ŒåŒºåˆ«æ˜¯ä¸€ä¸ªéœ€è¦å£°æ˜åç«‹å³èµ‹å€¼ï¼Œå¦ä¸€ä¸ªä¸éœ€è¦ã€‚</p>
<h1 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h1><p>ä¸ºäº†è§„å®šç±»ä¸­çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼Œå†™å‡ºæ¥å°±æ˜¯ä¸ºäº†è¢«ç»§æ‰¿çš„ï¼Œä¹Ÿåªèƒ½è¢«ç»§æ‰¿ã€‚</p>
<p>æŠ½è±¡ç±»æ— æ³•å®åˆ—åŒ–ï¼ŒæŠ½è±¡ç±»ä¸­ä¹Ÿå¯ä»¥æ‹¥æœ‰ä¸€äº›æŠ½è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œå’Œæ¥å£çš„ä¸»è¦åŒºåˆ«æ˜¯æ¥å£ä¸­æ— æ³•å®ç°æ–¹æ³•ï¼Œè€ŒæŠ½è±¡ç±»çš„å¯ä»¥ã€‚ <strong>å…³é”®å­—</strong><code>abstract</code></p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="title function_">move</span>(<span class="attr">x</span>: <span class="built_in">number</span>): <span class="built_in">any</span>;</span><br><span class="line">    <span class="title function_">constructor</span> (<span class="keyword">readonly</span> <span class="attr">name</span>:<span class="built_in">string</span>) &#123;&#125;</span><br><span class="line">    <span class="title function_">eat</span>(<span class="params"></span>) &#123;</span><br><span class="line">         </span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Human</span> &#123;</span><br><span class="line">    <span class="title function_">move</span>(<span class="params">x:<span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="comment">// ä»æŠ½è±¡ç±»ä¸­ç»§æ‰¿æ¥çš„æŠ½è±¡æ–¹æ³•å¿…é¡»åœ¨æ´¾ç”Ÿç±»ä¸­å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">constructor</span> (<span class="attr">name</span>:<span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Human</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="title function_">move</span>(<span class="attr">x</span>: <span class="built_in">number</span>):T;</span><br><span class="line">    <span class="title function_">constructor</span> (<span class="keyword">readonly</span> <span class="attr">name</span>:<span class="built_in">string</span>) &#123;&#125;</span><br><span class="line">    <span class="title function_">eat</span>(<span class="params"></span>) &#123;</span><br><span class="line">         </span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="æ¥å£ç»§æ‰¿ç±»ï¼š"><a href="#æ¥å£ç»§æ‰¿ç±»ï¼š" class="headerlink" title="æ¥å£ç»§æ‰¿ç±»ï¼š"></a>æ¥å£ç»§æ‰¿ç±»ï¼š</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Man</span> &#123;</span><br><span class="line">    <span class="attr">job</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">constructor</span> (<span class="keyword">readonly</span> <span class="attr">name</span>: <span class="built_in">string</span>) &#123;&#125;</span><br><span class="line">    earnMoney () &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`earning money`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">HumanRule</span> <span class="keyword">extends</span> <span class="title class_">Man</span>&#123;</span><br><span class="line">    <span class="attr">nose</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">mouth</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">ear</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">eye</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">eyebrow</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬è¦ä½¿ç”¨è¿™ä¸ªæ¥å£çš„æ—¶å€™ä¹Ÿè¦ç»§æ‰¿Manå¦åˆ™å°±æ˜¯ç¡®å®ä¸€ä¸ªnameå±æ€§ï¼Œç±»ç»§æ‰¿æ¥å£ä½¿ç”¨å…³é”®å­—<code>implements</code>ã€‚</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">a</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Man</span> <span class="keyword">implements</span> <span class="title class_">HumanRule</span>&#123;</span><br><span class="line">    <span class="attr">nose</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">mouth</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">ear</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">eye</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">eyebrow</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">constructor</span> (name) &#123;</span><br><span class="line">    	<span class="variable language_">super</span>(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>implements</code>ä¹Ÿå¯ä»¥å®ç°ç±»çš„å¤šç»§æ‰¿ã€‚æ„æ€æ˜¯å½“ä¸€ä¸ªæ¥å£ç»§æ‰¿äº†ç±»çš„å±æ€§æˆ–è€…æ–¹æ³•ä¹‹åï¼Œä½¿ç”¨è¿™ä¸ªæ¥å£æ˜¯ä¹Ÿè¦ç»§æ‰¿é‚£ä¸ªç±»ã€‚</p>
<h2 id="æ··åˆç±»å‹"><a href="#æ··åˆç±»å‹" class="headerlink" title="æ··åˆç±»å‹"></a>æ··åˆç±»å‹</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    (<span class="attr">start</span>: <span class="built_in">number</span>): <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">interval</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">reset</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCounter</span>(<span class="params"></span>): <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> counter = &lt;<span class="title class_">Counter</span>&gt;<span class="keyword">function</span> (<span class="params">start: <span class="built_in">number</span></span>) &#123; &#125;;</span><br><span class="line">    counter.<span class="property">interval</span> = <span class="number">123</span>;</span><br><span class="line">    counter.<span class="property">reset</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;;</span><br><span class="line">    <span class="keyword">return</span> counter;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="title function_">getCounter</span>();</span><br><span class="line"><span class="title function_">c</span>(<span class="number">10</span>);</span><br><span class="line">c.<span class="title function_">reset</span>();</span><br><span class="line">c.<span class="property">interval</span> = <span class="number">5.0</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>typescript</category>
      </categories>
      <tags>
        <tag>typescript</tag>
      </tags>
  </entry>
  <entry>
    <title>Git å‘½ä»¤ä¹‹ Reset ä¸ Revert</title>
    <url>/2022/03/18/git%20%E5%91%BD%E4%BB%A4%E4%B9%8B%20reset%20%E4%B8%8E%20revert/</url>
    <content><![CDATA[<h1 id="Git-Reset"><a href="#Git-Reset" class="headerlink" title="Git Reset"></a>Git Reset</h1><p>git reset å‘½ä»¤å¯ä»¥å°†å½“å‰çš„<code>HEAD</code>é‡ç½®åˆ°ç‰¹å®šçš„çŠ¶æ€ã€‚</p>
<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>é¦–å…ˆè¦ææ¸…æ¥šä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>HEADï¼šæŒ‡å‘å½“å‰åˆ†æ”¯å½“å‰ç‰ˆæœ¬çš„æ¸¸æ ‡</li>
<li>Indexï¼šæš‚å­˜åŒºï¼Œå½“ä½ ä¿®æ”¹äº†ä½ çš„ git ä»“åº“é‡Œçš„ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¿™äº›å˜åŒ–ä¸€å¼€å§‹æ˜¯ <strong>unstaged</strong> çŠ¶æ€ï¼Œä¸ºäº†æäº¤è¿™äº›ä¿®æ”¹ï¼Œä½ éœ€è¦ä½¿ç”¨<code>git add</code>æŠŠå®ƒåŠ å…¥åˆ° indexï¼Œä½¿å®ƒæˆä¸º <strong>staged</strong> çŠ¶æ€ã€‚å½“æäº¤ä¸€ä¸ª commit æ—¶ï¼Œindex é‡Œé¢çš„ä¿®æ”¹è¢«æäº¤</li>
<li>working treeï¼šå½“å‰çš„å·¥ä½œç›®å½•</li>
</ul>
<h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><p><code>git reset</code>çš„å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset [&lt;mode&gt;] [&lt;commit&gt;]</span><br></pre></td></tr></table></figure>

<p> git reset ä¼šå°†å½“å‰åˆ†æ”¯çš„ HEAD æŒ‡å‘ç»™å®šçš„ç‰ˆæœ¬ï¼Œå¹¶æ ¹æ®æ¨¡å¼çš„ä¸åŒå†³å®šæ˜¯å¦ä¿®æ”¹ index å’Œ working tree<br>å¸¸ç”¨çš„<mode>æœ‰ä¸‰ç§æ¨¡å¼ï¼š<code>--soft</code>, <code>--mixed</code>, <code>--hard</code>ï¼Œæ²¡æœ‰æŒ‡å®š <mode> é»˜è®¤æ˜¯<code>--mixed</code>æ¨¡å¼</p>
<h2 id="soft"><a href="#soft" class="headerlink" title="soft"></a>soft</h2><p>ä½¿ç”¨<code>--soft</code>å‚æ•°å°†ä¼šä»…ä»…é‡ç½® HEAD åˆ°åˆ¶å®šçš„ç‰ˆæœ¬ï¼Œä¸ä¼šä¿®æ”¹ index å’Œ working treeã€‚ä¾‹å¦‚å½“å‰åˆ†æ”¯ç°åœ¨æœ‰ä¸‰æ¬¡æäº¤ï¼Œæ‰§è¡Œ<code>git reset --soft HEAD~</code>ä¹‹åï¼ŒæŸ¥çœ‹git logï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/160063514-924585e2-ff73-4d26-a7d3-21202d24a0bd.png" alt="image"></p>
<p>è€Œæœ¬åœ°æ–‡ä»¶çš„å†…å®¹å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè€Œindexä¸­ä»ç„¶æœ‰æœ€è¿‘ä¸€æ¬¡æäº¤çš„ä¿®æ”¹ï¼Œè¿™æ—¶æ‰§è¡Œgit statusä¼šæ˜¾ç¤ºè¿™äº›ä¿®æ”¹å·²ç»åœ¨å†æš‚å­˜åŒºä¸­äº†ï¼Œæ— éœ€å†ä¸€æ¬¡æ‰§è¡Œgit add</p>
<p><img src="https://user-images.githubusercontent.com/33454514/160063524-adfbb0b1-3bf0-4276-8af2-ac9e8eb71ad9.png" alt="image"></p>
<h2 id="mixed"><a href="#mixed" class="headerlink" title="mixed"></a>mixed</h2><p>ä½¿ç”¨<code>--mixed</code>å‚æ•°ä¸<code>--soft</code>çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œ**â€“mixed** ä¿®æ”¹äº† <strong>index</strong>ï¼Œä½¿å…¶ä¸ç¬¬äºŒä¸ªç‰ˆæœ¬åŒ¹é…ã€‚index ä¸­ç»™å®š commit ä¹‹åçš„ä¿®æ”¹è¢«<code>unstaged</code>ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/33454514/160063677-34caf47f-e0d8-453f-9e60-399bf17f848b.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/33454514/160063683-48b2685d-524f-47f2-8768-025792865840.png" alt="image"></p>
<p> å¦‚æœç°åœ¨æ‰§è¡Œgit commit å°†ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹ï¼Œå› ä¸ºæš‚å­˜åŒºä¸­æ²¡æœ‰ä¿®æ”¹ï¼Œåœ¨æäº¤ä¹‹å‰éœ€è¦å†æ¬¡æ‰§è¡Œgit add</p>
<h2 id="hard"><a href="#hard" class="headerlink" title="hard"></a>hard</h2><p>ä½¿ç”¨<code>--hard</code>åŒæ—¶ä¹Ÿä¼šä¿®æ”¹ working treeï¼Œä¹Ÿå°±æ˜¯å½“å‰çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œ<code>git reset --hard HEAD~</code>ï¼Œé‚£ä¹ˆæœ€åä¸€æ¬¡æäº¤çš„ä¿®æ”¹ï¼ŒåŒ…æ‹¬æœ¬åœ°æ–‡ä»¶çš„ä¿®æ”¹éƒ½ä¼šè¢«æ¸…é™¤ï¼Œå½»åº•è¿˜åŸåˆ°ä¸Šä¸€æ¬¡æäº¤çš„çŠ¶æ€ä¸”æ— æ³•æ‰¾å›ã€‚æ‰€ä»¥åœ¨æ‰§è¡Œ<code>reset --hard</code>ä¹‹å‰ä¸€å®šè¦å°å¿ƒï¼</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>softï¼šé‡ç½® HEAD åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œå½±å“ working tree</li>
<li>hardï¼šä¼šæ¸…é™¤æœ¬åœ°çš„ä¿®æ”¹æ–‡ä»¶ï¼Œä¸”æ— æ³•æ‰¾å›</li>
<li>mixedï¼šä¿®æ”¹ indexï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ git add</li>
</ul>
<h1 id="Git-Revert"><a href="#Git-Revert" class="headerlink" title="Git Revert"></a>Git Revert</h1><p>ä½¿ç”¨<code>git revert</code>ä¹Ÿèƒ½èµ·åˆ°å›é€€ç‰ˆæœ¬çš„ä½œç”¨ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼š</p>
<ul>
<li><code>git revert &lt;commit&gt;</code>ä¼šå›é€€åˆ° <commit> ä¹‹å‰çš„é‚£æ¬¡æäº¤ã€‚æ¯”å¦‚ï¼š<code>git revert HEAD~3</code>ä¼šå›é€€åˆ°æœ€è¿‘çš„ç¬¬4ä¸ªæäº¤çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç¬¬3ä¸ª</li>
<li><code>git revert</code>ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„commitï¼Œå°†è¿™æ¬¡å›é€€ä½œä¸ºä¸€æ¬¡ä¿®æ”¹è®°å½•æäº¤ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¸ä¿®æ”¹å†å²æäº¤è®°å½•</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/33454514/160064129-9af07499-5ddd-4f25-88e0-a3fc127a7ded.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/33454514/160064132-faf553f3-d344-4aab-801c-97c37fdb2e0a.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/33454514/160064136-d83d597a-9c75-4479-9665-d6f64c056ee8.png" alt="image"></p>
]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆvue3ä¸­çš„refå’Œreactive</title>
    <url>/2022/03/25/ref%E5%92%8Creactive/</url>
    <content><![CDATA[<h1 id="refå’Œreactive"><a href="#refå’Œreactive" class="headerlink" title="refå’Œreactive"></a>refå’Œreactive</h1><p><code>ref</code>æœ¬è´¨ä¹Ÿæ˜¯<code>reactive</code>ï¼Œ<code>ref(obj)</code>ç­‰ä»·äº<code>reactive(&#123;value: obj&#125;)</code>ï¼š</p>
<ul>
<li><p>vue3ä¸­å®ç°å“åº”å¼æ•°æ®çš„æ–¹æ³•æ˜¯å°±æ˜¯ä½¿ç”¨<code>ref</code>å’Œ<code>reactive</code>ï¼Œæ‰€è°“å“åº”å¼å°±æ˜¯ç•Œé¢å’Œæ•°æ®åŒæ­¥ï¼Œèƒ½å®ç°å®æ—¶æ›´æ–°</p>
</li>
<li><p>vue2ä¸­å“åº”å¼æ˜¯é€šè¿‡<code>defineProperty</code>å®ç°çš„ï¼Œvue3ä¸­æ˜¯é€šè¿‡ES6çš„<code>Proxy</code>æ¥å®ç°çš„</p>
<span id="more"></span>
<h2 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h2></li>
</ul>
<p>reactiveçš„å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬jsonæ•°æ®å’Œæ•°ç»„éƒ½å¯ä»¥ï¼Œå¦åˆ™ä¸å…·æœ‰å“åº”å¼ã€‚å¦‚æœç»™reactiveä¼ é€’äº†å…¶ä»–å¯¹è±¡ï¼ˆå¦‚æ—¶é—´å¯¹è±¡ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¿®æ”¹å¯¹è±¡ç•Œé¢ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œå¦‚æœæƒ³æ›´æ–°ï¼Œå¯ä»¥é€šè¿‡ç»™å¯¹è±¡é‡æ–°èµ‹å€¼æ¥è§£å†³ã€‚</p>
<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p>æ—¢ç„¶æœ‰äº†<code>reactive</code>ï¼Œä¸ºä½•è¿˜è¦<code>ref</code>å‘¢ï¼Ÿå½“æˆ‘ä»¬åªæƒ³è®©æŸä¸ªå˜é‡å®ç°å“åº”å¼çš„æ—¶å€™ï¼Œé‡‡ç”¨reactiveå°±ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤vue3æä¾›äº†refæ–¹æ³•è¿›è¡Œç®€å•å€¼çš„ç›‘å¬ï¼Œä½†å¹¶ä¸æ˜¯è¯´refåªèƒ½ä¼ å…¥ç®€å•å€¼ï¼Œä»–çš„åº•å±‚æ˜¯reactiveã€‚</p>
<h1 id="shallowRefå’ŒshallowReactive"><a href="#shallowRefå’ŒshallowReactive" class="headerlink" title="shallowRefå’ŒshallowReactive"></a>shallowRefå’ŒshallowReactive</h1><h2 id="é€’å½’ç›‘å¬å’Œéé€’å½’ç›‘å¬"><a href="#é€’å½’ç›‘å¬å’Œéé€’å½’ç›‘å¬" class="headerlink" title="é€’å½’ç›‘å¬å’Œéé€’å½’ç›‘å¬"></a>é€’å½’ç›‘å¬å’Œéé€’å½’ç›‘å¬</h2><ol>
<li><code>ref</code>å’Œ<code>reactive</code>ï¼šéƒ½å±äºé€’å½’ç›‘å¬ï¼Œä¹Ÿå°±æ˜¯æ•°æ®çš„æ¯ä¸€å±‚éƒ½æ˜¯å“åº”å¼çš„ï¼Œå¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œéå¸¸æ¶ˆè€—æ€§èƒ½ã€‚</li>
<li><code>shallowReactive</code>å’Œ<code>shallowRef</code>ï¼šéƒ½å±äºéé€’å½’ç›‘å¬ï¼Œä¸¤ä¸ªæ–¹æ³•æ¥åŒ…è£…å“åº”å¼æ•°æ®ï¼Œé€šè¿‡è¯¥æ–¹æ³•åŒ…è£…çš„æ•°æ®åªæœ‰ç¬¬ä¸€å±‚å…·æœ‰å“åº”æ€§ã€‚</li>
</ol>
<h2 id="ref-å’Œ-shallowRef"><a href="#ref-å’Œ-shallowRef" class="headerlink" title="ref å’Œ shallowRef"></a>ref å’Œ shallowRef</h2><ul>
<li><code>ref</code>å®šä¹‰çš„æ•°æ®æ¯ä¸€å±‚éƒ½æ˜¯å“åº”å¼æ•°æ®</li>
<li><code>shallowRef</code>å®šä¹‰çš„æ•°æ®ï¼Œåªæœ‰ç¬¬ä¸€å±‚æ˜¯å“åº”å¼çš„ï¼Œå³åªæœ‰åœ¨æ›´æ”¹<code>.value</code>çš„æ—¶å€™æ‰èƒ½å®ç°å“åº”å¼</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="title function_">ref</span>(&#123;</span><br><span class="line">      <span class="attr">a</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">      <span class="attr">f</span>: &#123;</span><br><span class="line">        <span class="attr">b</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">        <span class="attr">s</span>:&#123;</span><br><span class="line">          <span class="attr">c</span>: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="comment">//æ‰“å°å„å±‚æ•°æ®</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(age);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(age.<span class="property">value</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(age.<span class="property">value</span>.<span class="property">f</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(age.<span class="property">value</span>.<span class="property">f</span>.<span class="property">s</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="title function_">shallowRef</span>(&#123;</span><br><span class="line">      <span class="attr">a</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">      <span class="attr">f</span>: &#123;</span><br><span class="line">        <span class="attr">b</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">        <span class="attr">s</span>:&#123;</span><br><span class="line">          <span class="attr">c</span>: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="comment">//æ‰“å°å„å±‚æ•°æ®</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(age);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(age.<span class="property">value</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(age.<span class="property">value</span>.<span class="property">f</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(age.<span class="property">value</span>.<span class="property">f</span>.<span class="property">s</span>);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>shallowRef</code>åï¼Œå¯ä»¥é€šè¿‡<code>triggerRef()</code>æ–¹æ³•ä¸»åŠ¨æ›´æ–°ç•Œé¢ï¼Œå®ç°ç•Œé¢åˆ·æ–°</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">doSome</span>(<span class="params"></span>)&#123;</span><br><span class="line">  age.<span class="property">value</span>.<span class="property">f</span>.<span class="property">s</span>.<span class="property">c</span> = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">  <span class="comment">//ä¸»åŠ¨æ›´æ–°ç•Œé¢</span></span><br><span class="line">  <span class="title function_">triggerRef</span>(age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="reactive-å’Œ-shallowReactive"><a href="#reactive-å’Œ-shallowReactive" class="headerlink" title="reactive å’Œ shallowReactive"></a>reactive å’Œ shallowReactive</h2><ul>
<li><code>reactive </code>å®šä¹‰çš„æ•°æ®æ¯ä¸€å±‚éƒ½æ˜¯å“åº”å¼æ•°æ®</li>
<li><code>shallowReactive</code> å®šä¹‰çš„æ•°æ®ï¼Œåªæœ‰ç¬¬ä¸€å±‚æ˜¯å“åº”å¼çš„</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong><code>shallowReactive</code>æ²¡æœ‰ç±»ä¼¼ <code>triggerRef()</code> çš„æ–¹æ³•</p>
<h1 id="toRaw"><a href="#toRaw" class="headerlink" title="toRaw"></a>toRaw</h1><p>æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›æ•°æ®è¿›è¡Œå“åº”å¼å®æ—¶æ›´æ–°ï¼Œå¯ä»¥é€šè¿‡<code>toRaw</code>è·å–<code>ref</code>æˆ–<code>reactive</code>å¼•ç”¨çš„åŸå§‹æ•°æ®ï¼Œé€šè¿‡ä¿®æ”¹åŸå§‹æ•°æ®ï¼Œä¸ä¼šé€ æˆç•Œé¢çš„æ›´æ–°ï¼Œåªæœ‰é€šè¿‡ä¿®æ”¹<code>ref</code>å’Œ<code>reactive</code>åŒ…è£…åçš„æ•°æ®æ—¶æ‰ä¼šå‘ç”Ÿç•Œé¢å“åº”å¼å˜åŒ–ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;...&#125;;</span><br><span class="line"><span class="comment">//stateå’Œobj1æ˜¯å¼•ç”¨å…³ç³»ï¼Œstateçš„æœ¬è´¨æ˜¯ä¸€ä¸ªProxyå¯¹è±¡ï¼Œå…¶ä¸­å¼•ç”¨äº†obj1</span></span><br><span class="line"><span class="keyword">let</span> state = <span class="title function_">reactive</span>(obj1);</span><br><span class="line"><span class="comment">//é€šè¿‡toRawæ–¹æ³•è·å–åˆ°åŸå§‹æ•°æ®ï¼Œå…¶å®æ˜¯è·å–åˆ°obj1çš„å†…å­˜åœ°å€ï¼Œobj2å’Œobj1æ˜¯å®Œå…¨ç›¸ç­‰çš„</span></span><br><span class="line"><span class="keyword">let</span> obj2 = <span class="title function_">toRaw</span>(state)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1 === obj2);<span class="comment">//true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ‰äº›åŒå­¦ä¼šé—®ï¼Œé‚£ç›´æ¥ä½¿ç”¨obj1æ¥ä¿®æ”¹æ•°æ®ä¸å°±è¡Œäº†å—ï¼Ÿå¯å…³é”®æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨<code>reactive</code>å®šä¹‰æ•°æ®æ—¶ä¸€èˆ¬ä¸ä¼šå…ˆå®šä¹‰ä¸€ä¸ª<code>obj</code>ï¼Œå†å°†ä»–ä¼ ç»™<code>reactive</code>ï¼Œéƒ½æ˜¯ç›´æ¥åœ¨<code>reactive</code>ä¸­å†™æ•°æ®çš„ã€‚</p>
<h1 id="markRaw"><a href="#markRaw" class="headerlink" title="markRaw"></a>markRaw</h1><p>ä¸toRawä¸åŒï¼ŒmarkRawåŒ…è£…åçš„æ•°æ®æ°¸è¿œä¸ä¼šè¢«è¿½è¸ªã€‚</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;<span class="attr">name</span>: <span class="string">&quot;lijing&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;</span><br><span class="line"><span class="keyword">let</span> obj2 = <span class="title function_">markRaw</span>(obj1);</span><br><span class="line"><span class="comment">//æ­¤æ—¶reactiveåŒ…è£…çš„æ•°æ®è™½ç„¶æ˜¯å“åº”å¼å¯¹è±¡ï¼Œä½†æ˜¯ä¸ä¼šè¢«è·Ÿè¸ªï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿæ•ˆåº”å¼æ•ˆæœ</span></span><br><span class="line"><span class="keyword">let</span> state1 = <span class="title function_">reactive</span>(obj2)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1 === obj2); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h1 id="toRef-å’Œ-toRefs"><a href="#toRef-å’Œ-toRefs" class="headerlink" title="toRef å’Œ toRefs"></a>toRef å’Œ toRefs</h1><p><code>ref</code>å’Œ<code>toRef</code>éƒ½æ˜¯ç”¨æ¥æ„é€ å“åº”å¼æ•°æ®ï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Œçœ‹ä¸¤ä¸ªä¾‹å­</p>
<h2 id="ref-1"><a href="#ref-1" class="headerlink" title="ref"></a>ref</h2><p>å¤åˆ¶ã€ä¿®æ”¹å“åº”å¼æ•°æ®ä¸ä¼šå½±å“ä»¥å‰çš„æ•°æ®ï¼Œæ•°æ®å‘ç”Ÿæ”¹å˜ç•Œé¢å°±ä¼šè‡ªåŠ¨æ›´æ–°ã€‚è½¬æ¢åçš„æ˜¯ä¸€ä¸ª<code>RefImpl</code>ç±»å‹</p>
<p><img src="https://user-images.githubusercontent.com/33454514/166103528-1211a22b-9b35-4ef6-9e5c-9b0b463f2ae4.png" alt="image"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨refå¯¹ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªç®€å•æ•°æ®ç±»å‹å±æ€§è¿›è¡Œå“åº”å¼æ”¹é€ åï¼Œé€šè¿‡ä¿®æ”¹å“åº”å¼æ•°æ®ä¸ä¼šå½±å“åˆ°åŸå§‹æ•°æ®ï¼Œå¦‚ä¸Šå›¾ä¸­ï¼Œé€šè¿‡state1ä¿®æ”¹å€¼åï¼Œobj1ä¸­çš„aå±æ€§å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚</p>
<p><strong>æ³¨æ„ç‚¹ï¼š</strong>ä¿®æ”¹çš„è¿™ä¸ªå±æ€§å¿…é¡»æ˜¯ç®€å•æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œä¸èƒ½æ˜¯å¼•ç”¨ï¼Œå¦‚æœè¯¥å±æ€§ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šå½±å“ã€‚</p>
<h2 id="toRef"><a href="#toRef" class="headerlink" title="toRef"></a>toRef</h2><p>refç±»ä¼¼æ·±æ‹·è´ï¼Œtorefç±»ä¼¼æµ…æ‹·è´ã€‚å¦‚æœä½¿ç”¨toRefæ¥è½¬æ¢ï¼Œåˆ™ä¿®æ”¹å“åº”å¼æ•°æ®ä¼šå½±å“åˆ°åŸå§‹æ•°æ®ï¼Œæ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œä½†æ˜¯ç•Œé¢ä¸ä¼šè‡ªåŠ¨æ›´æ–°ã€‚è½¬æ¢åçš„æ˜¯ä¸€ä¸ª<code>ObjectRefImpl</code>ç±»å‹<img src="https://user-images.githubusercontent.com/33454514/166103644-81bfcefe-f9d4-44c6-8261-e1caa2038f23.png" alt="image"></p>
<h2 id="toRefs"><a href="#toRefs" class="headerlink" title="toRefs"></a>toRefs</h2><p>éå†å¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œå°†å…¶å˜ä¸ºå“åº”å¼æ•°æ®</p>
<p><img src="https://user-images.githubusercontent.com/33454514/166103685-851b36f2-663b-4f94-a728-054ad8bb3f12.png" alt="image"></p>
]]></content>
      <categories>
        <category>vue3</category>
      </categories>
      <tags>
        <tag>vue3</tag>
      </tags>
  </entry>
  <entry>
    <title>V8å¼•æ“çš„åƒåœ¾å›æ”¶æœºåˆ¶</title>
    <url>/2022/01/26/v8%E7%9A%84gc%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p>[toc]</p>
<h1 id="V8å¼•æ“çš„åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#V8å¼•æ“çš„åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="V8å¼•æ“çš„åƒåœ¾å›æ”¶æœºåˆ¶"></a>V8å¼•æ“çš„åƒåœ¾å›æ”¶æœºåˆ¶</h1><p>æˆ‘ä»¬é¦–å…ˆå¸¦ç€è¿™ 4 ä¸ªé—®é¢˜ï¼Œæ¥äº†è§£V8åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ï¼Œåé¢ä¼šé€ä¸€è§£ç­”ï¼š</p>
<ol>
<li>V8æ€ä¹ˆè¿›è¡Œåƒåœ¾å›æ”¶ï¼Ÿ</li>
<li>V8ä¸­ä¸åŒç±»å‹å˜é‡çš„å†…å­˜éƒ½æ˜¯ä½•æ—¶é‡Šæ”¾ï¼Ÿ</li>
<li>å“ªäº›æƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ</li>
<li><code>weakMap</code> <code>weakSet</code> å’Œ <code>Map</code> <code>Set</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
</ol>
<h1 id="å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ"></a>å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>åœ¨ä¸€äº›å˜é‡ä¸å†è¢«éœ€è¦çš„æ—¶å€™ï¼Œå®ƒå°±æ˜¯åƒåœ¾æ•°æ®ï¼Œåƒåœ¾æ•°æ®å ç”¨çš„å†…å­˜å°±åº”è¯¥è¢«å›æ”¶ã€‚æ¯”å¦‚è¿™ä¹ˆä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> dog = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">let</span> dog.<span class="property">a</span> = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>å½“ JavaScript æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ï¼Œ</p>
<p>ä¼šå…ˆåœ¨å…¨å±€ä½œç”¨åŸŸä¸­æ·»åŠ ä¸€ä¸ª<code>dog</code> å±æ€§ï¼Œå¹¶åœ¨å †ä¸­åˆ›å»ºäº†ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå°†è¯¥å¯¹è±¡çš„åœ°å€æŒ‡å‘äº† <code>dog</code>ã€‚</p>
<p>éšååˆåˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 1 çš„æ•°ç»„ï¼Œå¹¶å°†å±æ€§åœ°å€æŒ‡å‘äº† <code>dog.a</code>ã€‚æ­¤æ—¶çš„å†…å­˜å¸ƒå±€å›¾å¦‚ä¸‹æ‰€ç¤º:</p>
<p><img src="https://image.z.itpub.net/zitpub.net/JPG/2020-11-16/9CB21A9D10A25B2CFCEF8A2693141818.jpg" alt="img">å¦‚æœæ­¤æ—¶ï¼Œæˆ‘å°†å¦å¤–ä¸€ä¸ªå¯¹è±¡èµ‹ç»™äº† <code>a</code> å±æ€§ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">dog.<span class="property">a</span> = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶çš„å†…å­˜å¸ƒå±€å›¾ï¼š<img src="https://image.z.itpub.net/zitpub.net/JPG/2020-11-16/2D88EADBC1C1C35E1005637CCE49D949.jpg" alt="img"></p>
<p><code>a</code> çš„æŒ‡å‘æ”¹å˜äº†ï¼Œ æ­¤æ—¶å †ä¸­çš„æ•°ç»„å¯¹è±¡å°±æˆä¸ºäº†ä¸è¢«ä½¿ç”¨çš„æ•°æ®ï¼Œä¸“ä¸šåè¯å«ã€Œä¸å¯è¾¾ã€çš„æ•°æ®ã€‚</p>
<p>è¿™å°±æ˜¯éœ€è¦å›æ”¶çš„åƒåœ¾æ•°æ®ã€‚</p>
<h1 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h1><p>å¯ä»¥å°†è¿™ä¸ªè¿‡ç¨‹æƒ³è±¡æˆä»æ ¹æº¢å‡ºä¸€ä¸ªå·¨å¤§çš„æ²¹æ¼†æ¡¶ï¼Œå®ƒä»ä¸€ä¸ªæ ¹èŠ‚ç‚¹å‡ºå‘å°†å¯åˆ°è¾¾çš„å¯¹è±¡æ ‡è®°æŸ“è‰²ï¼Œ ç„¶åç§»é™¤æœªæ ‡è®°çš„ã€‚</p>
<h2 id="æ ‡è®°ç©ºé—´ä¸­å¯è¾¾å€¼"><a href="#æ ‡è®°ç©ºé—´ä¸­å¯è¾¾å€¼" class="headerlink" title="æ ‡è®°ç©ºé—´ä¸­å¯è¾¾å€¼"></a>æ ‡è®°ç©ºé—´ä¸­å¯è¾¾å€¼</h2><p>V8 é‡‡ç”¨çš„æ˜¯å¯è¾¾æ€§ (reachability) ç®—æ³•æ¥åˆ¤æ–­å †ä¸­çš„å¯¹è±¡åº”ä¸åº”è¯¥è¢«å›æ”¶ã€‚</p>
<p>è¿™ä¸ªç®—æ³•çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>ä»æ ¹èŠ‚ç‚¹ï¼ˆRootï¼‰å‡ºå‘ï¼Œéå†æ‰€æœ‰çš„å¯¹è±¡ã€‚</li>
<li>å¯ä»¥éå†åˆ°çš„å¯¹è±¡ï¼Œæ˜¯å¯è¾¾çš„ï¼ˆreachableï¼‰ã€‚</li>
<li>æ²¡æœ‰è¢«éå†åˆ°çš„å¯¹è±¡ï¼Œä¸å¯è¾¾çš„ï¼ˆunreachableï¼‰ã€‚</li>
</ul>
<p>åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ï¼Œæ ¹èŠ‚ç‚¹æœ‰å¾ˆå¤šï¼Œä¸»è¦åŒ…æ‹¬è¿™å‡ ç§ï¼š</p>
<ul>
<li>å…¨å±€å˜é‡ <code>window</code>ï¼Œä½äºæ¯ä¸ª <code>iframe</code> ä¸­</li>
<li>æ–‡æ¡£ <code>DOM</code> æ ‘</li>
<li>å­˜æ”¾åœ¨æ ˆä¸Šçš„å˜é‡</li>
<li>â€¦</li>
</ul>
<p>è¿™äº›æ ¹èŠ‚ç‚¹ä¸æ˜¯åƒåœ¾ï¼Œä¸å¯èƒ½è¢«å›æ”¶ã€‚</p>
<h2 id="å›æ”¶ä¸å¯è¾¾çš„å€¼æ‰€å æ®çš„å†…å­˜"><a href="#å›æ”¶ä¸å¯è¾¾çš„å€¼æ‰€å æ®çš„å†…å­˜" class="headerlink" title="å›æ”¶ä¸å¯è¾¾çš„å€¼æ‰€å æ®çš„å†…å­˜"></a>å›æ”¶ä¸å¯è¾¾çš„å€¼æ‰€å æ®çš„å†…å­˜</h2><p>åœ¨æ‰€æœ‰çš„æ ‡è®°å®Œæˆä¹‹åï¼Œç»Ÿä¸€æ¸…ç†å†…å­˜ä¸­æ‰€æœ‰ä¸å¯è¾¾çš„å¯¹è±¡ã€‚</p>
<h2 id="å†…å­˜æ•´ç†"><a href="#å†…å­˜æ•´ç†" class="headerlink" title="å†…å­˜æ•´ç†"></a>å†…å­˜æ•´ç†</h2><ul>
<li>åœ¨é¢‘ç¹å›æ”¶å¯¹è±¡åï¼Œå†…å­˜ä¸­å°±ä¼šå­˜åœ¨å¤§é‡ä¸è¿ç»­ç©ºé—´ï¼Œä¸“ä¸šåè¯å«ã€Œå†…å­˜ç¢ç‰‡ã€ã€‚</li>
<li>å½“å†…å­˜ä¸­å‡ºç°äº†å¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¦‚æœéœ€è¦åˆ†é…è¾ƒå¤§çš„è¿ç»­å†…å­˜æ—¶ï¼Œå°±æœ‰å¯èƒ½å‡ºç°å†…å­˜ä¸è¶³çš„æƒ…å†µã€‚</li>
<li>æ‰€ä»¥æœ€åä¸€æ­¥æ˜¯æ•´ç†å†…å­˜ç¢ç‰‡ã€‚(ä½†è¿™æ­¥å…¶å®æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºæœ‰çš„åƒåœ¾å›æ”¶å™¨ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ¯”å¦‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä»‹ç»çš„å‰¯åƒåœ¾å›æ”¶å™¨ã€‚)</li>
</ul>
<h1 id="åƒåœ¾å›æ”¶æ–¹å¼"><a href="#åƒåœ¾å›æ”¶æ–¹å¼" class="headerlink" title="åƒåœ¾å›æ”¶æ–¹å¼"></a>åƒåœ¾å›æ”¶æ–¹å¼</h1><p>V8è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œä¼šæš‚åœ JavaScript è„šæœ¬ï¼Œç­‰åƒåœ¾å›æ”¶å®Œæ¯•å†ç»§ç»­æ‰§è¡Œã€‚</p>
<p>å¯¹äºæ™®é€šåº”ç”¨è¿™æ ·æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¯¹äº JS æ¸¸æˆã€åŠ¨ç”»å¯¹è¿è´¯æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åº”ç”¨ï¼Œå¦‚æœæš‚åœæ—¶é—´å¾ˆé•¿å°±ä¼šé€ æˆé¡µé¢å¡é¡¿ã€‚</p>
<p>è¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è°ˆçš„å…³äºåƒåœ¾å›æ”¶çš„é—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¯ä»¥é¿å…é•¿æ—¶é—´æš‚åœã€‚</p>
<h2 id="åˆ†ä»£æ”¶é›†"><a href="#åˆ†ä»£æ”¶é›†" class="headerlink" title="åˆ†ä»£æ”¶é›†"></a>åˆ†ä»£æ”¶é›†</h2><p>V8å°†æ•°æ®åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ã€Œä¸´æ—¶ã€å¯¹è±¡ï¼Œä¸€ç§æ˜¯ã€Œé•¿ä¹…ã€å¯¹è±¡ã€‚</p>
<ul>
<li><p>ä¸´æ—¶å¯¹è±¡ï¼š</p>
</li>
<li><ul>
<li>å¤§éƒ¨åˆ†å¯¹è±¡åœ¨å†…å­˜ä¸­å­˜æ´»çš„æ—¶é—´å¾ˆçŸ­ã€‚</li>
<li>æ¯”å¦‚å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡ï¼Œæˆ–è€…å—çº§ä½œç”¨åŸŸä¸­çš„å˜é‡ã€‚å½“å‡½æ•°æˆ–è€…ä»£ç å—æ‰§è¡Œç»“æŸæ—¶ï¼Œä½œç”¨åŸŸä¸­å®šä¹‰çš„å˜é‡å°±ä¼šè¢«é”€æ¯ã€‚</li>
<li>è¿™ç±»å¯¹è±¡å¾ˆå¿«å°±å˜å¾—ä¸å¯è®¿é—®ï¼Œåº”è¯¥å¿«ç‚¹å›æ”¶ã€‚</li>
</ul>
</li>
<li><p>é•¿ä¹…å¯¹è±¡ï¼š</p>
</li>
<li><ul>
<li>ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿çš„å¯¹è±¡ï¼Œæ¯”å¦‚å…¨å±€çš„ <code>windowã€DOMã€Web API</code> ç­‰ç­‰ã€‚</li>
<li>è¿™ç±»å¯¹è±¡å¯ä»¥æ…¢ç‚¹å›æ”¶ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ä¸¤ç§å¯¹è±¡å¯¹åº”ä¸åŒçš„å›æ”¶ç­–ç•¥ï¼Œæ‰€ä»¥ï¼ŒV8 æŠŠå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ä¸¤ä¸ªåŒºåŸŸï¼Œ æ–°ç”Ÿä»£ä¸­å­˜æ”¾ä¸´æ—¶å¯¹è±¡ï¼Œè€ç”Ÿä»£ä¸­å­˜æ”¾æŒä¹…å¯¹è±¡ã€‚</p>
<p>å¹¶ä¸”è®©å‰¯åƒåœ¾å›æ”¶å™¨ã€ä¸»åƒåœ¾å›æ”¶å™¨ï¼Œåˆ†åˆ«è´Ÿè´£æ–°ç”Ÿä»£ã€è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶ã€‚</p>
<p>è¿™æ ·å°±å¯ä»¥å®ç°é«˜æ•ˆçš„åƒåœ¾å›æ”¶å•¦ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œé¢è¯•å›ç­”åˆ°è¿™å°±å¤Ÿäº†ã€‚å¦‚æœæƒ³å’Œé¢è¯•å®˜æ·±å…¥äº¤æµï¼Œå¯ä»¥ç»§ç»­èŠèŠä¸¤ä¸ªåƒåœ¾å›æ”¶å™¨ã€‚</p>
<h3 id="ä¸»åƒåœ¾å›æ”¶å™¨"><a href="#ä¸»åƒåœ¾å›æ”¶å™¨" class="headerlink" title="ä¸»åƒåœ¾å›æ”¶å™¨"></a>ä¸»åƒåœ¾å›æ”¶å™¨</h3><p>è´Ÿè´£è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼Œæœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li>å¯¹è±¡å ç”¨ç©ºé—´å¤§ã€‚</li>
<li>å¯¹è±¡å­˜æ´»æ—¶é—´é•¿ã€‚</li>
</ol>
<p>å®ƒä½¿ç”¨ã€Œæ ‡è®°-æ¸…é™¤ã€çš„ç®—æ³•æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚</p>
<ol>
<li>é¦–å…ˆæ˜¯æ ‡è®°ã€‚</li>
</ol>
<ul>
<li>ä»ä¸€ç»„æ ¹å…ƒç´ å¼€å§‹ï¼Œé€’å½’éå†è¿™ç»„æ ¹å…ƒç´ ã€‚</li>
<li>åœ¨è¿™ä¸ªéå†è¿‡ç¨‹ä¸­ï¼Œèƒ½åˆ°è¾¾çš„å…ƒç´ ç§°ä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œæ²¡æœ‰åˆ°è¾¾çš„å…ƒç´ å°±å¯ä»¥åˆ¤æ–­ä¸ºåƒåœ¾æ•°æ®ã€‚</li>
</ul>
<p>ç„¶åæ˜¯åƒåœ¾æ¸…é™¤ã€‚<img src="https://image.z.itpub.net/zitpub.net/JPG/2020-11-16/BDDC2A2EDC0D87EFD594C41B20A5FCEC.jpg" alt="img">ç›´æ¥å°†æ ‡è®°ä¸ºåƒåœ¾çš„æ•°æ®æ¸…ç†æ‰ã€‚</p>
<p>å¤šæ¬¡æ ‡è®°-æ¸…é™¤åï¼Œä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œéœ€è¦è¿›è¡Œå†…å­˜æ•´ç†ã€‚<img src="https://image.z.itpub.net/zitpub.net/JPG/2020-11-16/A4BD5AEEF4FF19858B823BDFB82E879B.jpg" alt="img"></p>
<h3 id="å‰¯åƒåœ¾å›æ”¶å™¨"><a href="#å‰¯åƒåœ¾å›æ”¶å™¨" class="headerlink" title="å‰¯åƒåœ¾å›æ”¶å™¨"></a>å‰¯åƒåœ¾å›æ”¶å™¨</h3><p>è´Ÿè´£æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼Œé€šå¸¸åªæ”¯æŒ 1~8 M çš„å®¹é‡ã€‚</p>
<p>æ–°ç”Ÿä»£è¢«åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼šä¸€èˆ¬æ˜¯å¯¹è±¡åŒºåŸŸï¼Œä¸€åŠæ˜¯ç©ºé—²åŒºåŸŸã€‚<img src="https://image.z.itpub.net/zitpub.net/JPG/2020-11-16/1F8C55A87A1DAAED998BFE1729BF604C.jpg" alt="img">æ–°åŠ å…¥çš„å¯¹è±¡éƒ½è¢«æ”¾å…¥å¯¹è±¡åŒºåŸŸï¼Œç­‰å¯¹è±¡åŒºåŸŸå¿«æ»¡çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡åƒåœ¾æ¸…ç†ã€‚</p>
<ol>
<li>å…ˆç»™å¯¹è±¡åŒºåŸŸæ‰€æœ‰åƒåœ¾åšæ ‡è®°ã€‚</li>
<li>æ ‡è®°å®Œæˆåï¼Œå­˜æ´»çš„å¯¹è±¡è¢«å¤åˆ¶åˆ°ç©ºé—²åŒºåŸŸï¼Œå¹¶ä¸”å°†ä»–ä»¬æœ‰åºçš„æ’åˆ—ä¸€éã€‚<img src="https://image.z.itpub.net/zitpub.net/JPG/2020-11-16/9AFA85C62E23E5BFE7BCC02989E14FDF.jpg" alt="img">è¿™å°±å›åˆ°æˆ‘ä»¬å‰é¢ç•™ä¸‹çš„é—®é¢˜ â€“ å‰¯åƒåœ¾å›æ”¶å™¨æ²¡æœ‰ç¢ç‰‡æ•´ç†ã€‚å› ä¸ºç©ºé—²åŒºåŸŸé‡Œæ­¤æ—¶æ˜¯æœ‰åºçš„ï¼Œæ²¡æœ‰ç¢ç‰‡ï¼Œä¹Ÿå°±ä¸éœ€è¦æ•´ç†äº†ã€‚</li>
<li>å¤åˆ¶å®Œæˆåï¼Œå¯¹è±¡åŒºåŸŸä¼šå’Œç©ºé—²åŒºåŸŸè¿›è¡Œå¯¹è°ƒã€‚å°†ç©ºé—²åŒºåŸŸä¸­å­˜æ´»çš„å¯¹è±¡æ”¾å…¥å¯¹è±¡åŒºåŸŸé‡Œã€‚<img src="https://image.z.itpub.net/zitpub.net/JPG/2020-11-16/932E7BB81521530505384FF56A59DF48.jpg" alt="img">è¿™æ ·ï¼Œå°±å®Œæˆäº†åƒåœ¾å›æ”¶ã€‚</li>
</ol>
<p>å› ä¸ºå‰¯åƒåœ¾å›æ”¶å™¨æ“ä½œæ¯”è¾ƒé¢‘ç¹ï¼Œæ‰€ä»¥ä¸ºäº†æ‰§è¡Œæ•ˆç‡ï¼Œä¸€èˆ¬æ–°ç”ŸåŒºçš„ç©ºé—´ä¼šè¢«è®¾ç½®å¾—æ¯”è¾ƒå°ã€‚</p>
<p>ä¸€æ—¦æ£€æµ‹åˆ°ç©ºé—´è£…æ»¡äº†ï¼Œå°±æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚</p>
<h3 id="åˆ†ä»£æ”¶é›†-1"><a href="#åˆ†ä»£æ”¶é›†-1" class="headerlink" title="åˆ†ä»£æ”¶é›†"></a>åˆ†ä»£æ”¶é›†</h3><p>ä¸€å¥è¯æ€»ç»“åˆ†ä»£å›æ”¶å°±æ˜¯ï¼šå°†å †åˆ†ä¸ºæ–°ç”Ÿä»£ä¸è€ç”Ÿä»£ï¼Œå¤šå›æ”¶æ–°ç”Ÿä»£ï¼Œå°‘å›æ”¶è€ç”Ÿä»£ã€‚</p>
<p>è¿™æ ·å°±å‡å°‘äº†æ¯æ¬¡éœ€éå†çš„å¯¹è±¡ï¼Œä»è€Œå‡å°‘æ¯æ¬¡åƒåœ¾å›æ”¶çš„è€—æ—¶ã€‚<img src="https://image.z.itpub.net/zitpub.net/JPG/2020-11-16/F03806EE24DA9A564E0BC3ECAD500DFD.jpg" alt="img"></p>
<h2 id="å¢é‡æ”¶é›†"><a href="#å¢é‡æ”¶é›†" class="headerlink" title="å¢é‡æ”¶é›†"></a>å¢é‡æ”¶é›†</h2><p>å¦‚æœè„šæœ¬ä¸­æœ‰è®¸å¤šå¯¹è±¡ï¼Œå¼•æ“ä¸€æ¬¡æ€§éå†æ•´ä¸ªå¯¹è±¡ï¼Œä¼šé€ æˆä¸€ä¸ªé•¿æ—¶é—´æš‚åœã€‚</p>
<p>æ‰€ä»¥å¼•æ“å°†åƒåœ¾æ”¶é›†å·¥ä½œåˆ†æˆæ›´å°çš„å—ï¼Œæ¯æ¬¡å¤„ç†ä¸€éƒ¨åˆ†ï¼Œå¤šæ¬¡å¤„ç†ã€‚</p>
<p>è¿™æ ·å°±è§£å†³äº†é•¿æ—¶é—´åœé¡¿çš„é—®é¢˜ã€‚<img src="https://image.z.itpub.net/zitpub.net/JPG/2020-11-16/97A76334ACE67AC1FC3022376EDCC27E.jpg" alt="img"></p>
<h2 id="é—²æ—¶æ”¶é›†"><a href="#é—²æ—¶æ”¶é›†" class="headerlink" title="é—²æ—¶æ”¶é›†"></a>é—²æ—¶æ”¶é›†</h2><p>åƒåœ¾æ”¶é›†å™¨åªä¼šåœ¨ CPU ç©ºé—²æ—¶å°è¯•è¿è¡Œï¼Œä»¥å‡å°‘å¯èƒ½å¯¹ä»£ç æ‰§è¡Œçš„å½±å“ã€‚</p>
<h1 id="å…³äºV8-GCçš„ä¸€äº›é—®é¢˜"><a href="#å…³äºV8-GCçš„ä¸€äº›é—®é¢˜" class="headerlink" title="å…³äºV8 GCçš„ä¸€äº›é—®é¢˜"></a>å…³äºV8 GCçš„ä¸€äº›é—®é¢˜</h1><h2 id="é—®é¢˜1ï¼šV8æ€ä¹ˆè¿›è¡Œåƒåœ¾å›æ”¶ï¼Ÿ"><a href="#é—®é¢˜1ï¼šV8æ€ä¹ˆè¿›è¡Œåƒåœ¾å›æ”¶ï¼Ÿ" class="headerlink" title="é—®é¢˜1ï¼šV8æ€ä¹ˆè¿›è¡Œåƒåœ¾å›æ”¶ï¼Ÿ"></a>é—®é¢˜1ï¼šV8æ€ä¹ˆè¿›è¡Œåƒåœ¾å›æ”¶ï¼Ÿ</h2><p>ä»ä¸‰ä¸ªç‚¹æ¥å›ç­”ä»€ä¹ˆæ˜¯åƒåœ¾ã€å¦‚ä½•æ¡åƒåœ¾ã€ä»€ä¹ˆæ—¶å€™æ¡åƒåœ¾ã€‚</p>
<ol>
<li>ä»€ä¹ˆæ˜¯åƒåœ¾</li>
</ol>
<ul>
<li>ä¸å†éœ€è¦ï¼Œå³ä¸ºåƒåœ¾</li>
<li>å…¨å±€å˜é‡éšæ—¶å¯èƒ½ç”¨åˆ°ï¼Œæ‰€ä»¥ä¸€å®šä¸æ˜¯åƒåœ¾</li>
</ul>
<p>å¦‚ä½•æ¡åƒåœ¾ï¼ˆéå†ç®—æ³•ï¼‰</p>
<ul>
<li><p>æ ‡è®°ç©ºé—´ä¸­ã€Œå¯è¾¾ã€å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- ä»æ ¹èŠ‚ç‚¹ï¼ˆRootï¼‰å‡ºå‘ï¼Œéå†æ‰€æœ‰çš„å¯¹è±¡ã€‚</span><br><span class="line">- å¯ä»¥éå†åˆ°çš„å¯¹è±¡ï¼Œæ˜¯å¯è¾¾çš„ï¼ˆreachableï¼‰ã€‚</span><br><span class="line">- æ²¡æœ‰è¢«éå†åˆ°çš„å¯¹è±¡ï¼Œä¸å¯è¾¾çš„ï¼ˆunreachableï¼‰</span><br></pre></td></tr></table></figure></li>
<li><p>å›æ”¶ã€Œä¸å¯è¾¾ã€çš„å€¼æ‰€å æ®çš„å†…å­˜ã€‚</p>
</li>
<li><p>åšå†…å­˜æ•´ç†ã€‚</p>
</li>
</ul>
<p>ä»€ä¹ˆæ—¶å€™æ¡åƒåœ¾</p>
<ul>
<li>å‰ç«¯æœ‰å…¶ç‰¹æ®Šæ€§ï¼Œåƒåœ¾å›æ”¶çš„æ—¶å€™ä¼šé€ æˆé¡µé¢å¡é¡¿ã€‚</li>
<li>åˆ†ä»£æ”¶é›†ã€å¢é‡æ”¶é›†ã€é—²æ—¶æ”¶é›†ã€‚</li>
</ul>
<h2 id="é—®é¢˜2ï¼šV8ä¸­ä¸åŒç±»å‹å˜é‡çš„å†…å­˜éƒ½æ˜¯ä½•æ—¶é‡Šæ”¾ï¼Ÿ"><a href="#é—®é¢˜2ï¼šV8ä¸­ä¸åŒç±»å‹å˜é‡çš„å†…å­˜éƒ½æ˜¯ä½•æ—¶é‡Šæ”¾ï¼Ÿ" class="headerlink" title="é—®é¢˜2ï¼šV8ä¸­ä¸åŒç±»å‹å˜é‡çš„å†…å­˜éƒ½æ˜¯ä½•æ—¶é‡Šæ”¾ï¼Ÿ"></a>é—®é¢˜2ï¼šV8ä¸­ä¸åŒç±»å‹å˜é‡çš„å†…å­˜éƒ½æ˜¯ä½•æ—¶é‡Šæ”¾ï¼Ÿ</h2><p>Javascritp ä¸­ç±»å‹ï¼šå€¼ç±»å‹ï¼Œå¼•ç”¨ç±»å‹ã€‚</p>
<ul>
<li><p>å¼•ç”¨ç±»å‹</p>
<ul>
<li>åœ¨æ²¡æœ‰å¼•ç”¨ä¹‹åï¼Œé€šè¿‡ V8 è‡ªåŠ¨å›æ”¶ã€‚</li>
</ul>
</li>
<li><p>å€¼ç±»å‹</p>
<ul>
<li>å¦‚æœå¤„äºé—­åŒ…çš„æƒ…å†µä¸‹ï¼Œè¦ç­‰é—­åŒ…æ²¡æœ‰å¼•ç”¨æ‰ä¼šè¢« V8 å›æ”¶ã€‚</li>
</ul>
<ul>
<li>éé—­åŒ…çš„æƒ…å†µä¸‹ï¼Œç­‰å¾… V8 çš„æ–°ç”Ÿä»£åˆ‡æ¢çš„æ—¶å€™å›æ”¶ã€‚</li>
</ul>
</li>
</ul>
<h2 id="é—®é¢˜3ï¼šå“ªäº›æƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ"><a href="#é—®é¢˜3ï¼šå“ªäº›æƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ" class="headerlink" title="é—®é¢˜3ï¼šå“ªäº›æƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ"></a>é—®é¢˜3ï¼šå“ªäº›æƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ</h2><blockquote>
<p>å†…å­˜æ³„éœ²æ˜¯æŒ‡ä½ ã€Œç”¨ä¸åˆ°ã€ï¼ˆè®¿é—®ä¸åˆ°ï¼‰çš„å˜é‡ï¼Œä¾ç„¶å å±…ç€å†…å­˜ç©ºé—´ï¼Œä¸èƒ½è¢«å†æ¬¡åˆ©ç”¨èµ·æ¥ã€‚</p>
</blockquote>
<p>ä»¥ Vue ä¸ºä¾‹ï¼Œé€šå¸¸æœ‰è¿™äº›æƒ…å†µï¼š</p>
<ul>
<li>ç›‘å¬åœ¨ <code>window/body</code> ç­‰äº‹ä»¶æ²¡æœ‰è§£ç»‘</li>
<li>ç»‘åœ¨ <code>EventBus</code> çš„äº‹ä»¶æ²¡æœ‰è§£ç»‘</li>
<li><code>Vuex</code> çš„ <code>$store</code>ï¼Œ<code>watch</code> äº†ä¹‹åæ²¡æœ‰ <code>unwatch</code></li>
<li>ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“åˆ›å»ºï¼Œæ²¡æœ‰è°ƒç”¨æ­£ç¡®çš„é”€æ¯å‡½æ•°</li>
</ul>
<p>è§£å†³åŠæ³•ï¼š<code>beforeDestroy</code> ä¸­åŠæ—¶é”€æ¯</p>
<ul>
<li>ç»‘å®šäº† <code>DOM/BOM</code> å¯¹è±¡ä¸­çš„äº‹ä»¶ <code>addEventListener</code> ï¼Œ<code>removeEventListener</code>ã€‚</li>
<li>è§‚å¯Ÿè€…æ¨¡å¼ <code>$on</code>ï¼Œ<code>$off</code>å¤„ç†ã€‚</li>
<li>å¦‚æœç»„ä»¶ä¸­ä½¿ç”¨äº†å®šæ—¶å™¨ï¼Œåº”é”€æ¯å¤„ç†ã€‚</li>
<li>å¦‚æœåœ¨ <code>mounted/created</code> é’©å­ä¸­ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹åº“åˆå§‹åŒ–ï¼Œå¯¹åº”çš„é”€æ¯ã€‚</li>
<li>ä½¿ç”¨å¼±å¼•ç”¨ <code>weakMap</code>ã€<code>weakSet</code>ã€‚</li>
</ul>
<h3 id="é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„éœ²å—ï¼Ÿ"><a href="#é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„éœ²å—ï¼Ÿ" class="headerlink" title="é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„éœ²å—ï¼Ÿ"></a>é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„éœ²å—ï¼Ÿ</h3><p>é¡ºä¾¿è¯´ä¸€ä¸ªæˆ‘åœ¨äº†è§£åƒåœ¾å›æ”¶ä¹‹å‰å¯¹é—­åŒ…çš„è¯¯è§£ã€‚</p>
<p>é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„éœ²å—ï¼Ÿæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ä¸ä¼šã€‚</p>
<p>å†…å­˜æ³„éœ²æ˜¯æŒ‡ä½ ã€Œç”¨ä¸åˆ°ã€ï¼ˆè®¿é—®ä¸åˆ°ï¼‰çš„å˜é‡ï¼Œä¾ç„¶å å±…ç€å†…å­˜ç©ºé—´ï¼Œä¸èƒ½è¢«å†æ¬¡åˆ©ç”¨èµ·æ¥ã€‚é—­åŒ…é‡Œé¢çš„å˜é‡å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å˜é‡ï¼Œä¸èƒ½è¯´æ˜¯å†…å­˜æ³„éœ²ã€‚</p>
<blockquote>
<p>è¿™ä¸ªè¯¯è§£æ˜¯å¦‚ä½•æ¥çš„ï¼Ÿå› ä¸º IEã€‚IE æœ‰ bugï¼ŒIE åœ¨æˆ‘ä»¬ä½¿ç”¨å®Œé—­åŒ…ä¹‹åï¼Œä¾ç„¶å›æ”¶ä¸äº†é—­åŒ…é‡Œé¢å¼•ç”¨çš„å˜é‡ã€‚è¿™æ˜¯ IE çš„é—®é¢˜ï¼Œä¸æ˜¯é—­åŒ…çš„é—®é¢˜ã€‚</p>
</blockquote>
<h2 id="é—®é¢˜4ï¼šweakMap-weakSet-å’Œ-Map-Set-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#é—®é¢˜4ï¼šweakMap-weakSet-å’Œ-Map-Set-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="é—®é¢˜4ï¼šweakMap weakSet å’Œ Map Set æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>é—®é¢˜4ï¼š<code>weakMap</code> <code>weakSet</code> å’Œ <code>Map</code> <code>Set</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>åœ¨ ES6 ä¸­ä¸ºæˆ‘ä»¬æ–°å¢äº†ä¸¤ä¸ªæ•°æ®ç»“æ„ <code>WeakMap</code>å’Œ<code>WeakSet</code>å°±æ˜¯ä¸ºäº†è§£å†³å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚</p>
<p>å®ƒçš„é”®åæ‰€å¼•ç”¨çš„å¯¹è±¡éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œå°±æ˜¯åƒåœ¾å›æ”¶æœºåˆ¶éå†çš„æ—¶å€™ä¸è€ƒè™‘è¯¥å¼•ç”¨ã€‚åªè¦æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å…¶ä»–å¼•ç”¨éƒ½è¢«æ¸…é™¤ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä¸å†éœ€è¦ï¼Œ <code>WeakMap</code>é‡Œé¢çš„é”®åå¯¹è±¡å’Œæ‰€å¯¹åº”çš„é”®å€¼å¯¹ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ é™¤å¼•ç”¨ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç°åœ¨æˆ‘ä»¬ç®€å•äº†è§£äº†V8çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè¿˜è®°å¾—æœ€åˆçš„ 4 ä¸ªé—®é¢˜å—ï¼Ÿ</p>
<ol>
<li>V8æ€ä¹ˆè¿›è¡Œåƒåœ¾å›æ”¶ï¼Ÿ</li>
</ol>
<p>ç­”é¢˜æ€è·¯ï¼šä»€ä¹ˆæ˜¯åƒåœ¾ã€æ€ä¹ˆæ”¶åƒåœ¾ã€ä»€ä¹ˆæ—¶å€™æ”¶åƒåœ¾ã€‚</p>
<ol start="2">
<li>V8ä¸­ä¸åŒç±»å‹å˜é‡çš„å†…å­˜éƒ½æ˜¯ä½•æ—¶é‡Šæ”¾ï¼Ÿ</li>
</ol>
<p>ç­”é¢˜æ€è·¯ï¼šåˆ†ä¸ºå€¼ç±»å‹ã€å¼•ç”¨ç±»å‹ã€‚</p>
<ol start="3">
<li>å“ªäº›æƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ</li>
</ol>
<p>ç­”é¢˜æ€è·¯ï¼šå†…å­˜æ³„éœ²æ˜¯æŒ‡ä½ ã€Œç”¨ä¸åˆ°ã€ï¼ˆè®¿é—®ä¸åˆ°ï¼‰çš„å˜é‡ï¼Œä¾ç„¶å å±…ç€å†…å­˜ç©ºé—´ï¼Œä¸èƒ½è¢«å†æ¬¡åˆ©ç”¨èµ·æ¥ã€‚</p>
<ol start="4">
<li><code>weakMap</code> <code>weakSet</code> å’Œ <code>Map</code> <code>Set</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
</ol>
<p>ç­”é¢˜æ€è·¯ï¼š<code>WeakMap</code>ã€<code>WeakSet</code> å¼±å¼•ç”¨ï¼Œè§£å†³äº†å†…å­˜æ³„éœ²é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
        <category>V8</category>
      </categories>
      <tags>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
        <tag>V8</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨ Github Actions è‡ªåŠ¨éƒ¨ç½² Hexo åšå®¢</title>
    <url>/2022/01/28/%E5%88%A9%E7%94%A8%20Github%20Actions%20%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%20Hexo%20%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<p>[toc]</p>
<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>Github Actions å¯ä»¥å¾ˆæ–¹ä¾¿å®ç° CI/CD å·¥ä½œæµï¼Œç±»ä¼¼ Travis çš„ç”¨æ³•ï¼Œæ¥å¸®æˆ‘ä»¬å®Œæˆä¸€äº›å·¥ä½œï¼Œæ¯”å¦‚å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰æ“ä½œã€‚å½“æˆ‘ä»¬è¿è¡Œ Jobs æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå®¹å™¨ (runner)ï¼Œå®¹å™¨æ”¯æŒï¼šUbuntuã€Windows å’Œ MacOS ç­‰ç³»ç»Ÿï¼Œåœ¨å®¹å™¨ä¸­æˆ‘ä»¬å¯ä»¥å®‰è£…è½¯ä»¶ï¼Œåˆ©ç”¨å®‰è£…çš„è½¯ä»¶å¸®æˆ‘ä»¬å¤„ç†ä¸€äº›æ•°æ®ï¼Œç„¶åæŠŠå¤„ç†å¥½çš„æ•°æ®æ¨é€åˆ°æŸä¸ªåœ°æ–¹ã€‚åœ¨ Travis å…¨é¢æ”¶è´¹ä¹‹åï¼Œç¬”è€…ä¸å¾—ä¸æ¢ä¸€ä¸ª CI å¹³å°æ¥å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œä¾¿æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p>
<p>æœ¬æ–‡å°†ä»‹ç»åˆ©ç”¨ Github Actions å®ç°è‡ªåŠ¨éƒ¨ç½² hexo åˆ° Github Pagesã€‚åœ¨ä¹‹å‰æˆ‘ä»¬éœ€è¦å†™å®Œæ–‡ç« ååœ¨æœ¬åœ°æ‰§è¡Œ <code>hexo g -d</code> æ¥éƒ¨ç½²ï¼Œå½“ä½ æ–‡ç« æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œç¼–è¯‘éƒ¨ç½²éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚è€Œä¸”è¿˜å¯èƒ½ä¼šé‡åˆ°æœ¬åœ°å®‰è£…çš„ Node.js ç‰ˆæœ¬ä¸ Hexo ä¸å…¼å®¹çš„é—®é¢˜ï¼Œéœ€è¦ç”¨ <code>nvm</code> æ¥ç®¡ç†ä¸åŒç‰ˆæœ¬çš„Node.jsï¼ˆå…¶å®ä¸»è¦è¿˜æ˜¯å› ä¸ºæ‡’ï¼‰ã€‚ã€‚åˆ©ç”¨ Github Actions ä½ å°†ä¼šæ²¡æœ‰è¿™äº›çƒ¦æ¼ï¼Œä»…éœ€è¦æŠŠHexoé¡¹ç›®pullåˆ°æœ¬åœ°ï¼ŒæŠŠæœ¬åœ°å†™å¥½çš„æ–‡ç« æ”¾å…¥é¡¹ç›®çš„ <code>_posts</code> æ–‡ä»¶å¤¹ä¸‹ç„¶å pushï¼ŒActionså°†è‡ªåŠ¨éƒ¨ç½²æ›´æ–°ã€‚</p>
<h1 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h1><h2 id="åˆ›å»ºæ‰€éœ€ä»“åº“"><a href="#åˆ›å»ºæ‰€éœ€ä»“åº“" class="headerlink" title="åˆ›å»ºæ‰€éœ€ä»“åº“"></a>åˆ›å»ºæ‰€éœ€ä»“åº“</h2><p>æœ¬æ–‡ä»…ç”¨ä¸€ä¸ªä»“åº“å­˜å‚¨é™æ€æ–‡ä»¶å’Œhexoé¡¹ç›®ï¼Œåˆ†ä¸åŒçš„branchå­˜å‚¨ï¼š</p>
<ol>
<li>åˆ›å»º <code>blog</code> åˆ†æ”¯ç”¨æ¥å­˜æ”¾ Hexo é¡¹ç›®</li>
<li>åˆ›å»º <code>main</code> åˆ†æ”¯ç”¨æ¥å­˜æ”¾é™æ€åšå®¢é¡µé¢</li>
</ol>
<h2 id="ç”Ÿæˆéƒ¨ç½²å¯†é’¥"><a href="#ç”Ÿæˆéƒ¨ç½²å¯†é’¥" class="headerlink" title="ç”Ÿæˆéƒ¨ç½²å¯†é’¥"></a>ç”Ÿæˆéƒ¨ç½²å¯†é’¥</h2><p>ä¸€è·¯æŒ‰å›è½¦ç›´åˆ°ç”ŸæˆæˆåŠŸ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen -f github-deploy-key</span><br></pre></td></tr></table></figure>

<p>å½“å‰ç›®å½•ä¸‹ä¼šæœ‰ <code>github-deploy-key</code> å’Œ <code>github-deploy-key.pub</code> ä¸¤ä¸ªæ–‡ä»¶ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/33454514/151518040-6204df2e-413e-40c0-bb9f-2dbcf61b35f2.png" alt="image"></p>
<h2 id="é…ç½®éƒ¨ç½²å¯†é’¥"><a href="#é…ç½®éƒ¨ç½²å¯†é’¥" class="headerlink" title="é…ç½®éƒ¨ç½²å¯†é’¥"></a>é…ç½®éƒ¨ç½²å¯†é’¥</h2><p>å¤åˆ¶ <code>github-deploy-key</code> æ–‡ä»¶å†…å®¹ï¼Œåœ¨ <code>blog</code> ä»“åº“ <code>Settings -&gt; Secrets -&gt; Actions -&gt; Add a new secret</code> é¡µé¢ä¸Šæ·»åŠ ã€‚</p>
<ol>
<li>åœ¨ <code>Name</code> è¾“å…¥æ¡†å¡«å†™ <code>HEXO_DEPLOY_PRI</code>ã€‚</li>
<li>åœ¨ <code>Value</code> è¾“å…¥æ¡†å¡«å†™ <code>github-deploy-key</code> æ–‡ä»¶å†…å®¹ï¼ˆä»¥<code>-----BEGIN OPENSSH PRIVATE KEY-----</code>å¼€å¤´ï¼‰ã€‚</li>
</ol>
<p><img src="https://user-images.githubusercontent.com/33454514/151518361-36101e8d-db94-4362-b7f7-6e9497ce0880.png" alt="image"></p>
<p>å¤åˆ¶ <code>github-deploy-key.pub</code> æ–‡ä»¶å†…å®¹ï¼Œåœ¨ <code>your.github.io</code> ä»“åº“ <code>Settings -&gt; Deploy keys -&gt; Add deploy key</code> é¡µé¢ä¸Šæ·»åŠ ã€‚</p>
<ol>
<li>åœ¨ <code>Title</code> è¾“å…¥æ¡†å¡«å†™ <code>HEXO_DEPLOY_PUB</code>ã€‚</li>
<li>åœ¨ <code>Key</code> è¾“å…¥æ¡†å¡«å†™ <code>github-deploy-key.pub</code> æ–‡ä»¶å†…å®¹ã€‚<img src="https://user-images.githubusercontent.com/33454514/151518605-f89c8566-d231-4cdc-9cd7-ca6cad0eecd4.png" alt="image"></li>
<li>å‹¾é€‰ <code>Allow write access</code> é€‰é¡¹ã€‚<img src="https://user-images.githubusercontent.com/33454514/151518731-37a7c402-a78f-40b0-a25a-9f8d742fa053.png" alt="image"></li>
</ol>
<h1 id="ç¼–å†™-Github-Actions"><a href="#ç¼–å†™-Github-Actions" class="headerlink" title="ç¼–å†™ Github Actions"></a>ç¼–å†™ Github Actions</h1><h2 id="Workflow-æ¨¡ç‰ˆ"><a href="#Workflow-æ¨¡ç‰ˆ" class="headerlink" title="Workflow æ¨¡ç‰ˆ"></a>Workflow æ¨¡ç‰ˆ</h2><p>åœ¨ä»“åº“çš„ <code>blog</code> åˆ†æ”¯ä¸‹æ ¹ç›®å½•ä¸‹åˆ›å»º <code>.github/workflows/deploy.yml</code> æ–‡ä»¶ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">blog</span><br><span class="line">â””â”€ .github</span><br><span class="line">    â””â”€ workflows</span><br><span class="line">        â””â”€ deploy.yml</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>deploy.yml</code> æ–‡ä»¶ä¸­ç²˜è´´ä»¥ä¸‹å†…å®¹ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Hexo</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">GIT_USER:</span> <span class="string">yourname</span></span><br><span class="line">  <span class="attr">GIT_EMAIL:</span> <span class="string">yourname@example.com</span></span><br><span class="line">  <span class="attr">DEPLOY_REPO:</span> <span class="string">yourname/yourname.github.io</span></span><br><span class="line">  <span class="attr">DEPLOY_BRANCH:</span> <span class="string">main</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Build</span> <span class="string">on</span> <span class="string">node</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span> <span class="string">and</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.os</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">matrix:</span></span><br><span class="line">        <span class="attr">os:</span> [ <span class="string">ubuntu-latest</span> ]</span><br><span class="line">        <span class="attr">node_version:</span> [ <span class="number">12.</span><span class="string">x</span> ]</span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">deploy</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">repository:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.DEPLOY_REPO</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.DEPLOY_BRANCH</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">.deploy_git</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configuration</span> <span class="string">environment</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">HEXO_DEPLOY_PRI:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.HEXO_BUILD_PRI</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          sudo timedatectl set-timezone &quot;Asia/Shanghai&quot;</span></span><br><span class="line"><span class="string">          mkdir -p ~/.ssh/</span></span><br><span class="line"><span class="string">          echo &quot;$HEXO_DEPLOY_PRI&quot; &gt; ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          chmod 700 ~/.ssh</span></span><br><span class="line"><span class="string">          chmod 600 ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span></span><br><span class="line"><span class="string">          git config --global user.name $GIT_USER</span></span><br><span class="line"><span class="string">          git config --global user.email $GIT_EMAIL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          npm install hexo-cli -g</span></span><br><span class="line"><span class="string">          npm install</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">hexo</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          hexo clean</span></span><br><span class="line"><span class="string">          hexo deploy</span></span><br></pre></td></tr></table></figure>

<h2 id="æ¨¡ç‰ˆå‚æ•°è¯´æ˜"><a href="#æ¨¡ç‰ˆå‚æ•°è¯´æ˜" class="headerlink" title="æ¨¡ç‰ˆå‚æ•°è¯´æ˜"></a>æ¨¡ç‰ˆå‚æ•°è¯´æ˜</h2><ul>
<li><code>name</code>ä¸ºæ­¤ Action çš„åå­—</li>
<li><code>on</code>è§¦å‘æ¡ä»¶ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶ä¼šè§¦å‘æ­¤ä»»åŠ¡ï¼Œè¿™é‡Œçš„ <code>on.push.branches.blog</code> æ˜¯æŒ‡å½“ <code>blog</code> åˆ†æ”¯æ”¶åˆ° <code>push</code> åæ‰§è¡Œä»»åŠ¡ã€‚</li>
<li>envä¸ºç¯å¢ƒå˜é‡å¯¹è±¡<ul>
<li><code>env.GIT_USER</code> ä¸º Hexo ç¼–è¯‘åä½¿ç”¨æ­¤ git ç”¨æˆ·éƒ¨ç½²åˆ°ä»“åº“ã€‚</li>
<li><code>env.GIT_EMAIL</code> ä¸º Hexo ç¼–è¯‘åä½¿ç”¨æ­¤ git é‚®ç®±éƒ¨ç½²åˆ°ä»“åº“ã€‚</li>
<li><code>env.DEPLOY_REPO</code> ä¸º Hexo ç¼–è¯‘åè¦éƒ¨ç½²çš„ä»“åº“ï¼Œä¾‹å¦‚ï¼š<code>zhsama/zhsama.github.io</code>ã€‚</li>
<li><code>env.DEPLOY_BRANCH</code> ä¸º Hexo ç¼–è¯‘åè¦éƒ¨ç½²åˆ°çš„åˆ†æ”¯ï¼Œä¾‹å¦‚ï¼šmasterã€‚</li>
</ul>
</li>
<li>jobsä¸ºæ­¤ Action ä¸‹çš„ä»»åŠ¡åˆ—è¡¨<ul>
<li><code>jobs.&#123;job&#125;.name</code> ä»»åŠ¡åç§°</li>
<li><code>jobs.&#123;job&#125;.runs-on</code> ä»»åŠ¡æ‰€éœ€å®¹å™¨ï¼Œå¯é€‰å€¼ï¼š<code>ubuntu-latest</code>ã€<code>windows-latest</code>ã€<code>macos-latest</code>ã€‚</li>
<li><code>jobs.&#123;job&#125;.strategy</code> ç­–ç•¥ä¸‹å¯ä»¥å†™ <code>array</code> æ ¼å¼ï¼Œæ­¤ job ä¼šéå†æ­¤æ•°ç»„æ‰§è¡Œã€‚</li>
<li><code>jobs.&#123;job&#125;.steps</code>ä¸€ä¸ªæ­¥éª¤æ•°ç»„ï¼Œå¯ä»¥æŠŠæ‰€è¦å¹²çš„äº‹åˆ†æ­¥éª¤æ”¾åˆ°è¿™é‡Œã€‚<ul>
<li><code>jobs.&#123;job&#125;.steps.$.name</code> æ­¥éª¤åï¼Œç¼–è¯‘æ—¶ä¼šä¼šä»¥ LOG å½¢å¼è¾“å‡ºã€‚</li>
<li><code>jobs.&#123;job&#125;.steps.$.uses</code> æ‰€è¦è°ƒç”¨çš„ Actionï¼Œå¯ä»¥åˆ° <a href="https://github.com/actions">https://github.com/actions</a> æŸ¥çœ‹æ›´å¤šã€‚</li>
<li><code>jobs.&#123;job&#125;.steps.$.with</code> ä¸€ä¸ªå¯¹è±¡ï¼Œè°ƒç”¨ Action ä¼ çš„å‚æ•°ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹æ‰€ä½¿ç”¨ Action çš„è¯´æ˜ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><p>æœ€ç»ˆç›®å½•ç»“æ„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">blog</span><br><span class="line">â””â”€ .github</span><br><span class="line">    â””â”€ workflows</span><br><span class="line">        â””â”€ deploy.yml</span><br></pre></td></tr></table></figure>

<p>æŠŠ <code>deploy.yml</code> æ–‡ä»¶æ¨é€åˆ° <code>blog</code> åˆ†æ”¯ï¼Œåœ¨æ­¤ä»“åº“ <code>Actions</code> é¡µé¢å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåå­—ä¸º <code>HEXO</code> çš„ Actionã€‚</p>
<h2 id="æ‰§è¡Œä»»åŠ¡"><a href="#æ‰§è¡Œä»»åŠ¡" class="headerlink" title="æ‰§è¡Œä»»åŠ¡"></a>æ‰§è¡Œä»»åŠ¡</h2><p>å†™ä¸€ç¯‡æ–‡ç« ï¼Œ<code>push</code> åˆ°ä»“åº“çš„ <code>blog</code> åˆ†æ”¯ï¼Œåœ¨æ­¤ä»“åº“ <code>Actions</code> é¡µé¢æŸ¥çœ‹å½“å‰çš„taskã€‚</p>
<p><img src="https://user-images.githubusercontent.com/33454514/151520844-e97f8697-3501-4edf-9d05-56271db059ef.png" alt="image"></p>
<p>å½“ä»»åŠ¡å®ŒæˆåæŸ¥çœ‹æ‚¨çš„åšå®¢ <code>https://your.github.io</code>ï¼Œå¦‚æœä¸å‡ºæ„å¤–çš„è¯å·²ç»å¯ä»¥çœ‹åˆ°æ–°æ·»åŠ çš„æ–‡ç« äº†ã€‚</p>
<h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>å·æ‡’æ˜¯äººç±»å‘å±•çš„æœ€å¤§åŠ¨åŠ›ï¼ï¼ï¼è¿˜æ˜¯å¾®è½¯çˆ¸çˆ¸æœ‰é’±ï¼ŒActionså…è´¹ç”¨ï¼Œè¿™æ ·æˆ‘çš„å®ˆæœ›å…ˆé”‹2æ˜¯ä¸æ˜¯æœªæ¥å¯æœŸäº†å•Šï¼ŸğŸ¤¤ğŸ¤¤ğŸ¤¤</p>
]]></content>
      <categories>
        <category>CI</category>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>CI</tag>
        <tag>Github Actions</tag>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸è§ HTTP çŠ¶æ€ç </title>
    <url>/2022/03/16/%E5%B8%B8%E8%A7%81HTTP%E7%8A%B6%E6%80%81%E7%A0%81/</url>
    <content><![CDATA[<h1 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h1><p>çŠ¶æ€ç ï¼ˆStatus Codeï¼‰å’ŒåŸå› çŸ­è¯­ï¼ˆReason Phraseï¼‰ç”¨äº<strong>æè¿°è¯·æ±‚çš„ç»“æœ</strong>ã€‚å¸¸è§çš„æ¯”å¦‚ï¼š</p>
<ul>
<li>200 OKï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼›</li>
<li>404 Not Foundè¡¨ç¤ºè¯·æ±‚çš„èµ„æºæœªæ‰¾åˆ°ã€‚</li>
</ul>
<p>åŸå› çŸ­è¯­ï¼ˆä¸Šé¢çš„ok å’ŒNot Foundï¼‰æ˜¯å¯¹çŠ¶æ€ç çš„è§£é‡Šè¯´æ˜ã€‚</p>
<p>å½¢å¦‚<code>200</code>è¿™æ ·çš„çŠ¶æ€ç ï¼Œè¿™é‡Œçš„ç¬¬1ä½æ•°å­—ï¼Œé€šå¸¸è¡¨ç¤ºå“åº”çš„ç±»åˆ«ï¼Œå¤§è‡´å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š</p>
<table>
<thead>
<tr>
<th>çŠ¶æ€ç </th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>1xx</td>
<td align="left">è¯·æ±‚æ­£è¢«å¤„ç†</td>
</tr>
<tr>
<td>2xx</td>
<td align="left">è¯·æ±‚æˆåŠŸå¤„ç†</td>
</tr>
<tr>
<td>3xx</td>
<td align="left">è¯·æ±‚éœ€è¦é™„åŠ æ“ä½œï¼Œå¸¸è§çš„ä¾‹å­å¦‚é‡å®šå‘</td>
</tr>
<tr>
<td>4xx</td>
<td align="left">å®¢æˆ·ç«¯å‡ºé”™å¯¼è‡´è¯·æ±‚æ— æ³•è¢«å¤„ç†</td>
</tr>
<tr>
<td>5xx</td>
<td align="left">æœåŠ¡ç«¯å¤„ç†å‡ºé”™</td>
</tr>
</tbody></table>
<span id="more"></span>
<h1 id="2xx"><a href="#2xx" class="headerlink" title="2xx"></a>2xx</h1><h2 id="200-OK"><a href="#200-OK" class="headerlink" title="200 OK"></a>200 OK</h2><p>è¡¨ç¤ºè¯·æ±‚å·²ç»è¢«æ­£å¸¸å¤„ç†ï¼Œè¿™ä¸ªæ¯”è¾ƒå¸¸è§ï¼Œå°±ä¸åœ¨è¿™èµ˜è¿°äº†ã€‚</p>
<h2 id="204-NO-Content"><a href="#204-NO-Content" class="headerlink" title="204 NO Content"></a>204 NO Content</h2><blockquote>
<p>è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼Œä½†æ˜¯å“åº”çš„æŠ¥æ–‡ä¸­ä¸å«å®ä½“ä¸»ä½“ã€‚é€šå¸¸ç”¨äºåªéœ€è¦å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦æ¥å—æ–°ä¿¡æ¯çš„æƒ…å†µä½¿ç”¨</p>
</blockquote>
<p>è¯´è¯äººå°±æ˜¯ï¼šæœ‰ä¸€ç§å¸¸è§çš„ç§è¯·æ±‚ç±»å‹<code>options</code>ï¼Œé€šå¸¸è¢«ç”¨æ¥åšæ­£å¼è¯·æ±‚çš„é¢„è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚<strong>åªéœ€è¦ç¡®è®¤åç»­çš„è¯·æ±‚èƒ½ä¸èƒ½é€šè¿‡ï¼Œå³åªéœ€è¦ä¸€ä¸ªç»“æœï¼Œè€Œä¸éœ€è¦è¿”å›å…¶ä»–å†…å®¹</strong>ï¼Œè¿™ç±»è¯·æ±‚æˆåŠŸæ—¶å°±ä¼šè¿”å›204ã€‚</p>
<h2 id="206-Partial-Content"><a href="#206-Partial-Content" class="headerlink" title="206 Partial Content"></a>206 Partial Content</h2><p>å­—é¢æ„æ€ï¼šå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨æˆåŠŸæ‰§è¡Œäº†è¿™éƒ¨åˆ†è¯·æ±‚ã€‚è¿™ç§æƒ…å†µå¿…é¡»æåˆ°æåˆ°ä¸€ä¸ªè¯·æ±‚å¤´<code>Range</code>ï¼šåœ¨ http çš„è¯·æ±‚ä¸­ï¼Œè¿™ä¸ªå¤´éƒ¨ç”¨æ¥è¡¨ç¤º<strong>èŒƒå›´è¯·æ±‚</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;Range&#x27;</span>:byte=<span class="number">5001</span>-<span class="number">10000</span> <span class="regexp">//</span> è¡¨ç¤ºæœ¬æ¬¡è¦è¯·æ±‚èµ„æºçš„<span class="number">5001</span>-<span class="number">10000</span>å­—èŠ‚çš„éƒ¨åˆ†</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæœåŠ¡å™¨æ¥å—èŒƒå›´è¯·æ±‚å¹¶ä¸”æˆåŠŸå¤„ç†ï¼Œå°±ä¼šè¿”å›<code>206</code>,å¹¶ä¸”åœ¨å“åº”çš„å¤´éƒ¨è¿”å›ï¼š</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;Content-Range&#x27;</span>:<span class="built_in">bytes</span> <span class="number">5001</span><span class="number">-10000</span>/<span class="number">10000</span> <span class="comment">// è¡¨ç¤ºæ•´ä¸ªèµ„æºæœ‰10000å­—èŠ‚ï¼Œæœ¬æ¬¡è¿”å›çš„èŒƒå›´ä¸º 5001-10000å­—èŠ‚</span></span><br></pre></td></tr></table></figure>

<h1 id="3xx"><a href="#3xx" class="headerlink" title="3xx"></a>3xx</h1><h2 id="301-Moved-Permanently"><a href="#301-Moved-Permanently" class="headerlink" title="301 Moved Permanently"></a>301 Moved Permanently</h2><p>å­—é¢æ„æ€ï¼šèµ„æºè¢«<strong>æ°¸ä¹…</strong>é‡å®šå‘äº†ã€‚è¿™ç§æƒ…å†µä¸‹å“åº”çš„å¤´éƒ¨å­—æ®µ<code>Location</code>ä¸­ä¸€èˆ¬è¿˜ä¼šè¿”å›ä¸€ä¸ªåœ°å€ï¼Œç”¨æ¥è¡¨ç¤ºè¦æ–°åœ°å€ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="number">301</span> Moved Permanently </span><br><span class="line"><span class="params">...</span></span><br><span class="line">Location:<span class="string">&#x27;b.com&#x27;</span></span><br><span class="line"><span class="params">...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…è½¬ç§»ï¼Œéœ€å¯¹æ–°åœ°å€ b.com è®¿é—®ï¼Œä»¥åçš„è¯·æ±‚ç›´æ¥è®¿é—®æ–°åœ°å€</span></span><br></pre></td></tr></table></figure>

<h2 id="302-Found"><a href="#302-Found" class="headerlink" title="302 Found"></a>302 Found</h2><p>å­—é¢æ„æ€ï¼šèµ„æº<strong>ä¸´æ—¶</strong>é‡å®šå‘äº†ã€‚è¿˜æ˜¯ä¸¾ä¸Šé¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="number">302</span> Found</span><br><span class="line"><span class="params">...</span></span><br><span class="line">Location: <span class="string">&#x27;b.com&#x27;</span></span><br><span class="line"><span class="params">...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸Šè¿°å†…å®¹è¡¨ç¤ºï¼šå®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºè¢«ä¸´æ—¶è½¬ç§»ï¼Œåé¢ä¹Ÿæœ‰å¯èƒ½å†æ¬¡è½¬ç§»ï¼Œæœ¬æ¬¡è¯·æ±‚è®¿é—®æ–°åœ°å€ b.comï¼Œä»¥åçš„è¯·æ±‚è¿˜æ˜¯å…ˆè®¿é—®åŸæ¥åœ°å€ã€‚</span></span><br></pre></td></tr></table></figure>

<h2 id="303-See-Other"><a href="#303-See-Other" class="headerlink" title="303 See Other"></a>303 See Other</h2><p>è¿™ä¸ªå’Œ302å¾ˆåƒï¼Œä½†æ˜¯æœ‰ä¸ªç»†å¾®åŒºåˆ«æ˜¯ï¼Œé™¤äº†ä¼šæç¤ºå®¢æˆ·ç«¯å»è¯·æ±‚<code>Location</code>ä»¥å¤–ï¼Œè¿˜ä¼šè¦æ±‚è¯·æ±‚è¦ä½¿ç”¨<code>Location</code>æ—¶ä½¿ç”¨<code>GET</code>æ–¹æ³•ã€‚ åœ¨è¿™è¡¥å……ä¸€ä¸‹ä¸€ä¸ªå†å²èƒŒæ™¯ï¼š</p>
<blockquote>
<p>è¯·æ±‚è¿”å›301 302 303 æ—¶ï¼Œå‡ ä¹æ‰€æœ‰æµè§ˆå™¨éƒ½ä¼šæŠŠåŸå…ˆçš„POSTè¯·æ±‚æ”¹ä¸ºGETè¯·æ±‚ã€‚è™½ç„¶FRC1945å’ŒRFC2068è§„èŒƒä¸­æœ‰è§„å®šï¼šä¸å…è®¸å®¢æˆ·ç«¯åœ¨é‡å®šå‘æ—¶ä¿®æ”¹æ–¹æ³•ã€‚</p>
</blockquote>
<p>ç®€å•çš„è¯´ï¼Œå®é™…çš„æµè§ˆå™¨åœ¨å¤„ç†301å’Œ302æ—¶ï¼Œé»˜è®¤å°±ä¼šæŠŠåŸå…ˆçš„POSTè¯·æ±‚æ”¹ä¸ºGETè¯·æ±‚ï¼Œæ‰€ä»¥å®é™…ä¸Šä½¿ç”¨303çš„æ„ä¹‰ï¼Œå•çº¯åªæ˜¯è®©è¯­ä¹‰åŒ–æ›´æ¸…æ™°ç‚¹ã€‚ï¼ˆ303è¡¨ç¤ºæœåŠ¡å™¨<strong>æ˜ç¡®å‘Šè¯‰</strong>å®¢æˆ·ç«¯ï¼Œä½ è¦ä½¿ç”¨<code>GET</code>æ–¹æ³•è®¿é—®<code>location</code>ã€‚å¦‚æœæ˜¯302ï¼Œå°±æ˜¯ä»…ä»…å‘Šè¯‰å®¢æˆ·ç«¯è¦è®¿é—®<code>location</code>ï¼Œä¸é™åˆ¶æ–¹æ³•ï¼Œä½†æ˜¯å®é™…ä¸Šå®¢æˆ·ç«¯è‡ªå·±ä¹Ÿä¼šç”¨<code>GET</code>æ–¹æ³•è®¿é—®ã€‚ï¼‰</p>
<blockquote>
<p>æ³¨æ„ï¼šå½“301ï¼Œ302ï¼Œ303å“åº”çŠ¶æ€ç è¿”å›æ—¶ï¼Œå‡ ä¹æ‰€æœ‰çš„æµè§ˆå™¨ä¼šæŠŠPOSTæ”¹æˆGETï¼Œå¹¶åˆ é™¤è¯·æ±‚æŠ¥æ–‡å†…çš„ä¸»ä½“ï¼Œä¹‹åè¯·æ±‚ä¼šè‡ªåŠ¨å†æ¬¡å‘é€</p>
</blockquote>
<h2 id="304-Not-Modified"><a href="#304-Not-Modified" class="headerlink" title="304 Not Modified"></a>304 Not Modified</h2><p> æœåŠ¡å™¨ç«¯èµ„æºæœªæ”¹å˜ï¼Œå¯ç›´æ¥ä½¿ç”¨å®¢æˆ·ç«¯æœªè¿‡æœŸçš„ç¼“å­˜ï¼Œä¸åŒ…å«ä»»ä½•å“åº”çš„ä¸»ä½“éƒ¨åˆ†ã€‚304æ˜¯3xxé‡Œé¢çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå› ä¸ºå®ƒä¸ç®—æ˜¯ä¸€ä¸ªé‡å®šå‘ã€‚</p>
<p>è¿™ç§å“åº”ä¸€èˆ¬æ˜¯<code>GET</code>è¯·æ±‚ä¸­å¸¦æœ‰<strong>é™„åŠ æ¡ä»¶</strong>ï¼Œä¾‹å¦‚è¯·æ±‚å¤´ä¸­å«æœ‰<code>if-Match</code>ï¼Œ<code>if-Modified-Since</code>ç­‰ã€‚</p>
<p><code>if-Match</code>è¡¨ç¤ºåªè¯·æ±‚å¸¦æœ‰ç‰¹æ®Šæ ‡è®°çš„èµ„æºï¼Œ<code>if-Modified-Since</code>è¡¨ç¤ºè¯·æ±‚æŒ‡å®šæ—¶é—´åæœªå˜æ›´çš„èµ„æºã€‚</p>
<h1 id="4xx"><a href="#4xx" class="headerlink" title="4xx"></a>4xx</h1><p>4xxè¡¨ç¤ºä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯å‘ç”Ÿäº†é”™è¯¯ã€‚</p>
<h2 id="400-Bad-Request"><a href="#400-Bad-Request" class="headerlink" title="400 Bad Request"></a>400 Bad Request</h2><p>400çš„å«ä¹‰ç®€å•ç²—æš´ï¼šè¯·æ±‚ä¸­æœ‰è¯­æ³•é”™è¯¯ã€‚é‚£å…·ä½“æ˜¯ä»€ä¹ˆè¯­æ³•é”™è¯¯å‘¢?ä¸€èˆ¬æ¥è¯´å“åº”æŠ¥æ–‡é‡Œä¼šæœ‰ä¸€äº›æç¤ºï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>å¤šåŠ äº†è¯·æ±‚å¤´</li>
<li>è¯·æ±‚åœ°å€é”™è¯¯å¯¼ï¼Œè¯¥ uri ä¸å­˜åœ¨</li>
<li>è¯·æ±‚æ–¹æ³•é”™è¯¯ï¼Œè¯¥ uri ä¹‹åªèƒ½ç”¨ put è€Œä¸æ˜¯ post</li>
<li>â€¦</li>
</ul>
<h2 id="401-Unauthorized"><a href="#401-Unauthorized" class="headerlink" title="401 Unauthorized"></a>401 Unauthorized</h2><p>å­—é¢æ„æ€ï¼šæœªç»è¿‡è®¤è¯ã€‚ä¸€èˆ¬åœ¨åå°ç³»ç»Ÿä¹‹ç±»çš„åº”ç”¨é‡Œï¼Œç”¨æˆ·ç™»å½•ä¹‹åä¼šè·å¾—ä¸€ä¸ªèº«ä»½è®¤è¯ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆ<code>mac</code>ä¹‹ç±»çš„ä¿¡æ¯ï¼Œæ”¾åœ¨è¯·æ±‚å¤´çš„<code>Authorization</code>å­—æ®µé‡Œï¼Œå‘é€ç»™æœåŠ¡ç«¯ï¼Œå¦‚æœè¿™ä¸ªè®¤è¯ä¿¡æ¯æœ‰é—®é¢˜æˆ–è€…æ ¹æœ¬æ²¡å‘é€ï¼Œå°±ä¼šå‡ºç°è¿™ä¸ªçŠ¶æ€ç ã€‚</p>
<h2 id="403-Forbidden"><a href="#403-Forbidden" class="headerlink" title="403 Forbidden"></a>403 Forbidden</h2><p>è¿™ä¸ªå°±ç®€å•äº†ï¼šç¦æ­¢è®¿é—®ä¹Ÿå°±æ˜¯æ— æƒé™è®¿é—®ã€‚ç¦æ­¢åŸå› ä¸€èˆ¬ç”±æœåŠ¡å™¨åœ¨å“åº”å†…ä¸­ç»™å‡ºã€‚</p>
<h2 id="404-Not-Find"><a href="#404-Not-Find" class="headerlink" title="404 Not Find"></a>404 Not Find</h2><p>è¿™ä¸ªé”™è¯¯å¯ä»¥è¯´æ˜¯å¾ˆå¸¸è§äº†ï¼Œè¡¨ç¤ºæœåŠ¡ç«¯æ²¡æœ‰æ‰¾åˆ°æ‰€è¯·æ±‚çš„èµ„æºã€‚ï¼ˆç»éªŒè¡¨æ˜ï¼Œä¸€èˆ¬è¿™ä¸ªé”™è¯¯æ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚urlå†™é”™äº†ã€‚ï¼‰</p>
<h1 id="499-Client-Has-Closed-Connection"><a href="#499-Client-Has-Closed-Connection" class="headerlink" title="499 Client Has Closed Connection"></a>499 Client Has Closed Connection</h1><p>æœåŠ¡å™¨ç«¯å¤„ç†çš„æ—¶é—´è¿‡é•¿ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€é“¾æ¥ï¼Œnginxå®šä¹‰çš„çŠ¶æ€ç ã€‚</p>
<h1 id="5xx"><a href="#5xx" class="headerlink" title="5xx"></a>5xx</h1><p>5xxè¡¨æ˜æœåŠ¡ç«¯å‘ç”Ÿäº†é”™è¯¯ã€‚</p>
<h2 id="500-Internal-Server-Error"><a href="#500-Internal-Server-Error" class="headerlink" title="500 Internal Server Error"></a>500 Internal Server Error</h2><p>ç®€å•ç²—æš´ï¼ŒæœåŠ¡å™¨æ•…éšœäº†ã€‚å•¥ï¼Ÿä½ é—®æˆ‘ä»€ä¹ˆæ•…éšœï¼Ÿæˆ‘å“ªçŸ¥é“ï¼Œæˆ‘åªä¼šç†Ÿç»ƒåœ°æŠŠbugè½¬ç»™éš”å£çš„æœåŠ¡ç«¯åŒå­¦ã€‚</p>
<h2 id="502-Bad-Gateway"><a href="#502-Bad-Gateway" class="headerlink" title="502 Bad Gateway"></a>502 Bad Gateway</h2><p>ä½œä¸º<strong>ç½‘å…³</strong>æˆ–è€…<strong>ä»£ç†</strong>å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶åˆ°æ— æ•ˆçš„å“åº”ã€‚è¿™é‡Œè¯´æ˜ä¸‹ç½‘å…³å’Œä»£ç†æœåŠ¡å™¨çš„æ¦‚å¿µï¼šå‰é¢æˆ‘ä»¬ä¸¾ä¾‹å­éƒ½æ˜¯ç›´æ¥å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘è¯·æ±‚ï¼Œå®é™…ä¸Šå®¢æˆ·ç«¯æœ‰æ—¶å€™ä¸æ˜¯ç›´æ¥å‘æœåŠ¡å™¨è¯·æ±‚ï¼Œè¿™ä¸­é—´å¯èƒ½å­˜åœ¨ç½‘å…³å’Œä»£ç†ï¼š</p>
<ul>
<li><strong>ä»£ç†</strong>è¿æ¥çš„æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªä½¿ç”¨ç›¸åŒåè®®çš„åº”ç”¨ç¨‹åºã€‚</li>
<li><strong>ç½‘å…³</strong>è¿æ¥çš„æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªä½¿ç”¨ä¸åŒåè®®çš„ç«¯ç‚¹ï¼Œæ‰®æ¼”â€œåè®®è½¬æ¢å™¨â€çš„è§’è‰²ã€‚</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/33454514/157812931-33161215-7936-431d-a6c0-215718fa6044.png" alt="image"></p>
<h2 id="503-Service-Unavailable"><a href="#503-Service-Unavailable" class="headerlink" title="503 Service Unavailable"></a>503 Service Unavailable</h2><p>æœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè·æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚</p>
<h2 id="504-Gateway-Timeout"><a href="#504-Gateway-Timeout" class="headerlink" title="504 Gateway Timeout"></a>504 Gateway Timeout</h2><p>ä½œä¸º<strong>ç½‘å…³</strong>æˆ–è€…<strong>ä»£ç†</strong>å·¥ä½œçš„æœåŠ¡å™¨è®¿é—®è¶…æ—¶ã€‚</p>
]]></content>
      <categories>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆ XSS å’Œ CRFS æ”»å‡»</title>
    <url>/2022/03/30/%E6%B5%85%E8%B0%88%20XSS%20%E5%92%8C%20CRFS%20%E6%94%BB%E5%87%BB/</url>
    <content><![CDATA[<p>éšç€äº’è”ç½‘çš„é«˜é€Ÿå‘å±•ï¼Œä¿¡æ¯å®‰å…¨é—®é¢˜å·²ç»æˆä¸ºä¼ä¸šæœ€ä¸ºå…³æ³¨çš„ç„¦ç‚¹ä¹‹ä¸€ï¼Œè€Œå‰ç«¯åˆæ˜¯å¼•å‘ä¼ä¸šå®‰å…¨é—®é¢˜çš„é«˜å±æ®ç‚¹ã€‚åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼Œå‰ç«¯äººå‘˜é™¤äº†ä¼ ç»Ÿçš„ XSSã€CSRF ç­‰å®‰å…¨é—®é¢˜ä¹‹å¤–ï¼Œåˆæ—¶å¸¸é­é‡ç½‘ç»œåŠ«æŒã€éæ³•è°ƒç”¨ Hybrid API ç­‰æ–°å‹å®‰å…¨é—®é¢˜ã€‚å½“ç„¶ï¼Œæµè§ˆå™¨è‡ªèº«ä¹Ÿåœ¨ä¸æ–­åœ¨è¿›åŒ–å’Œå‘å±•ï¼Œä¸æ–­å¼•å…¥ CSPã€Same-Site Cookies ç­‰æ–°æŠ€æœ¯æ¥å¢å¼ºå®‰å…¨æ€§ï¼Œä½†æ˜¯ä»å­˜åœ¨å¾ˆå¤šæ½œåœ¨çš„å¨èƒï¼Œè¿™éœ€è¦å‰ç«¯æŠ€æœ¯äººå‘˜ä¸æ–­è¿›è¡Œâ€œæŸ¥æ¼è¡¥ç¼ºâ€ã€‚</p>
<span id="more"></span>

<h1 id="ä»€ä¹ˆæ˜¯-XSS-æ”»å‡»"><a href="#ä»€ä¹ˆæ˜¯-XSS-æ”»å‡»" class="headerlink" title="ä»€ä¹ˆæ˜¯ XSS æ”»å‡»"></a>ä»€ä¹ˆæ˜¯ XSS æ”»å‡»</h1><p><code>XSS</code> å…¨ç§°æ˜¯ <code>Cross Site Scripting</code>ï¼ˆå³<code>è·¨ç«™è„šæœ¬</code>ï¼‰ï¼Œä¸ºäº†å’Œ CSS åŒºåˆ†ï¼Œæ•…å«å®ƒ<code>XSS</code>ã€‚XSS æ”»å‡»æ˜¯æŒ‡æµè§ˆå™¨ä¸­æ‰§è¡Œæ¶æ„è„šæœ¬ï¼ˆæ— è®ºæ˜¯è·¨åŸŸè¿˜æ˜¯åŒåŸŸï¼‰ï¼Œä»è€Œæ‹¿åˆ°ç”¨æˆ·çš„ä¿¡æ¯å¹¶è¿›è¡Œæ“ä½œã€‚</p>
<p>è¿™äº›æ“ä½œä¸€èˆ¬å¯ä»¥å®Œæˆä¸‹é¢è¿™äº›äº‹æƒ…:</p>
<ol>
<li>çªƒå–<code>Cookie</code>ã€‚</li>
<li>ç›‘å¬ç”¨æˆ·è¡Œä¸ºï¼Œæ¯”å¦‚è¾“å…¥è´¦å·å¯†ç åç›´æ¥å‘é€åˆ°é»‘å®¢æœåŠ¡å™¨ã€‚</li>
<li>ä¿®æ”¹ DOM ä¼ªé€ ç™»å½•è¡¨å•ã€‚</li>
<li>åœ¨é¡µé¢ä¸­ç”Ÿæˆæµ®çª—å¹¿å‘Šã€‚</li>
</ol>
<h1 id="XSS-æ”»å‡»ç±»å‹"><a href="#XSS-æ”»å‡»ç±»å‹" class="headerlink" title="XSS æ”»å‡»ç±»å‹"></a>XSS æ”»å‡»ç±»å‹</h1><p>é€šå¸¸æƒ…å†µï¼ŒXSS æ”»å‡»çš„å®ç°æœ‰ä¸‰ç§æ–¹å¼â€”â€”<strong>å­˜å‚¨å‹</strong>ã€<strong>åå°„å‹</strong>å’Œ<strong>æ–‡æ¡£å‹</strong>ã€‚åŸç†éƒ½æ¯”è¾ƒç®€å•ï¼Œå…ˆæ¥ä¸€ä¸€ä»‹ç»ä¸€ä¸‹ã€‚</p>
<h2 id="å­˜å‚¨å‹"><a href="#å­˜å‚¨å‹" class="headerlink" title="å­˜å‚¨å‹"></a>å­˜å‚¨å‹</h2><p>å­˜å‚¨å‹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å­˜å‚¨æ¶æ„è„šæœ¬ï¼Œå®é™…åº”ç”¨ä¸­é€šå¸¸æ˜¯å°†æ¶æ„è„šæœ¬å­˜å‚¨åˆ°æœåŠ¡ç«¯çš„æ•°æ®åº“ï¼Œåœ¨å®¢æˆ·è¯·æ±‚æ—¶è¿”å›æ¶æ„è„šæœ¬å¹¶æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ”»å‡»çš„æ•ˆæœã€‚</p>
<p>å¸¸è§çš„åœºæ™¯æ˜¯åœ¨ç•™è¨€è¯„è®ºåŒºæäº¤ä¸€æ®µè„šæœ¬ä»£ç ï¼Œå¦‚æœå‰åç«¯æ²¡æœ‰åšå¥½è½¬ä¹‰çš„å·¥ä½œï¼Œè¯„è®ºå†…å®¹å°±å°†è¢«å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œå¹¶åœ¨é¡µé¢æ¸²æŸ“è¿‡ç¨‹ä¸­ç›´æ¥æ‰§è¡Œï¼Œç›¸å½“äºæ‰§è¡Œä¸€æ®µæœªçŸ¥é€»è¾‘çš„ JS ä»£ç ã€‚</p>
<h2 id="åå°„å‹"><a href="#åå°„å‹" class="headerlink" title="åå°„å‹"></a>åå°„å‹</h2><p><code>åå°„å‹XSS</code>æŒ‡çš„æ˜¯æ¶æ„è„šæœ¬ä½œä¸º<strong>ç½‘ç»œè¯·æ±‚çš„ä¸€éƒ¨åˆ†</strong>ã€‚</p>
<p>æ¯”å¦‚è¾“å…¥ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">http://sanyuan.com?q=&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œåœ¨æœåŠ¡å™¨ç«¯ä¼šæ‹¿åˆ°<code>q</code>å‚æ•°,ç„¶åå°†å†…å®¹è¿”å›ç»™æµè§ˆå™¨ç«¯ï¼Œæµè§ˆå™¨å°†è¿™äº›å†…å®¹ä½œä¸ºHTMLçš„ä¸€éƒ¨åˆ†è§£æï¼Œå‘ç°æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œç›´æ¥æ‰§è¡Œï¼Œè¿™æ ·å°±è¢«æ”»å‡»äº†ã€‚</p>
<p>ä¹‹æ‰€ä»¥å«å®ƒ<code>åå°„å‹</code>, æ˜¯å› ä¸ºæ¶æ„è„šæœ¬æ˜¯é€šè¿‡ä½œä¸ºç½‘ç»œè¯·æ±‚çš„å‚æ•°ï¼Œç»è¿‡æœåŠ¡å™¨ï¼Œç„¶åå†åå°„åˆ°HTMLæ–‡æ¡£ä¸­ï¼Œæ‰§è¡Œè§£æã€‚å’Œ<code>å­˜å‚¨å‹</code>ä¸ä¸€æ ·çš„æ˜¯ï¼ŒæœåŠ¡å™¨å¹¶ä¸ä¼šå­˜å‚¨è¿™äº›æ¶æ„è„šæœ¬ã€‚</p>
<h2 id="æ–‡æ¡£ï¼ˆDOMï¼‰å‹"><a href="#æ–‡æ¡£ï¼ˆDOMï¼‰å‹" class="headerlink" title="æ–‡æ¡£ï¼ˆDOMï¼‰å‹"></a>æ–‡æ¡£ï¼ˆDOMï¼‰å‹</h2><p>æ–‡æ¡£å‹çš„ XSS æ”»å‡»å¹¶ä¸ä¼šç»è¿‡æœåŠ¡ç«¯ï¼Œè€Œæ˜¯ä½œä¸ºä¸­é—´äººçš„è§’è‰²ï¼Œåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹åŠ«æŒåˆ°ç½‘ç»œæ•°æ®åŒ…ï¼Œç„¶åä¿®æ”¹å“åº”ä¸­çš„ html æ–‡æ¡£ã€‚</p>
<p>è¿™æ ·çš„åŠ«æŒæ–¹å¼åŒ…æ‹¬<code>WIFIè·¯ç”±å™¨åŠ«æŒ</code>æˆ–è€…<code>æœ¬åœ°æ¶æ„è½¯ä»¶</code>ç­‰ã€‚</p>
<h1 id="é˜²èŒƒæªæ–½"><a href="#é˜²èŒƒæªæ–½" class="headerlink" title="é˜²èŒƒæªæ–½"></a>é˜²èŒƒæªæ–½</h1><p>æ˜ç™½äº†ä¸‰ç§<code>XSS</code>æ”»å‡»çš„åŸç†ï¼Œæˆ‘ä»¬èƒ½å‘ç°ä¸€ä¸ªå…±åŒç‚¹ï¼šæ¶æ„è„šæœ¬ç›´æ¥èƒ½åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œã€‚é‚£ä¹ˆè¦é˜²èŒƒå®ƒï¼Œå°±æ˜¯è¦é¿å…è¿™äº›è„šæœ¬ä»£ç çš„æ‰§è¡Œã€‚</p>
<h2 id="è¿‡æ»¤ç”¨æˆ·çš„è¾“å…¥ä¿¡æ¯"><a href="#è¿‡æ»¤ç”¨æˆ·çš„è¾“å…¥ä¿¡æ¯" class="headerlink" title="è¿‡æ»¤ç”¨æˆ·çš„è¾“å…¥ä¿¡æ¯"></a>è¿‡æ»¤ç”¨æˆ·çš„è¾“å…¥ä¿¡æ¯</h2><p>åƒä¸‡ä¸è¦ç›¸ä¿¡ä»»ä½•ç”¨æˆ·çš„è¾“å…¥ï¼æ— è®ºæ˜¯åœ¨å‰ç«¯å’ŒæœåŠ¡ç«¯ï¼Œéƒ½è¦å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œ<strong>è½¬ç </strong>æˆ–è€…<strong>è¿‡æ»¤</strong>ã€‚</p>
<p>å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="string">&#x27;xss&#x27;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>è½¬ç åå˜ä¸º:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&amp;lt;script&amp;gt;<span class="title function_">alert</span>(&amp;#<span class="number">39</span>;xss&amp;#<span class="number">39</span>;)&amp;lt;/script&amp;gt;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„ä»£ç åœ¨ html è§£æçš„è¿‡ç¨‹ä¸­æ˜¯æ— æ³•æ‰§è¡Œçš„ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨å…³é”®è¯è¿‡æ»¤çš„æ–¹å¼ï¼Œå°† script æ ‡ç­¾ç»™åˆ é™¤ã€‚</p>
<h2 id="åˆ©ç”¨-CSP"><a href="#åˆ©ç”¨-CSP" class="headerlink" title="åˆ©ç”¨ CSP"></a>åˆ©ç”¨ CSP</h2><p>CSPï¼Œå³æµè§ˆå™¨ä¸­çš„å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯æœåŠ¡å™¨å†³å®šæµè§ˆå™¨åŠ è½½å“ªäº›èµ„æºï¼Œå…·ä½“æ¥è¯´å¯ä»¥å®Œæˆä»¥ä¸‹åŠŸèƒ½:</p>
<ol>
<li>é™åˆ¶å…¶ä»–åŸŸä¸‹çš„èµ„æºåŠ è½½ã€‚</li>
<li>ç¦æ­¢å‘å…¶å®ƒåŸŸæäº¤æ•°æ®ã€‚</li>
<li>æä¾›ä¸ŠæŠ¥æœºåˆ¶ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬åŠæ—¶å‘ç° XSS æ”»å‡»ã€‚</li>
</ol>
<h2 id="åˆ©ç”¨-HttpOnly"><a href="#åˆ©ç”¨-HttpOnly" class="headerlink" title="åˆ©ç”¨ HttpOnly"></a>åˆ©ç”¨ HttpOnly</h2><p>å¾ˆå¤š XSS æ”»å‡»è„šæœ¬éƒ½æ˜¯ç”¨æ¥çªƒå–Cookie, è€Œè®¾ç½® Cookie çš„ HttpOnly å±æ€§åï¼ŒJavaScript ä¾¿æ— æ³•è¯»å– Cookie çš„å€¼ã€‚è¿™æ ·ä¹Ÿèƒ½å¾ˆå¥½çš„é˜²èŒƒ XSS æ”»å‡»ã€‚</p>
<h1 id="ä»€ä¹ˆæ˜¯-CSRF-æ”»å‡»"><a href="#ä»€ä¹ˆæ˜¯-CSRF-æ”»å‡»" class="headerlink" title="ä»€ä¹ˆæ˜¯ CSRF æ”»å‡»"></a>ä»€ä¹ˆæ˜¯ CSRF æ”»å‡»</h1><p>CSRFï¼ˆCross-site request forgeryï¼‰ï¼Œå³è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šæ”»å‡»è€…è¯±å¯¼å—å®³è€…è¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œå‘è¢«æ”»å‡»ç½‘ç«™å‘é€è·¨ç«™è¯·æ±‚ã€‚åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç»è·å–çš„æ³¨å†Œå‡­è¯ï¼Œç»•è¿‡åå°çš„ç”¨æˆ·éªŒè¯ï¼Œè¾¾åˆ°å†’å……ç”¨æˆ·å¯¹è¢«æ”»å‡»çš„ç½‘ç«™æ‰§è¡ŒæŸé¡¹æ“ä½œçš„ç›®çš„ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„CSRFæ”»å‡»æœ‰ç€å¦‚ä¸‹çš„æµç¨‹ï¼š</p>
<ul>
<li>å—å®³è€…ç™»å½•a.comï¼Œå¹¶ä¿ç•™äº†ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ã€‚</li>
<li>æ”»å‡»è€…å¼•è¯±å—å®³è€…è®¿é—®äº†b.comã€‚</li>
<li>b.com å‘ a.com å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼ša.com/act=xxã€‚æµè§ˆå™¨ä¼šé»˜è®¤æºå¸¦a.comçš„Cookieã€‚</li>
<li>a.comæ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¯¹è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œå¹¶ç¡®è®¤æ˜¯å—å®³è€…çš„å‡­è¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯å—å®³è€…è‡ªå·±å‘é€çš„è¯·æ±‚ã€‚</li>
<li>a.comä»¥å—å®³è€…çš„åä¹‰æ‰§è¡Œäº†act=xxã€‚</li>
<li>æ”»å‡»å®Œæˆï¼Œæ”»å‡»è€…åœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå†’å……å—å®³è€…ï¼Œè®©a.comæ‰§è¡Œäº†è‡ªå·±å®šä¹‰çš„æ“ä½œã€‚</li>
</ul>
<h1 id="å‡ ç§å¸¸è§çš„æ”»å‡»ç±»å‹"><a href="#å‡ ç§å¸¸è§çš„æ”»å‡»ç±»å‹" class="headerlink" title="å‡ ç§å¸¸è§çš„æ”»å‡»ç±»å‹"></a>å‡ ç§å¸¸è§çš„æ”»å‡»ç±»å‹</h1><h2 id="è‡ªåŠ¨å‘-GET-è¯·æ±‚"><a href="#è‡ªåŠ¨å‘-GET-è¯·æ±‚" class="headerlink" title="è‡ªåŠ¨å‘ GET è¯·æ±‚"></a>è‡ªåŠ¨å‘ GET è¯·æ±‚</h2><p>é»‘å®¢ç½‘é¡µé‡Œé¢å¯èƒ½æœ‰ä¸€æ®µè¿™æ ·çš„ä»£ç :</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://xxx.com/info?user=hhh&amp;count=100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿›å…¥é¡µé¢åè‡ªåŠ¨å‘é€ get è¯·æ±‚ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šè‡ªåŠ¨å¸¦ä¸Šå…³äº xxx.com çš„ cookie ä¿¡æ¯(è¿™é‡Œæ˜¯å‡å®šä½ å·²ç»åœ¨ xxx.com ä¸­ç™»å½•è¿‡)ã€‚</p>
<p>å‡å¦‚æœåŠ¡å™¨ç«¯æ²¡æœ‰ç›¸åº”çš„éªŒè¯æœºåˆ¶ï¼Œå®ƒå¯èƒ½è®¤ä¸ºå‘è¯·æ±‚çš„æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç”¨æˆ·ï¼Œå› ä¸ºæºå¸¦äº†ç›¸åº”çš„ cookieï¼Œç„¶åè¿›è¡Œç›¸åº”çš„å„ç§æ“ä½œï¼Œå¯ä»¥æ˜¯è½¬è´¦æ±‡æ¬¾ä»¥åŠå…¶ä»–çš„æ¶æ„æ“ä½œã€‚</p>
<h2 id="è‡ªåŠ¨å‘-POST-è¯·æ±‚"><a href="#è‡ªåŠ¨å‘-POST-è¯·æ±‚" class="headerlink" title="è‡ªåŠ¨å‘ POST è¯·æ±‚"></a>è‡ªåŠ¨å‘ POST è¯·æ±‚</h2><p>é»‘å®¢å¯èƒ½è‡ªå·±å¡«äº†ä¸€ä¸ªè¡¨å•ï¼Œå†™äº†ä¸€æ®µè‡ªåŠ¨æäº¤çš„è„šæœ¬ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&#x27;hacker-form&#x27;</span> <span class="attr">action</span>=<span class="string">&quot;https://xxx.com/info&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hhh&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hacker-form&#x27;</span>).<span class="title function_">submit</span>();</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·ä¹Ÿä¼šæºå¸¦ç›¸åº”çš„ç”¨æˆ· cookie ä¿¡æ¯ï¼Œè®©æœåŠ¡å™¨è¯¯ä»¥ä¸ºæ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç”¨æˆ·åœ¨æ“ä½œï¼Œè®©å„ç§æ¶æ„çš„æ“ä½œå˜ä¸ºå¯èƒ½ã€‚</p>
<h2 id="è¯±å¯¼ç‚¹å‡»å‘é€-GET-è¯·æ±‚"><a href="#è¯±å¯¼ç‚¹å‡»å‘é€-GET-è¯·æ±‚" class="headerlink" title="è¯±å¯¼ç‚¹å‡»å‘é€ GET è¯·æ±‚"></a>è¯±å¯¼ç‚¹å‡»å‘é€ GET è¯·æ±‚</h2><p>åœ¨é»‘å®¢çš„ç½‘ç«™ä¸Šï¼Œå¯èƒ½ä¼šæ”¾ä¸Šä¸€ä¸ªé“¾æ¥ï¼Œé©±ä½¿ä½ æ¥ç‚¹å‡»:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://xxx/info?user=hhh&amp;count=100&quot;</span> <span class="attr">taget</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>å± é¾™å®åˆ€ç‚¹å‡»å°±é€<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç‚¹å‡»åï¼Œè‡ªåŠ¨å‘é€ get è¯·æ±‚ï¼Œæ¥ä¸‹æ¥å’Œ<code>è‡ªåŠ¨å‘ GET è¯·æ±‚</code>éƒ¨åˆ†åŒç†ã€‚</p>
<p>è¿™å°±æ˜¯<code>CSRF</code>æ”»å‡»çš„åŸç†ã€‚å’Œ<code>XSS</code>æ”»å‡»å¯¹æ¯”ï¼ŒCSRF æ”»å‡»å¹¶ä¸éœ€è¦å°†æ¶æ„ä»£ç æ³¨å…¥ç”¨æˆ·å½“å‰é¡µé¢çš„<code>html</code>æ–‡æ¡£ä¸­ï¼Œè€Œæ˜¯è·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œåˆ©ç”¨æœåŠ¡å™¨çš„<strong>éªŒè¯æ¼æ´</strong>å’Œ<strong>ç”¨æˆ·ä¹‹å‰çš„ç™»å½•çŠ¶æ€</strong>æ¥æ¨¡æ‹Ÿç”¨æˆ·è¿›è¡Œæ“ä½œã€‚</p>
<h1 id="é˜²èŒƒæªæ–½-1"><a href="#é˜²èŒƒæªæ–½-1" class="headerlink" title="é˜²èŒƒæªæ–½"></a>é˜²èŒƒæªæ–½</h1><h2 id="åˆ©ç”¨-Cookie-çš„-SameSite-å±æ€§"><a href="#åˆ©ç”¨-Cookie-çš„-SameSite-å±æ€§" class="headerlink" title="åˆ©ç”¨ Cookie çš„ SameSite å±æ€§"></a>åˆ©ç”¨ Cookie çš„ SameSite å±æ€§</h2><p><code>CSRFæ”»å‡»</code>ä¸­é‡è¦çš„ä¸€ç¯å°±æ˜¯è‡ªåŠ¨å‘é€ç›®æ ‡ç«™ç‚¹ä¸‹çš„ <code>Cookie</code>,ç„¶åå°±æ˜¯è¿™ä¸€ä»½ Cookie æ¨¡æ‹Ÿäº†ç”¨æˆ·çš„èº«ä»½ã€‚å› æ­¤åœ¨<code>Cookie</code>ä¸Šé¢ä¸‹æ–‡ç« æ˜¯é˜²èŒƒçš„ä¸äºŒä¹‹é€‰ã€‚</p>
<p>æ°å¥½ï¼Œåœ¨ Cookie å½“ä¸­æœ‰ä¸€ä¸ªå…³é”®çš„å­—æ®µï¼Œå¯ä»¥å¯¹è¯·æ±‚ä¸­ Cookie çš„æºå¸¦ä½œä¸€äº›é™åˆ¶ï¼Œè¿™ä¸ªå­—æ®µå°±æ˜¯<code>SameSite</code>ã€‚</p>
<p><code>SameSite</code>å¯ä»¥è®¾ç½®ä¸ºä¸‰ä¸ªå€¼ï¼Œ<code>Strict</code>ã€<code>Lax</code>å’Œ<code>None</code>ã€‚</p>
<ol>
<li><p><code>Strict</code>æ¨¡å¼ï¼šæµè§ˆå™¨å®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹è¯·æ±‚æºå¸¦Cookieã€‚æ¯”å¦‚è¯´ b.com è®¾ç½®äº†å¦‚ä¸‹ Cookieï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Set-Cookie: foo=1; Samesite=Strict</span><br><span class="line">Set-Cookie: bar=2; Samesite=Lax</span><br><span class="line">Set-Cookie: baz=3</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨ a.com ä¸‹å‘èµ·å¯¹ b.com çš„ä»»æ„è¯·æ±‚ï¼Œfoo è¿™ä¸ª Cookie éƒ½ä¸ä¼šè¢«åŒ…å«åœ¨ Cookie è¯·æ±‚å¤´ä¸­ï¼Œä½† bar ä¼šã€‚ä¸¾ä¸ªå®é™…çš„ä¾‹å­å°±æ˜¯ï¼Œå‡å¦‚æ·˜å®ç½‘ç«™ç”¨æ¥è¯†åˆ«ç”¨æˆ·ç™»å½•ä¸å¦çš„ Cookie è¢«è®¾ç½®æˆäº† Samesite=Strictï¼Œé‚£ä¹ˆç”¨æˆ·ä»ç™¾åº¦æœç´¢é¡µé¢ç”šè‡³å¤©çŒ«é¡µé¢çš„é“¾æ¥ç‚¹å‡»è¿›å…¥æ·˜å®åï¼Œæ·˜å®éƒ½ä¸ä¼šæ˜¯ç™»å½•çŠ¶æ€ï¼Œå› ä¸ºæ·˜å®çš„æœåŠ¡å™¨ä¸ä¼šæ¥å—åˆ°é‚£ä¸ª Cookieï¼Œå…¶å®ƒç½‘ç«™å‘èµ·çš„å¯¹æ·˜å®çš„ä»»æ„è¯·æ±‚éƒ½ä¸ä¼šå¸¦ä¸Šé‚£ä¸ª Cookieã€‚</p>
</li>
<li><p><code>Lax</code>æ¨¡å¼ï¼šæ¯” Strict æ”¾å®½äº†ç‚¹é™åˆ¶ï¼Œå‡å¦‚è¿™ä¸ªè¯·æ±‚æ˜¯è¿™ç§è¯·æ±‚ï¼ˆæ”¹å˜äº†å½“å‰é¡µé¢æˆ–è€…æ‰“å¼€äº†æ–°é¡µé¢ï¼‰ä¸”åŒæ—¶æ˜¯ä¸ªGETè¯·æ±‚ï¼Œåˆ™è¿™ä¸ªCookieå¯ä»¥ä½œä¸ºç¬¬ä¸‰æ–¹Cookie</p>
</li>
<li><p><code>None</code>æ¨¡å¼ï¼šä¹Ÿå°±æ˜¯é»˜è®¤æ¨¡å¼ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦ä¸Š Cookieã€‚</p>
</li>
</ol>
<h2 id="éªŒè¯æ¥æºç«™ç‚¹"><a href="#éªŒè¯æ¥æºç«™ç‚¹" class="headerlink" title="éªŒè¯æ¥æºç«™ç‚¹"></a>éªŒè¯æ¥æºç«™ç‚¹</h2><p>åœ¨HTTPåè®®ä¸­ï¼Œæ¯ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚éƒ½ä¼šæºå¸¦ä¸¤ä¸ªHeaderï¼Œç”¨äºæ ‡è®°æ¥æºåŸŸåï¼š</p>
<ul>
<li>Origin Header</li>
<li>Referer Header</li>
</ul>
<p>å…¶ä¸­ï¼Œ<strong>Origin</strong> åªåŒ…å«åŸŸåä¿¡æ¯ï¼Œè€Œ <strong>Referer</strong> åŒ…å«äº†å…·ä½“çš„ URL è·¯å¾„ã€‚</p>
<h3 id="ä½¿ç”¨Origin-Headerç¡®å®šæ¥æºåŸŸå"><a href="#ä½¿ç”¨Origin-Headerç¡®å®šæ¥æºåŸŸå" class="headerlink" title="ä½¿ç”¨Origin Headerç¡®å®šæ¥æºåŸŸå"></a>ä½¿ç”¨Origin Headerç¡®å®šæ¥æºåŸŸå</h3><p>åœ¨éƒ¨åˆ†ä¸ CSRF æœ‰å…³çš„è¯·æ±‚ä¸­ï¼Œè¯·æ±‚çš„ Header ä¸­ä¼šæºå¸¦ Origin å­—æ®µã€‚å­—æ®µå†…åŒ…å«è¯·æ±‚çš„åŸŸåï¼ˆä¸åŒ…å« path åŠ queryï¼‰ã€‚</p>
<p>å¦‚æœ Origin å­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨ Originä¸­çš„å­—æ®µç¡®è®¤æ¥æºåŸŸåå°±å¯ä»¥ã€‚</p>
<p>ä½†æ˜¯åœ¨302é‡å®šå‘ä¹‹åOriginä¸åŒ…å«åœ¨é‡å®šå‘çš„è¯·æ±‚ä¸­ï¼Œå› ä¸ºOriginå¯èƒ½ä¼šè¢«è®¤ä¸ºæ˜¯å…¶ä»–æ¥æºçš„æ•æ„Ÿä¿¡æ¯ã€‚å¯¹äº302é‡å®šå‘çš„æƒ…å†µæ¥è¯´éƒ½æ˜¯å®šå‘åˆ°æ–°çš„æœåŠ¡å™¨ä¸Šçš„URLï¼Œå› æ­¤æµè§ˆå™¨ä¸æƒ³å°†Originæ³„æ¼åˆ°æ–°çš„æœåŠ¡å™¨ä¸Šã€‚</p>
<h3 id="ä½¿ç”¨Referer-Headerç¡®å®šæ¥æºåŸŸå"><a href="#ä½¿ç”¨Referer-Headerç¡®å®šæ¥æºåŸŸå" class="headerlink" title="ä½¿ç”¨Referer Headerç¡®å®šæ¥æºåŸŸå"></a>ä½¿ç”¨Referer Headerç¡®å®šæ¥æºåŸŸå</h3><p>åœ¨HTTPå¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå«Refererï¼Œè®°å½•äº†è¯¥HTTPè¯·æ±‚çš„æ¥æºåœ°å€ã€‚ å¯¹äºAjaxè¯·æ±‚ï¼Œå›¾ç‰‡å’Œscriptç­‰èµ„æºè¯·æ±‚ï¼ŒRefererä¸ºå‘èµ·è¯·æ±‚çš„é¡µé¢åœ°å€ã€‚å¯¹äºé¡µé¢è·³è½¬ï¼ŒRefererä¸ºæ‰“å¼€é¡µé¢å†å²è®°å½•çš„å‰ä¸€ä¸ªé¡µé¢åœ°å€ã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨Refererä¸­é“¾æ¥çš„Originéƒ¨åˆ†å¯ä»¥å¾—çŸ¥è¯·æ±‚çš„æ¥æºåŸŸåã€‚</p>
<p>è¿™ç§æ–¹æ³•å¹¶éä¸‡æ— ä¸€å¤±ï¼ŒRefererçš„å€¼æ˜¯ç”±æµè§ˆå™¨æä¾›çš„ï¼Œè™½ç„¶HTTPåè®®ä¸Šæœ‰æ˜ç¡®çš„è¦æ±‚ï¼Œä½†æ˜¯æ¯ä¸ªæµè§ˆå™¨å¯¹äºRefererçš„å…·ä½“å®ç°å¯èƒ½æœ‰å·®åˆ«ï¼Œå¹¶ä¸èƒ½ä¿è¯æµè§ˆå™¨è‡ªèº«æ²¡æœ‰å®‰å…¨æ¼æ´ã€‚ä½¿ç”¨éªŒè¯ Referer å€¼çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠŠå®‰å…¨æ€§éƒ½ä¾èµ–äºç¬¬ä¸‰æ–¹ï¼ˆå³æµè§ˆå™¨ï¼‰æ¥ä¿éšœï¼Œä»ç†è®ºä¸Šæ¥è®²ï¼Œè¿™æ ·å¹¶ä¸æ˜¯å¾ˆå®‰å…¨ã€‚åœ¨éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥éšè—ï¼Œç”šè‡³ä¿®æ”¹è‡ªå·±è¯·æ±‚çš„Refererã€‚</p>
<h2 id="CSRF-Token"><a href="#CSRF-Token" class="headerlink" title="CSRF Token"></a>CSRF Token</h2><p>CSRFæ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºæœåŠ¡å™¨è¯¯æŠŠæ”»å‡»è€…å‘é€çš„è¯·æ±‚å½“æˆäº†ç”¨æˆ·è‡ªå·±çš„è¯·æ±‚ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¦æ±‚æ‰€æœ‰çš„ç”¨æˆ·è¯·æ±‚éƒ½æºå¸¦ä¸€ä¸ªCSRFæ”»å‡»è€…æ— æ³•è·å–åˆ°çš„Tokenã€‚æœåŠ¡å™¨é€šè¿‡æ ¡éªŒè¯·æ±‚æ˜¯å¦æºå¸¦æ­£ç¡®çš„Tokenï¼Œæ¥æŠŠæ­£å¸¸çš„è¯·æ±‚å’Œæ”»å‡»çš„è¯·æ±‚åŒºåˆ†å¼€ï¼Œä¹Ÿå¯ä»¥é˜²èŒƒCSRFçš„æ”»å‡»ã€‚</p>
<p>CSRF Tokençš„é˜²æŠ¤ç­–ç•¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<p><strong>1. å°†CSRF Tokenè¾“å‡ºåˆ°é¡µé¢ä¸­</strong></p>
<p>é¦–å…ˆï¼Œç”¨æˆ·æ‰“å¼€é¡µé¢çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦ç»™è¿™ä¸ªç”¨æˆ·ç”Ÿæˆä¸€ä¸ªTokenï¼Œè¯¥Tokené€šè¿‡åŠ å¯†ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä¸€èˆ¬Tokenéƒ½åŒ…æ‹¬éšæœºå­—ç¬¦ä¸²å’Œæ—¶é—´æˆ³çš„ç»„åˆï¼Œæ˜¾ç„¶åœ¨æäº¤æ—¶Tokenä¸èƒ½å†æ”¾åœ¨Cookieä¸­äº†ï¼Œå¦åˆ™åˆä¼šè¢«æ”»å‡»è€…å†’ç”¨ã€‚å› æ­¤ï¼Œä¸ºäº†å®‰å…¨èµ·è§Tokenæœ€å¥½è¿˜æ˜¯å­˜åœ¨æœåŠ¡å™¨çš„Sessionä¸­ï¼Œä¹‹ååœ¨æ¯æ¬¡é¡µé¢åŠ è½½æ—¶ï¼Œä½¿ç”¨JSéå†æ•´ä¸ªDOMæ ‘ï¼Œå¯¹äºDOMä¸­æ‰€æœ‰çš„aå’Œformæ ‡ç­¾ååŠ å…¥Tokenã€‚è¿™æ ·å¯ä»¥è§£å†³å¤§éƒ¨åˆ†çš„è¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºåœ¨é¡µé¢åŠ è½½ä¹‹ååŠ¨æ€ç”Ÿæˆçš„HTMLä»£ç ï¼Œè¿™ç§æ–¹æ³•å°±æ²¡æœ‰ä½œç”¨ï¼Œè¿˜éœ€è¦ç¨‹åºå‘˜åœ¨ç¼–ç æ—¶æ‰‹åŠ¨æ·»åŠ Tokenã€‚</p>
<p><strong>2. é¡µé¢æäº¤çš„è¯·æ±‚æºå¸¦è¿™ä¸ªToken</strong></p>
<p>å¯¹äºGETè¯·æ±‚ï¼ŒTokenå°†é™„åœ¨è¯·æ±‚åœ°å€ä¹‹åï¼Œè¿™æ ·URL å°±å˜æˆ <a href="http://url/?csrftoken=tokenvalue">http://url?csrftoken=tokenvalue</a></p>
<p>è€Œå¯¹äº POST è¯·æ±‚æ¥è¯´ï¼Œè¦åœ¨ form çš„æœ€ååŠ ä¸Šï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">â€hiddenâ€</span> <span class="attr">name</span>=<span class="string">â€csrftokenâ€</span> <span class="attr">value</span>=<span class="string">â€tokenvalueâ€/</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œå°±æŠŠTokenä»¥å‚æ•°çš„å½¢å¼åŠ å…¥è¯·æ±‚äº†ã€‚</p>
<p><strong>3. æœåŠ¡å™¨éªŒè¯Tokenæ˜¯å¦æ­£ç¡®</strong></p>
<p>å½“ç”¨æˆ·ä»å®¢æˆ·ç«¯å¾—åˆ°äº†Tokenï¼Œå†æ¬¡æäº¤ç»™æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦åˆ¤æ–­Tokençš„æœ‰æ•ˆæ€§ï¼ŒéªŒè¯è¿‡ç¨‹æ˜¯å…ˆè§£å¯†Tokenï¼Œå¯¹æ¯”åŠ å¯†å­—ç¬¦ä¸²ä»¥åŠæ—¶é—´æˆ³ï¼Œå¦‚æœåŠ å¯†å­—ç¬¦ä¸²ä¸€è‡´ä¸”æ—¶é—´æœªè¿‡æœŸï¼Œé‚£ä¹ˆè¿™ä¸ªTokenå°±æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>è¿™ç§æ–¹æ³•è¦æ¯”ä¹‹å‰æ£€æŸ¥Refereræˆ–è€…Originè¦å®‰å…¨ä¸€äº›ï¼ŒTokenå¯ä»¥åœ¨äº§ç”Ÿå¹¶æ”¾äºSessionä¹‹ä¸­ï¼Œç„¶ååœ¨æ¯æ¬¡è¯·æ±‚æ—¶æŠŠTokenä»Sessionä¸­æ‹¿å‡ºï¼Œä¸è¯·æ±‚ä¸­çš„Tokenè¿›è¡Œæ¯”å¯¹ï¼Œä½†è¿™ç§æ–¹æ³•çš„æ¯”è¾ƒéº»çƒ¦çš„åœ¨äºå¦‚ä½•æŠŠTokenä»¥å‚æ•°çš„å½¢å¼åŠ å…¥è¯·æ±‚ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p><code>XSS</code> æ”»å‡»æ˜¯æŒ‡æµè§ˆå™¨ä¸­æ‰§è¡Œæ¶æ„è„šæœ¬, ç„¶åæ‹¿åˆ°ç”¨æˆ·çš„ä¿¡æ¯è¿›è¡Œæ“ä½œã€‚ä¸»è¦åˆ†ä¸º<code>å­˜å‚¨å‹</code>ã€<code>åå°„å‹</code>å’Œ<code>æ–‡æ¡£å‹</code>ã€‚é˜²èŒƒçš„æªæ–½åŒ…æ‹¬ï¼š</p>
<ul>
<li>å¯¹ç”¨æˆ·çš„è¾“å…¥å†…å®¹è¿›è¡Œè½¬ç æˆ–è€…è¿‡æ»¤ï¼Œè®©å…¶ä¸å¯æ‰§è¡Œã€‚</li>
<li>åˆ©ç”¨ CSP æˆ–åˆ©ç”¨ Cookie çš„ HttpOnly å±æ€§ã€‚</li>
</ul>
<h2 id="CFRS"><a href="#CFRS" class="headerlink" title="CFRS"></a>CFRS</h2><p>CSRF(Cross-site request forgery), å³è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ŒæŒ‡çš„æ˜¯é»‘å®¢è¯±å¯¼ç”¨æˆ·ç‚¹å‡»é“¾æ¥ï¼Œæ‰“å¼€é»‘å®¢çš„ç½‘ç«™ï¼Œç„¶åé»‘å®¢åˆ©ç”¨ç”¨æˆ·ç›®å‰çš„ç™»å½•çŠ¶æ€å‘èµ·è·¨ç«™è¯·æ±‚ã€‚</p>
<p><code>CSRF</code>æ”»å‡»ä¸€èˆ¬ä¼šæœ‰ä¸‰ç§æ–¹å¼:</p>
<ul>
<li>è‡ªåŠ¨ GET è¯·æ±‚</li>
<li>è‡ªåŠ¨ POST è¯·æ±‚</li>
<li>è¯±å¯¼ç‚¹å‡»å‘é€ GET è¯·æ±‚ã€‚</li>
</ul>
<p>é˜²èŒƒæªæ–½: åˆ©ç”¨ Cookie çš„ SameSite å±æ€§ã€éªŒè¯æ¥æºç«™ç‚¹å’ŒCSRF Tokenã€‚</p>
]]></content>
      <categories>
        <category>å®‰å…¨</category>
      </categories>
      <tags>
        <tag>å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Git å¸¸ç”¨å‘½ä»¤</title>
    <url>/2022/03/25/GIT/</url>
    <content><![CDATA[<h1 id="æäº¤ï¼ˆcommitï¼‰"><a href="#æäº¤ï¼ˆcommitï¼‰" class="headerlink" title="æäº¤ï¼ˆcommitï¼‰"></a>æäº¤ï¼ˆcommitï¼‰</h1><h2 id="åˆšæ‰æäº¤äº†ä»€ä¹ˆ"><a href="#åˆšæ‰æäº¤äº†ä»€ä¹ˆ" class="headerlink" title="åˆšæ‰æäº¤äº†ä»€ä¹ˆ"></a>åˆšæ‰æäº¤äº†ä»€ä¹ˆ</h2><p>å¦‚æœä½ ç”¨ <code>git commit -a</code> æäº¤äº†ä¸€æ¬¡å˜åŒ–(changes)ï¼Œè€Œä½ åˆä¸ç¡®å®šåˆ°åº•è¿™æ¬¡æäº¤äº†å“ªäº›å†…å®¹ã€‚ä½ å°±å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ˜¾ç¤ºå½“å‰<code>HEAD</code>ä¸Šçš„æœ€è¿‘ä¸€æ¬¡çš„æäº¤(commit):</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git show</span>  </span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">log</span> -n1 -p</span>  </span><br></pre></td></tr></table></figure>

<h2 id="æäº¤ä¿¡æ¯-commit-message-å†™é”™äº†"><a href="#æäº¤ä¿¡æ¯-commit-message-å†™é”™äº†" class="headerlink" title="æäº¤ä¿¡æ¯(commit message)å†™é”™äº†"></a>æäº¤ä¿¡æ¯(commit message)å†™é”™äº†</h2><p>å¦‚æœä½ çš„æäº¤ä¿¡æ¯(<code>commit message</code>)å†™é”™äº†ä¸”è¿™æ¬¡æäº¤(commit)è¿˜æ²¡æœ‰æ¨(push), ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ¥ä¿®æ”¹æäº¤ä¿¡æ¯(<code>commit message</code>):</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit --amend --only</span>  </span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šæ‰“å¼€ä½ çš„é»˜è®¤ç¼–è¾‘å™¨, åœ¨è¿™é‡Œä½ å¯ä»¥ç¼–è¾‘ä¿¡æ¯. å¦ä¸€æ–¹é¢, ä½ ä¹Ÿå¯ä»¥ç”¨ä¸€æ¡å‘½ä»¤ä¸€æ¬¡å®Œæˆ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit --amend --only -m <span class="string">&#x27;xxxxxxx&#x27;</span></span>  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å·²ç»æ¨(push)äº†è¿™æ¬¡æäº¤(commit), ä½ å¯ä»¥ä¿®æ”¹è¿™æ¬¡æäº¤(commit)ç„¶åå¼ºæ¨(<code>force push</code>), ä½†æ˜¯ä¸æ¨èè¿™ä¹ˆåšã€‚</p>
<h2 id="æäº¤-commit-é‡Œçš„ç”¨æˆ·åå’Œé‚®ç®±ä¸å¯¹"><a href="#æäº¤-commit-é‡Œçš„ç”¨æˆ·åå’Œé‚®ç®±ä¸å¯¹" class="headerlink" title="æäº¤(commit)é‡Œçš„ç”¨æˆ·åå’Œé‚®ç®±ä¸å¯¹"></a>æäº¤(commit)é‡Œçš„ç”¨æˆ·åå’Œé‚®ç®±ä¸å¯¹</h2><p>å¦‚æœè¿™åªæ˜¯å•ä¸ªæäº¤(commit)ï¼Œä¿®æ”¹å®ƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit --amend --author <span class="string">&quot;New Authorname &lt;email@gmail.com&gt;&quot;</span></span> </span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ éœ€è¦ä¿®æ”¹æ‰€æœ‰å†å², å‚è€ƒ <code>git filter-branch</code> çš„æŒ‡å—é¡µ.</p>
<h2 id="ä»ä¸€ä¸ªæäº¤-commit-é‡Œç§»é™¤ä¸€ä¸ªæ–‡ä»¶"><a href="#ä»ä¸€ä¸ªæäº¤-commit-é‡Œç§»é™¤ä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="ä»ä¸€ä¸ªæäº¤(commit)é‡Œç§»é™¤ä¸€ä¸ªæ–‡ä»¶"></a>ä»ä¸€ä¸ªæäº¤(commit)é‡Œç§»é™¤ä¸€ä¸ªæ–‡ä»¶</h2><p>é€šè¿‡ä¸‹é¢çš„æ–¹æ³•ï¼Œä»ä¸€ä¸ªæäº¤(commit)é‡Œç§»é™¤ä¸€ä¸ªæ–‡ä»¶:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout HEAD^ myfile</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add -A</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit --amend</span>  </span><br></pre></td></tr></table></figure>

<p>è¿™å°†éå¸¸æœ‰ç”¨ï¼Œå½“ä½ æœ‰ä¸€ä¸ªå¼€æ”¾çš„è¡¥ä¸(<code>open patch</code>)ï¼Œä½ å¾€ä¸Šé¢æäº¤äº†ä¸€ä¸ªä¸å¿…è¦çš„æ–‡ä»¶ï¼Œä½ éœ€è¦å¼ºæ¨(<code>force push</code>)å»æ›´æ–°è¿™ä¸ªè¿œç¨‹è¡¥ä¸ã€‚</p>
<h2 id="åˆ é™¤æœ€åä¸€æ¬¡æäº¤-commit"><a href="#åˆ é™¤æœ€åä¸€æ¬¡æäº¤-commit" class="headerlink" title="åˆ é™¤æœ€åä¸€æ¬¡æäº¤(commit)"></a>åˆ é™¤æœ€åä¸€æ¬¡æäº¤(commit)</h2><p>å¦‚æœä½ éœ€è¦åˆ é™¤æ¨äº†çš„æäº¤(<code>pushed commits</code>)ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ã€‚å¯æ˜¯ï¼Œè¿™ä¼šä¸å¯é€†çš„æ”¹å˜ä½ çš„å†å²ï¼Œä¹Ÿä¼šæä¹±é‚£äº›å·²ç»ä»è¯¥ä»“åº“æ‹‰å–(pulled)äº†çš„äººçš„å†å²ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœä½ ä¸æ˜¯å¾ˆç¡®å®šï¼Œåƒä¸‡ä¸è¦è¿™ä¹ˆåšã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset HEAD^ --hard</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git push -f [remote] [branch]</span>  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ è¿˜æ²¡æœ‰æ¨åˆ°è¿œç¨‹, æŠŠGité‡ç½®(reset)åˆ°ä½ æœ€åä¸€æ¬¡æäº¤å‰çš„çŠ¶æ€å°±å¯ä»¥äº†(åŒæ—¶ä¿å­˜æš‚å­˜çš„å˜åŒ–):</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(my-branch*)$ git reset --soft HEAD@&#123;1&#125;  </span><br></pre></td></tr></table></figure>

<p>è¿™åªèƒ½åœ¨æ²¡æœ‰æ¨é€ä¹‹å‰æœ‰ç”¨. å¦‚æœä½ å·²ç»æ¨äº†, å”¯ä¸€å®‰å…¨èƒ½åšçš„æ˜¯ <code>git revert SHAofBadCommit</code>ï¼Œ é‚£ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤(commit)ç”¨äºæ’¤æ¶ˆå‰ä¸€ä¸ªæäº¤çš„æ‰€æœ‰å˜åŒ–(changes)ï¼›æˆ–è€…, å¦‚æœä½ æ¨çš„è¿™ä¸ªåˆ†æ”¯æ˜¯rebase-safeçš„ (ä¾‹å¦‚ï¼šå…¶å®ƒå¼€å‘è€…ä¸ä¼šä»è¿™ä¸ªåˆ†æ”¯æ‹‰), åªéœ€è¦ä½¿ç”¨ <code>git push -f</code>ã€‚</p>
<h2 id="åˆ é™¤ä»»æ„æäº¤-commit"><a href="#åˆ é™¤ä»»æ„æäº¤-commit" class="headerlink" title="åˆ é™¤ä»»æ„æäº¤(commit)"></a>åˆ é™¤ä»»æ„æäº¤(commit)</h2><p>åŒæ ·çš„è­¦å‘Šï¼šä¸åˆ°ä¸‡ä¸å¾—å·²çš„æ—¶å€™ä¸è¦è¿™ä¹ˆåš.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git rebase --onto SHA1_OF_BAD_COMMIT^ SHA1_OF_BAD_COMMIT</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git push -f [remote] [branch]</span>  </span><br></pre></td></tr></table></figure>

<p>æˆ–è€…åšä¸€ä¸ª äº¤äº’å¼rebase åˆ é™¤é‚£äº›ä½ æƒ³è¦åˆ é™¤çš„æäº¤(commit)é‡Œæ‰€å¯¹åº”çš„è¡Œã€‚</p>
<h2 id="æˆ‘å°è¯•æ¨ä¸€ä¸ªä¿®æ­£åçš„æäº¤-amended-commit-åˆ°è¿œç¨‹ï¼Œä½†æ˜¯æŠ¥é”™"><a href="#æˆ‘å°è¯•æ¨ä¸€ä¸ªä¿®æ­£åçš„æäº¤-amended-commit-åˆ°è¿œç¨‹ï¼Œä½†æ˜¯æŠ¥é”™" class="headerlink" title="æˆ‘å°è¯•æ¨ä¸€ä¸ªä¿®æ­£åçš„æäº¤(amended commit)åˆ°è¿œç¨‹ï¼Œä½†æ˜¯æŠ¥é”™"></a>æˆ‘å°è¯•æ¨ä¸€ä¸ªä¿®æ­£åçš„æäº¤(amended commit)åˆ°è¿œç¨‹ï¼Œä½†æ˜¯æŠ¥é”™</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">To https://github.com/yourusername/repo.git  </span><br><span class="line">! [rejected]        mybranch -&gt; mybranch (non-fast-forward)  </span><br><span class="line">error: failed to push some refs to &#x27;https://github.com/tanay1337/webmaker.org.git&#x27;  </span><br><span class="line">hint: Updates were rejected because the tip of your current branch is behind  </span><br><span class="line">hint: its remote counterpart. Integrate the remote changes (e.g.  </span><br><span class="line">hint: &#x27;git pull ...&#x27;) before pushing again.  </span><br><span class="line">hint: See the &#x27;Note about fast-forwards&#x27; in &#x27;git push --help&#x27; for details.  </span><br></pre></td></tr></table></figure>

<p>æ³¨æ„, rebasing(è§ä¸‹é¢)å’Œä¿®æ­£(amending)ä¼šç”¨ä¸€ä¸ª<strong>æ–°çš„æäº¤(commit)ä»£æ›¿æ—§çš„</strong>, æ‰€ä»¥å¦‚æœä¹‹å‰ä½ å·²ç»å¾€è¿œç¨‹ä»“åº“ä¸Šæ¨è¿‡ä¸€æ¬¡ä¿®æ­£å‰çš„æäº¤(commit)ï¼Œé‚£ä½ ç°åœ¨å°±å¿…é¡»å¼ºæ¨(<code>force push</code>) (<code>-f</code>)ã€‚æ³¨æ„ â€“ <em>æ€»æ˜¯</em> ç¡®ä¿ä½ æŒ‡æ˜ä¸€ä¸ªåˆ†æ”¯!</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git push origin mybranch -f</span>  </span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æ¥è¯´, <strong>è¦é¿å…å¼ºæ¨</strong>. æœ€å¥½æ˜¯åˆ›å»ºå’Œæ¨(push)ä¸€ä¸ªæ–°çš„æäº¤(commit)ï¼Œè€Œä¸æ˜¯å¼ºæ¨ä¸€ä¸ªä¿®æ­£åçš„æäº¤ã€‚åè€…ä¼šä½¿é‚£äº›ä¸è¯¥åˆ†æ”¯æˆ–è¯¥åˆ†æ”¯çš„å­åˆ†æ”¯å·¥ä½œçš„å¼€å‘è€…ï¼Œåœ¨æºå†å²ä¸­äº§ç”Ÿå†²çªã€‚</p>
<h2 id="æ„å¤–åšäº†ä¸€æ¬¡ç¡¬é‡ç½®-hard-reset-ï¼Œæ‰¾å›å†…å®¹"><a href="#æ„å¤–åšäº†ä¸€æ¬¡ç¡¬é‡ç½®-hard-reset-ï¼Œæ‰¾å›å†…å®¹" class="headerlink" title="æ„å¤–åšäº†ä¸€æ¬¡ç¡¬é‡ç½®(hard reset)ï¼Œæ‰¾å›å†…å®¹"></a>æ„å¤–åšäº†ä¸€æ¬¡ç¡¬é‡ç½®(hard reset)ï¼Œæ‰¾å›å†…å®¹</h2><p>å¦‚æœä½ æ„å¤–çš„åšäº† <code>git reset --hard</code>, ä½ é€šå¸¸èƒ½æ‰¾å›ä½ çš„æäº¤(commit), å› ä¸ºGitå¯¹æ¯ä»¶äº‹éƒ½ä¼šæœ‰æ—¥å¿—ï¼Œä¸”éƒ½ä¼šä¿å­˜å‡ å¤©ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reflog</span>  </span><br></pre></td></tr></table></figure>

<p>ä½ å°†ä¼šçœ‹åˆ°ä¸€ä¸ªä½ è¿‡å»æäº¤(commit)çš„åˆ—è¡¨, å’Œä¸€ä¸ªé‡ç½®çš„æäº¤ã€‚é€‰æ‹©ä½ æƒ³è¦å›åˆ°çš„æäº¤(commit)çš„SHAï¼Œå†é‡ç½®ä¸€æ¬¡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset --hard SHA1234</span>  </span><br></pre></td></tr></table></figure>

<h1 id="æš‚å­˜-Staging"><a href="#æš‚å­˜-Staging" class="headerlink" title="æš‚å­˜(Staging)"></a>æš‚å­˜(Staging)</h1><h2 id="æŠŠæš‚å­˜çš„å†…å®¹æ·»åŠ åˆ°ä¸Šä¸€æ¬¡çš„æäº¤-commit"><a href="#æŠŠæš‚å­˜çš„å†…å®¹æ·»åŠ åˆ°ä¸Šä¸€æ¬¡çš„æäº¤-commit" class="headerlink" title="æŠŠæš‚å­˜çš„å†…å®¹æ·»åŠ åˆ°ä¸Šä¸€æ¬¡çš„æäº¤(commit)"></a>æŠŠæš‚å­˜çš„å†…å®¹æ·»åŠ åˆ°ä¸Šä¸€æ¬¡çš„æäº¤(commit)</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(my-branch*)$ git commit --amend  </span><br></pre></td></tr></table></figure>

<h2 id="æš‚å­˜ä¸€ä¸ªæ–°æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¿™ä¸ªæ–‡ä»¶çš„å…¨éƒ¨"><a href="#æš‚å­˜ä¸€ä¸ªæ–°æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¿™ä¸ªæ–‡ä»¶çš„å…¨éƒ¨" class="headerlink" title="æš‚å­˜ä¸€ä¸ªæ–°æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¿™ä¸ªæ–‡ä»¶çš„å…¨éƒ¨"></a>æš‚å­˜ä¸€ä¸ªæ–°æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¿™ä¸ªæ–‡ä»¶çš„å…¨éƒ¨</h2><p>ä¸€èˆ¬æ¥è¯´, å¦‚æœä½ æƒ³æš‚å­˜ä¸€ä¸ªæ–‡ä»¶çš„ä¸€éƒ¨åˆ†, ä½ å¯è¿™æ ·åš:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add --patch filename.x</span>  </span><br></pre></td></tr></table></figure>

<p><code>-p</code> ç®€å†™ã€‚è¿™ä¼šæ‰“å¼€äº¤äº’æ¨¡å¼ï¼Œ ä½ å°†èƒ½å¤Ÿç”¨ <code>s</code> é€‰é¡¹æ¥åˆ†éš”æäº¤(commit)ï¼›ç„¶è€Œ, å¦‚æœè¿™ä¸ªæ–‡ä»¶æ˜¯æ–°çš„, ä¼šæ²¡æœ‰è¿™ä¸ªé€‰æ‹©ï¼Œ æ·»åŠ ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶, è¿™æ ·åš:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add -N filename.x</span>  </span><br></pre></td></tr></table></figure>

<p>ç„¶å, ä½ éœ€è¦ç”¨ <code>e</code> é€‰é¡¹æ¥æ‰‹åŠ¨é€‰æ‹©éœ€è¦æ·»åŠ çš„è¡Œï¼Œæ‰§è¡Œ <code>git diff --cached</code> å°†ä¼šæ˜¾ç¤ºå“ªäº›è¡Œæš‚å­˜äº†å“ªäº›è¡Œåªæ˜¯ä¿å­˜åœ¨æœ¬åœ°äº†ã€‚</p>
<h2 id="æŠŠåœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œçš„å˜åŒ–-changes-åŠ åˆ°ä¸¤ä¸ªæäº¤-commit-é‡Œ"><a href="#æŠŠåœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œçš„å˜åŒ–-changes-åŠ åˆ°ä¸¤ä¸ªæäº¤-commit-é‡Œ" class="headerlink" title="æŠŠåœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œçš„å˜åŒ–(changes)åŠ åˆ°ä¸¤ä¸ªæäº¤(commit)é‡Œ"></a>æŠŠåœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œçš„å˜åŒ–(changes)åŠ åˆ°ä¸¤ä¸ªæäº¤(commit)é‡Œ</h2><p><code>git add</code> ä¼šæŠŠæ•´ä¸ªæ–‡ä»¶åŠ å…¥åˆ°ä¸€ä¸ªæäº¤</p>
<p><code>git add -p</code> å…è®¸äº¤äº’å¼çš„é€‰æ‹©ä½ æƒ³è¦æäº¤çš„éƒ¨åˆ†</p>
<h2 id="æŠŠæš‚å­˜çš„å†…å®¹å˜æˆæœªæš‚å­˜ï¼ŒæŠŠæœªæš‚å­˜çš„å†…å®¹æš‚å­˜èµ·æ¥"><a href="#æŠŠæš‚å­˜çš„å†…å®¹å˜æˆæœªæš‚å­˜ï¼ŒæŠŠæœªæš‚å­˜çš„å†…å®¹æš‚å­˜èµ·æ¥" class="headerlink" title="æŠŠæš‚å­˜çš„å†…å®¹å˜æˆæœªæš‚å­˜ï¼ŒæŠŠæœªæš‚å­˜çš„å†…å®¹æš‚å­˜èµ·æ¥"></a>æŠŠæš‚å­˜çš„å†…å®¹å˜æˆæœªæš‚å­˜ï¼ŒæŠŠæœªæš‚å­˜çš„å†…å®¹æš‚å­˜èµ·æ¥</h2><p>å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥å°†æ‰€æœ‰çš„å†…å®¹å˜ä¸ºæœªæš‚å­˜ï¼Œç„¶åå†é€‰æ‹©ä½ æƒ³è¦çš„å†…å®¹è¿›è¡Œcommitã€‚ä½†å‡å®šä½ å°±æ˜¯æƒ³è¦è¿™ä¹ˆåšï¼Œè¿™é‡Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„commitæ¥ä¿å­˜ä½ å·²æš‚å­˜çš„å†…å®¹ï¼Œç„¶åæš‚å­˜ä½ çš„æœªæš‚å­˜çš„å†…å®¹å¹¶è¿›è¡Œstashã€‚ç„¶åresetæœ€åä¸€ä¸ªcommitå°†åŸæœ¬æš‚å­˜çš„å†…å®¹å˜ä¸ºæœªæš‚å­˜ï¼Œæœ€åstash popå›æ¥ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&quot;WIP&quot;</span></span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add .</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git stash</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset HEAD^</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git stash pop --index 0</span>  </span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ol>
<li><p>è¿™é‡Œä½¿ç”¨<code>pop</code>ä»…ä»…æ˜¯å› ä¸ºæƒ³å°½å¯èƒ½ä¿æŒå¹‚ç­‰ã€‚</p>
</li>
<li><p>å‡å¦‚ä½ ä¸åŠ ä¸Š<code>--index</code>ä½ ä¼šæŠŠæš‚å­˜çš„æ–‡ä»¶æ ‡è®°ä¸ºä¸ºå­˜å‚¨ã€‚</p>
</li>
</ol>
<h1 id="æœªæš‚å­˜-Unstaged-çš„å†…å®¹"><a href="#æœªæš‚å­˜-Unstaged-çš„å†…å®¹" class="headerlink" title="æœªæš‚å­˜(Unstaged)çš„å†…å®¹"></a>æœªæš‚å­˜(Unstaged)çš„å†…å®¹</h1><h2 id="æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯"><a href="#æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯" class="headerlink" title="æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯"></a>æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout -b my-branch</span>  </span><br></pre></td></tr></table></figure>

<h2 id="æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå·²å­˜åœ¨çš„åˆ†æ”¯"><a href="#æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå·²å­˜åœ¨çš„åˆ†æ”¯" class="headerlink" title="æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå·²å­˜åœ¨çš„åˆ†æ”¯"></a>æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå·²å­˜åœ¨çš„åˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git stash</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout my-branch</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git stash pop</span>  </span><br></pre></td></tr></table></figure>

<h2 id="ä¸¢å¼ƒæœ¬åœ°æœªæäº¤çš„å˜åŒ–-uncommitted-changes"><a href="#ä¸¢å¼ƒæœ¬åœ°æœªæäº¤çš„å˜åŒ–-uncommitted-changes" class="headerlink" title="ä¸¢å¼ƒæœ¬åœ°æœªæäº¤çš„å˜åŒ–(uncommitted changes)"></a>ä¸¢å¼ƒæœ¬åœ°æœªæäº¤çš„å˜åŒ–(uncommitted changes)</h2><p>å¦‚æœä½ åªæ˜¯æƒ³é‡ç½®æº(origin)å’Œä½ æœ¬åœ°(local)ä¹‹é—´çš„ä¸€äº›æäº¤(commit)ï¼Œä½ å¯ä»¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">one commit</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset --hard HEAD^</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">two commits</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset --hard HEAD^^</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">four commits</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset --hard HEAD~4</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span>  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout -f</span>  </span><br></pre></td></tr></table></figure>

<p>é‡ç½®æŸä¸ªç‰¹æ®Šçš„æ–‡ä»¶, ä½ å¯ä»¥ç”¨æ–‡ä»¶ååšä¸ºå‚æ•°:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset filename</span>  </span><br></pre></td></tr></table></figure>

<h2 id="ä¸¢å¼ƒæŸäº›æœªæš‚å­˜çš„å†…å®¹"><a href="#ä¸¢å¼ƒæŸäº›æœªæš‚å­˜çš„å†…å®¹" class="headerlink" title="ä¸¢å¼ƒæŸäº›æœªæš‚å­˜çš„å†…å®¹"></a>ä¸¢å¼ƒæŸäº›æœªæš‚å­˜çš„å†…å®¹</h2><p>å¦‚æœä½ æƒ³ä¸¢å¼ƒå·¥ä½œæ‹·è´ä¸­çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ã€‚</p>
<p>ç­¾å‡º(checkout)ä¸éœ€è¦çš„å†…å®¹ï¼Œä¿ç•™éœ€è¦çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git checkout -p  </span><br><span class="line"># Answer y to all of the snippets you want to drop  </span><br></pre></td></tr></table></figure>

<p>å¦å¤–ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨ <code>stash</code>ï¼Œ Stashæ‰€æœ‰è¦ä¿ç•™ä¸‹çš„å†…å®¹, é‡ç½®å·¥ä½œæ‹·è´, é‡æ–°åº”ç”¨ä¿ç•™çš„éƒ¨åˆ†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash -p  </span><br><span class="line"># Select all of the snippets you want to save  </span><br><span class="line">$ git reset --hard  </span><br><span class="line">$ git stash pop  </span><br></pre></td></tr></table></figure>

<p>æˆ–è€…, stash ä½ ä¸éœ€è¦çš„éƒ¨åˆ†, ç„¶åstash dropã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash -p  </span><br><span class="line"># Select all of the snippets you don&#x27;t want to save  </span><br><span class="line">$ git stash drop  </span><br></pre></td></tr></table></figure>

<h1 id="åˆ†æ”¯-Branches"><a href="#åˆ†æ”¯-Branches" class="headerlink" title="åˆ†æ”¯(Branches)"></a>åˆ†æ”¯(Branches)</h1><h2 id="ä»é”™è¯¯çš„åˆ†æ”¯æ‹‰å–äº†å†…å®¹ï¼Œæˆ–æŠŠå†…å®¹æ‹‰å–åˆ°äº†é”™è¯¯çš„åˆ†æ”¯"><a href="#ä»é”™è¯¯çš„åˆ†æ”¯æ‹‰å–äº†å†…å®¹ï¼Œæˆ–æŠŠå†…å®¹æ‹‰å–åˆ°äº†é”™è¯¯çš„åˆ†æ”¯" class="headerlink" title="ä»é”™è¯¯çš„åˆ†æ”¯æ‹‰å–äº†å†…å®¹ï¼Œæˆ–æŠŠå†…å®¹æ‹‰å–åˆ°äº†é”™è¯¯çš„åˆ†æ”¯"></a>ä»é”™è¯¯çš„åˆ†æ”¯æ‹‰å–äº†å†…å®¹ï¼Œæˆ–æŠŠå†…å®¹æ‹‰å–åˆ°äº†é”™è¯¯çš„åˆ†æ”¯</h2><p>è¿™æ˜¯å¦å¤–ä¸€ç§ä½¿ç”¨ <code>git reflog</code> æƒ…å†µï¼Œæ‰¾åˆ°åœ¨è¿™æ¬¡é”™è¯¯æ‹‰(pull) ä¹‹å‰HEADçš„æŒ‡å‘ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git reflog  </span><br><span class="line">ab7555f HEAD@&#123;0&#125;: pull origin wrong-branch: Fast-forward  </span><br><span class="line">c5bc55a HEAD@&#123;1&#125;: checkout: checkout message goes here  </span><br></pre></td></tr></table></figure>

<p>é‡ç½®åˆ†æ”¯åˆ°ä½ æ‰€éœ€çš„æäº¤(desired commit):</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git reset --hard c5bc55a  </span><br></pre></td></tr></table></figure>

<p>å®Œæˆã€‚</p>
<h2 id="èˆå¼ƒæœ¬åœ°çš„æäº¤-commit-ï¼Œä»¥ä¾¿æˆ‘çš„åˆ†æ”¯ä¸è¿œç¨‹çš„ä¿æŒä¸€è‡´"><a href="#èˆå¼ƒæœ¬åœ°çš„æäº¤-commit-ï¼Œä»¥ä¾¿æˆ‘çš„åˆ†æ”¯ä¸è¿œç¨‹çš„ä¿æŒä¸€è‡´" class="headerlink" title="èˆå¼ƒæœ¬åœ°çš„æäº¤(commit)ï¼Œä»¥ä¾¿æˆ‘çš„åˆ†æ”¯ä¸è¿œç¨‹çš„ä¿æŒä¸€è‡´"></a>èˆå¼ƒæœ¬åœ°çš„æäº¤(commit)ï¼Œä»¥ä¾¿æˆ‘çš„åˆ†æ”¯ä¸è¿œç¨‹çš„ä¿æŒä¸€è‡´</h2><p>å…ˆç¡®è®¤ä½ æ²¡æœ‰æ¨(push)ä½ çš„å†…å®¹åˆ°è¿œç¨‹ã€‚</p>
<p><code>git status</code> ä¼šæ˜¾ç¤ºä½ é¢†å…ˆ(ahead)æº(origin)å¤šå°‘ä¸ªæäº¤:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git status</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">On branch my-branch</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Your branch is ahead of <span class="string">&#x27;origin/my-branch&#x27;</span> by 2 commits.</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  (use <span class="string">&quot;git push&quot;</span> to publish your <span class="built_in">local</span> commits)</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> </span></span><br></pre></td></tr></table></figure>

<p>ä¸€ç§æ–¹æ³•æ˜¯:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset --hard origin/my-branch</span>  </span><br></pre></td></tr></table></figure>

<h2 id="éœ€è¦æäº¤åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œä½†é”™è¯¯çš„æäº¤åˆ°äº†main"><a href="#éœ€è¦æäº¤åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œä½†é”™è¯¯çš„æäº¤åˆ°äº†main" class="headerlink" title="éœ€è¦æäº¤åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œä½†é”™è¯¯çš„æäº¤åˆ°äº†main"></a>éœ€è¦æäº¤åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œä½†é”™è¯¯çš„æäº¤åˆ°äº†main</h2><p>åœ¨mainä¸‹åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œä¸åˆ‡æ¢åˆ°æ–°åˆ†æ”¯,ä»åœ¨mainä¸‹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git branch my-branch</span>  </span><br></pre></td></tr></table></figure>

<p>æŠŠmainåˆ†æ”¯é‡ç½®åˆ°å‰ä¸€ä¸ªæäº¤:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset --hard HEAD^</span></span><br></pre></td></tr></table></figure>

<p><code>HEAD^</code> æ˜¯ <code>HEAD^1</code> çš„ç®€å†™ï¼Œä½ å¯ä»¥é€šè¿‡æŒ‡å®šè¦è®¾ç½®çš„<code>HEAD</code>æ¥è¿›ä¸€æ­¥é‡ç½®ã€‚</p>
<p>æˆ–è€…, å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ <code>HEAD^</code>, æ‰¾åˆ°ä½ æƒ³é‡ç½®åˆ°çš„æäº¤(commit)çš„hash(<code>git log</code> èƒ½å¤Ÿå®Œæˆ)ï¼Œ ç„¶åé‡ç½®åˆ°è¿™ä¸ªhashã€‚ä½¿ç”¨<code>git push</code> åŒæ­¥å†…å®¹åˆ°è¿œç¨‹ã€‚</p>
<p>ä¾‹å¦‚, mainåˆ†æ”¯æƒ³é‡ç½®åˆ°çš„æäº¤çš„hashä¸º<code>a13b85e</code>:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset --hard a13b85e</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HEAD is now at a13b85e</span>  </span><br></pre></td></tr></table></figure>

<p>ç­¾å‡º(checkout)åˆšæ‰æ–°å»ºçš„åˆ†æ”¯ç»§ç»­å·¥ä½œ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout new-branch</span>  </span><br></pre></td></tr></table></figure>

<h2 id="ä¿ç•™æ¥è‡ªå¦å¤–ä¸€ä¸ªref-ishçš„æ•´ä¸ªæ–‡ä»¶"><a href="#ä¿ç•™æ¥è‡ªå¦å¤–ä¸€ä¸ªref-ishçš„æ•´ä¸ªæ–‡ä»¶" class="headerlink" title="ä¿ç•™æ¥è‡ªå¦å¤–ä¸€ä¸ªref-ishçš„æ•´ä¸ªæ–‡ä»¶"></a>ä¿ç•™æ¥è‡ªå¦å¤–ä¸€ä¸ªref-ishçš„æ•´ä¸ªæ–‡ä»¶</h2><p>å‡è®¾ä½ æ­£åœ¨åšä¸€ä¸ªåŸå‹æ–¹æ¡ˆ(åŸæ–‡ä¸ºworking spike (see note)), æœ‰æˆç™¾çš„å†…å®¹ï¼Œæ¯ä¸ªéƒ½å·¥ä½œå¾—å¾ˆå¥½ã€‚ç°åœ¨, ä½ æäº¤åˆ°äº†ä¸€ä¸ªåˆ†æ”¯ï¼Œä¿å­˜å·¥ä½œå†…å®¹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add -A &amp;&amp; git commit -m <span class="string">&quot;Adding all changes from this spike into one big commit.&quot;</span></span>  </span><br></pre></td></tr></table></figure>

<p>å½“ä½ æƒ³è¦æŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªåˆ†æ”¯é‡Œ (å¯èƒ½æ˜¯<code>feature</code>, æˆ–è€… <code>develop</code>), ä½ å…³å¿ƒæ˜¯ä¿æŒæ•´ä¸ªæ–‡ä»¶çš„å®Œæ•´ï¼Œä½ æƒ³è¦ä¸€ä¸ªå¤§çš„æäº¤åˆ†éš”æˆæ¯”è¾ƒå°ã€‚</p>
<p>å‡è®¾ä½ æœ‰:</p>
<ul>
<li>åˆ†æ”¯ <code>solution</code>, æ‹¥æœ‰åŸå‹æ–¹æ¡ˆï¼Œ é¢†å…ˆ <code>develop</code> åˆ†æ”¯ã€‚</li>
<li>åˆ†æ”¯ <code>develop</code>, åœ¨è¿™é‡Œä½ åº”ç”¨åŸå‹æ–¹æ¡ˆçš„ä¸€äº›å†…å®¹ã€‚</li>
</ul>
<p>æˆ‘å»å¯ä»¥é€šè¿‡æŠŠå†…å®¹æ‹¿åˆ°ä½ çš„åˆ†æ”¯é‡Œï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(develop)$ git checkout solution -- file1.txt  </span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶å†…å®¹ä»åˆ†æ”¯ <code>solution</code> æ‹¿åˆ°åˆ†æ”¯ <code>develop</code> é‡Œæ¥:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># On branch develop  </span><br><span class="line"># Your branch is up-to-date with &#x27;origin/develop&#x27;.  </span><br><span class="line"># Changes to be committed:  </span><br><span class="line">#  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)  </span><br><span class="line">#  </span><br><span class="line">#        modified:   file1.txt  </span><br></pre></td></tr></table></figure>

<p>ç„¶å, æ­£å¸¸æäº¤ã€‚</p>
<blockquote>
<p>Note: Spike solutions are made to analyze or solve the problem. These solutions are used for estimation and discarded once everyone gets clear visualization of the problem.</p>
</blockquote>
<h2 id="æŠŠå‡ ä¸ªæäº¤-commit-æäº¤åˆ°äº†åŒä¸€ä¸ªåˆ†æ”¯ï¼Œè€Œè¿™äº›æäº¤åº”è¯¥åˆ†å¸ƒåœ¨ä¸åŒçš„åˆ†æ”¯é‡Œ"><a href="#æŠŠå‡ ä¸ªæäº¤-commit-æäº¤åˆ°äº†åŒä¸€ä¸ªåˆ†æ”¯ï¼Œè€Œè¿™äº›æäº¤åº”è¯¥åˆ†å¸ƒåœ¨ä¸åŒçš„åˆ†æ”¯é‡Œ" class="headerlink" title="æŠŠå‡ ä¸ªæäº¤(commit)æäº¤åˆ°äº†åŒä¸€ä¸ªåˆ†æ”¯ï¼Œè€Œè¿™äº›æäº¤åº”è¯¥åˆ†å¸ƒåœ¨ä¸åŒçš„åˆ†æ”¯é‡Œ"></a>æŠŠå‡ ä¸ªæäº¤(commit)æäº¤åˆ°äº†åŒä¸€ä¸ªåˆ†æ”¯ï¼Œè€Œè¿™äº›æäº¤åº”è¯¥åˆ†å¸ƒåœ¨ä¸åŒçš„åˆ†æ”¯é‡Œ</h2><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª<code>main</code>åˆ†æ”¯ï¼Œ æ‰§è¡Œ<code>git log</code>, ä½ çœ‹åˆ°ä½ åšè¿‡ä¸¤æ¬¡æäº¤:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">(main)$ </span><span class="language-bash">git <span class="built_in">log</span></span>  </span><br><span class="line">  </span><br><span class="line">commit e3851e817c451cc36f2e6f3049db528415e3c114  </span><br><span class="line">Author: Alex Lee &lt;alexlee@example.com&gt;  </span><br><span class="line">Date:   Tue Jul 22 15:39:27 2014 -0400  </span><br><span class="line">  </span><br><span class="line">    Bug #21 - Added CSRF protection  </span><br><span class="line">  </span><br><span class="line">commit 5ea51731d150f7ddc4a365437931cd8be3bf3131  </span><br><span class="line">Author: Alex Lee &lt;alexlee@example.com&gt;  </span><br><span class="line">Date:   Tue Jul 22 15:39:12 2014 -0400  </span><br><span class="line">  </span><br><span class="line">    Bug #14 - Fixed spacing on title  </span><br><span class="line">  </span><br><span class="line">commit a13b85e984171c6e2a1729bb061994525f626d14  </span><br><span class="line">Author: Aki Rose &lt;akirose@example.com&gt;  </span><br><span class="line">Date:   Tue Jul 21 01:12:48 2014 -0400  </span><br><span class="line">  </span><br><span class="line">    First commit  </span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬ç”¨æäº¤hash(commit hash)æ ‡è®°bug (<code>e3851e8</code> for #21, <code>5ea5173</code> for #14).</p>
<p>é¦–å…ˆ, æˆ‘ä»¬æŠŠ<code>main</code>åˆ†æ”¯é‡ç½®åˆ°æ­£ç¡®çš„æäº¤(<code>a13b85e</code>):</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset --hard a13b85e</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HEAD is now at a13b85e</span>  </span><br></pre></td></tr></table></figure>

<p>ç°åœ¨, æˆ‘ä»¬å¯¹ <code>bug #21</code> åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git checkout -b 21  </span><br><span class="line">(21)$  </span><br></pre></td></tr></table></figure>

<p>æ¥ç€, æˆ‘ä»¬ç”¨<code>_cherry-pick_</code>æŠŠå¯¹<code>bug #21</code>çš„æäº¤æ”¾å…¥å½“å‰åˆ†æ”¯ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å°†åº”ç”¨(apply)è¿™ä¸ªæäº¤(commit)ï¼Œä»…ä»…è¿™ä¸€ä¸ªæäº¤(commit)ï¼Œç›´æ¥åœ¨HEADä¸Šé¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(21)$ git cherry-pick e3851e8  </span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™, è¿™é‡Œå¯èƒ½ä¼šäº§ç”Ÿå†²çªï¼Œ å‚è§äº¤äº’å¼ rebasing ç«  <strong>å†²çªèŠ‚</strong> è§£å†³å†²çª.</p>
<p>å†è€…ï¼Œ æˆ‘ä»¬ä¸ºbug #14 åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯, ä¹ŸåŸºäº<code>main</code>åˆ†æ”¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(21)$ git checkout main  </span><br><span class="line">(main)$ git checkout -b 14  </span><br><span class="line">(14)$  </span><br></pre></td></tr></table></figure>

<p>æœ€å, ä¸º bug #14 æ‰§è¡Œ <code>cherry-pick</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(14)$ git cherry-pick 5ea5173  </span><br></pre></td></tr></table></figure>

<h2 id="æƒ³åˆ é™¤ä¸Šæ¸¸-upstream-åˆ†æ”¯è¢«åˆ é™¤äº†çš„æœ¬åœ°åˆ†æ”¯"><a href="#æƒ³åˆ é™¤ä¸Šæ¸¸-upstream-åˆ†æ”¯è¢«åˆ é™¤äº†çš„æœ¬åœ°åˆ†æ”¯" class="headerlink" title="æƒ³åˆ é™¤ä¸Šæ¸¸(upstream)åˆ†æ”¯è¢«åˆ é™¤äº†çš„æœ¬åœ°åˆ†æ”¯"></a>æƒ³åˆ é™¤ä¸Šæ¸¸(upstream)åˆ†æ”¯è¢«åˆ é™¤äº†çš„æœ¬åœ°åˆ†æ”¯</h2><p>ä¸€æ—¦ä½ åœ¨github ä¸Šé¢åˆå¹¶(merge)äº†ä¸€ä¸ª<code>pull request</code>, ä½ å°±å¯ä»¥åˆ é™¤ä½ forké‡Œè¢«åˆå¹¶çš„åˆ†æ”¯ã€‚å¦‚æœä½ ä¸å‡†å¤‡ç»§ç»­åœ¨è¿™ä¸ªåˆ†æ”¯é‡Œå·¥ä½œ, åˆ é™¤è¿™ä¸ªåˆ†æ”¯çš„æœ¬åœ°æ‹·è´ä¼šæ›´å¹²å‡€ï¼Œä½¿ä½ ä¸ä¼šé™·å…¥å·¥ä½œåˆ†æ”¯å’Œä¸€å †é™ˆæ—§åˆ†æ”¯çš„æ··ä¹±ä¹‹ä¸­ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git fetch -p</span>  </span><br></pre></td></tr></table></figure>

<h3 id="ä¸å°å¿ƒåˆ é™¤äº†æˆ‘çš„åˆ†æ”¯"><a href="#ä¸å°å¿ƒåˆ é™¤äº†æˆ‘çš„åˆ†æ”¯" class="headerlink" title="ä¸å°å¿ƒåˆ é™¤äº†æˆ‘çš„åˆ†æ”¯"></a>ä¸å°å¿ƒåˆ é™¤äº†æˆ‘çš„åˆ†æ”¯</h3><p>å¦‚æœä½ å®šæœŸæ¨é€åˆ°è¿œç¨‹, å¤šæ•°æƒ…å†µä¸‹åº”è¯¥æ˜¯å®‰å…¨çš„ï¼Œä½†æœ‰äº›æ—¶å€™è¿˜æ˜¯å¯èƒ½åˆ é™¤äº†è¿˜æ²¡æœ‰æ¨åˆ°è¿œç¨‹çš„åˆ†æ”¯ã€‚è®©æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåˆ†æ”¯å’Œä¸€ä¸ªæ–°çš„æ–‡ä»¶:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">(main)$ </span><span class="language-bash">git checkout -b my-branch</span>  </span><br><span class="line"><span class="meta prompt_">(my-branch)$ </span><span class="language-bash">git branch</span>  </span><br><span class="line"><span class="meta prompt_">(my-branch)$ </span><span class="language-bash"><span class="built_in">touch</span> foo.txt</span>  </span><br><span class="line"><span class="meta prompt_">(my-branch)$ </span><span class="language-bash"><span class="built_in">ls</span></span>  </span><br><span class="line">README.md foo.txt  </span><br></pre></td></tr></table></figure>

<p>æ·»åŠ æ–‡ä»¶å¹¶åšä¸€æ¬¡æäº¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(my-branch)$ git add .  </span><br><span class="line">(my-branch)$ git commit -m &#x27;foo.txt added&#x27;  </span><br><span class="line">(my-branch)$ foo.txt added  </span><br><span class="line"> 1 files changed, 1 insertions(+)  </span><br><span class="line"> create mode 100644 foo.txt  </span><br><span class="line">(my-branch)$ git log  </span><br><span class="line">  </span><br><span class="line">commit 4e3cd85a670ced7cc17a2b5d8d3d809ac88d5012  </span><br><span class="line">Author: siemiatj &lt;siemiatj@example.com&gt;  </span><br><span class="line">Date:   Wed Jul 30 00:34:10 2014 +0200  </span><br><span class="line">  </span><br><span class="line">    foo.txt added  </span><br><span class="line">  </span><br><span class="line">commit 69204cdf0acbab201619d95ad8295928e7f411d5  </span><br><span class="line">Author: Kate Hudson &lt;katehudson@example.com&gt;  </span><br><span class="line">Date:   Tue Jul 29 13:14:46 2014 -0400  </span><br><span class="line">  </span><br><span class="line">    Fixes #6: Force pushing after amending commits  </span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬åˆ‡å›åˆ°ä¸»(main)åˆ†æ”¯ï¼Œâ€˜ä¸å°å¿ƒçš„â€™åˆ é™¤<code>my-branch</code>åˆ†æ”¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(my-branch)$ git checkout main  </span><br><span class="line">Switched to branch &#x27;main&#x27;  </span><br><span class="line">Your branch is up-to-date with &#x27;origin/main&#x27;.  </span><br><span class="line">(main)$ git branch -D my-branch  </span><br><span class="line">Deleted branch my-branch (was 4e3cd85).  </span><br><span class="line">(main)$ echo oh noes, deleted my branch!  </span><br><span class="line">oh noes, deleted my branch!  </span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™æ—¶å€™ä½ åº”è¯¥æƒ³èµ·äº†<code>reflog</code>, ä¸€ä¸ªå‡çº§ç‰ˆçš„æ—¥å¿—ï¼Œå®ƒå­˜å‚¨äº†ä»“åº“(repo)é‡Œé¢æ‰€æœ‰åŠ¨ä½œçš„å†å²ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git reflog  </span><br><span class="line">69204cd HEAD@&#123;0&#125;: checkout: moving from my-branch to main  </span><br><span class="line">4e3cd85 HEAD@&#123;1&#125;: commit: foo.txt added  </span><br><span class="line">69204cd HEAD@&#123;2&#125;: checkout: moving from main to my-branch  </span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ¥è‡ªåˆ é™¤åˆ†æ”¯çš„æäº¤hash(commit hash)ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æ˜¯å¦èƒ½æ¢å¤åˆ é™¤äº†çš„åˆ†æ”¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git checkout -b my-branch-help  </span><br><span class="line">Switched to a new branch &#x27;my-branch-help&#x27;  </span><br><span class="line">(my-branch-help)$ git reset --hard 4e3cd85  </span><br><span class="line">HEAD is now at 4e3cd85 foo.txt added  </span><br><span class="line">(my-branch-help)$ ls  </span><br><span class="line">README.md foo.txt  </span><br></pre></td></tr></table></figure>

<p>çœ‹! æˆ‘ä»¬æŠŠåˆ é™¤çš„æ–‡ä»¶æ‰¾å›æ¥äº†ã€‚Gitçš„ <code>reflog</code> åœ¨rebasingå‡ºé”™çš„æ—¶å€™ä¹Ÿæ˜¯åŒæ ·æœ‰ç”¨çš„ã€‚</p>
<h3 id="æˆ‘æƒ³åˆ é™¤ä¸€ä¸ªåˆ†æ”¯"><a href="#æˆ‘æƒ³åˆ é™¤ä¸€ä¸ªåˆ†æ”¯" class="headerlink" title="æˆ‘æƒ³åˆ é™¤ä¸€ä¸ªåˆ†æ”¯"></a>æˆ‘æƒ³åˆ é™¤ä¸€ä¸ªåˆ†æ”¯</h3><p>åˆ é™¤ä¸€ä¸ªè¿œç¨‹åˆ†æ”¯:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git push origin --delete my-branch  </span><br></pre></td></tr></table></figure>

<p>ä½ ä¹Ÿå¯ä»¥:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git push origin :my-branch  </span><br></pre></td></tr></table></figure>

<p>åˆ é™¤ä¸€ä¸ªæœ¬åœ°åˆ†æ”¯:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git branch -D my-branch  </span><br></pre></td></tr></table></figure>

<h3 id="æˆ‘æƒ³ä»åˆ«äººæ­£åœ¨å·¥ä½œçš„è¿œç¨‹åˆ†æ”¯ç­¾å‡º-checkout-ä¸€ä¸ªåˆ†æ”¯"><a href="#æˆ‘æƒ³ä»åˆ«äººæ­£åœ¨å·¥ä½œçš„è¿œç¨‹åˆ†æ”¯ç­¾å‡º-checkout-ä¸€ä¸ªåˆ†æ”¯" class="headerlink" title="æˆ‘æƒ³ä»åˆ«äººæ­£åœ¨å·¥ä½œçš„è¿œç¨‹åˆ†æ”¯ç­¾å‡º(checkout)ä¸€ä¸ªåˆ†æ”¯"></a>æˆ‘æƒ³ä»åˆ«äººæ­£åœ¨å·¥ä½œçš„è¿œç¨‹åˆ†æ”¯ç­¾å‡º(checkout)ä¸€ä¸ªåˆ†æ”¯</h3><p>é¦–å…ˆ, ä»è¿œç¨‹æ‹‰å–(fetch) æ‰€æœ‰åˆ†æ”¯:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git fetch --all  </span><br></pre></td></tr></table></figure>

<p>å‡è®¾ä½ æƒ³è¦ä»è¿œç¨‹çš„<code>daves</code>åˆ†æ”¯ç­¾å‡ºåˆ°æœ¬åœ°çš„<code>daves</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git checkout --track origin/daves  </span><br><span class="line">Branch daves set up to track remote branch daves from origin.  </span><br><span class="line">Switched to a new branch &#x27;daves&#x27;  </span><br></pre></td></tr></table></figure>

<p>(<code>--track</code> æ˜¯ <code>git checkout -b [branch] [remotename]/[branch]</code> çš„ç®€å†™)</p>
<p>è¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ª<code>daves</code>åˆ†æ”¯çš„æœ¬åœ°æ‹·è´, ä»»ä½•æ¨è¿‡(pushed)çš„æ›´æ–°ï¼Œè¿œç¨‹éƒ½èƒ½çœ‹åˆ°.</p>
<h2 id="Rebasing-å’Œåˆå¹¶-Merging"><a href="#Rebasing-å’Œåˆå¹¶-Merging" class="headerlink" title="Rebasing å’Œåˆå¹¶(Merging)"></a>Rebasing å’Œåˆå¹¶(Merging)</h2><h3 id="æˆ‘æƒ³æ’¤é”€rebase-merge"><a href="#æˆ‘æƒ³æ’¤é”€rebase-merge" class="headerlink" title="æˆ‘æƒ³æ’¤é”€rebase/merge"></a>æˆ‘æƒ³æ’¤é”€rebase/merge</h3><p>ä½ å¯ä»¥åˆå¹¶(merge)æˆ–rebaseäº†ä¸€ä¸ªé”™è¯¯çš„åˆ†æ”¯, æˆ–è€…å®Œæˆä¸äº†ä¸€ä¸ªè¿›è¡Œä¸­çš„rebase/mergeã€‚Git åœ¨è¿›è¡Œå±é™©æ“ä½œçš„æ—¶å€™ä¼šæŠŠåŸå§‹çš„HEADä¿å­˜åœ¨ä¸€ä¸ªå«ORIG_HEADçš„å˜é‡é‡Œ, æ‰€ä»¥è¦æŠŠåˆ†æ”¯æ¢å¤åˆ°rebase/mergeå‰çš„çŠ¶æ€æ˜¯å¾ˆå®¹æ˜“çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(my-branch)$ git reset --hard ORIG_HEAD  </span><br></pre></td></tr></table></figure>

<h3 id="æˆ‘å·²ç»rebaseè¿‡-ä½†æ˜¯æˆ‘ä¸æƒ³å¼ºæ¨-force-push"><a href="#æˆ‘å·²ç»rebaseè¿‡-ä½†æ˜¯æˆ‘ä¸æƒ³å¼ºæ¨-force-push" class="headerlink" title="æˆ‘å·²ç»rebaseè¿‡, ä½†æ˜¯æˆ‘ä¸æƒ³å¼ºæ¨(force push)"></a>æˆ‘å·²ç»rebaseè¿‡, ä½†æ˜¯æˆ‘ä¸æƒ³å¼ºæ¨(force push)</h3><p>ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœä½ æƒ³æŠŠè¿™äº›å˜åŒ–(changes)ååº”åˆ°è¿œç¨‹åˆ†æ”¯ä¸Šï¼Œä½ å°±å¿…é¡»å¾—å¼ºæ¨(<code>force push</code>)ã€‚æ˜¯å› ä½ å¿«è¿›(<code>Fast forward</code>)äº†æäº¤ï¼Œæ”¹å˜äº†Gitå†å², è¿œç¨‹åˆ†æ”¯ä¸ä¼šæ¥å—å˜åŒ–(changes)ï¼Œé™¤éå¼ºæ¨(force push)ã€‚</p>
<p>è¿™å°±æ˜¯è®¸å¤šäººä½¿ç”¨ merge å·¥ä½œæµ, è€Œä¸æ˜¯ rebasing å·¥ä½œæµçš„ä¸»è¦åŸå› ä¹‹ä¸€ï¼Œ å¼€å‘è€…çš„å¼ºæ¨(force push)ä¼šä½¿å¤§çš„å›¢é˜Ÿé™·å…¥éº»çƒ¦ã€‚ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ï¼Œä¸€ç§å®‰å…¨ä½¿ç”¨ rebase çš„æ–¹æ³•æ˜¯ï¼Œä¸è¦æŠŠä½ çš„å˜åŒ–(changes)åæ˜ åˆ°è¿œç¨‹åˆ†æ”¯ä¸Š, è€Œæ˜¯æŒ‰ä¸‹é¢çš„åš:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git checkout my-branch  </span><br><span class="line">(my-branch)$ git rebase -i main  </span><br><span class="line">(my-branch)$ git checkout main  </span><br><span class="line">(main)$ git merge --ff-only my-branch  </span><br></pre></td></tr></table></figure>

<h3 id="æˆ‘éœ€è¦ç»„åˆ-combine-å‡ ä¸ªæäº¤-commit"><a href="#æˆ‘éœ€è¦ç»„åˆ-combine-å‡ ä¸ªæäº¤-commit" class="headerlink" title="æˆ‘éœ€è¦ç»„åˆ(combine)å‡ ä¸ªæäº¤(commit)"></a>æˆ‘éœ€è¦ç»„åˆ(combine)å‡ ä¸ªæäº¤(commit)</h3><p>å‡è®¾ä½ çš„å·¥ä½œåˆ†æ”¯å°†ä¼šåšå¯¹äº <code>main</code> çš„pull-requestã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä½ ä¸å…³å¿ƒæäº¤(commit)çš„æ—¶é—´æˆ³ï¼Œåªæƒ³ç»„åˆ <strong>æ‰€æœ‰</strong> æäº¤(commit) åˆ°ä¸€ä¸ªå•ç‹¬çš„é‡Œé¢, ç„¶åé‡ç½®(reset)é‡æäº¤(recommit)ã€‚ç¡®ä¿ä¸»(main)åˆ†æ”¯æ˜¯æœ€æ–°çš„å’Œä½ çš„å˜åŒ–éƒ½å·²ç»æäº¤äº†, ç„¶å:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(my-branch)$ git reset --soft main  </span><br><span class="line">(my-branch)$ git commit -am &quot;New awesome feature&quot;  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³è¦æ›´å¤šçš„æ§åˆ¶, æƒ³è¦ä¿ç•™æ—¶é—´æˆ³, ä½ éœ€è¦åšäº¤äº’å¼rebase (interactive rebase):</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(my-branch)$ git rebase -i main  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰ç›¸å¯¹çš„å…¶å®ƒåˆ†æ”¯ï¼Œ ä½ å°†ä¸å¾—ä¸ç›¸å¯¹è‡ªå·±çš„<code>HEAD</code> è¿›è¡Œ rebaseã€‚ä¾‹å¦‚ï¼šä½ æƒ³ç»„åˆæœ€è¿‘çš„ä¸¤æ¬¡æäº¤(commit), ä½ å°†ç›¸å¯¹äº<code>HEAD~2</code> è¿›è¡Œrebaseï¼Œ ç»„åˆæœ€è¿‘3æ¬¡æäº¤(commit), ç›¸å¯¹äº<code>HEAD~3</code>, ç­‰ç­‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git rebase -i HEAD~2  </span><br></pre></td></tr></table></figure>

<p>åœ¨ä½ æ‰§è¡Œäº†äº¤äº’å¼ rebaseçš„å‘½ä»¤(interactive rebase command)å, ä½ å°†åœ¨ä½ çš„ç¼–è¾‘å™¨é‡Œçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pick a9c8a1d Some refactoring  </span><br><span class="line">pick 01b2fd8 New awesome feature  </span><br><span class="line">pick b729ad5 fixup  </span><br><span class="line">pick e3851e8 another fix  </span><br><span class="line">  </span><br><span class="line"># Rebase 8074d12..b729ad5 onto 8074d12  </span><br><span class="line">#  </span><br><span class="line"># Commands:  </span><br><span class="line">#  p, pick = use commit  </span><br><span class="line">#  r, reword = use commit, but edit the commit message  </span><br><span class="line">#  e, edit = use commit, but stop for amending  </span><br><span class="line">#  s, squash = use commit, but meld into previous commit  </span><br><span class="line">#  f, fixup = like &quot;squash&quot;, but discard this commit&#x27;s log message  </span><br><span class="line">#  x, exec = run command (the rest of the line) using shell  </span><br><span class="line">#  </span><br><span class="line"># These lines can be re-ordered; they are executed from top to bottom.  </span><br><span class="line">#  </span><br><span class="line"># If you remove a line here THAT COMMIT WILL BE LOST.  </span><br><span class="line">#  </span><br><span class="line"># However, if you remove everything, the rebase will be aborted.  </span><br><span class="line">#  </span><br><span class="line"># Note that empty commits are commented out  </span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰ä»¥ <code>#</code> å¼€å¤´çš„è¡Œéƒ½æ˜¯æ³¨é‡Š, ä¸ä¼šå½±å“ rebase.</p>
<p>ç„¶åï¼Œä½ å¯ä»¥ç”¨ä»»ä½•ä¸Šé¢å‘½ä»¤åˆ—è¡¨çš„å‘½ä»¤æ›¿æ¢ <code>pick</code>, ä½ ä¹Ÿå¯ä»¥é€šè¿‡åˆ é™¤å¯¹åº”çš„è¡Œæ¥åˆ é™¤ä¸€ä¸ªæäº¤(commit)ã€‚</p>
<p>ä¾‹å¦‚, å¦‚æœä½ æƒ³ <strong>å•ç‹¬ä¿ç•™æœ€æ—§(first)çš„æäº¤(commit),ç»„åˆæ‰€æœ‰å‰©ä¸‹çš„åˆ°ç¬¬äºŒä¸ªé‡Œé¢</strong>, ä½ å°±åº”è¯¥ç¼–è¾‘ç¬¬äºŒä¸ªæäº¤(commit)åé¢çš„æ¯ä¸ªæäº¤(commit) å‰çš„å•è¯ä¸º <code>f</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pick a9c8a1d Some refactoring  </span><br><span class="line">pick 01b2fd8 New awesome feature  </span><br><span class="line">f b729ad5 fixup  </span><br><span class="line">f e3851e8 another fix  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³ç»„åˆè¿™äº›æäº¤(commit) <strong>å¹¶é‡å‘½åè¿™ä¸ªæäº¤(commit)</strong>, ä½ åº”è¯¥åœ¨ç¬¬äºŒä¸ªæäº¤(commit)æ—è¾¹æ·»åŠ ä¸€ä¸ª<code>r</code>ï¼Œæˆ–è€…æ›´ç®€å•çš„ç”¨<code>s</code> æ›¿ä»£ <code>f</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pick a9c8a1d Some refactoring  </span><br><span class="line">pick 01b2fd8 New awesome feature  </span><br><span class="line">s b729ad5 fixup  </span><br><span class="line">s e3851e8 another fix  </span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥åœ¨æ¥ä¸‹æ¥å¼¹å‡ºçš„æ–‡æœ¬æç¤ºæ¡†é‡Œé‡å‘½åæäº¤(commit)ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Newer, awesomer features  </span><br><span class="line">  </span><br><span class="line"># Please enter the commit message for your changes. Lines starting  </span><br><span class="line"># with &#x27;#&#x27; will be ignored, and an empty message aborts the commit.  </span><br><span class="line"># rebase in progress; onto 8074d12  </span><br><span class="line"># You are currently editing a commit while rebasing branch &#x27;main&#x27; on &#x27;8074d12&#x27;.  </span><br><span class="line">#  </span><br><span class="line"># Changes to be committed:  </span><br><span class="line"># modified:   README.md  </span><br><span class="line">#  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆåŠŸäº†, ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ Successfully rebased and updated refs/heads/main.  </span><br></pre></td></tr></table></figure>

<h4 id="å®‰å…¨åˆå¹¶-merging-ç­–ç•¥"><a href="#å®‰å…¨åˆå¹¶-merging-ç­–ç•¥" class="headerlink" title="å®‰å…¨åˆå¹¶(merging)ç­–ç•¥"></a>å®‰å…¨åˆå¹¶(merging)ç­–ç•¥</h4><p><code>--no-commit</code> æ‰§è¡Œåˆå¹¶(merge)ä½†ä¸è‡ªåŠ¨æäº¤, ç»™ç”¨æˆ·åœ¨åšæäº¤å‰æ£€æŸ¥å’Œä¿®æ”¹çš„æœºä¼šã€‚<code>no-ff</code> ä¼šä¸ºç‰¹æ€§åˆ†æ”¯(feature branch)çš„å­˜åœ¨è¿‡ç•™ä¸‹è¯æ®, ä¿æŒé¡¹ç›®å†å²ä¸€è‡´ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git merge --no-ff --no-commit my-branch  </span><br></pre></td></tr></table></figure>

<h4 id="æˆ‘éœ€è¦å°†ä¸€ä¸ªåˆ†æ”¯åˆå¹¶æˆä¸€ä¸ªæäº¤-commit"><a href="#æˆ‘éœ€è¦å°†ä¸€ä¸ªåˆ†æ”¯åˆå¹¶æˆä¸€ä¸ªæäº¤-commit" class="headerlink" title="æˆ‘éœ€è¦å°†ä¸€ä¸ªåˆ†æ”¯åˆå¹¶æˆä¸€ä¸ªæäº¤(commit)"></a>æˆ‘éœ€è¦å°†ä¸€ä¸ªåˆ†æ”¯åˆå¹¶æˆä¸€ä¸ªæäº¤(commit)</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git merge --squash my-branch  </span><br></pre></td></tr></table></figure>

<h4 id="æˆ‘åªæƒ³ç»„åˆ-combine-æœªæ¨çš„æäº¤-unpushed-commit"><a href="#æˆ‘åªæƒ³ç»„åˆ-combine-æœªæ¨çš„æäº¤-unpushed-commit" class="headerlink" title="æˆ‘åªæƒ³ç»„åˆ(combine)æœªæ¨çš„æäº¤(unpushed commit)"></a>æˆ‘åªæƒ³ç»„åˆ(combine)æœªæ¨çš„æäº¤(unpushed commit)</h4><p>æœ‰æ—¶å€™ï¼Œåœ¨å°†æ•°æ®æ¨å‘ä¸Šæ¸¸ä¹‹å‰ï¼Œä½ æœ‰å‡ ä¸ªæ­£åœ¨è¿›è¡Œçš„å·¥ä½œæäº¤(commit)ã€‚è¿™æ—¶å€™ä¸å¸Œæœ›æŠŠå·²ç»æ¨(push)è¿‡çš„ç»„åˆè¿›æ¥ï¼Œå› ä¸ºå…¶ä»–äººå¯èƒ½å·²ç»æœ‰æäº¤(commit)å¼•ç”¨å®ƒä»¬äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git rebase -i @&#123;u&#125;  </span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šäº§ç”Ÿä¸€æ¬¡äº¤äº’å¼çš„rebase(interactive rebase), åªä¼šåˆ—å‡ºæ²¡æœ‰æ¨(push)çš„æäº¤(commit)ï¼Œ åœ¨è¿™ä¸ªåˆ—è¡¨æ—¶è¿›è¡Œreorder/fix/squash éƒ½æ˜¯å®‰å…¨çš„ã€‚</p>
<h3 id="æ£€æŸ¥æ˜¯å¦åˆ†æ”¯ä¸Šçš„æ‰€æœ‰æäº¤-commit-éƒ½åˆå¹¶-merge-è¿‡äº†"><a href="#æ£€æŸ¥æ˜¯å¦åˆ†æ”¯ä¸Šçš„æ‰€æœ‰æäº¤-commit-éƒ½åˆå¹¶-merge-è¿‡äº†" class="headerlink" title="æ£€æŸ¥æ˜¯å¦åˆ†æ”¯ä¸Šçš„æ‰€æœ‰æäº¤(commit)éƒ½åˆå¹¶(merge)è¿‡äº†"></a>æ£€æŸ¥æ˜¯å¦åˆ†æ”¯ä¸Šçš„æ‰€æœ‰æäº¤(commit)éƒ½åˆå¹¶(merge)è¿‡äº†</h3><p>æ£€æŸ¥ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„æ‰€æœ‰æäº¤(commit)æ˜¯å¦éƒ½å·²ç»åˆå¹¶(merge)åˆ°äº†å…¶å®ƒåˆ†æ”¯, ä½ åº”è¯¥åœ¨è¿™äº›åˆ†æ”¯çš„head(æˆ–ä»»ä½• commits)ä¹‹é—´åšä¸€æ¬¡diff:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git log --graph --left-right --cherry-pick --oneline HEAD...feature/120-on-scroll  </span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šå‘Šè¯‰ä½ åœ¨ä¸€ä¸ªåˆ†æ”¯é‡Œæœ‰è€Œå¦ä¸€ä¸ªåˆ†æ”¯æ²¡æœ‰çš„æ‰€æœ‰æäº¤(commit), å’Œåˆ†æ”¯ä¹‹é—´ä¸å…±äº«çš„æäº¤(commit)çš„åˆ—è¡¨ã€‚å¦ä¸€ä¸ªåšæ³•å¯ä»¥æ˜¯:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git log main ^feature/120-on-scroll --no-merges  </span><br></pre></td></tr></table></figure>

<h3 id="äº¤äº’å¼rebase-interactive-rebase-å¯èƒ½å‡ºç°çš„é—®é¢˜"><a href="#äº¤äº’å¼rebase-interactive-rebase-å¯èƒ½å‡ºç°çš„é—®é¢˜" class="headerlink" title="äº¤äº’å¼rebase(interactive rebase)å¯èƒ½å‡ºç°çš„é—®é¢˜"></a>äº¤äº’å¼rebase(interactive rebase)å¯èƒ½å‡ºç°çš„é—®é¢˜</h3><h4 id="è¿™ä¸ªrebase-ç¼–è¾‘å±å¹•å‡ºç°â€™noopâ€™"><a href="#è¿™ä¸ªrebase-ç¼–è¾‘å±å¹•å‡ºç°â€™noopâ€™" class="headerlink" title="è¿™ä¸ªrebase ç¼–è¾‘å±å¹•å‡ºç°â€™noopâ€™"></a>è¿™ä¸ªrebase ç¼–è¾‘å±å¹•å‡ºç°â€™noopâ€™</h4><p>å¦‚æœä½ çœ‹åˆ°çš„æ˜¯è¿™æ ·:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">noop  </span><br></pre></td></tr></table></figure>

<p>è¿™æ„å‘³ç€ä½ rebaseçš„åˆ†æ”¯å’Œå½“å‰åˆ†æ”¯åœ¨åŒä¸€ä¸ªæäº¤(commit)ä¸Š, æˆ–è€… <em>é¢†å…ˆ(ahead)</em> å½“å‰åˆ†æ”¯ã€‚ä½ å¯ä»¥å°è¯•:</p>
<ul>
<li>æ£€æŸ¥ç¡®ä¿ä¸»(main)åˆ†æ”¯æ²¡æœ‰é—®é¢˜</li>
<li>rebase  <code>HEAD~2</code> æˆ–è€…æ›´æ—©</li>
</ul>
<h4 id="æœ‰å†²çªçš„æƒ…å†µ"><a href="#æœ‰å†²çªçš„æƒ…å†µ" class="headerlink" title="æœ‰å†²çªçš„æƒ…å†µ"></a>æœ‰å†²çªçš„æƒ…å†µ</h4><p>å¦‚æœä½ ä¸èƒ½æˆåŠŸçš„å®Œæˆrebase, ä½ å¯èƒ½å¿…é¡»è¦è§£å†³å†²çªã€‚</p>
<p>é¦–å…ˆæ‰§è¡Œ <code>git status</code> æ‰¾å‡ºå“ªäº›æ–‡ä»¶æœ‰å†²çª:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(my-branch)$ git status  </span><br><span class="line">On branch my-branch  </span><br><span class="line">Changes not staged for commit:  </span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)  </span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)  </span><br><span class="line">  </span><br><span class="line"> modified:   README.md  </span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢, <code>README.md</code> æœ‰å†²çªã€‚æ‰“å¼€è¿™ä¸ªæ–‡ä»¶æ‰¾åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD  </span><br><span class="line">  some code  </span><br><span class="line">  =========  </span><br><span class="line">  some code  </span><br><span class="line">  &gt;&gt;&gt;&gt;&gt;&gt;&gt; new-commit</span><br></pre></td></tr></table></figure>

<p>ä½ éœ€è¦è§£å†³æ–°æäº¤çš„ä»£ç (ç¤ºä¾‹é‡Œ, ä»ä¸­é—´<code>==</code>çº¿åˆ°<code>new-commit</code>çš„åœ°æ–¹)ä¸<code>HEAD</code> ä¹‹é—´ä¸ä¸€æ ·çš„åœ°æ–¹.</p>
<p>æœ‰æ—¶å€™è¿™äº›åˆå¹¶éå¸¸å¤æ‚ï¼Œä½ åº”è¯¥ä½¿ç”¨å¯è§†åŒ–çš„å·®å¼‚ç¼–è¾‘å™¨(visual diff editor):</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main*)$ git mergetool -t opendiff  </span><br></pre></td></tr></table></figure>

<p>åœ¨ä½ è§£å†³å®Œæ‰€æœ‰å†²çªå’Œæµ‹è¯•è¿‡å, <code>git add</code> å˜åŒ–äº†çš„(changed)æ–‡ä»¶, ç„¶åç”¨<code>git rebase --continue</code> ç»§ç»­rebaseã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(my-branch)$ git add README.md  </span><br><span class="line">(my-branch)$ git rebase --continue  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨è§£å†³å®Œæ‰€æœ‰çš„å†²çªè¿‡åï¼Œå¾—åˆ°äº†ä¸æäº¤å‰ä¸€æ ·çš„ç»“æœ, å¯ä»¥æ‰§è¡Œ<code>git rebase --skip</code>ã€‚</p>
<p>ä»»ä½•æ—¶å€™ä½ æƒ³ç»“æŸæ•´ä¸ªrebase è¿‡ç¨‹ï¼Œå›æ¥rebaseå‰çš„åˆ†æ”¯çŠ¶æ€, ä½ å¯ä»¥åš:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(my-branch)$ git rebase --abort  </span><br></pre></td></tr></table></figure>

<h2 id="Stash"><a href="#Stash" class="headerlink" title="Stash"></a>Stash</h2><h3 id="æš‚å­˜æ‰€æœ‰æ”¹åŠ¨"><a href="#æš‚å­˜æ‰€æœ‰æ”¹åŠ¨" class="headerlink" title="æš‚å­˜æ‰€æœ‰æ”¹åŠ¨"></a>æš‚å­˜æ‰€æœ‰æ”¹åŠ¨</h3><p>æš‚å­˜ä½ å·¥ä½œç›®å½•ä¸‹çš„æ‰€æœ‰æ”¹åŠ¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash  </span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥ä½¿ç”¨<code>-u</code>æ¥æ’é™¤ä¸€äº›æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash -u  </span><br></pre></td></tr></table></figure>

<h3 id="æš‚å­˜æŒ‡å®šæ–‡ä»¶"><a href="#æš‚å­˜æŒ‡å®šæ–‡ä»¶" class="headerlink" title="æš‚å­˜æŒ‡å®šæ–‡ä»¶"></a>æš‚å­˜æŒ‡å®šæ–‡ä»¶</h3><p>å‡è®¾ä½ åªæƒ³æš‚å­˜æŸä¸€ä¸ªæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash push working-directory-path/filename.ext  </span><br></pre></td></tr></table></figure>

<p>å‡è®¾ä½ æƒ³æš‚å­˜å¤šä¸ªæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash push working-directory-path/filename1.ext working-directory-path/filename2.ext  </span><br></pre></td></tr></table></figure>

<h3 id="æš‚å­˜æ—¶è®°å½•æ¶ˆæ¯"><a href="#æš‚å­˜æ—¶è®°å½•æ¶ˆæ¯" class="headerlink" title="æš‚å­˜æ—¶è®°å½•æ¶ˆæ¯"></a>æš‚å­˜æ—¶è®°å½•æ¶ˆæ¯</h3><p>è¿™æ ·ä½ å¯ä»¥åœ¨<code>list</code>æ—¶çœ‹åˆ°å®ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash save &lt;message&gt;  </span><br></pre></td></tr></table></figure>

<p>æˆ–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash push -m &lt;message&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨æŸä¸ªæŒ‡å®šæš‚å­˜"><a href="#ä½¿ç”¨æŸä¸ªæŒ‡å®šæš‚å­˜" class="headerlink" title="ä½¿ç”¨æŸä¸ªæŒ‡å®šæš‚å­˜"></a>ä½¿ç”¨æŸä¸ªæŒ‡å®šæš‚å­˜</h3><p>é¦–å…ˆä½ å¯ä»¥æŸ¥çœ‹ä½ çš„<code>stash</code>è®°å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash list  </span><br></pre></td></tr></table></figure>

<p>ç„¶åä½ å¯ä»¥<code>apply</code>æŸä¸ª<code>stash</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash apply &quot;stash@&#123;n&#125;&quot;  </span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„ï¼Œ â€˜nâ€™æ˜¯<code>stash</code>åœ¨æ ˆä¸­çš„ä½ç½®ï¼Œæœ€ä¸Šå±‚çš„<code>stash</code>ä¼šæ˜¯0</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ—¶é—´æ ‡è®°(å‡å¦‚ä½ èƒ½è®°å¾—çš„è¯)ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash apply &quot;stash@&#123;2.hours.ago&#125;&quot;  </span><br></pre></td></tr></table></figure>

<h3 id="æš‚å­˜æ—¶ä¿ç•™æœªæš‚å­˜çš„å†…å®¹"><a href="#æš‚å­˜æ—¶ä¿ç•™æœªæš‚å­˜çš„å†…å®¹" class="headerlink" title="æš‚å­˜æ—¶ä¿ç•™æœªæš‚å­˜çš„å†…å®¹"></a>æš‚å­˜æ—¶ä¿ç•™æœªæš‚å­˜çš„å†…å®¹</h3><p>ä½ éœ€è¦æ‰‹åŠ¨createä¸€ä¸ª<code>stash commit</code>ï¼Œ ç„¶åä½¿ç”¨<code>git stash store</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git stash create  </span><br><span class="line">$ git stash store -m &quot;commit-message&quot; CREATED_SHA1  </span><br></pre></td></tr></table></figure>

<h2 id="æ‚é¡¹-Miscellaneous-Objects"><a href="#æ‚é¡¹-Miscellaneous-Objects" class="headerlink" title="æ‚é¡¹(Miscellaneous Objects)"></a>æ‚é¡¹(Miscellaneous Objects)</h2><h3 id="å…‹éš†æ‰€æœ‰å­æ¨¡å—"><a href="#å…‹éš†æ‰€æœ‰å­æ¨¡å—" class="headerlink" title="å…‹éš†æ‰€æœ‰å­æ¨¡å—"></a>å…‹éš†æ‰€æœ‰å­æ¨¡å—</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git clone --recursive git://github.com/foo/bar.git  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœå·²ç»å…‹éš†äº†:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git submodule update --init --recursive  </span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤æ ‡ç­¾-tag"><a href="#åˆ é™¤æ ‡ç­¾-tag" class="headerlink" title="åˆ é™¤æ ‡ç­¾(tag)"></a>åˆ é™¤æ ‡ç­¾(tag)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git tag -d &lt;tag_name&gt;  </span><br><span class="line">$ git push &lt;remote&gt; :refs/tags/&lt;tag_name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="æ¢å¤å·²åˆ é™¤æ ‡ç­¾-tag"><a href="#æ¢å¤å·²åˆ é™¤æ ‡ç­¾-tag" class="headerlink" title="æ¢å¤å·²åˆ é™¤æ ‡ç­¾(tag)"></a>æ¢å¤å·²åˆ é™¤æ ‡ç­¾(tag)</h3><p>å¦‚æœä½ æƒ³æ¢å¤ä¸€ä¸ªå·²åˆ é™¤æ ‡ç­¾(tag), å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤: é¦–å…ˆ, éœ€è¦æ‰¾åˆ°æ— æ³•è®¿é—®çš„æ ‡ç­¾(unreachable tag):</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git fsck --unreachable | grep tag  </span><br></pre></td></tr></table></figure>

<p>è®°ä¸‹è¿™ä¸ªæ ‡ç­¾(tag)çš„hashï¼Œç„¶åç”¨Gitçš„ update-ref</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git update-ref refs/tags/&lt;tag_name&gt; &lt;hash&gt;  </span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶ä½ çš„æ ‡ç­¾(tag)åº”è¯¥å·²ç»æ¢å¤äº†ã€‚</p>
<h3 id="å·²åˆ é™¤è¡¥ä¸-patch"><a href="#å·²åˆ é™¤è¡¥ä¸-patch" class="headerlink" title="å·²åˆ é™¤è¡¥ä¸(patch)"></a>å·²åˆ é™¤è¡¥ä¸(patch)</h3><p>å¦‚æœæŸäººåœ¨ GitHub ä¸Šç»™ä½ å‘äº†ä¸€ä¸ª<code>pull request</code>, ä½†æ˜¯ç„¶åä»–åˆ é™¤äº†ä»–è‡ªå·±çš„åŸå§‹ fork, ä½ å°†æ²¡æ³•å…‹éš†ä»–ä»¬çš„æäº¤(commit)æˆ–ä½¿ç”¨ <code>git am</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, æœ€å¥½æ‰‹åŠ¨çš„æŸ¥çœ‹ä»–ä»¬çš„æäº¤(commit)ï¼Œå¹¶æŠŠå®ƒä»¬æ‹·è´åˆ°ä¸€ä¸ªæœ¬åœ°æ–°åˆ†æ”¯ï¼Œç„¶ååšæäº¤ã€‚</p>
<p>åšå®Œæäº¤å, å†ä¿®æ”¹ä½œè€…ï¼Œå‚è§å˜æ›´ä½œè€…ã€‚ç„¶å, åº”ç”¨å˜åŒ–, å†å‘èµ·ä¸€ä¸ªæ–°çš„<code>pull request</code>ã€‚</p>
<h2 id="è·Ÿè¸ªæ–‡ä»¶-Tracking-Files"><a href="#è·Ÿè¸ªæ–‡ä»¶-Tracking-Files" class="headerlink" title="è·Ÿè¸ªæ–‡ä»¶(Tracking Files)"></a>è·Ÿè¸ªæ–‡ä»¶(Tracking Files)</h2><h3 id="æˆ‘åªæƒ³æ”¹å˜ä¸€ä¸ªæ–‡ä»¶åå­—çš„å¤§å°å†™ï¼Œè€Œä¸ä¿®æ”¹å†…å®¹"><a href="#æˆ‘åªæƒ³æ”¹å˜ä¸€ä¸ªæ–‡ä»¶åå­—çš„å¤§å°å†™ï¼Œè€Œä¸ä¿®æ”¹å†…å®¹" class="headerlink" title="æˆ‘åªæƒ³æ”¹å˜ä¸€ä¸ªæ–‡ä»¶åå­—çš„å¤§å°å†™ï¼Œè€Œä¸ä¿®æ”¹å†…å®¹"></a>æˆ‘åªæƒ³æ”¹å˜ä¸€ä¸ªæ–‡ä»¶åå­—çš„å¤§å°å†™ï¼Œè€Œä¸ä¿®æ”¹å†…å®¹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git mv --force myfile MyFile  </span><br></pre></td></tr></table></figure>

<h3 id="æˆ‘æƒ³ä»Gitåˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†ä¿ç•™è¯¥æ–‡ä»¶"><a href="#æˆ‘æƒ³ä»Gitåˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†ä¿ç•™è¯¥æ–‡ä»¶" class="headerlink" title="æˆ‘æƒ³ä»Gitåˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†ä¿ç•™è¯¥æ–‡ä»¶"></a>æˆ‘æƒ³ä»Gitåˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†ä¿ç•™è¯¥æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git rm --cached log.txt  </span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®-Configuration"><a href="#é…ç½®-Configuration" class="headerlink" title="é…ç½®(Configuration)"></a>é…ç½®(Configuration)</h2><h3 id="æˆ‘æƒ³ç»™ä¸€äº›Gitå‘½ä»¤æ·»åŠ åˆ«å-alias"><a href="#æˆ‘æƒ³ç»™ä¸€äº›Gitå‘½ä»¤æ·»åŠ åˆ«å-alias" class="headerlink" title="æˆ‘æƒ³ç»™ä¸€äº›Gitå‘½ä»¤æ·»åŠ åˆ«å(alias)"></a>æˆ‘æƒ³ç»™ä¸€äº›Gitå‘½ä»¤æ·»åŠ åˆ«å(alias)</h3><p>åœ¨ OS X å’Œ Linux ä¸‹, ä½ çš„ Gitçš„é…ç½®æ–‡ä»¶å‚¨å­˜åœ¨ <code>~/.gitconfig</code>ã€‚æˆ‘åœ¨<code>[alias]</code> éƒ¨åˆ†æ·»åŠ äº†ä¸€äº›å¿«æ·åˆ«å(å’Œä¸€äº›æˆ‘å®¹æ˜“æ‹¼å†™é”™è¯¯çš„)ï¼Œå¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[alias]  </span><br><span class="line">    a = add  </span><br><span class="line">    amend = commit --amend  </span><br><span class="line">    c = commit  </span><br><span class="line">    ca = commit --amend  </span><br><span class="line">    ci = commit -a  </span><br><span class="line">    co = checkout  </span><br><span class="line">    d = diff  </span><br><span class="line">    dc = diff --changed  </span><br><span class="line">    ds = diff --staged  </span><br><span class="line">    f = fetch  </span><br><span class="line">    loll = log --graph --decorate --pretty=oneline --abbrev-commit  </span><br><span class="line">    m = merge  </span><br><span class="line">    one = log --pretty=oneline  </span><br><span class="line">    outstanding = rebase -i @&#123;u&#125;  </span><br><span class="line">    s = status  </span><br><span class="line">    unpushed = log @&#123;u&#125;  </span><br><span class="line">    wc = whatchanged  </span><br><span class="line">    wip = rebase -i @&#123;u&#125;  </span><br><span class="line">    zap = fetch -p  </span><br></pre></td></tr></table></figure>

<h3 id="æˆ‘æƒ³ç¼“å­˜ä¸€ä¸ªä»“åº“-repository-çš„ç”¨æˆ·åå’Œå¯†ç "><a href="#æˆ‘æƒ³ç¼“å­˜ä¸€ä¸ªä»“åº“-repository-çš„ç”¨æˆ·åå’Œå¯†ç " class="headerlink" title="æˆ‘æƒ³ç¼“å­˜ä¸€ä¸ªä»“åº“(repository)çš„ç”¨æˆ·åå’Œå¯†ç "></a>æˆ‘æƒ³ç¼“å­˜ä¸€ä¸ªä»“åº“(repository)çš„ç”¨æˆ·åå’Œå¯†ç </h3><p>ä½ å¯èƒ½æœ‰ä¸€ä¸ªä»“åº“éœ€è¦æˆæƒï¼Œè¿™æ—¶ä½ å¯ä»¥ç¼“å­˜ç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œä¸ç”¨æ¯æ¬¡æ¨/æ‹‰(push/pull)çš„æ—¶å€™éƒ½è¾“å…¥ï¼ŒCredential helperèƒ½å¸®ä½ ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git config --global credential.helper cache  </span><br><span class="line"># Set git to use the credential memory cache  </span><br><span class="line">$ git config --global credential.helper &#x27;cache --timeout=3600&#x27;  </span><br><span class="line"># Set the cache to timeout after 1 hour (setting is in seconds)  </span><br></pre></td></tr></table></figure>

<h3 id="æˆ‘ä¸çŸ¥é“æˆ‘åšé”™äº†äº›ä»€ä¹ˆ"><a href="#æˆ‘ä¸çŸ¥é“æˆ‘åšé”™äº†äº›ä»€ä¹ˆ" class="headerlink" title="æˆ‘ä¸çŸ¥é“æˆ‘åšé”™äº†äº›ä»€ä¹ˆ"></a>æˆ‘ä¸çŸ¥é“æˆ‘åšé”™äº†äº›ä»€ä¹ˆ</h3><p>ä½ æŠŠäº‹æƒ…æç ¸äº†ï¼šä½  <code>é‡ç½®(reset)</code> äº†ä¸€äº›ä¸œè¥¿, æˆ–è€…ä½ åˆå¹¶äº†é”™è¯¯çš„åˆ†æ”¯, äº¦æˆ–ä½ å¼ºæ¨äº†åæ‰¾ä¸åˆ°ä½ è‡ªå·±çš„æäº¤(commit)äº†ã€‚æœ‰äº›æ—¶å€™, ä½ ä¸€ç›´éƒ½åšå¾—å¾ˆå¥½, ä½†ä½ æƒ³å›åˆ°ä»¥å‰çš„æŸä¸ªçŠ¶æ€ã€‚</p>
<p>è¿™å°±æ˜¯ <code>git reflog</code> çš„ç›®çš„ï¼Œ <code>reflog</code> è®°å½•å¯¹åˆ†æ”¯é¡¶ç«¯(the tip of a branch)çš„ä»»ä½•æ”¹å˜, å³ä½¿é‚£ä¸ªé¡¶ç«¯æ²¡æœ‰è¢«ä»»ä½•åˆ†æ”¯æˆ–æ ‡ç­¾å¼•ç”¨ã€‚åŸºæœ¬ä¸Š, æ¯æ¬¡HEADçš„æ”¹å˜, ä¸€æ¡æ–°çš„è®°å½•å°±ä¼šå¢åŠ åˆ°<code>reflog</code>ã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™åªå¯¹æœ¬åœ°åˆ†æ”¯èµ·ä½œç”¨ï¼Œä¸”å®ƒåªè·Ÿè¸ªåŠ¨ä½œ (ä¾‹å¦‚ï¼Œä¸ä¼šè·Ÿè¸ªä¸€ä¸ªæ²¡æœ‰è¢«è®°å½•çš„æ–‡ä»¶çš„ä»»ä½•æ”¹å˜)ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(main)$ git reflog  </span><br><span class="line">0a2e358 HEAD@&#123;0&#125;: reset: moving to HEAD~2  </span><br><span class="line">0254ea7 HEAD@&#123;1&#125;: checkout: moving from 2.2 to main  </span><br><span class="line">c10f740 HEAD@&#123;2&#125;: checkout: moving from main to 2.2  </span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„reflogå±•ç¤ºäº†ä»mainåˆ†æ”¯ç­¾å‡º(checkout)åˆ°2.2 åˆ†æ”¯ï¼Œç„¶åå†ç­¾å›ã€‚é‚£é‡Œï¼Œè¿˜æœ‰ä¸€ä¸ªç¡¬é‡ç½®(hard reset)åˆ°ä¸€ä¸ªè¾ƒæ—§çš„æäº¤ã€‚æœ€æ–°çš„åŠ¨ä½œå‡ºç°åœ¨æœ€ä¸Šé¢ä»¥ <code>HEAD@&#123;0&#125;</code>æ ‡è¯†.</p>
<p>å¦‚æœäº‹å®è¯æ˜ä½ ä¸å°å¿ƒå›ç§»(move back)äº†æäº¤(commit), reflog ä¼šåŒ…å«ä½ ä¸å°å¿ƒå›ç§»å‰mainä¸ŠæŒ‡å‘çš„æäº¤(0254ea7)ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git reset --hard 0254ea7  </span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨<code>git reset</code>å°±å¯ä»¥æŠŠmainæ”¹å›åˆ°ä¹‹å‰çš„commitï¼Œè¿™æä¾›äº†ä¸€ä¸ªåœ¨å†å²è¢«æ„å¤–æ›´æ”¹æƒ…å†µä¸‹çš„å®‰å…¨ç½‘ã€‚</p>
]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>WebSocket åŸç†åŠç®€å•åº”ç”¨</title>
    <url>/2022/03/18/WebSocket/</url>
    <content><![CDATA[<h1 id="WebSocket-ç®€ä»‹"><a href="#WebSocket-ç®€ä»‹" class="headerlink" title="WebSocket ç®€ä»‹"></a>WebSocket ç®€ä»‹</h1><p><code>Websocket å®šä¹‰</code>  <a href="https://link.juejin.cn/?target=https://tools.ietf.org/html/rfc6455">å‚è€ƒè§„èŒƒ rfc6455</a></p>
<p><strong>è§„èŒƒè§£é‡Š</strong> <code>Websocket</code> æ˜¯ä¸€ç§æä¾›å®¢æˆ·ç«¯(æä¾›ä¸å¯é ç§˜é’¥)ä¸æœåŠ¡ç«¯(æ ¡éªŒé€šè¿‡è¯¥ç§˜é’¥)è¿›è¡Œ<strong>åŒå‘é€šä¿¡</strong>çš„åè®®ã€‚</p>
<p>åœ¨æ²¡æœ‰<code>websocket</code>åè®®ä¹‹å‰ï¼Œè¦æä¾›å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å®æ—¶<strong>åŒå‘æ¨é€</strong>æ¶ˆæ¯ï¼Œå°±ä¼šä½¿ç”¨<code>polling</code>æŠ€æœ¯ï¼Œå®¢æˆ·ç«¯é€šè¿‡<code>xhr</code>æˆ–<code>jsonp</code> <strong>å‘é€</strong>æ¶ˆæ¯ç»™æœåŠ¡ç«¯ï¼Œå¹¶é€šè¿‡äº‹ä»¶å›è°ƒæ¥<strong>æ¥æ”¶</strong>æœåŠ¡ç«¯æ¶ˆæ¯ã€‚</p>
<p>è¿™ç§æŠ€æœ¯è™½ç„¶ä¹Ÿèƒ½ä¿è¯åŒå‘é€šä¿¡ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªä¸å¯é¿å…çš„é—®é¢˜ï¼Œå°±æ˜¯<strong>æ€§èƒ½é—®é¢˜</strong>ã€‚å®¢æˆ·ç«¯ä¸æ–­å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å¹¶å‘æ•°è¿‡å¤§ï¼Œæ— ç–‘å¯¼è‡´æœåŠ¡ç«¯å‹åŠ›å‰§å¢ã€‚å› æ­¤ï¼Œ<code>websocket</code>å°±æ˜¯è§£å†³è¿™ä¸€ç—›ç‚¹è€Œè¯ç”Ÿçš„ã€‚</p>
<span id="more"></span>

<p>è¿™é‡Œå†å»¶ä¼¸ä¸€äº›åè¯:</p>
<ul>
<li><strong>é•¿è½®è¯¢</strong> å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€<code>xhr</code>è¯·æ±‚,æœåŠ¡ç«¯æ¥æ”¶å¹¶<code>hold</code>è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯<code>push</code>åˆ°å®¢æˆ·ç«¯ï¼Œæ‰ä¼šä¸»åŠ¨æ–­å¼€è¯¥è¿æ¥ã€‚ç„¶åï¼Œå®¢æˆ·ç«¯å¤„ç†è¯¥<code>response</code>åå†å‘æœåŠ¡ç«¯å‘èµ·æ–°çš„è¯·æ±‚ã€‚ä»¥æ­¤ç±»æ¨ã€‚</li>
</ul>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP1.1`é»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œä½¿ç”¨é•¿è¿æ¥çš„`HTTP`åè®®ï¼Œä¼šåœ¨å“åº”å¤´ä¸­åŠ å…¥ä¸‹é¢è¿™è¡Œä¿¡æ¯: `Connection:keep-alive</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><strong>çŸ­è½®è¯¢</strong>:</li>
</ul>
<p>å®¢æˆ·ç«¯ä¸ç®¡æ˜¯å¦æ”¶åˆ°æœåŠ¡ç«¯çš„<code>response</code>æ•°æ®ï¼Œéƒ½ä¼šå®šæ—¶æƒ³æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰æ•°æ®æ›´æ–°ã€‚</p>
<ul>
<li><strong>é•¿è¿æ¥</strong> æŒ‡åœ¨ä¸€ä¸ª<code>TCP</code>è¿æ¥ä¸Šå¯ä»¥å‘é€å¤šä¸ªæ•°æ®åŒ…ï¼Œåœ¨<code>TCP</code>è¿æ¥ä¿æŒæœŸé—´ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®åŒ…å‘é€ï¼Œåˆ™åŒæ–¹å°±éœ€è¦å‘é€<code>å¿ƒè·³åŒ…</code>æ¥ç»´æŒæ­¤è¿æ¥ã€‚</li>
</ul>
<blockquote>
<p>è¿æ¥è¿‡ç¨‹: å»ºç«‹è¿æ¥â€”â€”æ•°æ®ä¼ è¾“â€”â€”â€¦â€”â€”(å‘é€å¿ƒè·³åŒ…ï¼Œç»´æŒè¿æ¥)â€”â€”â€¦â€”â€”æ•°æ®ä¼ è¾“â€”â€”å…³é—­è¿æ¥</p>
</blockquote>
<ul>
<li><strong>çŸ­è¿æ¥</strong> æŒ‡é€šä¿¡åŒæ–¹æœ‰æ•°æ®äº¤äº’æ—¶ï¼Œå»ºç«‹ä¸€ä¸ª<code>TCP</code>è¿æ¥ï¼Œæ•°æ®å‘é€å®Œæˆä¹‹åï¼Œåˆ™æ–­å¼€æ­¤è¿æ¥ã€‚</li>
</ul>
<blockquote>
<p>è¿æ¥è¿‡ç¨‹: å»ºç«‹è¿æ¥â€”â€”æ•°æ®ä¼ è¾“â€”â€”æ–­å¼€è¿æ¥â€”â€”â€¦â€”â€”å»ºç«‹è¿æ¥â€”â€”æ•°æ®ä¼ è¾“â€”â€”æ–­å¼€è¿æ¥</p>
</blockquote>
<p><strong>Tips</strong></p>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸€ä¸ª<strong>è¯¯è§£</strong>ï¼Œé•¿è¿æ¥å’ŒçŸ­è¿æ¥çš„æ¦‚å¿µæœ¬è´¨ä¸ŠæŒ‡çš„æ˜¯ä¼ è¾“å±‚çš„<code>TCP</code>è¿æ¥ï¼Œå› ä¸º<code>HTTP1.1</code>åè®®ä»¥åï¼Œè¿æ¥é»˜è®¤éƒ½æ˜¯é•¿è¿æ¥ã€‚æ²¡æœ‰çŸ­è¿æ¥è¯´æ³•(<code>HTTP1.0</code>é»˜è®¤ä½¿ç”¨çŸ­è¿æ¥)ï¼Œç½‘ä¸Šå¤§å¤šæ•°æŒ‡çš„é•¿çŸ­è¿æ¥å®è´¨ä¸Šè¯´çš„å°±æ˜¯<code>TCP</code>è¿æ¥ã€‚ <code>http</code>ä½¿ç”¨é•¿è¿æ¥çš„å¥½å¤„: å½“æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªç½‘é¡µèµ„æºçš„æ—¶å€™ï¼Œä¼šå¸¦æœ‰å¾ˆå¤š<code>js</code>ã€<code>css</code>ç­‰èµ„æºæ–‡ä»¶ï¼Œå¦‚æœä½¿ç”¨çš„æ—¶çŸ­è¿æ¥çš„è¯ï¼Œå°±ä¼šæ‰“å¼€å¾ˆå¤š<code>tcp</code>è¿æ¥ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚æ•°è¿‡å¤§ï¼Œå¯¼è‡´<code>tcp</code>è¿æ¥æ•°é‡è¿‡å¤šï¼Œå¯¹æœåŠ¡ç«¯é€ æˆå‹åŠ›ä¹Ÿå°±å¯æƒ³è€ŒçŸ¥äº†ã€‚</p>
</blockquote>
<ul>
<li><strong>å•å·¥</strong> æ•°æ®ä¼ è¾“çš„æ–¹å‘å”¯ä¸€ï¼Œåªèƒ½ç”±å‘é€æ–¹å‘æ¥æ”¶æ–¹çš„å•ä¸€å›ºå®šæ–¹å‘ä¼ è¾“æ•°æ®ã€‚</li>
<li><strong>åŠåŒå·¥</strong> å³é€šä¿¡åŒæ–¹æ—¢æ˜¯æ¥æ”¶æ–¹ä¹Ÿæ˜¯å‘é€æ–¹ï¼Œä¸è¿‡ï¼Œåœ¨æŸä¸€æ—¶åˆ»åªèƒ½å…è®¸å‘ä¸€ä¸ªæ–¹å‘ä¼ è¾“æ•°æ®ã€‚</li>
<li><strong>å…¨åŒå·¥</strong>: å³é€šä¿¡åŒæ–¹æ—¢æ˜¯æ¥æ”¶æ–¹ä¹Ÿæ˜¯å‘é€æ–¹ï¼Œä¸¤ç«¯è®¾å¤‡å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</li>
</ul>
<p><strong>Tips</strong></p>
<blockquote>
<p><strong>å•å·¥</strong>ã€<strong>åŠåŒå·¥</strong>å’Œ<strong>å…¨åŒå·¥</strong> è¿™ä¸‰è€…éƒ½æ˜¯å»ºç«‹åœ¨    <code>TCP</code>åè®®(ä¼ è¾“å±‚ä¸Š)çš„æ¦‚å¿µï¼Œä¸è¦ä¸åº”ç”¨å±‚è¿›è¡Œæ··æ·†ã€‚</p>
</blockquote>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ul>
<li>æ”¯æŒæµè§ˆå™¨/Nodejsç¯å¢ƒ</li>
<li>æ”¯æŒåŒå‘é€šä¿¡</li>
<li>APIç®€å•æ˜“ç”¨</li>
<li>æ”¯æŒäºŒè¿›åˆ¶ä¼ è¾“</li>
<li>å‡å°‘ä¼ è¾“æ•°æ®é‡</li>
</ul>
<h2 id="å»ºç«‹è¿æ¥è¿‡ç¨‹"><a href="#å»ºç«‹è¿æ¥è¿‡ç¨‹" class="headerlink" title="å»ºç«‹è¿æ¥è¿‡ç¨‹"></a>å»ºç«‹è¿æ¥è¿‡ç¨‹</h2><p><code>Websocket</code>å¤ç”¨äº†<code>HTTP</code>çš„æ¡æ‰‹é€šé“ã€‚æŒ‡çš„æ˜¯ï¼Œå®¢æˆ·ç«¯å‘é€<code>HTTP</code>è¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚å¤´ä¸­å¸¦ä¸Š<code>Connection: Upgrade</code> ã€<code>Upgrade: websocket</code>ï¼ŒæœåŠ¡ç«¯è¯†åˆ«è¯¥headerä¹‹åï¼Œè¿›è¡Œåè®®å‡çº§ï¼Œä½¿ç”¨<code>Websocket</code>åè®®è¿›è¡Œæ•°æ®é€šä¿¡ã€‚</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/6/169f1656159c8519~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h3><ul>
<li><code>Request URL</code> è¯·æ±‚æœåŠ¡ç«¯åœ°å€</li>
<li><code>Request Method</code> è¯·æ±‚æ–¹å¼ (æ”¯æŒget/post/option)</li>
<li><code>Status Code</code> 101 Switching Protocols</li>
</ul>
<p><a href="https://link.juejin.cn/?target=https://tools.ietf.org/html/rfc7231%23section-6.2.2">RFC 7231 è§„èŒƒå®šä¹‰</a></p>
<blockquote>
<p>è§„èŒƒè§£é‡Š: å½“æ”¶åˆ°101è¯·æ±‚çŠ¶æ€ç æ—¶ï¼Œè¡¨æ˜æœåŠ¡ç«¯ç†è§£å¹¶åŒæ„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ›´æ”¹<code>Upgrade</code> headerå­—æ®µã€‚æœåŠ¡ç«¯ä¹Ÿå¿…é¡»åœ¨<code>response</code>ä¸­ï¼Œç”Ÿæˆå¯¹åº”çš„<code>Upgrade</code>å€¼ã€‚</p>
</blockquote>
<ul>
<li><code>Connection</code> è®¾ç½®<code>upgrade</code> header,é€šçŸ¥æœåŠ¡ç«¯ï¼Œè¯¥<code>request</code>ç±»å‹éœ€è¦è¿›è¡Œå‡çº§ä¸º<code>websocket</code>ã€‚ <a href="https://link.juejin.cn/?target=https://developer.mozilla.org/en-US/docs/Web/HTTP/Protocol_upgrade_mechanism">upgrade_mechanism è§„èŒƒ</a></li>
<li><code>Host</code> æœåŠ¡ç«¯ hostname</li>
<li><code>Origin</code> å®¢æˆ·ç«¯ hostname:port</li>
<li><code>Sec-WebSocket-Extensions</code> å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚æ‰©å±•åˆ—è¡¨(list)ï¼Œä¾›æœåŠ¡ç«¯é€‰æ‹©å¹¶åœ¨å“åº”ä¸­è¿”å›</li>
<li><code>Sec-WebSocket-Key</code> ç§˜é’¥çš„å€¼æ˜¯é€šè¿‡è§„èŒƒä¸­å®šä¹‰çš„ç®—æ³•è¿›è¡Œè®¡ç®—å¾—å‡ºï¼Œå› æ­¤æ˜¯ä¸å®‰å…¨çš„ï¼Œä½†æ˜¯å¯ä»¥é˜»æ­¢ä¸€äº›è¯¯æ“ä½œçš„websocketè¯·æ±‚ã€‚</li>
<li><code>Sec-WebSocket-Accept</code> è®¡ç®—å…¬å¼:       1. è·å–å®¢æˆ·ç«¯è¯·æ±‚headerçš„å€¼: <code>Sec-WebSocket-Key</code> 2. ä½¿ç”¨é­”æ•°magic = â€˜258EAFA5-E914-47DA-95CA-C5AB0DC85B11â€™ 3. é€šè¿‡<code>SHA1</code>è¿›è¡ŒåŠ å¯†è®¡ç®—, sha1(Sec-WebSocket-Key + magic) 4. å°†å€¼è½¬æ¢ä¸ºbase64</li>
<li><code>Sec-WebSocket-Protocol</code>  æŒ‡å®šæœ‰é™ä½¿ç”¨çš„Websocketåè®®ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªåè®®åˆ—è¡¨(list)ã€‚æœåŠ¡ç«¯åœ¨<code>response</code>ä¸­è¿”å›åˆ—è¡¨ä¸­æ”¯æŒçš„ç¬¬ä¸€ä¸ªå€¼ã€‚</li>
<li><code>Sec-WebSocket-Version</code>  æŒ‡å®šé€šä¿¡æ—¶ä½¿ç”¨çš„Websocketåè®®ç‰ˆæœ¬ã€‚æœ€æ–°ç‰ˆæœ¬:13,<a href="https://link.juejin.cn/?target=https://www.iana.org/assignments/websocket/websocket.xml%23version-number">å†å²ç‰ˆæœ¬</a></li>
<li><code>Upgrade</code> é€šçŸ¥æœåŠ¡ç«¯ï¼ŒæŒ‡å®šå‡çº§åè®®ç±»å‹ä¸º<code>websocket</code></li>
</ul>
<h3 id="æ•°æ®å¸§æ ¼å¼"><a href="#æ•°æ®å¸§æ ¼å¼" class="headerlink" title="æ•°æ®å¸§æ ¼å¼"></a>æ•°æ®å¸§æ ¼å¼</h3><p>æ•°æ®æ ¼å¼å®šä¹‰å‚è€ƒï¼š<a href="https://link.juejin.cn/?target=https://tools.ietf.org/html/rfc6455%23section-5.2">è§„èŒƒ RFC6455</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  0                   1                   2                   3</span><br><span class="line">  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line"> +-+-+-+-+-------+-+-------------+-------------------------------+</span><br><span class="line"> |F|R|R|R| opcode|M| Payload len |    Extended payload length    |</span><br><span class="line"> |I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |</span><br><span class="line"> |N|V|V|V|       |S|             |   (if payload len==126/127)   |</span><br><span class="line"> | |1|2|3|       |K|             |                               |</span><br><span class="line"> +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</span><br><span class="line"> |     Extended payload length continued, if payload len == 127  |</span><br><span class="line"> + - - - - - - - - - - - - - - - +-------------------------------+</span><br><span class="line"> |                               |Masking-key, if MASK set to 1  |</span><br><span class="line"> +-------------------------------+-------------------------------+</span><br><span class="line"> | Masking-key (continued)       |          Payload Data         |</span><br><span class="line"> +-------------------------------- - - - - - - - - - - - - - - - +</span><br><span class="line"> :                     Payload Data continued ...                :</span><br><span class="line"> + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line"> |                     Payload Data continued ...                |</span><br><span class="line"> +---------------------------------------------------------------+</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<ul>
<li><code>FIN</code>: 1 bit å¦‚æœè¯¥ä½å€¼ä¸º1ï¼Œè¡¨ç¤ºè¿™æ˜¯<code>message</code>çš„æœ€ç»ˆç‰‡æ®µ(<code>fragment</code>)ï¼Œå¦‚æœä¸º0ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª<code>message</code>çš„ç¬¬ä¸€ä¸ªç‰‡æ®µã€‚</li>
<li><code>RSV1, RSV2, RSV3</code>: å„å 1 bit ä¸€èˆ¬é»˜è®¤å€¼æ˜¯0ï¼Œé™¤éåå•†æ‰©å±•ï¼Œä¸ºéé›¶å€¼è¿›è¡Œå®šä¹‰ï¼Œå¦åˆ™æ”¶åˆ°éé›¶å€¼ï¼Œå¹¶ä¸”æ²¡æœ‰è¿›è¡Œåå•†æ‰©å±•å®šä¹‰ï¼Œåˆ™<code>websocket</code>è¿æ¥å¤±è´¥ã€‚</li>
<li><code>Opcode</code>: 4 bits æ ¹æ®æ“ä½œç (<code>Opcode</code>),è§£ææœ‰æ•ˆè½½è·æ•°æ®(<code>Payload data</code>).å¦‚æœæ¥å—åˆ°æœªå®šä¹‰æ“ä½œç ï¼Œåˆ™åº”è¯¥æ–­å¼€<code>websocket</code>è¿æ¥ã€‚</li>
<li><code>Mask</code>: 1 bit å®šä¹‰æ˜¯å¦éœ€è¦çš„è½½è·æ•°æ®(``Payload data)ï¼Œè¿›è¡Œæ©ç æ“ä½œã€‚å¦‚æœè®¾ç½®å€¼ä¸º1ï¼Œé‚£ä¹ˆåœ¨<code>Masking-key</code>ä¸­ä¼šå®šä¹‰ä¸€ä¸ªæ©ç key,å¹¶ç”¨è¿™ä¸ªkeyå¯¹è½½è·æ•°æ®è¿›è¡Œåæ©ç (<code>unmask</code>)æ“ä½œã€‚æ‰€æœ‰ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡ç«¯çš„æ•°æ®å¸§(<code>frame</code>),maskéƒ½è¢«è®¾ç½®ä¸º1.</li>
<li><code>Payload length</code>: 7 bits, 7+16 bits, or 7+64 bits è½½è·æ•°æ®çš„é•¿åº¦ã€‚</li>
<li><code>Masking-key</code>: 0 or 4 bytes æ‰€æœ‰ä»å®¢æˆ·ç«¯ä¼ é€åˆ°æœåŠ¡ç«¯çš„æ•°æ®å¸§ï¼Œæ•°æ®è½½è·éƒ½è¿›è¡Œäº†æ©ç æ“ä½œï¼ŒMaskä¸º1ï¼Œä¸”æºå¸¦äº†4å­—èŠ‚çš„Masking-keyã€‚å¦‚æœMaskä¸º0ï¼Œåˆ™æ²¡æœ‰Masking-keyã€‚</li>
<li><code>Payload data</code>:  (x+y) bytes</li>
</ul>
<h2 id="å¿ƒè·³æ£€æµ‹"><a href="#å¿ƒè·³æ£€æµ‹" class="headerlink" title="å¿ƒè·³æ£€æµ‹"></a>å¿ƒè·³æ£€æµ‹</h2><p>ä¸ºäº†ç¡®ä¿å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„é•¿è¿æ¥æ­£å¸¸ï¼Œæœ‰æ—¶å³ä½¿å®¢æˆ·ç«¯è¿æ¥ä¸­æ–­ï¼Œä½†æ˜¯æœåŠ¡ç«¯æœªè§¦å‘<code>onclose</code>äº‹ä»¶ï¼Œè¿™å°±æœ‰å¯èƒ½å¯¼è‡´æ— æ•ˆè¿æ¥å ç”¨ã€‚æ‰€ä»¥éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œç¡®ä¿ä¸¤ç«¯çš„è¿æ¥å¤„äºæ­£å¸¸çŠ¶æ€ï¼Œ<strong>å¿ƒè·³æ£€æµ‹</strong>å°±æ˜¯è¿™ç§æœºåˆ¶ã€‚å®¢æˆ·ç«¯æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œä¼šå‘æœåŠ¡ç«¯å‘é€<strong>å¿ƒè·³</strong>(æ•°æ®åŒ…)ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šè¿”å›<code>response</code>è¿›è¡Œåé¦ˆè¿æ¥æ­£å¸¸ã€‚</p>
<h1 id="WebSocket-ä¼˜ç‚¹"><a href="#WebSocket-ä¼˜ç‚¹" class="headerlink" title="WebSocket ä¼˜ç‚¹"></a>WebSocket ä¼˜ç‚¹</h1><p>æ¯”èµ·ä¼ ç»Ÿçš„è½®è¯¢æ–¹å¼ï¼ŒWebSocket å¯ä»¥æ›´å¥½çš„èŠ‚çœæœåŠ¡å™¨èµ„æºå’Œå¸¦å®½ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¿›è¡Œæ›´åŠ å®æ—¶åœ°é€šè®¯ï¼Œä¼˜åŠ¿å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å‡å°å¸¦å®½å¼€é”€</strong>ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åœ¨è¿æ¥å»ºç«‹åï¼Œç›¸æ¯”èµ· HTTP è¯·æ±‚ï¼Œäº¤æ¢æ•°æ®æ—¶ç”¨äºåè®®æ§åˆ¶çš„æ•°æ®åŒ…å¤´éƒ¨ç›¸å¯¹è¾ƒå°ï¼Œä¸€èˆ¬åªæœ‰ 2 å­—èŠ‚ï¼›</li>
<li><strong>å¢å¼ºå®æ—¶æ€§</strong>ã€‚æœåŠ¡å™¨å¯ä»¥éšæ—¶ä¸»åŠ¨ç»™å®¢æˆ·ç«¯ä¸‹å‘æ•°æ®ï¼Œç›¸å¯¹äº HTTP è¯·æ±‚éœ€è¦ç­‰å¾…å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æœåŠ¡ç«¯æ‰èƒ½å“åº”ï¼Œå»¶è¿Ÿæ˜æ˜¾æ›´å°‘ï¼Œå’Œä¼ ç»Ÿçš„è½®è¯¢æ¯”è¾ƒï¼ŒWebSocket ä¹Ÿå¯ä»¥åœ¨çŸ­æ—¶é—´å†…æ›´æœ‰æ•ˆç‡åœ°ä¼ é€’æ•°æ®ï¼›</li>
<li><strong>ç»´æŒè¿æ¥çŠ¶æ€</strong>ã€‚åœ¨ä¸€äº›éœ€è¦èº«ä»½è®¤è¯çš„åœºæ™¯ä¸‹ï¼Œ HTTP è¯·æ±‚å¯èƒ½éœ€è¦åœ¨æ¯ä¸ªè¯·æ±‚éƒ½æºå¸¦çŠ¶æ€ä¿¡æ¯ï¼ˆæœåŠ¡å™¨ä¸è®°å½•æ¯æ¬¡çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯ï¼‰ï¼Œè€Œ WebSocket ä¸€æ¬¡è¿æ¥å»ºç«‹åå°±ä¼šä¿æŒä½ä¼šè¯çŠ¶æ€ï¼Œè¿™å°±ä½¿å…¶æˆä¸ºä¸€ç§æœ‰çŠ¶æ€çš„åè®®ï¼Œåç»­é€šä¿¡æ—¶å°±å¯ä»¥çœç•¥éƒ¨åˆ†çŠ¶æ€ä¿¡æ¯ï¼›</li>
<li><strong>æ›´çµæ´»çš„æ‰©å±•æ”¯æŒ</strong>ã€‚æ ¹æ® RFC6455 åè®®[2]ï¼Œå¼€å‘è€…å¯ä»¥å¯¹ WebSocket è‡ªå®šä¹‰äºŒè¿›åˆ¶å¸§ï¼Œç›¸å¯¹ HTTPï¼Œå¯ä»¥æ›´è½»æ¾åœ°å¤„ç†äºŒè¿›åˆ¶å†…å®¹ï¼Œæ­¤å¤–å¼€å‘è€…ä¹Ÿè‡ªè¡Œæ‰©å±•åè®®ã€å®ç°éƒ¨åˆ†è‡ªå®šä¹‰çš„å­åè®®ã€‚</li>
<li><strong>æ›´å¥½çš„å‹ç¼©æ•ˆæœ</strong>ã€‚WebSocket åœ¨é€‚å½“çš„æ‰©å±•æ”¯æŒä¸‹ï¼Œå¯ä»¥æ²¿ç”¨ä¹‹å‰å†…å®¹çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨ä¼ é€’ç±»ä¼¼çš„æ•°æ®æ—¶ï¼Œå¯ä»¥æ˜¾è‘—åœ°æé«˜å‹ç¼©ç‡ã€‚</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/33454514/158771990-2812e406-c716-434f-ad24-07e0764550b7.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/33454514/158772037-7758c2d6-5751-4708-a02d-6d0df60062ef.png" alt="image"></p>
<h1 id="WebSocket-ä½¿ç”¨åœºæ™¯"><a href="#WebSocket-ä½¿ç”¨åœºæ™¯" class="headerlink" title="WebSocket ä½¿ç”¨åœºæ™¯"></a>WebSocket ä½¿ç”¨åœºæ™¯</h1><p>WebSocket æœ‰è¿™ä¹ˆå¤šä¼˜åŠ¿ï¼Œé‚£ä¹ˆå®ƒé€‚ç”¨äºå“ªäº›åœºæ™¯å‘¢ï¼Ÿä¸‹é¢æ¥ç®€å•äº†è§£ä¸‹ï¼š</p>
<ul>
<li><strong>éœ€è¦åŠæ—¶å“åº”çš„åœºæ™¯</strong>ã€‚å½“å®¢æˆ·ç«¯éœ€è¦å¯¹æœåŠ¡ç«¯å‘ç”Ÿçš„æ”¹å˜åšå‡ºå¿«é€Ÿå“åº”ï¼ˆå°¤å…¶æ˜¯å®¢æˆ·ç«¯æ— æ³•é¢„æµ‹çš„å“åº”ï¼‰æ—¶ï¼ŒWebSocket æ˜¯éå¸¸é€‚åˆçš„ã€‚ä¾‹å¦‚å¼€å‘ä¸€ä¸ªå®¢æœç³»ç»Ÿï¼Œè¿™å¾€å¾€è¦æ±‚å®ç°å¤šä¸ªç”¨æˆ·å®æ—¶æ²Ÿé€šã€‚å¦‚æœä½¿ç”¨ WebSocketï¼Œåˆ™æ¯ä¸ªå¯¹è¯éƒ½å¯ä»¥å®æ—¶å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚ä¸ HTTP ç›¸æ¯”ï¼ŒWebSocket ä¸éœ€è¦è€ƒè™‘å‘é€å’Œæ¥æ”¶çš„æ¯ä¸ªæ¶ˆæ¯çš„ HTTP è¯·æ±‚/å“åº”å¯¼è‡´çš„å¼€é”€ï¼Œä»è€Œä¼šæœ‰æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
<li><strong>éœ€è¦å®æ—¶æŸ¥è¯¢çš„åœºæ™¯</strong>ã€‚ä¾‹å¦‚ä¸€åç¯®çƒè¿·æƒ³è¦æŸ¥è¯¢æ¯”èµ›ç»“æœï¼Œå¦‚æœæ¯”èµ›æ˜¯ä¸Šå‘¨ç»“æŸçš„ï¼Œé‚£ä¹ˆæ¯”èµ›ç»“æœæ˜¯å›ºå®šçš„ï¼ŒHTTP åœ¨è¿™ç§æƒ…å†µä¸‹å°±éå¸¸é€‚åˆã€‚ä½†æ˜¯ï¼Œå¦‚æœæ˜¯å½“å‰æ­£åœ¨è¿›è¡Œçš„æ¯”èµ›ï¼Œå¾—åˆ†ä¼šä¸æ–­å˜åŒ–ï¼Œå¹¶ä¸”æ›´æ–°é¢‘ç¹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒWebSocket å°±æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</li>
<li><strong>å°è´Ÿè½½çš„é«˜é¢‘æ¶ˆæ¯ä¼ é€’</strong>ã€‚å¦‚ä»Šè¶Šæ¥è¶Šå¤šçš„å¼€å‘äººå‘˜æ­£åœ¨é€šè¿‡ç§»åŠ¨è®¾å¤‡çš„ GPS åŠŸèƒ½æ¥è®°å½• Web åº”ç”¨ç¨‹åºçš„æ–¹ä½æ„ŸçŸ¥ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦è®°å½•ä¸€æ®µæ—¶é—´å†…ç”¨æˆ·çš„ä½ç½®ä¿¡æ¯ï¼Œé«˜é¢‘ç‡å‘é€æ›´åŠ ç»†ç²’åº¦çš„ä½ç½®æ•°æ®ï¼Œä»è€Œèµ·åˆ°å®æ—¶åˆ†äº«åŠŸèƒ½ï¼ˆä¾‹å¦‚è¿åŠ¨ç±» APPï¼‰ï¼ŒWebSocket æ‰€ä½¿ç”¨çš„ TCP è¿æ¥ä¼šè®©æ•°æ®äº¤æ¢é£èµ·æ¥ã€‚</li>
<li><strong>å¤šäººååŒçš„åœºæ™¯</strong>ã€‚ä¾‹å¦‚è¿‘å‡ å¹´å‘å±•è¿…é€Ÿçš„åœ¨çº¿æ•™è‚²ï¼Œå­¦ç”Ÿå¯ä»¥è¶³ä¸å‡ºæˆ·ï¼Œå³å¯ä¸è€å¸ˆä»¥åŠå…¶ä»–åŒå­¦ä¸€èµ·è¿›è¡Œå®æ—¶æ²Ÿé€šä¸äº¤æµï¼Œè¯¸å¦‚å¸ƒç½®ä½œä¸šã€å¸ˆç”Ÿäº’åŠ¨ã€é—®é¢˜è®¨è®ºç­‰ç­‰å¼ºå®æ—¶äº¤äº’ç±»çš„åœºæ™¯éƒ½å¯äº¤ç”± WebSocket åè®®æ”¯æ’‘å®Œæˆï¼Œä»è€Œæ»¡è¶³ä½å»¶è¿Ÿï¼Œé«˜åŠæ—¶çš„åœºæ™¯è¦æ±‚ã€‚</li>
</ul>
<h1 id="WebSocket-API"><a href="#WebSocket-API" class="headerlink" title="WebSocket API"></a>WebSocket API</h1><h2 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket#%E5%B8%B8%E9%87%8F">å¸¸é‡</a></h2><table>
<thead>
<tr>
<th><strong>Constant</strong></th>
<th><strong>Value</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>WebSocket.CONNECTING</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>WebSocket.OPEN</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>WebSocket.CLOSING</code></td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>WebSocket.CLOSED</code></td>
<td><code>3</code></td>
</tr>
</tbody></table>
<h2 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket#%E5%B1%9E%E6%80%A7">å±æ€§</a></h2><ul>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/binaryType"><code>WebSocket.binaryType</code></a></p>
<p>ä½¿ç”¨äºŒè¿›åˆ¶çš„æ•°æ®ç±»å‹è¿æ¥ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/bufferedAmount"><code>WebSocket.bufferedAmount</code></a> åªè¯»</p>
<p>æœªå‘é€è‡³æœåŠ¡å™¨çš„å­—èŠ‚æ•°ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/extensions"><code>WebSocket.extensions</code></a> åªè¯»</p>
<p>æœåŠ¡å™¨é€‰æ‹©çš„æ‰©å±•ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/close_event"><code>WebSocket.onclose</code></a></p>
<p>ç”¨äºæŒ‡å®šè¿æ¥å…³é—­åçš„å›è°ƒå‡½æ•°ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/conflicting/Web/API/WebSocket/error_event"><code>WebSocket.onerror</code></a></p>
<p>ç”¨äºæŒ‡å®šè¿æ¥å¤±è´¥åçš„å›è°ƒå‡½æ•°ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/conflicting/Web/API/WebSocket/message_event"><code>WebSocket.onmessage</code></a></p>
<p>ç”¨äºæŒ‡å®šå½“ä»æœåŠ¡å™¨æ¥å—åˆ°ä¿¡æ¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/open_event"><code>WebSocket.onopen</code></a></p>
<p>ç”¨äºæŒ‡å®šè¿æ¥æˆåŠŸåçš„å›è°ƒå‡½æ•°ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/protocol"><code>WebSocket.protocol</code></a> åªè¯»</p>
<p>æœåŠ¡å™¨é€‰æ‹©çš„ä¸‹å±åè®®ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/readyState"><code>WebSocket.readyState</code></a> åªè¯»</p>
<p>å½“å‰çš„é“¾æ¥çŠ¶æ€ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/url"><code>WebSocket.url</code></a> åªè¯»</p>
<p>WebSocket çš„ç»å¯¹è·¯å¾„ã€‚</p>
</li>
</ul>
<h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket#method_overview">æ–¹æ³•</a></h2><ul>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/close"><code>WebSocket.close([code[, reason]])</code></a></p>
<p>å…³é—­å½“å‰é“¾æ¥ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/send"><code>WebSocket.send(data)</code></a></p>
<p>å¯¹è¦ä¼ è¾“çš„æ•°æ®è¿›è¡Œæ’é˜Ÿã€‚</p>
</li>
</ul>
<h2 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket#%E4%BA%8B%E4%BB%B6">äº‹ä»¶</a></h2><p>ä½¿ç”¨ <code>addEventListener()</code> æˆ–å°†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨èµ‹å€¼ç»™æœ¬æ¥å£çš„ <code>on*eventname*</code> å±æ€§ï¼Œæ¥ç›‘å¬ä¸‹é¢çš„äº‹ä»¶ã€‚</p>
<ul>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/close_event"><code>close</code></a></p>
<p>å½“ä¸€ä¸ª <code>WebSocket</code> è¿æ¥è¢«å…³é—­æ—¶è§¦å‘ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/close_event"><code>onclose</code></a> å±æ€§æ¥è®¾ç½®ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/error_event"><code>error</code></a></p>
<p>å½“ä¸€ä¸ª <code>WebSocket</code> è¿æ¥å› é”™è¯¯è€Œå…³é—­æ—¶è§¦å‘ï¼Œä¾‹å¦‚æ— æ³•å‘é€æ•°æ®æ—¶ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/docs/conflicting/Web/API/WebSocket/error_event"><code>onerror</code></a> å±æ€§æ¥è®¾ç½®.</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/message_event"><code>message</code></a></p>
<p>å½“é€šè¿‡ <code>WebSocket</code> æ”¶åˆ°æ•°æ®æ—¶è§¦å‘ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/docs/conflicting/Web/API/WebSocket/message_event"><code>onmessage</code></a> å±æ€§æ¥è®¾ç½®ã€‚</p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/open_event"><code>open</code></a></p>
<p>å½“ä¸€ä¸ª <code>WebSocket</code> è¿æ¥æˆåŠŸæ—¶è§¦å‘ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/open_event"><code>onopen</code></a> å±æ€§æ¥è®¾ç½®ã€‚</p>
</li>
</ul>
<h2 id="WebSocket-API-å…¼å®¹æ€§"><a href="#WebSocket-API-å…¼å®¹æ€§" class="headerlink" title="WebSocket API å…¼å®¹æ€§"></a>WebSocket API å…¼å®¹æ€§</h2><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/3/16ecac45c6f6fec3~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h1><h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> heartbeat = <span class="string">&#x27;HEARTBEAT&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> net.<span class="title class_">Socket</span>();</span><br><span class="line">client.<span class="title function_">connect</span>(<span class="number">9000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> content = chunk.<span class="title function_">toString</span>();</span><br><span class="line">  <span class="keyword">if</span> (content === heartbeat) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ”¶åˆ°å¿ƒè·³åŒ…ï¼š&#x27;</span>, content);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ”¶åˆ°æ•°æ®ï¼š&#x27;</span>, content);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// å®šæ—¶å‘é€æ•°æ®</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å‘é€æ•°æ®&#x27;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toUTCString</span>());</span><br><span class="line">  client.<span class="title function_">write</span>(<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toUTCString</span>());</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">// å®šæ—¶å‘é€å¿ƒè·³åŒ…</span></span><br><span class="line">  client.<span class="title function_">write</span>(heartbeat);</span><br><span class="line">&#125;, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clientList = [];</span><br><span class="line"><span class="keyword">const</span> heartBeat = <span class="string">&#x27;HEART&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>();</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">(<span class="params">client</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;client connect:&#x27;</span>, client.<span class="property">remoteAddress</span> + <span class="string">&#x27;:&#x27;</span> + client.<span class="property">remotePort</span>);</span><br><span class="line">  clientList.<span class="title function_">push</span>(client);</span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">pack</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> content = pack.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">if</span> (content === heartBeat) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get heartBeat from client&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get data from client&#x27;</span>, content);</span><br><span class="line">      client.<span class="title function_">write</span>(<span class="string">&#x27;server:&#x27;</span> + content);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;client end&#x27;</span>);</span><br><span class="line">    clientList.<span class="title function_">splice</span>(clientList.<span class="title function_">indexOf</span>(client), <span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> index = clientList.<span class="title function_">indexOf</span>(client);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;client&#x27;</span> + index + <span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    clientList.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">broadcast</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;broadcast heartbeat&#x27;</span>, clientList.<span class="property">length</span>);</span><br><span class="line">  <span class="keyword">const</span> cleanup = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; clientList.<span class="property">length</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (clientList[i].<span class="property">writable</span>) &#123; <span class="comment">// å…ˆæ£€æŸ¥ sockets æ˜¯å¦å¯å†™</span></span><br><span class="line">      clientList[i].<span class="title function_">write</span>(heartBeat);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ä¸€ä¸ªæ— æ•ˆçš„å®¢æˆ·ç«¯&#x27;</span>);</span><br><span class="line">      cleanup.<span class="title function_">push</span>(clientList[i]); <span class="comment">// å¦‚æœä¸å¯å†™ï¼Œæ”¶é›†èµ·æ¥é”€æ¯ã€‚é”€æ¯ä¹‹å‰è¦ Socket.destroy() ç”¨ API çš„æ–¹æ³•é”€æ¯ã€‚</span></span><br><span class="line">      clientList[i].<span class="title function_">destroy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Remove dead Nodes out of write loop to avoid trashing loop index</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cleanup.<span class="property">length</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åˆ é™¤æ— æ•ˆçš„å®¢æˆ·ç«¯:&#x27;</span>, cleanup[i].<span class="property">name</span>);</span><br><span class="line">    clientList.<span class="title function_">splice</span>(clientList.<span class="title function_">indexOf</span>(cleanup[i]), <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(broadcast, <span class="number">10000</span>); <span class="comment">// å®šæ—¶å‘é€å¿ƒè·³åŒ…</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>socket</category>
      </categories>
      <tags>
        <tag>socket</tag>
      </tags>
  </entry>
  <entry>
    <title>webpackåŸºç¡€åŠæ˜“æ··æ·†çš„æ¦‚å¿µ</title>
    <url>/2021/10/05/webpack%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<p>Webpack æœ‰éå¸¸å¤šçš„æ¦‚å¿µï¼Œå¾ˆå¤šåè¯é•¿å¾—éƒ½å·®ä¸å¤šã€‚æœ¬æ–‡æ—¨åœ¨å°†è¿™äº›åˆ†æ•£åœ¨æ–‡æ¡£å’Œæ•™ç¨‹é‡Œçš„å†…å®¹æ€»ç»“èµ·æ¥ï¼Œå®Œæˆä¸€ä»½ webpack ä¸­çš„æ˜“æ··æ·†çŸ¥è¯†ç‚¹é›†åˆã€‚</p>
<span id="more"></span>
<h1 id="moduleï¼Œchunk-å’Œ-bundle-çš„åŒºåˆ«"><a href="#moduleï¼Œchunk-å’Œ-bundle-çš„åŒºåˆ«" class="headerlink" title="moduleï¼Œchunk å’Œ bundle çš„åŒºåˆ«"></a>moduleï¼Œchunk å’Œ bundle çš„åŒºåˆ«</h1><h2 id="æ¦‚å¿µè¯´æ˜"><a href="#æ¦‚å¿µè¯´æ˜" class="headerlink" title="æ¦‚å¿µè¯´æ˜"></a>æ¦‚å¿µè¯´æ˜</h2><p>webpack å®˜ç½‘å¯¹ chunk å’Œ bundle çš„è§£é‡Šè¿‡äºæŠ½è±¡ã€‚ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæˆ‘è¿™é‡Œä¸¾ä¸ªä¾‹å­ç»™å¤§å®¶å½¢è±¡åŒ–çš„è§£é‡Šä¸€ä¸‹ã€‚</p>
<p>æˆ‘ä»¬åœ¨ src ç›®å½•ä¸‹å¼•å…¥ index.jsã€utils.jsã€common.js å’Œ index.css è¿™ 4 ä¸ªæ–‡ä»¶ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">â”œâ”€â”€ index.css</span><br><span class="line">â”œâ”€â”€ index.html # HTML æ¨¡æ¿ä»£ç </span><br><span class="line">â”œâ”€â”€ index.js</span><br><span class="line">â”œâ”€â”€ common.js</span><br><span class="line">â””â”€â”€ utils.js</span><br></pre></td></tr></table></figure>
<p>index.css çš„å†…å®¹ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>utils.js çš„å†…å®¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Fibonacci</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> n1 = <span class="number">1</span>, n2 = <span class="number">1</span>, sum;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt; n; i++) &#123;</span><br><span class="line">    sum = n1 + n2</span><br><span class="line">    n1 = n2</span><br><span class="line">    n2 = sum</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>common.js çš„å†…å®¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">log</span>: <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello &#x27;</span>, msg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js çš„å†…å®¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Common</span> <span class="keyword">from</span> <span class="string">&#x27;./common.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Common</span>.<span class="title function_">log</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>webpack çš„é…ç½®å¦‚ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">index</span>: <span class="string">&quot;../src/index.js&quot;</span>,</span><br><span class="line">        <span class="attr">utils</span>: <span class="string">&#x27;../src/utils.js&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;[name].bundle.js&quot;</span>, <span class="comment">// è¾“å‡º index.js å’Œ utils.js</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="comment">// åˆ›å»ºä¸€ä¸ª link æ ‡ç­¾</span></span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span>, <span class="comment">// css-loader è´Ÿè´£è§£æ CSS ä»£ç , å¤„ç† CSS ä¸­çš„ä¾èµ–</span></span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// ç”¨ MiniCssExtractPlugin æŠ½ç¦»å‡º css æ–‡ä»¶ï¼Œä»¥ link æ ‡ç­¾çš„å½¢å¼å¼•å…¥æ ·å¼æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.bundle.css&#x27;</span> <span class="comment">// è¾“å‡ºçš„ css æ–‡ä»¶åä¸º index.css</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ webpackååŒ…çš„ç»“æœï¼š<br><img src="https://user-images.githubusercontent.com/33454514/135892008-9f99b7f4-582c-4089-9107-aced8feb8621.png" alt="image"></p>
<p>ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œ<code>index.css</code> å’Œ <code>common.js</code> åœ¨ <code>index.js</code> ä¸­è¢«å¼•å…¥ï¼Œæ‰“åŒ…ç”Ÿæˆçš„ <code>index.bundle.css</code> å’Œ <code>index.bundle.js</code> éƒ½å±äº <code>chunk 0</code>ï¼Œ<code>utils.js</code> å› ä¸ºæ˜¯ç‹¬ç«‹æ‰“åŒ…çš„ï¼Œå®ƒç”Ÿæˆçš„ <code>utils.bundle.js</code> å±äº <code>chunk 1</code>ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135892433-d8191708-0dc5-4b78-84aa-057fbdf985b2.png" alt="image"></p>
<p>çœ‹è¿™ä¸ªå›¾å°±å¾ˆæ˜ç™½äº†ï¼š</p>
<ol>
<li>å¯¹äºä¸€ä»½åŒé€»è¾‘çš„ä»£ç ï¼Œå½“æˆ‘ä»¬æ‰‹å†™ä¸‹ä¸€ä¸ªä¸€ä¸ªçš„æ–‡ä»¶ï¼Œå®ƒä»¬æ— è®ºæ˜¯ ESM è¿˜æ˜¯ commonJS æˆ–æ˜¯ AMDï¼Œä»–ä»¬éƒ½æ˜¯ module ï¼›</li>
<li>å½“æˆ‘ä»¬å†™çš„ module æºæ–‡ä»¶ä¼ åˆ° webpack è¿›è¡Œæ‰“åŒ…æ—¶ï¼Œwebpack ä¼šæ ¹æ®æ–‡ä»¶å¼•ç”¨å…³ç³»ç”Ÿæˆ chunk æ–‡ä»¶ï¼Œwebpack ä¼šå¯¹è¿™ä¸ª chunk æ–‡ä»¶è¿›è¡Œä¸€äº›æ“ä½œï¼›</li>
<li>webpack å¤„ç†å¥½ chunk æ–‡ä»¶åï¼Œæœ€åä¼šè¾“å‡º bundle æ–‡ä»¶ï¼Œè¿™ä¸ª bundle æ–‡ä»¶åŒ…å«äº†ç»è¿‡åŠ è½½å’Œç¼–è¯‘çš„æœ€ç»ˆæºæ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚<br>ä¸€èˆ¬æ¥è¯´ä¸€ä¸ª chunk å¯¹åº”ä¸€ä¸ª bundleï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­çš„ utils.js -&gt; chunks 1 -&gt; utils.bundle.jsï¼›ä½†ä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚è¯´ä¸Šå›¾ä¸­ï¼Œæˆ‘å°±ç”¨ MiniCssExtractPlugin ä» chunks 0 ä¸­æŠ½ç¦»å‡ºäº† index.bundle.css æ–‡ä»¶ã€‚<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><code>module</code>ï¼Œ<code>chunk</code> å’Œ <code>bundle</code> å…¶å®å°±æ˜¯åŒä¸€ä»½é€»è¾‘ä»£ç åœ¨ä¸åŒè½¬æ¢åœºæ™¯ä¸‹çš„å–äº†ä¸‰ä¸ªåå­—ï¼š</li>
</ol>
<p>æˆ‘ä»¬ç›´æ¥å†™å‡ºæ¥çš„æ˜¯ <code>module</code>ï¼Œ<code>webpack</code> å¤„ç†æ—¶æ˜¯ <code>chunk</code>ï¼Œæœ€åç”Ÿæˆæµè§ˆå™¨å¯ä»¥ç›´æ¥è¿è¡Œçš„ <code>bundle</code>ã€‚</p>
<h1 id="filename-å’Œ-chunkFilename-çš„åŒºåˆ«"><a href="#filename-å’Œ-chunkFilename-çš„åŒºåˆ«" class="headerlink" title="filename å’Œ chunkFilename çš„åŒºåˆ«"></a>filename å’Œ chunkFilename çš„åŒºåˆ«</h1><h2 id="filename"><a href="#filename" class="headerlink" title="filename"></a>filename</h2><p><code>filename</code> æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é…ç½®ï¼Œå°±æ˜¯å¯¹åº”äº <code>entry</code> é‡Œé¢çš„è¾“å…¥æ–‡ä»¶ï¼Œ<code>ç»è¿‡webpack</code> æ‰“åŒ…åè¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶åã€‚æ¯”å¦‚è¯´ç»è¿‡ä¸‹é¢çš„é…ç½®ï¼Œç”Ÿæˆå‡ºæ¥çš„æ–‡ä»¶åä¸º <code>index.min.js</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">index</span>: <span class="string">&quot;../src/index.js&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;[name].min.js&quot;</span>, <span class="comment">// index.min.js</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://user-images.githubusercontent.com/33454514/135893374-3f5620a6-e9d5-46b6-b65a-0c4afbb3ebb1.png" alt="image"></p>
<h2 id="chunkFilename"><a href="#chunkFilename" class="headerlink" title="chunkFilename"></a>chunkFilename</h2><p><code>chunkFilename</code> æŒ‡æœªè¢«åˆ—åœ¨ <code>entry</code> ä¸­ï¼Œå´åˆéœ€è¦è¢«æ‰“åŒ…å‡ºæ¥çš„ <code>chunk</code> æ–‡ä»¶çš„åç§°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ª <code>chunk</code> æ–‡ä»¶æŒ‡çš„å°±æ˜¯è¦æ‡’åŠ è½½çš„ä»£ç ã€‚</p>
<p>æ¯”å¦‚åœ¨ä»£ç ä¸­å†™äº†ä¸€ä»½æ‡’åŠ è½½ lodash çš„ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–‡ä»¶ï¼šindex.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª button</span></span><br><span class="line"><span class="keyword">let</span> btn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">btn.<span class="property">innerHTML</span> = <span class="string">&quot;click me&quot;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(btn);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚æ­¥åŠ è½½ä»£ç </span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getAsyncComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> element = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">default</span>: _ &#125; = <span class="keyword">await</span> <span class="title function_">import</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line">  element.<span class="property">innerHTML</span> = _.<span class="title function_">join</span>([<span class="string">&#x27;Hello!&#x27;</span>, <span class="string">&#x27;dynamic&#x27;</span>, <span class="string">&#x27;imports&#x27;</span>, <span class="string">&#x27;async&#x27;</span>], <span class="string">&#x27; &#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‚¹å‡» button æ—¶ï¼Œæ‡’åŠ è½½ lodashï¼Œåœ¨ç½‘é¡µä¸Šæ˜¾ç¤º Hello! dynamic imports async</span></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getAsyncComponent</span>().<span class="title function_">then</span>(<span class="function"><span class="params">component</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(component);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>webpack</code> é…ç½®ä¸åšä»»ä½•å˜åŠ¨ï¼Œè¿™æ—¶å€™çš„æ‰“åŒ…ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135893745-8d0773ff-65dd-446d-ad7f-eccf25bc76e9.png" alt="image"><br>è¿™ä¸ª <code>1.min.js</code> å°±æ˜¯å¼‚æ­¥åŠ è½½çš„ <code>chunk</code> æ–‡ä»¶ã€‚å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><code>output.chunkFilename</code> é»˜è®¤ä½¿ç”¨ <code>[id].js</code> æˆ–ä» <code>output.filename</code> ä¸­æ¨æ–­å‡ºçš„å€¼ï¼ˆ<code>[name]</code> ä¼šè¢«é¢„å…ˆæ›¿æ¢ä¸º <code>[id]</code> æˆ– <code>[id].</code>ï¼‰</p>
</blockquote>
<p>ç»“åˆä¸Šé¢çš„ä¾‹å­æ¥çœ‹ï¼š</p>
<p><code>output.filename</code> çš„è¾“å‡ºæ–‡ä»¶åæ˜¯ <code>[name].min.js</code>ï¼Œ<code>[name]</code> æ ¹æ® <code>entry</code> çš„é…ç½®æ¨æ–­ä¸º <code>index</code>ï¼Œæ‰€ä»¥è¾“å‡ºä¸º <code>index.min.js</code>ï¼›</p>
<p>ç”±äº <code>output.chunkFilename</code> æ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šï¼Œå°±ä¼šæŠŠ <code>[name]</code> æ›¿æ¢ä¸º <code>chunk</code> æ–‡ä»¶çš„ <code>id</code> å·ï¼Œè¿™é‡Œæ–‡ä»¶çš„ <code>id</code> å·æ˜¯ 1ï¼Œæ‰€ä»¥æ–‡ä»¶åå°±æ˜¯ <code>1.min.js</code>ã€‚</p>
<p>å¦‚æœæ˜¾å¼åœ°é…ç½® <code>chunkFilename</code>ï¼Œå°±ä¼šæŒ‰é…ç½®çš„åå­—ç”Ÿæˆæ–‡ä»¶ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">index</span>: <span class="string">&quot;../src/index.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].min.js&quot;</span>,  <span class="comment">// index.min.js</span></span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&#x27;bundle.js&#x27;</span>, <span class="comment">// bundle.js</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…çš„ç»“æœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135894219-b65bd09a-b2cf-434c-9847-ecc5821ca342.png" alt="image"></p>
<h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>filename</code> æŒ‡åˆ—åœ¨ <code>entry</code> ä¸­ï¼Œæ‰“åŒ…åè¾“å‡ºçš„æ–‡ä»¶çš„åç§°ã€‚</p>
<p><code>chunkFilename</code> æŒ‡æœªåˆ—åœ¨ <code>entry</code> ä¸­ï¼Œå´åˆéœ€è¦è¢«æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶çš„åç§°ã€‚</p>
<h1 id="webpackPrefetchã€webpackPreload-å’Œ-webpackChunkName-çš„åŒºåˆ«"><a href="#webpackPrefetchã€webpackPreload-å’Œ-webpackChunkName-çš„åŒºåˆ«" class="headerlink" title="webpackPrefetchã€webpackPreload å’Œ webpackChunkName çš„åŒºåˆ«"></a>webpackPrefetchã€webpackPreload å’Œ webpackChunkName çš„åŒºåˆ«</h1><p>å‰é¢ä¸¾äº†ä¸ªå¼‚æ­¥åŠ è½½ <code>lodash</code> çš„ä¾‹å­ï¼Œæˆ‘ä»¬æœ€åæŠŠ <code>output.chunkFilename</code> å†™æ­»æˆ <code>bundle.js</code>ã€‚åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç ä¸­ï¼Œä¸å¯èƒ½åªå¼‚æ­¥åŠ è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥å†™æ­»è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œä½†æ˜¯å†™æˆ <code>[name].bundle.js</code> æ—¶ï¼Œæ‰“åŒ…çš„æ–‡ä»¶åˆæ˜¯æ„ä¹‰ä¸æ˜ã€è¾¨è¯†åº¦ä¸é«˜çš„ <code>chunk id</code>ã€‚</p>
<p>è¿™æ—¶å€™ <code>webpackChunkName</code> å°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <code>import</code> æ–‡ä»¶æ—¶ï¼Œåœ¨ <code>import</code> é‡Œä»¥æ³¨é‡Šçš„å½¢å¼ä¸º <code>chunk</code> æ–‡ä»¶å–åˆ«åï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getAsyncComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> element = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åœ¨ import çš„æ‹¬å·é‡Œ åŠ æ³¨é‡Š /* webpackChunkName: &quot;lodash&quot; */ ï¼Œä¸ºå¼•å…¥çš„æ–‡ä»¶å–åˆ«å</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">default</span>: _ &#125; = <span class="keyword">await</span> <span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;lodash&quot; */</span> <span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line">  element.<span class="property">innerHTML</span> = _.<span class="title function_">join</span>([<span class="string">&#x27;Hello!&#x27;</span>, <span class="string">&#x27;dynamic&#x27;</span>, <span class="string">&#x27;imports&#x27;</span>, <span class="string">&#x27;async&#x27;</span>], <span class="string">&#x27; &#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135894906-16f58da4-5910-41bb-933d-b58632b5d5f8.png" alt="image"></p>
<p>ç°åœ¨é—®é¢˜æ¥äº†ï¼Œ<code>lodash</code> æ˜¯æˆ‘ä»¬å–çš„åå­—ï¼ŒæŒ‰é“ç†æ¥è¯´åº”è¯¥ç”Ÿæˆ <code>lodash.bundle.js</code> å•Šï¼Œå‰é¢çš„ <code>vendors~</code> æ˜¯ä»€ä¹ˆç©æ„ï¼Ÿ</p>
<p>å…¶å® <code>webpack</code> æ‡’åŠ è½½æ˜¯ç”¨å†…ç½®çš„ä¸€ä¸ªæ’ä»¶ <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/">SplitChunksPlugin</a> å®ç°çš„ï¼Œè¿™ä¸ªæ’ä»¶é‡Œé¢æœ‰äº›é»˜è®¤ <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/#optimization-splitchunks">é…ç½®é¡¹</a> ï¼Œæ¯”å¦‚è¯´ <code>automaticNameDelimiter</code>ï¼Œé»˜è®¤çš„åˆ†å‰²ç¬¦å°±æ˜¯ <code>~</code>ï¼Œæ‰€ä»¥æœ€åçš„æ–‡ä»¶åæ‰ä¼šå‡ºç°è¿™ä¸ªç¬¦å·ã€‚</p>
<h2 id="webpackPrefetch-å’Œ-webpackPreload"><a href="#webpackPrefetch-å’Œ-webpackPreload" class="headerlink" title="webpackPrefetch å’Œ webpackPreload"></a>webpackPrefetch å’Œ webpackPreload</h2><p>è¿™ä¸¤ä¸ªé…ç½®ä¸€ä¸ªå«é¢„æ‹‰å–ï¼ˆPreloadï¼‰ï¼Œä¸€ä¸ªå«é¢„åŠ è½½ï¼ˆPrefetchï¼‰ï¼Œä¸¤è€…æœ‰äº›ç»†å¾®çš„ä¸åŒï¼Œæˆ‘ä»¬å…ˆè¯´è¯´ <code>webpackPreload</code>ã€‚</p>
<p>åœ¨ä¸Šé¢çš„æ‡’åŠ è½½ä»£ç é‡Œï¼Œæˆ‘ä»¬æ˜¯ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæ‰ä¼šè§¦å‘å¼‚æ­¥åŠ è½½ lodash çš„åŠ¨ä½œï¼Œè¿™æ—¶å€™ä¼šåŠ¨æ€çš„ç”Ÿæˆä¸€ä¸ª <code>script</code> æ ‡ç­¾ï¼ŒåŠ è½½åˆ° <code>head</code> å¤´é‡Œï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135895496-b3d2e1b7-1a82-4f92-b1a6-946552410ac3.png" alt="image"></p>
<p>å¦‚æœæˆ‘ä»¬ <code>import</code> çš„æ—¶å€™æ·»åŠ  <code>webpackPrefetch</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">default</span>: _ &#125; = <span class="keyword">await</span> <span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;lodash&quot; */</span> <span class="comment">/* webpackPrefetch: true */</span> <span class="string">&#x27;lodash&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>å°±ä¼šä»¥ <link rel="prefetch" as="script"> çš„å½¢å¼é¢„æ‹‰å– lodash ä»£ç ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135900665-8bbacb1c-2250-4e35-8807-19dc3ad59f60.png" alt="image"></p>
<p>è¿™ä¸ªå¼‚æ­¥åŠ è½½çš„ä»£ç ä¸éœ€è¦æ‰‹åŠ¨ç‚¹å‡» button è§¦å‘ï¼Œwebpack ä¼šåœ¨çˆ¶ chunk å®ŒæˆåŠ è½½åï¼Œé—²æ—¶åŠ è½½ lodash æ–‡ä»¶ã€‚</p>
<p>webpackPreload æ˜¯é¢„åŠ è½½å½“å‰å¯¼èˆªä¸‹å¯èƒ½éœ€è¦èµ„æºï¼Œä»–å’Œ webpackPrefetch çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š</p>
<ul>
<li><code>preload chunk</code> ä¼šåœ¨çˆ¶ <code>chunk</code> åŠ è½½æ—¶ï¼Œä»¥å¹¶è¡Œæ–¹å¼å¼€å§‹åŠ è½½ã€‚<code>prefetch chunk</code> ä¼šåœ¨çˆ¶ <code>chunk</code> åŠ è½½ç»“æŸåå¼€å§‹åŠ è½½ã€‚</li>
<li><code>preload chunk</code> å…·æœ‰ä¸­ç­‰ä¼˜å…ˆçº§ï¼Œå¹¶ç«‹å³ä¸‹è½½ã€‚<code>prefetch chunk</code> åœ¨æµè§ˆå™¨é—²ç½®æ—¶ä¸‹è½½ã€‚</li>
<li><code>preload chunk</code> ä¼šåœ¨çˆ¶ <code>chunk</code> ä¸­ç«‹å³è¯·æ±‚ï¼Œç”¨äºå½“ä¸‹æ—¶åˆ»ã€‚<code>prefetch chunk</code>ä¼šç”¨äºæœªæ¥çš„æŸä¸ªæ—¶åˆ»</li>
</ul>
<h2 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>webpackChunkName</code> æ˜¯ä¸ºé¢„åŠ è½½çš„æ–‡ä»¶å–åˆ«åï¼Œ<code>webpackPrefetch</code> ä¼šåœ¨æµè§ˆå™¨é—²ç½®ä¸‹è½½æ–‡ä»¶ï¼Œ<code>webpackPreload</code> ä¼šåœ¨çˆ¶ <code>chunk</code> åŠ è½½æ—¶å¹¶è¡Œä¸‹è½½æ–‡ä»¶ã€‚</p>
<h1 id="hashã€chunkhashã€contenthash-çš„åŒºåˆ«"><a href="#hashã€chunkhashã€contenthash-çš„åŒºåˆ«" class="headerlink" title="hashã€chunkhashã€contenthash çš„åŒºåˆ«"></a>hashã€chunkhashã€contenthash çš„åŒºåˆ«</h1><h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><p><code>hash</code> è®¡ç®—æ˜¯è·Ÿæ•´ä¸ªé¡¹ç›®çš„æ„å»ºç›¸å…³ï¼Œæ²¿ç”¨ä¾‹ä¸€ä¸­çš„é¡¹ç›®è·¯å¾„ã€‚</p>
<p>ä¿®æ”¹<code>webpack</code> çš„æ ¸å¿ƒé…ç½®å¦‚ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">index</span>: <span class="string">&quot;../src/index.js&quot;</span>,</span><br><span class="line">        <span class="attr">utils</span>: <span class="string">&#x27;../src/utils.js&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;[name].[hash].js&quot;</span>,  <span class="comment">// æ”¹ä¸º hash</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    ......</span><br><span class="line">    </span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.[hash].css&#x27;</span> <span class="comment">// æ”¹ä¸º hash</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…åç”Ÿæˆçš„æ–‡ä»¶åå¦‚ä¸‹ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135901307-475f7263-9f07-41ec-9dcc-6a883be5d5d5.png" alt="image"></p>
<p>ä¸éš¾å‘ç°ï¼šç”Ÿæˆæ–‡ä»¶çš„ <code>hash</code> å’Œé¡¹ç›®çš„æ„å»º <code>hash</code> éƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p>
<h2 id="chunkhash"><a href="#chunkhash" class="headerlink" title="chunkhash"></a>chunkhash</h2><p>å› ä¸º <code>hash</code> æ˜¯é¡¹ç›®æ„å»ºçš„å“ˆå¸Œå€¼ï¼Œé¡¹ç›®ä¸­å¦‚æœæœ‰äº›å˜åŠ¨ï¼Œ<code>hash</code> ä¸€å®šä¼šå˜ï¼Œæ¯”å¦‚ä¿®æ”¹ <code>utils.js</code> çš„ä»£ç ï¼Œ<code>index.js</code> é‡Œçš„ä»£ç è™½ç„¶æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å¤§å®¶éƒ½æ˜¯ç”¨çš„åŒä¸€ä»½ <code>hash</code>ã€‚<code>hash</code> ä¸€å˜ï¼Œç¼“å­˜ä¸€å®šå¤±æ•ˆäº†ï¼Œè¿™æ ·å­æ˜¯æ²¡åŠæ³•å®ç° CDN å’Œæµè§ˆå™¨ç¼“å­˜çš„ã€‚</p>
<p><code>chunkhash</code> å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œå®ƒæ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶(Entry)è¿›è¡Œä¾èµ–æ–‡ä»¶è§£æã€æ„å»ºå¯¹åº”çš„ <code>chunk</code>ï¼Œç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚</p>
<p>ä¾‹å¦‚å¯¹ <code>utils.js</code> é‡Œæ–‡ä»¶è¿›è¡Œæ”¹åŠ¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Fibonacci</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> n1 = <span class="number">1</span>, n2 = <span class="number">1</span>, sum;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt; n; i++) &#123;</span><br><span class="line">    sum = n1 + n2</span><br><span class="line">    n1 = n2</span><br><span class="line">    n2 = sum</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cube</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x * x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> utils = &#123;</span><br><span class="line">  cube,</span><br><span class="line">  <span class="title class_">Fibonacci</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> utils;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæŠŠ <code>webpack</code> é‡Œçš„æ‰€æœ‰ <code>hash</code> æ”¹ä¸º <code>chunkhash</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">index</span>: <span class="string">&quot;../src/index.js&quot;</span>,</span><br><span class="line">        <span class="attr">utils</span>: <span class="string">&#x27;../src/utils.js&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;[name].[chunkhash].js&quot;</span>, <span class="comment">// æ”¹ä¸º chunkhash</span></span><br><span class="line">    &#125;,</span><br><span class="line">          </span><br><span class="line">    ......</span><br><span class="line">    </span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.[chunkhash].css&#x27;</span> <span class="comment">// // æ”¹ä¸º chunkhash</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://user-images.githubusercontent.com/33454514/135901840-cbb01f5f-dec9-4d17-b860-d7bedf02975e.png" alt="image"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<code>chunk 0</code> çš„ <code>hash</code> éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ<code>chunk 1</code> çš„ <code>hash</code> å’Œä¸Šé¢çš„ä¸ä¸€æ ·ã€‚</p>
<p>å‡è®¾æˆ‘åˆæŠŠ <code>utils.js</code> é‡Œçš„ <code>cube()</code> å‡½æ•°å»æ‰ï¼Œå†æ‰“åŒ…ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135901951-4ed6daed-263a-44eb-a6e0-8f78cd5fda2f.png" alt="image"></p>
<p>å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œåªæœ‰ chunk 1 çš„ hash å‘ç”Ÿå˜åŒ–ï¼Œchunk 0 çš„ hash è¿˜æ˜¯åŸæ¥çš„ã€‚</p>
<h2 id="contenthash"><a href="#contenthash" class="headerlink" title="contenthash"></a>contenthash</h2><p>æˆ‘ä»¬æ›´è¿‘ä¸€æ­¥ï¼Œ<code>index.js</code> å’Œ <code>index.css</code> åŒä¸ºä¸€ä¸ª <code>chunk</code>ï¼Œå¦‚æœ <code>index.js</code> å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯ <code>index.css</code> æ²¡æœ‰å˜åŒ–ï¼Œæ‰“åŒ…åä»–ä»¬çš„ <code>hash</code> éƒ½å‘ç”Ÿå˜åŒ–ï¼Œè¿™å¯¹ <code>css</code> æ–‡ä»¶æ¥è¯´æ˜¯ä¸€ç§æµªè´¹ã€‚å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>
<p><code>contenthash</code> å°†æ ¹æ®èµ„æºå†…å®¹åˆ›å»ºå‡ºå”¯ä¸€ <code>hash</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶å†…å®¹ä¸å˜ï¼Œ<code>hash</code> å°±ä¸å˜ã€‚</p>
<p>ä¿®æ”¹ webpack çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">index</span>: <span class="string">&quot;../src/index.js&quot;</span>,</span><br><span class="line">        <span class="attr">utils</span>: <span class="string">&#x27;../src/utils.js&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;[name].[chunkhash].js&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">      </span><br><span class="line">    ......</span><br><span class="line">    </span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.[contenthash].css&#x27;</span> <span class="comment">// è¿™é‡Œæ”¹ä¸º contenthash</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¯¹ index.js æ–‡ä»¶è¿›è¡Œä¸‰æ¬¡ä¿®æ”¹ï¼Œæ‰“åŒ…çš„ç»“æœåˆ†åˆ«å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135902268-f0b0b2bd-2efb-4f18-bb5d-2603b375720f.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/33454514/135902274-7afa84b0-5d2f-4654-a9ba-12899bc2bc8e.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/33454514/135902277-535cc6c3-e5cc-4e3b-89d4-e7b3ed1781f5.png" alt="image"></p>
<p>ä¸éš¾çœ‹å‡ºï¼Œ<code>css</code> æ–‡ä»¶çš„ <code>hash</code> å§‹ç»ˆæ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚</p>
<h2 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>hash</code> è®¡ç®—ä¸æ•´ä¸ªé¡¹ç›®çš„æ„å»ºç›¸å…³ï¼›</p>
<p><code>chunkhash</code> è®¡ç®—ä¸åŒä¸€ <code>chunk</code> å†…å®¹ç›¸å…³ï¼›</p>
<p><code>contenthash</code> è®¡ç®—ä¸æ–‡ä»¶å†…å®¹æœ¬èº«ç›¸å…³ã€‚</p>
<h1 id="sourse-map-ä¸­-evalã€cheapã€inline-å’Œ-module-çš„åŒºåˆ«"><a href="#sourse-map-ä¸­-evalã€cheapã€inline-å’Œ-module-çš„åŒºåˆ«" class="headerlink" title="sourse-map ä¸­ evalã€cheapã€inline å’Œ module çš„åŒºåˆ«"></a>sourse-map ä¸­ evalã€cheapã€inline å’Œ module çš„åŒºåˆ«</h1><p>ç®€å•è¯´ï¼ŒSource mapå°±æ˜¯ä¸€ä¸ªä¿¡æ¯æ–‡ä»¶ï¼Œé‡Œé¢å‚¨å­˜ç€ä½ç½®ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè½¬æ¢åçš„ä»£ç çš„æ¯ä¸€ä¸ªä½ç½®ï¼Œæ‰€å¯¹åº”çš„è½¬æ¢å‰çš„ä½ç½®ã€‚</p>
<p>æœ‰äº†å®ƒï¼Œå‡ºé”™çš„æ—¶å€™ï¼Œé™¤é”™å·¥å…·å°†ç›´æ¥æ˜¾ç¤ºåŸå§‹ä»£ç ï¼Œè€Œä¸æ˜¯è½¬æ¢åçš„ä»£ç ã€‚è¿™æ— ç–‘ç»™å¼€å‘è€…å¸¦æ¥äº†å¾ˆå¤§æ–¹ä¾¿ã€‚</p>
<p>å®˜ç½‘ä¸Šçš„sourcemapç§ç±»å¦‚ä¸‹å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/33454514/135902685-0e8e17f7-4d43-401a-9fa9-eca8961ba0f4.png" alt="image"></p>
<p>è§‚å¯Ÿåä¸éš¾å‘ç°å¤§éƒ¨åˆ†éƒ½æ˜¯ evalã€cheapã€inline å’Œ moduleè¿™ 4 ä¸ªè¯æ’åˆ—ç»„åˆçš„ï¼Œäºæ˜¯å¯ä»¥å¤§è‡´å½’çº³ä¸ºå¦‚ä¸‹å››ä¸ªç§ç±»ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¡¨å¤´</th>
</tr>
</thead>
<tbody><tr>
<td>eval</td>
<td>æ‰“åŒ…åçš„æ¨¡å—éƒ½ä½¿ç”¨ <code>eval()</code> æ‰§è¡Œï¼Œè¡Œæ˜ å°„å¯èƒ½ä¸å‡†ï¼›ä¸äº§ç”Ÿç‹¬ç«‹çš„ <code>map</code> æ–‡ä»¶</td>
</tr>
<tr>
<td>cheap</td>
<td>map æ˜ å°„åªæ˜¾ç¤ºè¡Œä¸æ˜¾ç¤ºåˆ—ï¼Œå¿½ç•¥æºè‡ª <code>loader</code> çš„ <code>source-map</code></td>
</tr>
<tr>
<td>inline</td>
<td>æ˜ å°„æ–‡ä»¶ä»¥ <code>base64</code> æ ¼å¼ç¼–ç ï¼ŒåŠ åœ¨ <code>bundle</code> æ–‡ä»¶æœ€åï¼Œä¸äº§ç”Ÿç‹¬ç«‹çš„ <code>map</code> æ–‡ä»¶</td>
</tr>
<tr>
<td>module</td>
<td>å¢åŠ å¯¹ <code>loader</code> <code>source</code> <code>map</code> å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„æ˜ å°„</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="source-map"><a href="#source-map" class="headerlink" title="source-map"></a>source-map</h2><p>source-map æ˜¯æœ€å¤§è€Œå…¨çš„ï¼Œä¼šç”Ÿæˆç‹¬ç«‹ map æ–‡ä»¶</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135903295-45c87381-799b-45aa-a79d-460c76e61c40.png" alt="image"></p>
<p>source-map ä¼šæ˜¾ç¤ºæŠ¥é”™çš„è¡Œåˆ—ä¿¡æ¯ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135903373-dec99574-7ea9-4493-8a8b-e36a7f42a59e.png" alt="image"></p>
<h2 id="cheap-sourse-map"><a href="#cheap-sourse-map" class="headerlink" title="cheap-sourse-map"></a>cheap-sourse-map</h2><p><code>cheap</code> ä¸ä¼šäº§ç”Ÿåˆ—æ˜ å°„ï¼Œç›¸åº”çš„ä½“ç§¯ä¼šå°å¾ˆå¤šï¼Œå’Œ <code>sourse-map</code> çš„æ‰“åŒ…ç»“æœæ¯”ä¸€ä¸‹å‘ç°ä½“ç§¯åªæœ‰åŸæ¥çš„ 1/4 ã€‚</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135903497-64abffc3-551d-41c1-8897-15a531ba0bd9.png" alt="image"></p>
<h2 id="eval-source-map"><a href="#eval-source-map" class="headerlink" title="eval-source-map"></a>eval-source-map</h2><p><code>eval-source-map</code> ä¼šä»¥ <code>eval()</code> å‡½æ•°æ‰“åŒ…è¿è¡Œæ¨¡å—ï¼Œä¸äº§ç”Ÿç‹¬ç«‹çš„ <code>map</code> æ–‡ä»¶ï¼Œä¼šæ˜¾ç¤ºæŠ¥é”™çš„è¡Œåˆ—ä¿¡æ¯ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/33454514/135903556-9a39d9ad-be3d-469c-8dfc-5809b941593a.png" alt="image"></p>
<p><img src="https://user-images.githubusercontent.com/33454514/135903552-00a05907-f6d7-4362-9a96-4039a45be86f.png" alt="image"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.bundle.js æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">!<span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;([<span class="keyword">function</span>(<span class="params"><span class="variable language_">module</span>, <span class="built_in">exports</span></span>) &#123;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">&quot;console.lg(&#x27;hello source-map !&#x27;);&quot;</span> +</span><br><span class="line">      <span class="string">&quot;//# sourceURL=[module]\n//# &quot;</span> +</span><br><span class="line">      <span class="string">&quot;sourceMappingURL=data:application/json;&quot;</span> +</span><br><span class="line">      <span class="string">&quot;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJz&quot;</span> +</span><br><span class="line">      <span class="string">&quot;b3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vc3JjL2luZG&quot;</span> +</span><br><span class="line">      <span class="string">&quot;V4Mi5qcz9mNmJjIl0sIm5hbWVzIjpbImNvbnNvbGUiL&quot;</span> +</span><br><span class="line">      <span class="string">&quot;CJsZyJdLCJtYXBwaW5ncyI6IkFBQUFBLE9BQU8sQ0F&quot;</span> +</span><br><span class="line">      <span class="string">&quot;BQ0MsRUFBUixDQUFXLG9CQUFYIiwiZmlsZSI6IjAua&quot;</span> +</span><br><span class="line">      <span class="string">&quot;nMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zb2xlLmx&quot;</span> +</span><br><span class="line">      <span class="string">&quot;nKCdoZWxsbyBzb3VyY2UtbWFwICEnKSJdLCJzb3VyY2&quot;</span> +</span><br><span class="line">      <span class="string">&quot;VSb290IjoiIn0=\n//&quot;</span> +</span><br><span class="line">      <span class="string">&quot;# sourceURL=webpack-internal:///0\n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h2 id="inline-source-map"><a href="#inline-source-map" class="headerlink" title="inline-source-map"></a>inline-source-map</h2><p>æ˜ å°„æ–‡ä»¶ä»¥ <code>base64</code> æ ¼å¼ç¼–ç ï¼ŒåŠ åœ¨ <code>bundle</code> æ–‡ä»¶æœ€åï¼Œä¸äº§ç”Ÿç‹¬ç«‹çš„ <code>map</code> æ–‡ä»¶ã€‚</p>
<p>åŠ å…¥ <code>map</code> æ–‡ä»¶åå¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°åŒ…ä½“ç§¯å˜å¤§äº†ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.bundle.js æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">!<span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;([<span class="keyword">function</span>(<span class="params">e, t</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">lg</span>(<span class="string">&quot;hello source-map !&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// # sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3Vy...</span></span><br><span class="line"><span class="comment">// base64ç¼–ç </span></span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h2><ol>
<li>source-map</li>
</ol>
<ul>
<li>å¤§è€Œå…¨ï¼Œå•¥éƒ½æœ‰ï¼Œä¼šè®© webpack æ„å»ºæ—¶é—´å˜é•¿ï¼Œçœ‹æƒ…å†µä½¿ç”¨ã€‚</li>
</ul>
<ol start="2">
<li>cheap-module-eval-source-map </li>
</ol>
<ul>
<li>è¿™ä¸ªä¸€èˆ¬æ˜¯å¼€å‘ç¯å¢ƒï¼ˆdevï¼‰æ¨èä½¿ç”¨ï¼Œåœ¨æ„å»ºé€Ÿåº¦æŠ¥é”™æé†’ä¸Šåšäº†æ¯”è¾ƒå¥½çš„å‡è¡¡ã€‚</li>
</ul>
<ol start="3">
<li>cheap-module-source-map</li>
</ol>
<ul>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œç”Ÿäº§ç¯å¢ƒæ˜¯ä¸é… <code>source-map</code> çš„ï¼Œå¦‚æœæƒ³æ•æ‰çº¿ä¸Šçš„ä»£ç æŠ¥é”™ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ª</li>
</ul>
]]></content>
      <categories>
        <category>webpack</category>
        <category>å…«è‚¡æ–‡</category>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>å‰ç«¯</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢è¯•å…«è‚¡æ–‡ï¼ˆä¸€ï¼‰â€”â€” è®¡ç®—æœºç½‘ç»œ</title>
    <url>/2021/09/22/%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
    <content><![CDATA[<meta name="referrer" content="no-referrer" />
 
<h1 id="è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"><a href="#è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„" class="headerlink" title="è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"></a>è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„</h1><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628084581427-ad52128d-5d7c-4304-8fb3-8f8c6b59dc15.png"></p>
<ul>
<li>Physical, Data Link, Network, Transport, Application</li>
<li>åº”ç”¨å±‚ï¼šå¸¸è§åè®®ï¼š<ul>
<li>FTP(21ç«¯å£)ï¼šæ–‡ä»¶ä¼ è¾“åè®®</li>
<li>SSH(22ç«¯å£)ï¼šè¿œç¨‹ç™»é™†</li>
<li>TELNET(23ç«¯å£)ï¼šè¿œç¨‹ç™»å½•</li>
<li>SMTP(25ç«¯å£)ï¼šå‘é€é‚®ä»¶</li>
<li>POP3(110ç«¯å£)ï¼šæ¥æ”¶é‚®ä»¶</li>
<li>HTTP(80ç«¯å£)ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®</li>
<li>DNS(53ç«¯å£)ï¼šè¿è¡Œåœ¨UDPä¸Šï¼ŒåŸŸåè§£ææœåŠ¡</li>
</ul>
</li>
<li>ä¼ è¾“å±‚ï¼šTCP/UDP</li>
<li>ç½‘ç»œå±‚ï¼šIPã€ARPã€NATã€RIPâ€¦</li>
<li>è·¯ç”±å™¨ç½‘ç»œå±‚ï¼Œæ ¹æ®IPåœ°å€è¿›è¡Œå¯»å€ï¼›</li>
</ul>
<p><a href="#%E4%BB%80%E4%B9%88%E6%98%AFNAT-Network-Address-Translation-%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2"></a></p>
<h1 id="ä¼ è¾“å±‚ï¼šTCPå’ŒUDP"><a href="#ä¼ è¾“å±‚ï¼šTCPå’ŒUDP" class="headerlink" title="ä¼ è¾“å±‚ï¼šTCPå’ŒUDP"></a>ä¼ è¾“å±‚ï¼šTCPå’ŒUDP</h1><h3 id="ä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹-three-way-handshake-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹-three-way-handshake-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ (three-way handshake)ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ (three-way handshake)ï¼Ÿ</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628083612400-05353867-b677-449d-bc87-378dc2ac5fbd.png"></p>
<ul>
<li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClientå°†SYNç½®1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªåˆå§‹åºåˆ—å·seqå‘é€ç»™Serverï¼Œè¿›å…¥SYN_SENTçŠ¶æ€ï¼›</li>
<li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šServeræ”¶åˆ°Clientçš„SYN=1ä¹‹åï¼ŒçŸ¥é“å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œå°†è‡ªå·±çš„SYNç½®1ï¼ŒACKç½®1ï¼Œäº§ç”Ÿä¸€ä¸ªacknowledge number=sequence number+1ï¼Œå¹¶éšæœºäº§ç”Ÿä¸€ä¸ªè‡ªå·±çš„åˆå§‹åºåˆ—å·ï¼Œå‘é€ç»™å®¢æˆ·ç«¯ï¼›è¿›å…¥SYN_RCVDçŠ¶æ€ï¼›</li>
<li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ£€æŸ¥acknowledge numberæ˜¯å¦ä¸ºåºåˆ—å·+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œæ£€æŸ¥æ­£ç¡®ä¹‹åå°†è‡ªå·±çš„ACKç½®ä¸º1ï¼Œäº§ç”Ÿä¸€ä¸ªacknowledge number=æœåŠ¡å™¨å‘çš„åºåˆ—å·+1ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼›è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼›æœåŠ¡å™¨æ£€æŸ¥ACKä¸º1å’Œacknowledge numberä¸ºåºåˆ—å·+1ä¹‹åï¼Œä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼›å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œè¿æ¥å»ºç«‹ã€‚</li>
</ul>
<h5 id="TCPå»ºç«‹è¿æ¥å¯ä»¥ä¸¤æ¬¡æ¡æ‰‹å—ï¼Ÿä¸ºä»€ä¹ˆ"><a href="#TCPå»ºç«‹è¿æ¥å¯ä»¥ä¸¤æ¬¡æ¡æ‰‹å—ï¼Ÿä¸ºä»€ä¹ˆ" class="headerlink" title="TCPå»ºç«‹è¿æ¥å¯ä»¥ä¸¤æ¬¡æ¡æ‰‹å—ï¼Ÿä¸ºä»€ä¹ˆ?"></a>TCPå»ºç«‹è¿æ¥å¯ä»¥ä¸¤æ¬¡æ¡æ‰‹å—ï¼Ÿä¸ºä»€ä¹ˆ?</h5><p>ä¸å¯ä»¥ã€‚æœ‰ä¸¤ä¸ªåŸå› ï¼š<br>é¦–å…ˆï¼Œå¯èƒ½ä¼šå‡ºç°<strong>å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåˆä¼ åˆ°äº†æœåŠ¡å™¨ç«¯</strong>ã€‚</p>
<blockquote>
<p>client å‘å‡ºçš„ç¬¬ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µå¹¶æ²¡æœ‰ä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æŸä¸ªç½‘ç»œç»“ç‚¹é•¿æ—¶é—´çš„æ»ç•™äº†ï¼Œä»¥è‡´å»¶è¯¯åˆ°è¿æ¥é‡Šæ”¾ä»¥åçš„æŸä¸ªæ—¶é—´æ‰åˆ°è¾¾ serverã€‚æœ¬æ¥è¿™æ˜¯ä¸€ä¸ªæ—©å·²å¤±æ•ˆçš„æŠ¥æ–‡æ®µã€‚ä½† server æ”¶åˆ°æ­¤å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåï¼Œå°±è¯¯è®¤ä¸ºæ˜¯ client å†æ¬¡å‘å‡ºçš„ä¸€ä¸ªæ–°çš„è¿æ¥è¯·æ±‚ã€‚äºæ˜¯å°±å‘ client å‘å‡ºç¡®è®¤æŠ¥æ–‡æ®µï¼ŒåŒæ„å»ºç«‹è¿æ¥ã€‚å‡è®¾ä¸é‡‡ç”¨ â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œé‚£ä¹ˆåªè¦ server å‘å‡ºç¡®è®¤ï¼Œæ–°çš„è¿æ¥å°±å»ºç«‹äº†ã€‚ç”±äºç°åœ¨ client å¹¶æ²¡æœ‰å‘å‡ºå»ºç«‹è¿æ¥çš„è¯·æ±‚ï¼Œå› æ­¤ä¸ä¼šç†ç¬ server çš„ç¡®è®¤ï¼Œä¹Ÿä¸ä¼šå‘ server å‘é€æ•°æ®ã€‚ä½† server å´ä»¥ä¸ºæ–°çš„è¿è¾“è¿æ¥å·²ç»å»ºç«‹ï¼Œå¹¶ä¸€ç›´ç­‰å¾… client å‘æ¥æ•°æ®ã€‚è¿™æ ·ï¼Œserver çš„å¾ˆå¤šèµ„æºå°±ç™½ç™½æµªè´¹æ‰äº†ã€‚é‡‡ç”¨ â€œä¸‰æ¬¡æ¡æ‰‹â€ çš„åŠæ³•å¯ä»¥é˜²æ­¢ä¸Šè¿°ç°è±¡å‘ç”Ÿã€‚ä¾‹å¦‚åˆšæ‰é‚£ç§æƒ…å†µï¼Œclient ä¸ä¼šå‘ server çš„ç¡®è®¤å‘å‡ºç¡®è®¤ã€‚server ç”±äºæ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±çŸ¥é“ client å¹¶æ²¡æœ‰è¦æ±‚å»ºç«‹è¿æ¥ã€‚</p>
</blockquote>
<p>å…¶æ¬¡ï¼Œä¸¤æ¬¡æ¡æ‰‹æ— æ³•ä¿è¯Clientæ­£ç¡®æ¥æ”¶ç¬¬äºŒæ¬¡æ¡æ‰‹çš„æŠ¥æ–‡ï¼ˆServeræ— æ³•ç¡®è®¤Clientæ˜¯å¦æ”¶åˆ°ï¼‰ï¼Œä¹Ÿæ— æ³•ä¿è¯Clientå’ŒServerä¹‹é—´æˆåŠŸäº’æ¢åˆå§‹åºåˆ—å·ã€‚</p>
<h5 id="å¯ä»¥é‡‡ç”¨å››æ¬¡æ¡æ‰‹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#å¯ä»¥é‡‡ç”¨å››æ¬¡æ¡æ‰‹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¯ä»¥é‡‡ç”¨å››æ¬¡æ¡æ‰‹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>å¯ä»¥é‡‡ç”¨å››æ¬¡æ¡æ‰‹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h5><p>å¯ä»¥ã€‚ä½†æ˜¯ä¼šé™ä½ä¼ è¾“çš„æ•ˆç‡ã€‚<br>å››æ¬¡æ¡æ‰‹æ˜¯æŒ‡ï¼šç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šServeråªå‘é€ACKå’Œacknowledge numberï¼›è€ŒServerçš„SYNå’Œåˆå§‹åºåˆ—å·åœ¨ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ—¶å‘é€ï¼›åŸæ¥åè®®ä¸­çš„ç¬¬ä¸‰æ¬¡æ¡æ‰‹å˜ä¸ºç¬¬å››æ¬¡æ¡æ‰‹ã€‚å‡ºäºä¼˜åŒ–ç›®çš„ï¼Œå››æ¬¡æ¡æ‰‹ä¸­çš„äºŒã€ä¸‰å¯ä»¥åˆå¹¶ã€‚</p>
<h5 id="ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„ACKæœªé€è¾¾æœåŠ¡å™¨ï¼Œä¼šæ€æ ·ï¼Ÿ"><a href="#ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„ACKæœªé€è¾¾æœåŠ¡å™¨ï¼Œä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„ACKæœªé€è¾¾æœåŠ¡å™¨ï¼Œä¼šæ€æ ·ï¼Ÿ"></a>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„ACKæœªé€è¾¾æœåŠ¡å™¨ï¼Œä¼šæ€æ ·ï¼Ÿ</h5><p>Serverç«¯ï¼š<br>ç”±äºServeræ²¡æœ‰æ”¶åˆ°ACKç¡®è®¤ï¼Œå› æ­¤ä¼šé‡å‘ä¹‹å‰çš„SYN+ACKï¼ˆé»˜è®¤é‡å‘äº”æ¬¡ï¼Œä¹‹åè‡ªåŠ¨å…³é—­è¿æ¥è¿›å…¥CLOSEDçŠ¶æ€ï¼‰ï¼ŒClientæ”¶åˆ°åä¼šé‡æ–°ä¼ ACKç»™Serverã€‚<br>Clientç«¯ï¼Œä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>åœ¨Serverè¿›è¡Œè¶…æ—¶é‡å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœClientå‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œæ•°æ®å¤´éƒ¨çš„ACKæ˜¯ä¸º1çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨æ”¶åˆ°æ•°æ®ä¹‹åä¼šè¯»å– ACK numberï¼Œè¿›å…¥ establish çŠ¶æ€ </li>
<li>åœ¨Serverè¿›å…¥CLOSEDçŠ¶æ€ä¹‹åï¼Œå¦‚æœClientå‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼ŒæœåŠ¡å™¨ä¼šä»¥RSTåŒ…åº”ç­”ã€‚</li>
</ol>
<h5 id="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯å‡ºç°äº†æ•…éšœæ€ä¹ˆåŠï¼Ÿ"><a href="#å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯å‡ºç°äº†æ•…éšœæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯å‡ºç°äº†æ•…éšœæ€ä¹ˆåŠï¼Ÿ"></a>å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯å‡ºç°äº†æ•…éšœæ€ä¹ˆåŠï¼Ÿ</h5><p>æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75ç§’é’Ÿå‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚</p>
<h5 id="åˆå§‹åºåˆ—å·æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åˆå§‹åºåˆ—å·æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åˆå§‹åºåˆ—å·æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åˆå§‹åºåˆ—å·æ˜¯ä»€ä¹ˆï¼Ÿ</h5><p>TCPè¿æ¥çš„ä¸€æ–¹Aï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª32ä½çš„åºåˆ—å·ï¼ˆSequence Numberï¼‰ä½œä¸ºå‘é€æ•°æ®çš„åˆå§‹åºåˆ—å·ï¼ˆInitial Sequence Numberï¼ŒISNï¼‰ï¼Œæ¯”å¦‚ä¸º1000ï¼Œä»¥è¯¥åºåˆ—å·ä¸ºåŸç‚¹ï¼Œå¯¹è¦ä¼ é€çš„æ•°æ®è¿›è¡Œç¼–å·ï¼š1001ã€1002â€¦ä¸‰æ¬¡æ¡æ‰‹æ—¶ï¼ŒæŠŠè¿™ä¸ªåˆå§‹åºåˆ—å·ä¼ é€ç»™å¦ä¸€æ–¹Bï¼Œä»¥ä¾¿åœ¨ä¼ è¾“æ•°æ®æ—¶ï¼ŒBå¯ä»¥ç¡®è®¤ä»€ä¹ˆæ ·çš„æ•°æ®ç¼–å·æ˜¯åˆæ³•çš„ï¼›åŒæ—¶åœ¨è¿›è¡Œæ•°æ®ä¼ è¾“æ—¶ï¼ŒAè¿˜å¯ä»¥ç¡®è®¤Bæ”¶åˆ°çš„æ¯ä¸€ä¸ªå­—èŠ‚ï¼Œå¦‚æœAæ”¶åˆ°äº†Bçš„ç¡®è®¤ç¼–å·ï¼ˆacknowledge numberï¼‰æ˜¯2001ï¼Œå°±è¯´æ˜ç¼–å·ä¸º1001-2000çš„æ•°æ®å·²ç»è¢«BæˆåŠŸæ¥å—ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628083644967-a1117a3a-ad00-494a-bdf5-f357adfef3b9.png"></p>
<ul>
<li>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šClientå°†FINç½®ä¸º1ï¼Œå‘é€ä¸€ä¸ªåºåˆ—å·seqç»™Serverï¼›è¿›å…¥FIN_WAIT_1çŠ¶æ€ï¼›</li>
<li>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šServeræ”¶åˆ°FINä¹‹åï¼Œå‘é€ä¸€ä¸ªACK=1ï¼Œacknowledge number=æ”¶åˆ°çš„åºåˆ—å·+1ï¼›è¿›å…¥CLOSE_WAITçŠ¶æ€ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰è¦å‘é€çš„æ•°æ®äº†ï¼Œä½†ä»å¯ä»¥æ¥å—æœåŠ¡å™¨å‘æ¥çš„æ•°æ®ã€‚</li>
<li>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šServerå°†FINç½®1ï¼Œå‘é€ä¸€ä¸ªåºåˆ—å·ç»™Clientï¼›è¿›å…¥LAST_ACKçŠ¶æ€ï¼›</li>
<li>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šClientæ”¶åˆ°æœåŠ¡å™¨çš„FINåï¼Œè¿›å…¥TIME_WAITçŠ¶æ€ï¼›æ¥ç€å°†ACKç½®1ï¼Œå‘é€ä¸€ä¸ªacknowledge number=åºåˆ—å·+1ç»™æœåŠ¡å™¨ï¼›æœåŠ¡å™¨æ”¶åˆ°åï¼Œç¡®è®¤acknowledge numberåï¼Œå˜ä¸ºCLOSEDçŠ¶æ€ï¼Œä¸å†å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚å®¢æˆ·ç«¯ç­‰å¾…2*MSLï¼ˆæŠ¥æ–‡æ®µæœ€é•¿å¯¿å‘½ï¼‰æ—¶é—´åï¼Œä¹Ÿè¿›å…¥CLOSEDçŠ¶æ€ã€‚å®Œæˆå››æ¬¡æŒ¥æ‰‹ã€‚</li>
</ul>
<h5 id="ä¸ºä»€ä¹ˆä¸èƒ½æŠŠæœåŠ¡å™¨å‘é€çš„ACKå’ŒFINåˆå¹¶èµ·æ¥ï¼Œå˜æˆä¸‰æ¬¡æŒ¥æ‰‹ï¼ˆCLOSE-WAITçŠ¶æ€æ„ä¹‰æ˜¯ä»€ä¹ˆï¼‰ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½æŠŠæœåŠ¡å™¨å‘é€çš„ACKå’ŒFINåˆå¹¶èµ·æ¥ï¼Œå˜æˆä¸‰æ¬¡æŒ¥æ‰‹ï¼ˆCLOSE-WAITçŠ¶æ€æ„ä¹‰æ˜¯ä»€ä¹ˆï¼‰ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½æŠŠæœåŠ¡å™¨å‘é€çš„ACKå’ŒFINåˆå¹¶èµ·æ¥ï¼Œå˜æˆä¸‰æ¬¡æŒ¥æ‰‹ï¼ˆCLOSE_WAITçŠ¶æ€æ„ä¹‰æ˜¯ä»€ä¹ˆï¼‰ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸èƒ½æŠŠæœåŠ¡å™¨å‘é€çš„ACKå’ŒFINåˆå¹¶èµ·æ¥ï¼Œå˜æˆä¸‰æ¬¡æŒ¥æ‰‹ï¼ˆCLOSE_WAITçŠ¶æ€æ„ä¹‰æ˜¯ä»€ä¹ˆï¼‰ï¼Ÿ</h5><p>å› ä¸ºæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯æ–­å¼€è¿æ¥çš„è¯·æ±‚æ—¶ï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›æ•°æ®æ²¡æœ‰å‘å®Œï¼Œè¿™æ—¶å…ˆå›å¤ACKï¼Œè¡¨ç¤ºæ¥æ”¶åˆ°äº†æ–­å¼€è¿æ¥çš„è¯·æ±‚ã€‚ç­‰åˆ°æ•°æ®å‘å®Œä¹‹åå†å‘FINï¼Œæ–­å¼€æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ä¼ é€ã€‚</p>
<h5 id="å¦‚æœç¬¬äºŒæ¬¡æŒ¥æ‰‹æ—¶æœåŠ¡å™¨çš„ACKæ²¡æœ‰é€è¾¾å®¢æˆ·ç«¯ï¼Œä¼šæ€æ ·ï¼Ÿ"><a href="#å¦‚æœç¬¬äºŒæ¬¡æŒ¥æ‰‹æ—¶æœåŠ¡å™¨çš„ACKæ²¡æœ‰é€è¾¾å®¢æˆ·ç«¯ï¼Œä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="å¦‚æœç¬¬äºŒæ¬¡æŒ¥æ‰‹æ—¶æœåŠ¡å™¨çš„ACKæ²¡æœ‰é€è¾¾å®¢æˆ·ç«¯ï¼Œä¼šæ€æ ·ï¼Ÿ"></a>å¦‚æœç¬¬äºŒæ¬¡æŒ¥æ‰‹æ—¶æœåŠ¡å™¨çš„ACKæ²¡æœ‰é€è¾¾å®¢æˆ·ç«¯ï¼Œä¼šæ€æ ·ï¼Ÿ</h5><p>å®¢æˆ·ç«¯æ²¡æœ‰æ”¶åˆ°ACKç¡®è®¤ï¼Œä¼šé‡æ–°å‘é€FINè¯·æ±‚ã€‚</p>
<h5 id="å®¢æˆ·ç«¯TIME-WAITçŠ¶æ€çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å®¢æˆ·ç«¯TIME-WAITçŠ¶æ€çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å®¢æˆ·ç«¯TIME_WAITçŠ¶æ€çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å®¢æˆ·ç«¯TIME_WAITçŠ¶æ€çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</h5><p>ç¬¬å››æ¬¡æŒ¥æ‰‹æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„ACKæœ‰å¯èƒ½ä¸¢å¤±ï¼ŒTIME_WAITçŠ¶æ€å°±æ˜¯ç”¨æ¥é‡å‘å¯èƒ½ä¸¢å¤±çš„ACKæŠ¥æ–‡ã€‚å¦‚æœServeræ²¡æœ‰æ”¶åˆ°ACKï¼Œå°±ä¼šé‡å‘FINï¼Œå¦‚æœClientåœ¨2*MSLçš„æ—¶é—´å†…æ”¶åˆ°äº†FINï¼Œå°±ä¼šé‡æ–°å‘é€ACKå¹¶å†æ¬¡ç­‰å¾…2MSLï¼Œé˜²æ­¢Serveræ²¡æœ‰æ”¶åˆ°ACKè€Œä¸æ–­é‡å‘FINã€‚<br>MSL(Maximum Segment Lifetime)ï¼ŒæŒ‡ä¸€ä¸ªç‰‡æ®µåœ¨ç½‘ç»œä¸­æœ€å¤§çš„å­˜æ´»æ—¶é—´ï¼Œ2MSLå°±æ˜¯ä¸€ä¸ªå‘é€å’Œä¸€ä¸ªå›å¤æ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœç›´åˆ°2MSLï¼ŒClientéƒ½æ²¡æœ‰å†æ¬¡æ”¶åˆ°FINï¼Œé‚£ä¹ˆClientæ¨æ–­ACKå·²ç»è¢«æˆåŠŸæ¥æ”¶ï¼Œåˆ™ç»“æŸTCPè¿æ¥ã€‚</p>
<h3 id="TCPå¦‚ä½•å®ç°æµé‡æ§åˆ¶ï¼Ÿ"><a href="#TCPå¦‚ä½•å®ç°æµé‡æ§åˆ¶ï¼Ÿ" class="headerlink" title="TCPå¦‚ä½•å®ç°æµé‡æ§åˆ¶ï¼Ÿ"></a>TCPå¦‚ä½•å®ç°æµé‡æ§åˆ¶ï¼Ÿ</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628083671501-2d938176-eced-4414-b6aa-fbc32d323ae9.png"></p>
<p>ä½¿ç”¨æ»‘åŠ¨çª—å£åè®®å®ç°æµé‡æ§åˆ¶ã€‚é˜²æ­¢å‘é€æ–¹å‘é€é€Ÿç‡å¤ªå¿«ï¼Œæ¥æ”¶æ–¹ç¼“å­˜åŒºä¸å¤Ÿå¯¼è‡´æº¢å‡ºã€‚æ¥æ”¶æ–¹ä¼šç»´æŠ¤ä¸€ä¸ªæ¥æ”¶çª—å£ receiver windowï¼ˆçª—å£å¤§å°å•ä½æ˜¯å­—èŠ‚ï¼‰ï¼Œæ¥å—çª—å£çš„å¤§å°æ˜¯æ ¹æ®è‡ªå·±çš„èµ„æºæƒ…å†µåŠ¨æ€è°ƒæ•´çš„ï¼Œåœ¨è¿”å›ACKæ—¶å°†æ¥å—çª—å£å¤§å°æ”¾åœ¨TCPæŠ¥æ–‡ä¸­çš„çª—å£å­—æ®µå‘ŠçŸ¥å‘é€æ–¹ã€‚å‘é€çª—å£çš„å¤§å°ä¸èƒ½è¶…è¿‡æ¥å—çª—å£çš„å¤§å°ï¼Œåªæœ‰å½“å‘é€æ–¹å‘é€å¹¶æ”¶åˆ°ç¡®è®¤ä¹‹åï¼Œæ‰èƒ½å°†å‘é€çª—å£å³ç§»ã€‚</p>
<p>å‘é€çª—å£çš„ä¸Šé™ä¸ºæ¥å—çª—å£å’Œæ‹¥å¡çª—å£ä¸­çš„è¾ƒå°å€¼ã€‚æ¥å—çª—å£è¡¨æ˜äº†æ¥æ”¶æ–¹çš„æ¥æ”¶èƒ½åŠ›ï¼Œæ‹¥å¡çª—å£è¡¨æ˜äº†ç½‘ç»œçš„ä¼ é€èƒ½åŠ›ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/gif/1431305/1628083685654-29996960-ed15-47f4-99bf-246b8ac30214.gif"></p>
<h5 id="ä»€ä¹ˆæ˜¯é›¶çª—å£ï¼ˆæ¥æ”¶çª—å£ä¸º0æ—¶ä¼šæ€æ ·ï¼‰ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é›¶çª—å£ï¼ˆæ¥æ”¶çª—å£ä¸º0æ—¶ä¼šæ€æ ·ï¼‰ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é›¶çª—å£ï¼ˆæ¥æ”¶çª—å£ä¸º0æ—¶ä¼šæ€æ ·ï¼‰ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é›¶çª—å£ï¼ˆæ¥æ”¶çª—å£ä¸º0æ—¶ä¼šæ€æ ·ï¼‰ï¼Ÿ</h5><p>å¦‚æœæ¥æ”¶æ–¹æ²¡æœ‰èƒ½åŠ›æ¥æ”¶æ•°æ®ï¼Œå°±ä¼šå°†æ¥æ”¶çª—å£è®¾ç½®ä¸º0ï¼Œè¿™æ—¶å‘é€æ–¹å¿…é¡»æš‚åœå‘é€æ•°æ®ï¼Œä½†æ˜¯ä¼šå¯åŠ¨ä¸€ä¸ªæŒç»­è®¡æ—¶å™¨(persistence timer)ï¼Œåˆ°æœŸåå‘é€ä¸€ä¸ªå¤§å°ä¸º1å­—èŠ‚çš„æ¢æµ‹æ•°æ®åŒ…ï¼Œä»¥æŸ¥çœ‹æ¥æ”¶çª—å£çŠ¶æ€ã€‚å¦‚æœæ¥æ”¶æ–¹èƒ½å¤Ÿæ¥æ”¶æ•°æ®ï¼Œå°±ä¼šåœ¨è¿”å›çš„æŠ¥æ–‡ä¸­æ›´æ–°æ¥æ”¶çª—å£å¤§å°ï¼Œæ¢å¤æ•°æ®ä¼ é€ã€‚</p>
<h3 id="TCPçš„æ‹¥å¡æ§åˆ¶æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#TCPçš„æ‹¥å¡æ§åˆ¶æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="TCPçš„æ‹¥å¡æ§åˆ¶æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>TCPçš„æ‹¥å¡æ§åˆ¶æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628083709929-6e2bfba1-63ca-4742-a80a-256a93b0f159.png"></p>
<p>æ‹¥å¡æ§åˆ¶ä¸»è¦ç”±å››ä¸ªç®—æ³•ç»„æˆï¼š<strong>æ…¢å¯åŠ¨ï¼ˆSlow Startï¼‰ã€æ‹¥å¡é¿å…ï¼ˆCongestion voidanceï¼‰ã€å¿«é‡ä¼  ï¼ˆFast Retransmitï¼‰ã€å¿«æ¢å¤ï¼ˆFast Recoveryï¼‰</strong></p>
<ol>
<li>æ…¢å¯åŠ¨ï¼šåˆšå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå…ˆæŠŠæ‹¥å¡çª—å£ï¼ˆcongestion windowï¼‰è®¾ç½®ä¸ºä¸€ä¸ªæœ€å¤§æŠ¥æ–‡æ®µMSSçš„æ•°å€¼ï¼Œæ¯æ”¶åˆ°ä¸€ä¸ªæ–°çš„ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œå°±æŠŠæ‹¥å¡çª—å£åŠ 1ä¸ªMSSã€‚è¿™æ ·æ¯ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡ï¼ˆæˆ–è€…è¯´æ˜¯æ¯ç»è¿‡ä¸€ä¸ªå¾€è¿”æ—¶é—´RTTï¼‰ï¼Œæ‹¥å¡çª—å£çš„å¤§å°å°±ä¼šåŠ å€<br><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628083774060-71278d40-0b39-4e15-9dd1-22534e2c90d8.png"></li>
</ol>
<ol start="2">
<li>æ‹¥å¡é¿å…ï¼šå½“æ‹¥å¡çª—å£çš„å¤§å°è¾¾åˆ°æ…¢å¼€å§‹é—¨é™(slow start threshold)æ—¶ï¼Œå¼€å§‹æ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•ï¼Œæ‹¥å¡çª—å£å¤§å°ä¸å†æŒ‡æ•°å¢åŠ ï¼Œè€Œæ˜¯çº¿æ€§å¢åŠ ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡åªå¢åŠ 1MSS.</li>
</ol>
<blockquote>
<p>æ— è®ºåœ¨æ…¢å¼€å§‹é˜¶æ®µè¿˜æ˜¯åœ¨æ‹¥å¡é¿å…é˜¶æ®µï¼Œåªè¦å‘é€æ–¹åˆ¤æ–­ç½‘ç»œå‡ºç°æ‹¥å¡ï¼ˆå…¶æ ¹æ®å°±æ˜¯æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼‰ï¼Œå°±è¦æŠŠæ…¢å¼€å§‹é—¨é™ssthreshè®¾ç½®ä¸ºå‡ºç°æ‹¥å¡æ—¶çš„å‘é€æ–¹çª—å£å€¼çš„ä¸€åŠï¼ˆä½†ä¸èƒ½å°äº2ï¼‰ã€‚ç„¶åæŠŠæ‹¥å¡çª—å£cwndé‡æ–°è®¾ç½®ä¸º1ï¼Œæ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ã€‚<strong>ï¼ˆè¿™æ˜¯ä¸ä½¿ç”¨å¿«é‡ä¼ çš„æƒ…å†µï¼‰</strong></p>
</blockquote>
<ol start="3">
<li>å¿«é‡ä¼ ï¼šå¿«é‡ä¼ è¦æ±‚æ¥æ”¶æ–¹åœ¨æ”¶åˆ°ä¸€ä¸ªå¤±åºçš„æŠ¥æ–‡æ®µåå°±ç«‹å³å‘å‡º<strong>é‡å¤ç¡®è®¤</strong>ï¼ˆä¸ºçš„æ˜¯ä½¿å‘é€æ–¹åŠæ—©çŸ¥é“æœ‰æŠ¥æ–‡æ®µæ²¡æœ‰åˆ°è¾¾å¯¹æ–¹ï¼‰è€Œä¸è¦ç­‰åˆ°è‡ªå·±å‘é€æ•°æ®æ—¶æå¸¦ç¡®è®¤ã€‚å¿«é‡ä¼ ç®—æ³•è§„å®šï¼Œå‘é€æ–¹åªè¦ä¸€è¿æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤å°±åº”å½“ç«‹å³é‡ä¼ å¯¹æ–¹å°šæœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µï¼Œè€Œä¸å¿…ç»§ç»­ç­‰å¾…è®¾ç½®çš„é‡ä¼ è®¡æ—¶å™¨æ—¶é—´åˆ°æœŸã€‚</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628083866222-2e727029-b6f2-495e-97f2-e4b7b49cd16e.png"></p>
<ol start="4">
<li>å¿«æ¢å¤ï¼šå½“å‘é€æ–¹è¿ç»­æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤æ—¶ï¼Œå°±æŠŠæ…¢å¼€å§‹é—¨é™å‡åŠï¼Œç„¶åæ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•ã€‚ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•çš„åŸå› ï¼šå› ä¸ºå¦‚æœç½‘ç»œå‡ºç°æ‹¥å¡çš„è¯å°±ä¸ä¼šæ”¶åˆ°å¥½å‡ ä¸ªé‡å¤çš„ç¡®è®¤ï¼Œæ‰€ä»¥å‘é€æ–¹è®¤ä¸ºç°åœ¨ç½‘ç»œå¯èƒ½æ²¡æœ‰å‡ºç°æ‹¥å¡ã€‚<br>ä¹Ÿæœ‰çš„å¿«é‡ä¼ æ˜¯æŠŠå¼€å§‹æ—¶çš„æ‹¥å¡çª—å£cwndå€¼å†å¢å¤§ä¸€ç‚¹ï¼Œå³ç­‰äº ssthresh + 3*MSS ã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯ï¼šæ—¢ç„¶å‘é€æ–¹æ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ç¡®è®¤ï¼Œå°±è¡¨æ˜æœ‰ä¸‰ä¸ªåˆ†ç»„å·²ç»ç¦»å¼€äº†ç½‘ç»œã€‚è¿™ä¸‰ä¸ªåˆ†ç»„ä¸å†æ¶ˆè€—ç½‘ç»œçš„èµ„æºè€Œæ˜¯åœç•™åœ¨æ¥æ”¶æ–¹çš„ç¼“å­˜ä¸­ã€‚å¯è§ç°åœ¨ç½‘ç»œä¸­å‡å°‘äº†ä¸‰ä¸ªåˆ†ç»„ã€‚å› æ­¤å¯ä»¥é€‚å½“æŠŠæ‹¥å¡çª—å£æ‰©å¤§äº›ã€‚<h3 id="TCPå¦‚ä½•æœ€å¤§åˆ©ç”¨å¸¦å®½ï¼Ÿ"><a href="#TCPå¦‚ä½•æœ€å¤§åˆ©ç”¨å¸¦å®½ï¼Ÿ" class="headerlink" title="TCPå¦‚ä½•æœ€å¤§åˆ©ç”¨å¸¦å®½ï¼Ÿ"></a>TCPå¦‚ä½•æœ€å¤§åˆ©ç”¨å¸¦å®½ï¼Ÿ</h3>TCPé€Ÿç‡å—åˆ°ä¸‰ä¸ªå› ç´ å½±å“</li>
</ol>
<ul>
<li>çª—å£ï¼šå³æ»‘åŠ¨çª—å£å¤§å°ï¼Œè§<a href="#TCP%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">TCPå¦‚ä½•å®ç°æµé‡æ§åˆ¶ï¼Ÿ</a></li>
<li>å¸¦å®½ï¼šè¿™é‡Œå¸¦å®½æ˜¯æŒ‡å•ä½æ—¶é—´å†…ä»å‘é€ç«¯åˆ°æ¥æ”¶ç«¯æ‰€èƒ½é€šè¿‡çš„â€œæœ€é«˜æ•°æ®ç‡â€ï¼Œæ˜¯ä¸€ç§ç¡¬ä»¶é™åˆ¶ã€‚TCPå‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„æ•°æ®ä¼ è¾“æ•°ä¸å¯èƒ½è¶…è¿‡ä¸¤ç‚¹é—´çš„å¸¦å®½é™åˆ¶ã€‚å‘é€ç«¯å’Œæ¥æ”¶ç«¯ä¹‹é—´å¸¦å®½å–æ‰€é€šè¿‡çº¿è·¯çš„å¸¦å®½æœ€å°å€¼ï¼ˆå¦‚é€šè¿‡äº’è”ç½‘è¿æ¥ï¼‰ã€‚</li>
<li>RTTï¼šå³Round Trip Timeï¼Œè¡¨ç¤ºä»å‘é€ç«¯åˆ°æ¥æ”¶ç«¯çš„ä¸€å»ä¸€å›éœ€è¦çš„æ—¶é—´ï¼ŒTCPåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šå¯¹RTTè¿›è¡Œé‡‡æ ·ï¼ˆå³å¯¹å‘é€çš„æ•°æ®åŒ…åŠå…¶ACKçš„æ—¶é—´å·®è¿›è¡Œæµ‹é‡ï¼Œå¹¶æ ¹æ®æµ‹é‡å€¼æ›´æ–°RTTå€¼ï¼‰ï¼ŒTCPæ ¹æ®å¾—åˆ°çš„RTTå€¼æ›´æ–°RTOå€¼ï¼Œå³Retransmission TimeOutï¼Œå°±æ˜¯é‡ä¼ é—´éš”ï¼Œå‘é€ç«¯å¯¹æ¯ä¸ªå‘å‡ºçš„æ•°æ®åŒ…è¿›è¡Œè®¡æ—¶ï¼Œå¦‚æœåœ¨RTOæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ‰€å‘å‡ºçš„æ•°æ®åŒ…çš„å¯¹åº”ACKï¼Œåˆ™ä»»åŠ¡æ•°æ®åŒ…ä¸¢å¤±ï¼Œå°†é‡ä¼ æ•°æ®ã€‚ä¸€èˆ¬RTOå€¼éƒ½æ¯”é‡‡æ ·å¾—åˆ°çš„RTTå€¼è¦å¤§ã€‚</li>
</ul>
<p>å¸¦å®½æ—¶å»¶ä¹˜ç§¯=å¸¦å®½*RTTï¼Œå®é™…ä¸Šç­‰äºå‘é€ç«¯åˆ°æ¥æ”¶ç«¯å•å‘é€šé“çš„æ•°æ®å®¹ç§¯çš„ä¸¤å€ï¼Œè¿™é‡Œå•å‘é€šé“çš„æ•°æ®å®¹ç§¯å¯ä»¥è¿™æ ·æ¥ç†è§£ï¼Œå•å‘é€šé“çœ‹æˆæ˜¯ä¸€æ¡å•è¡Œé“é©¬è·¯ï¼Œå¸¦å®½å°±æ˜¯é©¬è·¯çš„è½¦é“æ•°ï¼Œè·¯ä¸Šè·‘çš„æ±½è½¦å°±æ˜¯æ•°æ®ï¼ˆä¸è¿‡è¿™é‡Œæ‰€æœ‰æ±½è½¦çš„é€Ÿç‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸”ä¸ä¼šæœ‰äººæƒ³è¶…è½¦ï¼Œå¤§å®¶é½å¤´å¹¶è¿›ï¼‰ï¼Œé‚£ä¹ˆå•å‘é€šé“çš„æ•°æ®å®¹ç§¯å°±æ˜¯è¿™æ¡å•è¡Œé“ä¸Šæ‘†æ»¡è½¦ï¼Œä¸€å…±å¯ä»¥æ‘†å¤šå°‘è¾†ã€‚å¸¦å®½å°±æ˜¯é©¬è·¯çš„è½¦é“æ•°ï¼Œå¸¦å®½æ•°ä¹˜ä»¥å•å‘é€šé“çš„æ•°æ®å®¹ç§¯å°±æ˜¯è·¯é¢ä¸Šæ‰€èƒ½å®¹çº³çš„å…¨éƒ¨æ•°æ®é‡ã€‚å½“è·¯é¢ä¸Šå·²ç»æ‘†æ»¡çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å†å¾€é‡Œé¢æ”¾äº†ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628084389045-9ba4652e-2456-424e-b530-bd95b496004d.png"></p>
<h3 id="TCPä¸UDPçš„åŒºåˆ«"><a href="#TCPä¸UDPçš„åŒºåˆ«" class="headerlink" title="TCPä¸UDPçš„åŒºåˆ«"></a>TCPä¸UDPçš„åŒºåˆ«</h3><ol>
<li>TCPæ˜¯é¢å‘è¿æ¥çš„ï¼ŒUDPæ˜¯æ— è¿æ¥çš„ï¼›</li>
<li>UDPå‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥</li>
<li>TCPæ˜¯å¯é çš„ï¼ŒUDPä¸å¯é ï¼› </li>
<li>UDPæ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡åï¼Œä¸éœ€è¦ç»™å‡ºä»»ä½•ç¡®è®¤</li>
<li>TCPåªæ”¯æŒç‚¹å¯¹ç‚¹é€šä¿¡ï¼ŒUDPæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šï¼›</li>
<li>TCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼ŒUDPæ˜¯é¢å‘æŠ¥æ–‡çš„ï¼› </li>
<li>é¢å‘å­—èŠ‚æµæ˜¯æŒ‡å‘é€æ•°æ®æ—¶ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œä¸€ä¸ªæ•°æ®åŒ…å¯ä»¥æ‹†åˆ†æˆè‹¥å¹²ç»„è¿›è¡Œå‘é€ï¼Œè€ŒUDPä¸€ä¸ªæŠ¥æ–‡åªèƒ½ä¸€æ¬¡å‘å®Œã€‚</li>
<li>TCPæœ‰æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼ŒUDPæ²¡æœ‰ã€‚ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿æºä¸»æœºçš„å‘é€é€Ÿç‡é™ä½ï¼Œè¿™å¯¹æŸäº›å®æ—¶åº”ç”¨æ˜¯å¾ˆé‡è¦çš„ï¼Œæ¯”å¦‚åª’ä½“é€šä¿¡ï¼Œæ¸¸æˆï¼›</li>
<li>TCPé¦–éƒ¨å¼€é”€ï¼ˆ20å­—èŠ‚ï¼‰æ¯”UDPé¦–éƒ¨å¼€é”€ï¼ˆ8å­—èŠ‚ï¼‰è¦å¤§</li>
<li>UDP çš„ä¸»æœºä¸éœ€è¦ç»´æŒå¤æ‚çš„è¿æ¥çŠ¶æ€è¡¨</li>
</ol>
<h5 id="ä»€ä¹ˆæ—¶å€™é€‰æ‹©TCPï¼Œä»€ä¹ˆæ—¶å€™é€‰UDPï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™é€‰æ‹©TCPï¼Œä»€ä¹ˆæ—¶å€™é€‰UDPï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™é€‰æ‹©TCPï¼Œä»€ä¹ˆæ—¶å€™é€‰UDPï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™é€‰æ‹©TCPï¼Œä»€ä¹ˆæ—¶å€™é€‰UDPï¼Ÿ</h5><h5 id="HTTPå¯ä»¥ä½¿ç”¨UDPå—ï¼Ÿ"><a href="#HTTPå¯ä»¥ä½¿ç”¨UDPå—ï¼Ÿ" class="headerlink" title="HTTPå¯ä»¥ä½¿ç”¨UDPå—ï¼Ÿ"></a>HTTPå¯ä»¥ä½¿ç”¨UDPå—ï¼Ÿ</h5><p>æ³¨ï¼š<strong>http 3.0 ä½¿ç”¨udpå®ç°</strong><br><a href="https://zh.wikipedia.org/wiki/HTTP/3">https://zh.wikipedia.org/wiki/HTTP/3</a></p>
<h5 id="é¢å‘è¿æ¥å’Œæ— è¿æ¥çš„åŒºåˆ«"><a href="#é¢å‘è¿æ¥å’Œæ— è¿æ¥çš„åŒºåˆ«" class="headerlink" title="é¢å‘è¿æ¥å’Œæ— è¿æ¥çš„åŒºåˆ«"></a>é¢å‘è¿æ¥å’Œæ— è¿æ¥çš„åŒºåˆ«</h5><p>æ— è¿æ¥çš„ç½‘ç»œæœåŠ¡ï¼ˆæ•°æ®æŠ¥æœåŠ¡ï¼‰â€“ é¢å‘è¿æ¥çš„ç½‘ç»œæœåŠ¡ï¼ˆè™šç”µè·¯æœåŠ¡ï¼‰<br>è™šç”µè·¯æœåŠ¡ï¼šé¦–å…ˆå»ºç«‹è¿æ¥ï¼Œæ‰€æœ‰çš„æ•°æ®åŒ…ç»è¿‡ç›¸åŒçš„è·¯å¾„ï¼ŒæœåŠ¡è´¨é‡æœ‰è¾ƒå¥½çš„ä¿è¯ï¼›<br>æ•°æ®æŠ¥æœåŠ¡ï¼šæ¯ä¸ªæ•°æ®åŒ…å«ç›®çš„åœ°å€ï¼Œæ•°æ®è·¯ç”±ç›¸äº’ç‹¬ç«‹ï¼ˆè·¯å¾„å¯èƒ½å˜åŒ–ï¼‰ï¼›ç½‘ç»œå°½æœ€å¤§åŠªåŠ›äº¤ä»˜æ•°æ®ï¼Œä½†ä¸ä¿è¯ä¸ä¸¢å¤±ã€ä¸ä¿è¯å…ˆåé¡ºåºã€ä¸ä¿è¯åœ¨æ—¶é™å†…äº¤ä»˜ï¼›ç½‘ç»œå‘ç”Ÿæ‹¥å¡æ—¶ï¼Œå¯èƒ½ä¼šå°†ä¸€äº›åˆ†ç»„ä¸¢å¼ƒï¼›</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628084520127-fb51536c-1fee-4fa4-a450-684dab556f9e.png#height=494&id=HncLV&originHeight=659&originWidth=769&originalType=binary&ratio=1&status=done&style=none&width=577"></p>
<h3 id="TCPå¦‚ä½•ä¿è¯ä¼ è¾“çš„å¯é æ€§"><a href="#TCPå¦‚ä½•ä¿è¯ä¼ è¾“çš„å¯é æ€§" class="headerlink" title="TCPå¦‚ä½•ä¿è¯ä¼ è¾“çš„å¯é æ€§"></a>TCPå¦‚ä½•ä¿è¯ä¼ è¾“çš„å¯é æ€§</h3><ol>
<li>æ•°æ®åŒ…æ ¡éªŒ</li>
<li>å¯¹å¤±åºæ•°æ®åŒ…é‡æ–°æ’åºï¼ˆTCPæŠ¥æ–‡å…·æœ‰åºåˆ—å·ï¼‰</li>
<li>ä¸¢å¼ƒé‡å¤æ•°æ®</li>
<li>åº”ç­”æœºåˆ¶ï¼šæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®ä¹‹åï¼Œä¼šå‘é€ä¸€ä¸ªç¡®è®¤ï¼ˆé€šå¸¸å»¶è¿Ÿå‡ åˆ†ä¹‹ä¸€ç§’ï¼‰ï¼›</li>
<li>è¶…æ—¶é‡å‘ï¼šå‘é€æ–¹å‘å‡ºæ•°æ®ä¹‹åï¼Œå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¶…æ—¶æœªæ”¶åˆ°æ¥æ”¶æ–¹çš„ç¡®è®¤ï¼Œåˆ™é‡æ–°å‘é€è¿™ä¸ªæ•°æ®ï¼›</li>
<li>æµé‡æ§åˆ¶ï¼šç¡®ä¿æ¥æ”¶ç«¯èƒ½å¤Ÿæ¥æ”¶å‘é€æ–¹çš„æ•°æ®è€Œä¸ä¼šç¼“å†²åŒºæº¢å‡º<h1 id="åº”ç”¨å±‚ï¼šHTTPå’ŒHTTPS"><a href="#åº”ç”¨å±‚ï¼šHTTPå’ŒHTTPS" class="headerlink" title="åº”ç”¨å±‚ï¼šHTTPå’ŒHTTPS"></a>åº”ç”¨å±‚ï¼šHTTPå’ŒHTTPS</h1></li>
</ol>
<h3 id="HTTPå’ŒHTTPSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#HTTPå’ŒHTTPSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="HTTPå’ŒHTTPSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>HTTPå’ŒHTTPSæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ol>
<li>ç«¯å£ä¸åŒï¼šHTTPä½¿ç”¨çš„æ˜¯80ç«¯å£ï¼ŒHTTPSä½¿ç”¨443ç«¯å£ï¼›</li>
<li>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰ä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼ŒHTTPSè¿è¡Œåœ¨SSL(Secure Socket Layer)ä¹‹ä¸Šï¼Œæ·»åŠ äº†åŠ å¯†å’Œè®¤è¯æœºåˆ¶ï¼Œæ›´åŠ å®‰å…¨ï¼›</li>
<li>HTTPSç”±äºåŠ å¯†è§£å¯†ä¼šå¸¦æ¥æ›´å¤§çš„CPUå’Œå†…å­˜å¼€é”€ï¼›</li>
<li>HTTPSé€šä¿¡éœ€è¦è¯ä¹¦ï¼Œä¸€èˆ¬éœ€è¦å‘è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰è´­ä¹°</li>
</ol>
<h5 id="Httpsçš„è¿æ¥è¿‡ç¨‹ï¼Ÿ"><a href="#Httpsçš„è¿æ¥è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="Httpsçš„è¿æ¥è¿‡ç¨‹ï¼Ÿ"></a>Httpsçš„è¿æ¥è¿‡ç¨‹ï¼Ÿ</h5><ol>
<li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒåŒæ—¶å‘é€å®¢æˆ·ç«¯æ”¯æŒçš„ä¸€å¥—åŠ å¯†è§„åˆ™ï¼ˆåŒ…æ‹¬å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€æ‘˜è¦ç®—æ³•ï¼‰ï¼›</li>
<li>æœåŠ¡å™¨ä»ä¸­é€‰å‡ºä¸€ç»„åŠ å¯†ç®—æ³•ä¸HASHç®—æ³•ï¼Œå¹¶å°†è‡ªå·±çš„èº«ä»½ä¿¡æ¯ä»¥è¯ä¹¦çš„å½¢å¼å‘å›ç»™æµè§ˆå™¨ã€‚è¯ä¹¦é‡Œé¢åŒ…å«äº†ç½‘ç«™åœ°å€ï¼Œ<strong>åŠ å¯†å…¬é’¥</strong>ï¼ˆç”¨äºéå¯¹ç§°åŠ å¯†ï¼‰ï¼Œä»¥åŠè¯ä¹¦çš„é¢å‘æœºæ„ç­‰ä¿¡æ¯ï¼ˆè¯ä¹¦ä¸­çš„ç§é’¥åªèƒ½ç”¨äºæœåŠ¡å™¨ç«¯è¿›è¡Œè§£å¯†ï¼‰ï¼›</li>
<li>å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨çš„åˆæ³•æ€§ï¼ŒåŒ…æ‹¬ï¼šè¯ä¹¦æ˜¯å¦è¿‡æœŸï¼ŒCA æ˜¯å¦å¯é ï¼Œå‘è¡Œè€…è¯ä¹¦çš„å…¬é’¥èƒ½å¦æ­£ç¡®è§£å¼€æœåŠ¡å™¨è¯ä¹¦çš„â€œå‘è¡Œè€…çš„æ•°å­—ç­¾åâ€ï¼ŒæœåŠ¡å™¨è¯ä¹¦ä¸Šçš„åŸŸåæ˜¯å¦å’ŒæœåŠ¡å™¨çš„å®é™…åŸŸåç›¸åŒ¹é…ï¼›</li>
<li>å¦‚æœè¯ä¹¦å—ä¿¡ä»»ï¼Œæˆ–è€…ç”¨æˆ·æ¥æ”¶äº†ä¸å—ä¿¡ä»»çš„è¯ä¹¦ï¼Œæµè§ˆå™¨ä¼šç”Ÿæˆä¸€ä¸ª<strong>éšæœºå¯†é’¥</strong>ï¼ˆç”¨äºå¯¹ç§°ç®—æ³•ï¼‰ï¼Œå¹¶ç”¨æœåŠ¡å™¨æä¾›çš„å…¬é’¥åŠ å¯†ï¼ˆé‡‡ç”¨éå¯¹ç§°ç®—æ³•å¯¹å¯†é’¥åŠ å¯†ï¼‰ï¼›ä½¿ç”¨Hashç®—æ³•å¯¹æ¡æ‰‹æ¶ˆæ¯è¿›è¡Œ<strong>æ‘˜è¦</strong>è®¡ç®—ï¼Œå¹¶å¯¹æ‘˜è¦ä½¿ç”¨ä¹‹å‰äº§ç”Ÿçš„å¯†é’¥åŠ å¯†ï¼ˆå¯¹ç§°ç®—æ³•ï¼‰ï¼›å°†åŠ å¯†åçš„éšæœºå¯†é’¥å’Œæ‘˜è¦ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨ï¼›</li>
<li>æœåŠ¡å™¨ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ï¼Œå¾—åˆ°å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œç”¨è¿™ä¸ªå¯†é’¥è§£å¯†å‡ºHashæ‘˜è¦å€¼ï¼Œå¹¶éªŒè¯æ¡æ‰‹æ¶ˆæ¯æ˜¯å¦ä¸€è‡´ï¼›å¦‚æœä¸€è‡´ï¼ŒæœåŠ¡å™¨ä½¿ç”¨å¯¹ç§°åŠ å¯†çš„å¯†é’¥åŠ å¯†æ¡æ‰‹æ¶ˆæ¯å‘ç»™æµè§ˆå™¨ï¼›</li>
<li>æµè§ˆå™¨è§£å¯†å¹¶éªŒè¯æ‘˜è¦ï¼Œè‹¥ä¸€è‡´ï¼Œåˆ™æ¡æ‰‹ç»“æŸã€‚ä¹‹åçš„æ•°æ®ä¼ é€éƒ½ä½¿ç”¨å¯¹ç§°åŠ å¯†çš„å¯†é’¥è¿›è¡ŒåŠ å¯†</li>
</ol>
<p>æ€»ç»“ï¼šéå¯¹ç§°åŠ å¯†ç®—æ³•ç”¨äºåœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­åŠ å¯†ç”Ÿæˆçš„å¯†ç ï¼›å¯¹ç§°åŠ å¯†ç®—æ³•ç”¨äºå¯¹çœŸæ­£ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼›HASHç®—æ³•ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p>
<h5 id="è¾“å…¥-www-baidu-comï¼Œæ€ä¹ˆå˜æˆ-https-www-baidu-com-çš„ï¼Œæ€ä¹ˆç¡®å®šç”¨HTTPè¿˜æ˜¯HTTPSï¼Ÿ"><a href="#è¾“å…¥-www-baidu-comï¼Œæ€ä¹ˆå˜æˆ-https-www-baidu-com-çš„ï¼Œæ€ä¹ˆç¡®å®šç”¨HTTPè¿˜æ˜¯HTTPSï¼Ÿ" class="headerlink" title="è¾“å…¥ www.baidu.comï¼Œæ€ä¹ˆå˜æˆ https://www.baidu.com çš„ï¼Œæ€ä¹ˆç¡®å®šç”¨HTTPè¿˜æ˜¯HTTPSï¼Ÿ"></a>è¾“å…¥ <a href="http://www.baidu.com,æ€ä¹ˆå˜æˆ/">www.baidu.comï¼Œæ€ä¹ˆå˜æˆ</a> <a href="https://www.baidu.com/">https://www.baidu.com</a> çš„ï¼Œæ€ä¹ˆç¡®å®šç”¨HTTPè¿˜æ˜¯HTTPSï¼Ÿ</h5><p><a href="https://www.sohu.com/a/136637876_487516">ä½ è®¿é—®çš„ç½‘ç«™æ˜¯å¦‚ä½•è‡ªåŠ¨åˆ‡æ¢åˆ° HTTPS çš„ï¼Ÿ</a><br>ä¸€ç§æ˜¯åŸå§‹çš„302è·³è½¬ï¼ŒæœåŠ¡å™¨æŠŠæ‰€æœ‰çš„HTTpæµé‡è·³è½¬åˆ°HTTPSã€‚ä½†è¿™æ ·æœ‰ä¸€ä¸ªæ¼æ´ï¼Œå°±æ˜¯ä¸­é—´äººå¯èƒ½åœ¨ç¬¬ä¸€æ¬¡è®¿é—®ç«™ç‚¹çš„æ—¶å€™å°±åŠ«æŒã€‚<br>è§£å†³æ–¹æ³•æ˜¯å¼•å…¥HSTSæœºåˆ¶ï¼Œç”¨æˆ·æµè§ˆå™¨åœ¨è®¿é—®ç«™ç‚¹çš„æ—¶å€™å¼ºåˆ¶ä½¿ç”¨HTTPSã€‚</p>
<h5 id="HTTPSè¿æ¥çš„æ—¶å€™ï¼Œæ€ä¹ˆç¡®å®šæ”¶åˆ°çš„åŒ…æ˜¯æœåŠ¡å™¨å‘æ¥çš„ï¼ˆä¸­é—´äººæ”»å‡»ï¼‰ï¼Ÿ"><a href="#HTTPSè¿æ¥çš„æ—¶å€™ï¼Œæ€ä¹ˆç¡®å®šæ”¶åˆ°çš„åŒ…æ˜¯æœåŠ¡å™¨å‘æ¥çš„ï¼ˆä¸­é—´äººæ”»å‡»ï¼‰ï¼Ÿ" class="headerlink" title="HTTPSè¿æ¥çš„æ—¶å€™ï¼Œæ€ä¹ˆç¡®å®šæ”¶åˆ°çš„åŒ…æ˜¯æœåŠ¡å™¨å‘æ¥çš„ï¼ˆä¸­é—´äººæ”»å‡»ï¼‰ï¼Ÿ"></a>HTTPSè¿æ¥çš„æ—¶å€™ï¼Œæ€ä¹ˆç¡®å®šæ”¶åˆ°çš„åŒ…æ˜¯æœåŠ¡å™¨å‘æ¥çš„ï¼ˆä¸­é—´äººæ”»å‡»ï¼‰ï¼Ÿ</h5><h5 id="ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ï¼ŸåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ï¼ŸåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ï¼ŸåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ï¼ŸåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h5><ul>
<li>å¯¹ç§°åŠ å¯†ï¼šåŠ å¯†å’Œè§£å¯†é‡‡ç”¨ç›¸åŒçš„å¯†é’¥ã€‚å¦‚ï¼šDESã€RC2ã€RC4</li>
<li>éå¯¹ç§°åŠ å¯†ï¼šéœ€è¦ä¸¤ä¸ªå¯†é’¥ï¼šå…¬é’¥å’Œç§é’¥ã€‚å¦‚æœç”¨å…¬é’¥åŠ å¯†ï¼Œéœ€è¦ç”¨ç§é’¥æ‰èƒ½è§£å¯†ã€‚å¦‚ï¼šRSA</li>
<li>åŒºåˆ«ï¼šå¯¹ç§°åŠ å¯†é€Ÿåº¦æ›´å¿«ï¼Œé€šå¸¸ç”¨äºå¤§é‡æ•°æ®çš„åŠ å¯†ï¼›éå¯¹ç§°åŠ å¯†å®‰å…¨æ€§æ›´é«˜ï¼ˆä¸éœ€è¦ä¼ é€ç§é’¥ï¼‰</li>
</ul>
<h5 id="æ•°å­—ç­¾åã€æŠ¥æ–‡æ‘˜è¦çš„åŸç†"><a href="#æ•°å­—ç­¾åã€æŠ¥æ–‡æ‘˜è¦çš„åŸç†" class="headerlink" title="æ•°å­—ç­¾åã€æŠ¥æ–‡æ‘˜è¦çš„åŸç†"></a>æ•°å­—ç­¾åã€æŠ¥æ–‡æ‘˜è¦çš„åŸç†</h5><ul>
<li>å‘é€è€…Aç”¨ç§é’¥è¿›è¡Œç­¾åï¼Œæ¥æ”¶è€…Bç”¨å…¬é’¥éªŒè¯ç­¾åã€‚å› ä¸ºé™¤Aå¤–æ²¡æœ‰äººæœ‰ç§é’¥ï¼Œæ‰€ä»¥Bç›¸ä¿¡ç­¾åæ˜¯æ¥è‡ªAã€‚Aä¸å¯æŠµèµ–ï¼ŒBä¹Ÿä¸èƒ½ä¼ªé€ æŠ¥æ–‡ã€‚</li>
<li>æ‘˜è¦ç®—æ³•:MD5ã€SHA</li>
</ul>
<h3 id="GETä¸POSTçš„åŒºåˆ«ï¼Ÿ"><a href="#GETä¸POSTçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="GETä¸POSTçš„åŒºåˆ«ï¼Ÿ"></a>GETä¸POSTçš„åŒºåˆ«ï¼Ÿ</h3><ol>
<li>GETæ˜¯å¹‚ç­‰çš„ï¼Œå³è¯»å–åŒä¸€ä¸ªèµ„æºï¼Œæ€»æ˜¯å¾—åˆ°ç›¸åŒçš„æ•°æ®ï¼ŒPOSTä¸æ˜¯å¹‚ç­‰çš„ï¼›</li>
<li>GETä¸€èˆ¬ç”¨äºä»æœåŠ¡å™¨è·å–èµ„æºï¼Œè€ŒPOSTæœ‰å¯èƒ½æ”¹å˜æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼›</li>
<li>è¯·æ±‚å½¢å¼ä¸Šï¼šGETè¯·æ±‚çš„æ•°æ®é™„åœ¨URLä¹‹åï¼Œåœ¨HTTPè¯·æ±‚å¤´ä¸­ï¼›POSTè¯·æ±‚çš„æ•°æ®åœ¨è¯·æ±‚ä½“ä¸­ï¼›</li>
<li>å®‰å…¨æ€§ï¼šGETè¯·æ±‚å¯è¢«ç¼“å­˜ã€æ”¶è—ã€ä¿ç•™åˆ°å†å²è®°å½•ï¼Œä¸”å…¶è¯·æ±‚æ•°æ®æ˜æ–‡å‡ºç°åœ¨URLä¸­ã€‚POSTçš„å‚æ•°ä¸ä¼šè¢«ä¿å­˜ï¼Œå®‰å…¨æ€§ç›¸å¯¹è¾ƒé«˜ï¼›</li>
<li>GETåªå…è®¸ASCIIå­—ç¬¦ï¼ŒPOSTå¯¹æ•°æ®ç±»å‹æ²¡æœ‰è¦æ±‚ï¼Œä¹Ÿå…è®¸äºŒè¿›åˆ¶æ•°æ®ï¼›</li>
<li>GETçš„é•¿åº¦æœ‰é™åˆ¶ï¼ˆæ“ä½œç³»ç»Ÿæˆ–è€…æµè§ˆå™¨ï¼‰ï¼Œè€ŒPOSTæ•°æ®å¤§å°æ— é™åˆ¶</li>
</ol>
<h3 id="Sessionä¸Cookieçš„åŒºåˆ«ï¼Ÿ"><a href="#Sessionä¸Cookieçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="Sessionä¸Cookieçš„åŒºåˆ«ï¼Ÿ"></a>Sessionä¸Cookieçš„åŒºåˆ«ï¼Ÿ</h3><p>Sessionæ˜¯æœåŠ¡å™¨ç«¯ä¿æŒçŠ¶æ€çš„æ–¹æ¡ˆï¼ŒCookieæ˜¯å®¢æˆ·ç«¯ä¿æŒçŠ¶æ€çš„æ–¹æ¡ˆ<br>Cookieä¿å­˜åœ¨å®¢æˆ·ç«¯æœ¬åœ°ï¼Œå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨æ—¶ä¼šå°†Cookieä¸€èµ·æäº¤ï¼›Sessionä¿å­˜åœ¨æœåŠ¡ç«¯ï¼Œé€šè¿‡æ£€ç´¢SessionidæŸ¥çœ‹çŠ¶æ€ã€‚ä¿å­˜Sessionidçš„æ–¹å¼å¯ä»¥é‡‡ç”¨Cookieï¼Œå¦‚æœç¦ç”¨äº†Cookieï¼Œå¯ä»¥ä½¿ç”¨URLé‡å†™æœºåˆ¶ï¼ˆæŠŠä¼šè¯IDä¿å­˜åœ¨URLä¸­ï¼‰ã€‚</p>
<h3 id="ä»è¾“å…¥ç½‘å€åˆ°è·å¾—é¡µé¢çš„è¿‡ç¨‹-è¶Šè¯¦ç»†è¶Šå¥½-ï¼Ÿ"><a href="#ä»è¾“å…¥ç½‘å€åˆ°è·å¾—é¡µé¢çš„è¿‡ç¨‹-è¶Šè¯¦ç»†è¶Šå¥½-ï¼Ÿ" class="headerlink" title="ä»è¾“å…¥ç½‘å€åˆ°è·å¾—é¡µé¢çš„è¿‡ç¨‹ (è¶Šè¯¦ç»†è¶Šå¥½)ï¼Ÿ"></a>ä»è¾“å…¥ç½‘å€åˆ°è·å¾—é¡µé¢çš„è¿‡ç¨‹ (è¶Šè¯¦ç»†è¶Šå¥½)ï¼Ÿ</h3><ol>
<li>æµè§ˆå™¨æŸ¥è¯¢ DNSï¼Œè·å–åŸŸåå¯¹åº”çš„IPåœ°å€:å…·ä½“è¿‡ç¨‹åŒ…æ‹¬æµè§ˆå™¨æœç´¢è‡ªèº«çš„DNSç¼“å­˜ã€æœç´¢æ“ä½œç³»ç»Ÿçš„DNSç¼“å­˜ã€è¯»å–æœ¬åœ°çš„Hostæ–‡ä»¶å’Œå‘æœ¬åœ°DNSæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ç­‰ã€‚å¯¹äºå‘æœ¬åœ°DNSæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœè¦æŸ¥è¯¢çš„åŸŸååŒ…å«åœ¨æœ¬åœ°é…ç½®åŒºåŸŸèµ„æºä¸­ï¼Œåˆ™è¿”å›è§£æç»“æœç»™å®¢æˆ·æœºï¼Œå®ŒæˆåŸŸåè§£æ(æ­¤è§£æå…·æœ‰æƒå¨æ€§)ï¼›å¦‚æœè¦æŸ¥è¯¢çš„åŸŸåä¸ç”±æœ¬åœ°DNSæœåŠ¡å™¨åŒºåŸŸè§£æï¼Œä½†è¯¥æœåŠ¡å™¨å·²ç¼“å­˜äº†æ­¤ç½‘å€æ˜ å°„å…³ç³»ï¼Œåˆ™è°ƒç”¨è¿™ä¸ªIPåœ°å€æ˜ å°„ï¼Œå®ŒæˆåŸŸåè§£æï¼ˆæ­¤è§£æä¸å…·æœ‰æƒå¨æ€§ï¼‰ã€‚å¦‚æœæœ¬åœ°åŸŸåæœåŠ¡å™¨å¹¶æœªç¼“å­˜è¯¥ç½‘å€æ˜ å°„å…³ç³»ï¼Œé‚£ä¹ˆå°†æ ¹æ®å…¶è®¾ç½®å‘èµ·é€’å½’æŸ¥è¯¢æˆ–è€…è¿­ä»£æŸ¥è¯¢ï¼›</li>
<li>æµè§ˆå™¨è·å¾—åŸŸåå¯¹åº”çš„IPåœ°å€ä»¥åï¼Œæµè§ˆå™¨å‘æœåŠ¡å™¨è¯·æ±‚å»ºç«‹é“¾æ¥ï¼Œå‘èµ·ä¸‰æ¬¡æ¡æ‰‹ï¼›</li>
<li>TCP/IPé“¾æ¥å»ºç«‹èµ·æ¥åï¼Œæµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚ï¼›</li>
<li>æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶æ ¹æ®è·¯å¾„å‚æ•°æ˜ å°„åˆ°ç‰¹å®šçš„è¯·æ±‚å¤„ç†å™¨è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å¤„ç†ç»“æœåŠç›¸åº”çš„è§†å›¾è¿”å›ç»™æµè§ˆå™¨ï¼›</li>
<li>æµè§ˆå™¨è§£æå¹¶æ¸²æŸ“è§†å›¾ï¼Œè‹¥é‡åˆ°å¯¹jsæ–‡ä»¶ã€cssæ–‡ä»¶åŠå›¾ç‰‡ç­‰é™æ€èµ„æºçš„å¼•ç”¨ï¼Œåˆ™é‡å¤ä¸Šè¿°æ­¥éª¤å¹¶å‘æœåŠ¡å™¨è¯·æ±‚è¿™äº›èµ„æºï¼›</li>
<li>æµè§ˆå™¨æ ¹æ®å…¶è¯·æ±‚åˆ°çš„èµ„æºã€æ•°æ®æ¸²æŸ“é¡µé¢ï¼Œæœ€ç»ˆå‘ç”¨æˆ·å‘ˆç°ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ã€‚</li>
</ol>
<h3 id="HTTPè¯·æ±‚æœ‰å“ªäº›å¸¸è§çŠ¶æ€ç ï¼Ÿ"><a href="#HTTPè¯·æ±‚æœ‰å“ªäº›å¸¸è§çŠ¶æ€ç ï¼Ÿ" class="headerlink" title="HTTPè¯·æ±‚æœ‰å“ªäº›å¸¸è§çŠ¶æ€ç ï¼Ÿ"></a>HTTPè¯·æ±‚æœ‰å“ªäº›å¸¸è§çŠ¶æ€ç ï¼Ÿ</h3><ol>
<li>2xxçŠ¶æ€ç ï¼šæ“ä½œæˆåŠŸã€‚200 OK</li>
<li>3xxçŠ¶æ€ç ï¼šé‡å®šå‘ã€‚301 æ°¸ä¹…é‡å®šå‘ï¼›302æš‚æ—¶é‡å®šå‘</li>
<li>4xxçŠ¶æ€ç ï¼šå®¢æˆ·ç«¯é”™è¯¯ã€‚400 Bad Requestï¼›401 Unauthorizedï¼›403 Forbiddenï¼›404 Not Foundï¼›</li>
<li>5xxçŠ¶æ€ç ï¼šæœåŠ¡ç«¯é”™è¯¯ã€‚500æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼›501æœåŠ¡ä¸å¯ç”¨</li>
</ol>
<h3 id="ä»€ä¹ˆæ˜¯RIP-Routing-Information-Protocol-è·ç¦»çŸ¢é‡è·¯ç”±åè®®-ç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯RIP-Routing-Information-Protocol-è·ç¦»çŸ¢é‡è·¯ç”±åè®®-ç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯RIP (Routing Information Protocol, è·ç¦»çŸ¢é‡è·¯ç”±åè®®)? ç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä»€ä¹ˆæ˜¯RIP (Routing Information Protocol, è·ç¦»çŸ¢é‡è·¯ç”±åè®®)? ç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>æ¯ä¸ªè·¯ç”±å™¨ç»´æŠ¤ä¸€å¼ è¡¨ï¼Œè®°å½•è¯¥è·¯ç”±å™¨åˆ°å…¶å®ƒç½‘ç»œçš„â€è·³æ•°â€œï¼Œè·¯ç”±å™¨åˆ°ä¸å…¶ç›´æ¥è¿æ¥çš„ç½‘ç»œçš„è·³æ•°æ˜¯1ï¼Œæ¯å¤šç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨è·³æ•°å°±åŠ 1ï¼›æ›´æ–°è¯¥è¡¨æ—¶å’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢è·¯ç”±ä¿¡æ¯ï¼›è·¯ç”±å™¨å…è®¸ä¸€ä¸ªè·¯å¾„æœ€å¤šåŒ…å«15ä¸ªè·¯ç”±å™¨ï¼Œå¦‚æœè·³æ•°ä¸º16ï¼Œåˆ™ä¸å¯è¾¾ã€‚äº¤ä»˜æ•°æ®æŠ¥æ—¶ä¼˜å…ˆé€‰å–è·ç¦»æœ€çŸ­çš„è·¯å¾„ã€‚</p>
<p>ï¼ˆPSï¼šRIPæ˜¯åº”ç”¨å±‚åè®®ï¼š<a href="https://www.zhihu.com/question/19645407">https://www.zhihu.com/question/19645407</a>ï¼‰</p>
<ul>
<li>å®ç°ç®€å•ï¼Œå¼€é”€å°</li>
<li>éšç€ç½‘ç»œè§„æ¨¡æ‰©å¤§å¼€é”€ä¹Ÿä¼šå¢å¤§ï¼›</li>
<li>æœ€å¤§è·ç¦»ä¸º15ï¼Œé™åˆ¶äº†ç½‘ç»œçš„è§„æ¨¡ï¼›</li>
<li>å½“ç½‘ç»œå‡ºç°æ•…éšœæ—¶ï¼Œè¦ç»è¿‡è¾ƒé•¿çš„æ—¶é—´æ‰èƒ½å°†æ­¤ä¿¡æ¯ä¼ é€’åˆ°æ‰€æœ‰è·¯ç”±å™¨</li>
<li>äº¤æ¢æœºæ•°æ®é“¾è·¯å±‚ï¼Œæ ¹æ®MACåœ°å€è¿›è¡Œå¯»å€</li>
</ul>
<h1 id="ç½‘ç»œå±‚åè®®"><a href="#ç½‘ç»œå±‚åè®®" class="headerlink" title="ç½‘ç»œå±‚åè®®"></a>ç½‘ç»œå±‚åè®®</h1><h3 id="IPåœ°å€çš„åˆ†ç±»ï¼Ÿ"><a href="#IPåœ°å€çš„åˆ†ç±»ï¼Ÿ" class="headerlink" title="IPåœ°å€çš„åˆ†ç±»ï¼Ÿ"></a>IPåœ°å€çš„åˆ†ç±»ï¼Ÿ</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628084593202-102c8a14-99c6-463c-8bde-866b86d19613.png"></p>
<p>è·¯ç”±å™¨ä»…æ ¹æ®ç½‘ç»œå·net-idæ¥è½¬å‘åˆ†ç»„ï¼Œå½“åˆ†ç»„åˆ°è¾¾ç›®çš„ç½‘ç»œçš„è·¯ç”±å™¨ä¹‹åï¼Œå†æŒ‰ç…§ä¸»æœºå·host-idå°†åˆ†ç»„äº¤ä»˜ç»™ä¸»æœºï¼›åŒä¸€ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºçš„ç½‘ç»œå·ç›¸åŒã€‚</p>
<h3 id="ä»€ä¹ˆå«åˆ’åˆ†å­ç½‘ï¼Ÿ"><a href="#ä»€ä¹ˆå«åˆ’åˆ†å­ç½‘ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆå«åˆ’åˆ†å­ç½‘ï¼Ÿ"></a>ä»€ä¹ˆå«åˆ’åˆ†å­ç½‘ï¼Ÿ</h3><p>ä»ä¸»æœºå·host-idå€Ÿç”¨è‹¥å¹²ä¸ªæ¯”ç‰¹ä½œä¸ºå­ç½‘å·subnet-idï¼›å­ç½‘æ©ç ï¼šç½‘ç»œå·å’Œå­ç½‘å·éƒ½ä¸º1ï¼Œä¸»æœºå·ä¸º0ï¼›æ•°æ®æŠ¥ä»ç„¶å…ˆæŒ‰ç…§ç½‘ç»œå·æ‰¾åˆ°ç›®çš„ç½‘ç»œï¼Œå‘é€åˆ°è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨å†æŒ‰ç…§ç½‘ç»œå·å’Œå­ç½‘å·æ‰¾åˆ°ç›®çš„å­ç½‘ï¼šå°†å­ç½‘æ©ç ä¸ç›®æ ‡åœ°å€é€æ¯”ç‰¹ä¸æ“ä½œï¼Œè‹¥ç»“æœä¸ºæŸä¸ªå­ç½‘çš„ç½‘ç»œåœ°å€ï¼Œåˆ™é€åˆ°è¯¥å­ç½‘ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯ARPåè®®-Address-Resolution-Protocol-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ARPåè®®-Address-Resolution-Protocol-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ARPåè®® (Address Resolution Protocol)ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ARPåè®® (Address Resolution Protocol)ï¼Ÿ</h3><p><strong>ARPåè®®å®Œæˆäº†IPåœ°å€ä¸ç‰©ç†åœ°å€çš„æ˜ å°„</strong>ã€‚æ¯ä¸€ä¸ªä¸»æœºéƒ½è®¾æœ‰ä¸€ä¸ª ARP é«˜é€Ÿç¼“å­˜ï¼Œé‡Œé¢æœ‰<strong>æ‰€åœ¨çš„å±€åŸŸç½‘</strong>ä¸Šçš„å„ä¸»æœºå’Œè·¯ç”±å™¨çš„ IP åœ°å€åˆ°ç¡¬ä»¶åœ°å€çš„æ˜ å°„è¡¨ã€‚å½“æºä¸»æœºè¦å‘é€æ•°æ®åŒ…åˆ°ç›®çš„ä¸»æœºæ—¶ï¼Œä¼šå…ˆæ£€æŸ¥è‡ªå·±çš„ARPé«˜é€Ÿç¼“å­˜ä¸­æœ‰æ²¡æœ‰ç›®çš„ä¸»æœºçš„MACåœ°å€ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥å°†æ•°æ®åŒ…å‘åˆ°è¿™ä¸ªMACåœ°å€ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å‘<strong>æ‰€åœ¨çš„å±€åŸŸç½‘</strong>å‘èµ·ä¸€ä¸ªARPè¯·æ±‚çš„å¹¿æ’­åŒ…ï¼ˆåœ¨å‘é€è‡ªå·±çš„ ARP è¯·æ±‚æ—¶ï¼ŒåŒæ—¶ä¼šå¸¦ä¸Šè‡ªå·±çš„ IP åœ°å€åˆ°ç¡¬ä»¶åœ°å€çš„æ˜ å°„ï¼‰ï¼Œæ”¶åˆ°è¯·æ±‚çš„ä¸»æœºæ£€æŸ¥è‡ªå·±çš„IPåœ°å€å’Œç›®çš„ä¸»æœºçš„IPåœ°å€æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™å…ˆä¿å­˜æºä¸»æœºçš„æ˜ å°„åˆ°è‡ªå·±çš„ARPç¼“å­˜ï¼Œç„¶åç»™æºä¸»æœºå‘é€ä¸€ä¸ªARPå“åº”æ•°æ®åŒ…ã€‚æºä¸»æœºæ”¶åˆ°å“åº”æ•°æ®åŒ…ä¹‹åï¼Œå…ˆæ·»åŠ ç›®çš„ä¸»æœºçš„IPåœ°å€ä¸MACåœ°å€çš„æ˜ å°„ï¼Œå†è¿›è¡Œæ•°æ®ä¼ é€ã€‚å¦‚æœæºä¸»æœºä¸€ç›´æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œè¡¨ç¤ºARPæŸ¥è¯¢å¤±è´¥ã€‚</p>
<p>å¦‚æœæ‰€è¦æ‰¾çš„ä¸»æœºå’Œæºä¸»æœºä¸åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ä¸Šï¼Œé‚£ä¹ˆå°±è¦é€šè¿‡ ARP æ‰¾åˆ°ä¸€ä¸ªä½äºæœ¬å±€åŸŸç½‘ä¸Šçš„æŸä¸ªè·¯ç”±å™¨çš„ç¡¬ä»¶åœ°å€ï¼Œç„¶åæŠŠåˆ†ç»„å‘é€ç»™è¿™ä¸ªè·¯ç”±å™¨ï¼Œè®©è¿™ä¸ªè·¯ç”±å™¨æŠŠåˆ†ç»„è½¬å‘ç»™ä¸‹ä¸€ä¸ªç½‘ç»œã€‚å‰©ä¸‹çš„å·¥ä½œå°±ç”±ä¸‹ä¸€ä¸ªç½‘ç»œæ¥åšã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯NAT-Network-Address-Translation-ç½‘ç»œåœ°å€è½¬æ¢-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯NAT-Network-Address-Translation-ç½‘ç»œåœ°å€è½¬æ¢-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯NAT (Network Address Translation, ç½‘ç»œåœ°å€è½¬æ¢)ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯NAT (Network Address Translation, ç½‘ç»œåœ°å€è½¬æ¢)ï¼Ÿ</h3><p>ç”¨äºè§£å†³å†…ç½‘ä¸­çš„ä¸»æœºè¦å’Œå› ç‰¹ç½‘ä¸Šçš„ä¸»æœºé€šä¿¡ã€‚ç”±NATè·¯ç”±å™¨å°†ä¸»æœºçš„æœ¬åœ°IPåœ°å€è½¬æ¢ä¸ºå…¨çƒIPåœ°å€ï¼Œåˆ†ä¸ºé™æ€è½¬æ¢ï¼ˆè½¬æ¢å¾—åˆ°çš„å…¨çƒIPåœ°å€å›ºå®šä¸å˜ï¼‰å’ŒåŠ¨æ€NATè½¬æ¢ã€‚</p>
<p>æ–‡ç« å†…å®¹æ¬è¿è‡ªæœ¬äºº<a href="https://www.yuque.com/docs/share/5b2ba306-5030-4cff-8c82-19ecb35b4f40">è¯­é›€</a></p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
        <category>å…«è‚¡æ–‡</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢è¯•å…«è‚¡æ–‡ï¼ˆä¸‰ï¼‰â€”â€” æ•°æ®åº“</title>
    <url>/2021/09/22/%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94-%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<meta name="referrer" content="no-referrer" />

<h1 id="æ•°æ®åº“åŸºç¡€"><a href="#æ•°æ®åº“åŸºç¡€" class="headerlink" title="æ•°æ®åº“åŸºç¡€"></a>æ•°æ®åº“åŸºç¡€</h1><h3 id="äº‹åŠ¡çš„æ¦‚å¿µå’Œç‰¹æ€§ï¼Ÿ"><a href="#äº‹åŠ¡çš„æ¦‚å¿µå’Œç‰¹æ€§ï¼Ÿ" class="headerlink" title="äº‹åŠ¡çš„æ¦‚å¿µå’Œç‰¹æ€§ï¼Ÿ"></a>äº‹åŠ¡çš„æ¦‚å¿µå’Œç‰¹æ€§ï¼Ÿ</h3><p>æ¦‚å¿µï¼šäº‹åŠ¡ï¼ˆTransactionï¼‰æ˜¯ä¸€ä¸ªæ“ä½œåºåˆ—ï¼Œä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œä»¥BEGIN TRANSACTIONå¼€å§‹ï¼Œä»¥ROLLBACK/COMMITç»“æŸ<br>ç‰¹æ€§ï¼ˆACIDï¼‰ï¼š</p>
<ul>
<li><strong>åŸå­æ€§</strong>ï¼ˆAtomicityï¼‰ï¼šé€»è¾‘ä¸Šæ˜¯ä¸å¯åˆ†å‰²çš„æ“ä½œå•å…ƒï¼Œäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šï¼ˆç”¨å›æ»šæ—¥å¿—å®ç°ï¼Œåå‘æ‰§è¡Œæ—¥å¿—ä¸­çš„æ“ä½œï¼‰ï¼›</li>
<li><strong>ä¸€è‡´æ€§</strong>ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡çš„æ‰§è¡Œå¿…é¡»ä½¿æ•°æ®åº“ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚åœ¨ä¸€è‡´æ€§çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰äº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®çš„è¯»å–ç»“æœéƒ½æ˜¯ç›¸åŒçš„ï¼›</li>
<li><strong>éš”ç¦»æ€§</strong>ï¼ˆIsolationï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ï¼ˆå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¹‹é—´ä¸èƒ½ç›¸äº’å½±å“ï¼‰ï¼›</li>
<li><strong>æŒä¹…æ€§</strong>ï¼ˆDurabilityï¼‰ï¼šä¸€æ—¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„</li>
</ul>
<h3 id="ä¼šå‡ºç°å“ªäº›å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ"><a href="#ä¼šå‡ºç°å“ªäº›å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ" class="headerlink" title="ä¼šå‡ºç°å“ªäº›å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ"></a>ä¼šå‡ºç°å“ªäº›å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</h3><ul>
<li><strong>ä¸¢å¤±ä¿®æ”¹</strong>ï¼šä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¦†ç›–äº†ä¹‹å‰çš„ä¿®æ”¹ï¼›</li>
<li><strong>è„è¯»</strong>ï¼ˆDirty Readï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–äº†è¢«å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹ã€ä½†æœªæäº¤ï¼ˆè¿›è¡Œäº†å›æ»šï¼‰çš„æ•°æ®ï¼Œé€ æˆä¸¤ä¸ªäº‹åŠ¡å¾—åˆ°çš„æ•°æ®ä¸ä¸€è‡´ï¼›</li>
<li><strong>ä¸å¯é‡å¤è¯»</strong>ï¼ˆNonrepeatable Readï¼‰ï¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒæŸæŸ¥è¯¢æ“ä½œåœ¨ä¸€ä¸ªæ—¶é—´è¯»å–æŸä¸€è¡Œæ•°æ®å’Œä¹‹åä¸€ä¸ªæ—¶é—´è¯»å–è¯¥è¡Œæ•°æ®ï¼Œå‘ç°æ•°æ®å·²ç»å‘ç”Ÿä¿®æ”¹ï¼ˆé’ˆå¯¹<strong>update</strong>æ“ä½œï¼‰ï¼›</li>
<li><strong>å¹»è¯»</strong>ï¼ˆPhantom Readï¼‰ï¼šå½“åŒä¸€æŸ¥è¯¢å¤šæ¬¡æ‰§è¡Œæ—¶ï¼Œç”±äºå…¶å®ƒäº‹åŠ¡åœ¨è¿™ä¸ªæ•°æ®èŒƒå›´å†…æ‰§è¡Œäº†æ’å…¥æ“ä½œï¼Œä¼šå¯¼è‡´æ¯æ¬¡è¿”å›ä¸åŒçš„ç»“æœé›†ï¼ˆå’Œä¸å¯é‡å¤è¯»çš„åŒºåˆ«ï¼šé’ˆå¯¹çš„æ˜¯ä¸€ä¸ªæ•°æ®æ•´ä½“/èŒƒå›´ï¼›å¹¶ä¸”é’ˆå¯¹<strong>insert/delete</strong>æ“ä½œï¼‰</li>
</ul>
<h3 id="æ•°æ®åº“çš„å››ç§éš”ç¦»çº§åˆ«ï¼Ÿ"><a href="#æ•°æ®åº“çš„å››ç§éš”ç¦»çº§åˆ«ï¼Ÿ" class="headerlink" title="æ•°æ®åº“çš„å››ç§éš”ç¦»çº§åˆ«ï¼Ÿ"></a>æ•°æ®åº“çš„å››ç§éš”ç¦»çº§åˆ«ï¼Ÿ</h3><ul>
<li><strong>æœªæäº¤è¯»</strong>ï¼ˆRead Uncommitedï¼‰ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå®ƒçš„æ‰§è¡Œç»“æœå¯¹å…¶å®ƒäº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚ä¼šå¯¼è‡´è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼›</li>
<li><strong>æäº¤è¯»</strong>ï¼ˆRead Commitedï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤çš„äº‹åŠ¡æ‰€ä½œçš„æ”¹å˜ã€‚å¯é¿å…è„è¯»é—®é¢˜ï¼›</li>
<li><strong>å¯é‡å¤è¯»</strong>ï¼ˆRepeatable Readï¼‰ï¼šå¯ä»¥ç¡®ä¿åŒä¸€ä¸ªäº‹åŠ¡åœ¨å¤šæ¬¡è¯»å–åŒæ ·çš„æ•°æ®æ—¶å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚ï¼ˆMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼‰ã€‚å¯é¿å…ä¸å¯é‡å¤è¯»ï¼›</li>
<li><strong>å¯ä¸²è¡ŒåŒ–</strong>ï¼ˆSerializableï¼‰ï¼šå¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œä½¿ä¹‹ä¸å¯èƒ½ç›¸äº’å†²çªï¼Œä»è€Œè§£å†³å¹»è¯»é—®é¢˜ã€‚å¯èƒ½å¯¼è‡´å¤§é‡çš„è¶…æ—¶ç°è±¡å’Œé”ç«äº‰ï¼Œå®é™…å¾ˆå°‘ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ</h3><ul>
<li>æ‚²è§‚é”ï¼šè®¤ä¸ºæ•°æ®éšæ—¶ä¼šè¢«ä¿®æ”¹ï¼Œå› æ­¤æ¯æ¬¡è¯»å–æ•°æ®ä¹‹å‰éƒ½ä¼šä¸Šé”ï¼Œé˜²æ­¢å…¶å®ƒäº‹åŠ¡è¯»å–æˆ–ä¿®æ”¹æ•°æ®ï¼›åº”ç”¨äº<strong>æ•°æ®æ›´æ–°æ¯”è¾ƒé¢‘ç¹</strong>çš„åœºæ™¯ï¼›</li>
<li>ä¹è§‚é”ï¼šæ“ä½œæ•°æ®æ—¶ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯æ›´æ–°æ—¶ä¼šåˆ¤æ–­åœ¨æ­¤æœŸé—´æœ‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œè‹¥è¢«æ›´æ–°è¿‡ï¼Œåˆ™å¤±è´¥é‡è¯•ï¼›é€‚ç”¨äº<strong>è¯»å¤šå†™å°‘</strong>çš„åœºæ™¯ã€‚ä¹è§‚é”çš„å®ç°æ–¹å¼æœ‰ï¼š<ul>
<li>åŠ ä¸€ä¸ªç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³å­—æ®µï¼Œæ¯æ¬¡æ•°æ®æ›´æ–°æ—¶åŒæ—¶æ›´æ–°è¿™ä¸ªå­—æ®µï¼›</li>
<li>å…ˆè¯»å–æƒ³è¦æ›´æ–°çš„å­—æ®µæˆ–è€…æ‰€æœ‰å­—æ®µï¼Œæ›´æ–°çš„æ—¶å€™æ¯”è¾ƒä¸€ä¸‹ï¼Œåªæœ‰å­—æ®µæ²¡æœ‰å˜åŒ–æ‰è¿›è¡Œæ›´æ–°</li>
</ul>
</li>
</ul>
<h3 id="å¸¸è§çš„å°é”ç±»å‹ï¼Ÿ"><a href="#å¸¸è§çš„å°é”ç±»å‹ï¼Ÿ" class="headerlink" title="å¸¸è§çš„å°é”ç±»å‹ï¼Ÿ"></a>å¸¸è§çš„å°é”ç±»å‹ï¼Ÿ</h3><p>æ„å‘é”æ˜¯ InnoDB è‡ªåŠ¨åŠ çš„ï¼Œ ä¸éœ€ç”¨æˆ·å¹²é¢„ã€‚<br>å¯¹äº UPDATEã€ DELETE å’Œ INSERT è¯­å¥ï¼Œ InnoDB<br>ä¼šè‡ªåŠ¨ç»™æ¶‰åŠæ•°æ®é›†åŠ æ’ä»–é”ï¼ˆX)ï¼›<br>å¯¹äºæ™®é€š SELECT è¯­å¥ï¼ŒInnoDB ä¸ä¼šåŠ ä»»ä½•é”ï¼›<br>äº‹åŠ¡å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ˜¾å¼ç»™è®°å½•é›†åŠ å…±äº«é”æˆ–æ’ä»–é”ï¼š<br>å…±äº«é”ï¼ˆSï¼‰ï¼šSELECT * FROM table_name WHERE â€¦ LOCK IN SHARE MODEã€‚ å…¶ä»– session ä»ç„¶å¯ä»¥æŸ¥è¯¢è®°å½•ï¼Œå¹¶ä¹Ÿå¯ä»¥å¯¹è¯¥è®°å½•åŠ  share mode çš„å…±äº«é”ã€‚ä½†æ˜¯å¦‚æœå½“å‰äº‹åŠ¡éœ€è¦å¯¹è¯¥è®°å½•è¿›è¡Œæ›´æ–°æ“ä½œï¼Œåˆ™å¾ˆæœ‰å¯èƒ½é€ æˆæ­»é”ã€‚<br>æ’ä»–é”ï¼ˆX)ï¼šSELECT * FROM table_name WHERE â€¦ FOR UPDATEã€‚å…¶ä»– session å¯ä»¥æŸ¥è¯¢è¯¥è®°å½•ï¼Œä½†æ˜¯ä¸èƒ½å¯¹è¯¥è®°å½•åŠ å…±äº«é”æˆ–æ’ä»–é”ï¼Œè€Œæ˜¯ç­‰å¾…è·å¾—é”</p>
<ul>
<li><strong>æ’å®ƒé”</strong>ï¼ˆExclusive Lockï¼‰/ Xé”ï¼šäº‹åŠ¡å¯¹æ•°æ®åŠ ä¸ŠXé”æ—¶ï¼Œåªå…è®¸æ­¤äº‹åŠ¡è¯»å–å’Œä¿®æ”¹æ­¤æ•°æ®ï¼Œå¹¶ä¸”å…¶å®ƒäº‹åŠ¡ä¸èƒ½å¯¹è¯¥æ•°æ®åŠ ä»»ä½•é”ï¼›</li>
<li><strong>å…±äº«é”</strong>ï¼ˆShared Lockï¼‰/ Sé”ï¼šåŠ äº†Sé”åï¼Œè¯¥äº‹åŠ¡åªèƒ½å¯¹æ•°æ®è¿›è¡Œè¯»å–è€Œä¸èƒ½ä¿®æ”¹ï¼Œå¹¶ä¸”å…¶å®ƒäº‹åŠ¡åªèƒ½åŠ Sé”ï¼Œä¸èƒ½åŠ Xé”</li>
<li><strong>æ„å‘é”</strong>ï¼ˆIntention Locksï¼‰ï¼š<ul>
<li>ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ª<strong>æ•°æ®è¡Œ</strong>å¯¹è±¡çš„ S é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—<strong>æ•´ä¸ªè¡¨</strong>çš„ IS é”æˆ–æ›´å¼ºçš„é”ï¼›</li>
<li>ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ªæ•°æ®è¡Œå¯¹è±¡çš„ X é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—æ•´ä¸ªè¡¨çš„ IX é”ï¼›</li>
<li>IS/IX é”ä¹‹é—´éƒ½æ˜¯å…¼å®¹çš„ï¼›</li>
<li>å¥½å¤„ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡æƒ³è¦å¯¹æ•´ä¸ªè¡¨åŠ Xé”ï¼Œå°±éœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰å…¶å®ƒäº‹åŠ¡å¯¹è¯¥è¡¨æˆ–è€…è¯¥è¡¨ä¸­çš„æŸä¸€è¡ŒåŠ äº†é”ï¼Œè¿™ç§æ£€æµ‹éå¸¸è€—æ—¶ã€‚æœ‰äº†æ„å‘é”ä¹‹åï¼Œåªéœ€è¦æ£€æµ‹æ•´ä¸ªè¡¨æ˜¯å¦å­˜åœ¨IX/IS/X/Sé”å°±è¡Œäº†</li>
</ul>
</li>
</ul>
<p>é”çš„ä½œç”¨ï¼šç”¨äºç®¡ç†å¯¹å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®ï¼Œä¿è¯æ•°æ®åº“çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§</p>
<p>MySQL ä¸­æä¾›äº†ä¸¤ç§å°é”ç²’åº¦ï¼š<strong>è¡Œçº§é”</strong>ä»¥åŠ<strong>è¡¨çº§é”</strong>ã€‚<br>å°é”ç²’åº¦å°ï¼š</p>
<ul>
<li>å¥½å¤„ï¼šé”å®šçš„æ•°æ®é‡è¶Šå°‘ï¼Œå‘ç”Ÿé”äº‰ç”¨çš„å¯èƒ½å°±è¶Šå°ï¼Œç³»ç»Ÿçš„<strong>å¹¶å‘ç¨‹åº¦</strong>å°±è¶Šé«˜ï¼›</li>
<li>åå¤„ï¼š<strong>ç³»ç»Ÿå¼€é”€</strong>å¤§ï¼ˆåŠ é”ã€é‡Šæ”¾é”ã€æ£€æŸ¥é”çš„çŠ¶æ€éƒ½éœ€è¦æ¶ˆè€—èµ„æºï¼‰</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT ... LOCK In SHARE MODE;</span><br><span class="line">SELECT ... FOR UPDATE;</span><br></pre></td></tr></table></figure>

<h3 id="ä»€ä¹ˆæ˜¯ä¸‰çº§å°é”åè®®ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸‰çº§å°é”åè®®ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸‰çº§å°é”åè®®ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸‰çº§å°é”åè®®ï¼Ÿ</h3><ul>
<li>ä¸€çº§å°é”åè®®ï¼šäº‹åŠ¡åœ¨ä¿®æ”¹æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå¯¹å…¶åŠ Xé”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ‰é‡Šæ”¾ã€‚å¯ä»¥è§£å†³ä¸¢å¤±ä¿®æ”¹é—®é¢˜ï¼ˆä¸¤ä¸ªäº‹åŠ¡ä¸èƒ½åŒæ—¶å¯¹ä¸€ä¸ªæ•°æ®åŠ Xé”ï¼Œé¿å…äº†ä¿®æ”¹è¢«è¦†ç›–ï¼‰ï¼›</li>
<li>äºŒçº§å°é”åè®®ï¼šåœ¨ä¸€çº§çš„åŸºç¡€ä¸Šï¼Œäº‹åŠ¡åœ¨è¯»å–æ•°æ®ä¹‹å‰å¿…é¡»å…ˆåŠ Sé”ï¼Œè¯»å®Œåé‡Šæ”¾ã€‚å¯ä»¥è§£å†³è„è¯»é—®é¢˜ï¼ˆå¦‚æœå·²ç»æœ‰äº‹åŠ¡åœ¨ä¿®æ”¹æ•°æ®ï¼Œå°±æ„å‘³ç€å·²ç»åŠ äº†Xé”ï¼Œæ­¤æ—¶æƒ³è¦è¯»å–æ•°æ®çš„äº‹åŠ¡å¹¶ä¸èƒ½åŠ Sé”ï¼Œä¹Ÿå°±æ— æ³•è¿›è¡Œè¯»å–ï¼Œé¿å…äº†è¯»å–è„æ•°æ®ï¼‰ï¼›</li>
<li>ä¸‰çº§å°é”åè®®ï¼šåœ¨äºŒçº§çš„åŸºç¡€ä¸Šï¼Œäº‹åŠ¡åœ¨è¯»å–æ•°æ®ä¹‹å‰å¿…é¡»å…ˆåŠ Sé”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ‰èƒ½é‡Šæ”¾ã€‚å¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜ï¼ˆé¿å…äº†åœ¨äº‹åŠ¡ç»“æŸå‰å…¶å®ƒäº‹åŠ¡å¯¹æ•°æ®åŠ Xé”è¿›è¡Œä¿®æ”¹ï¼Œä¿è¯äº†äº‹åŠ¡æœŸé—´æ•°æ®ä¸ä¼šè¢«å…¶å®ƒäº‹åŠ¡æ›´æ–°ï¼‰</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯ä¸¤æ®µé”åè®®ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸¤æ®µé”åè®®ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸¤æ®µé”åè®®ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸¤æ®µé”åè®®ï¼Ÿ</h3><p>äº‹åŠ¡å¿…é¡»ä¸¥æ ¼åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µå¯¹æ•°æ®è¿›è¡Œ<strong>åŠ é”å’Œè§£é”</strong>çš„æ“ä½œï¼Œç¬¬ä¸€é˜¶æ®µåŠ é”ï¼Œç¬¬äºŒé˜¶æ®µè§£é”ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªäº‹åŠ¡ä¸­ä¸€æ—¦é‡Šæ”¾äº†é”ï¼Œå°±ä¸èƒ½å†ç”³è¯·æ–°é”äº†ã€‚</p>
<p><strong>å¯ä¸²è¡ŒåŒ–è°ƒåº¦</strong>æ˜¯æŒ‡ï¼Œé€šè¿‡å¹¶å‘æ§åˆ¶ï¼Œä½¿å¾—å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ç»“æœä¸æŸä¸ªä¸²è¡Œæ‰§è¡Œçš„äº‹åŠ¡ç»“æœç›¸åŒã€‚äº‹åŠ¡éµå¾ªä¸¤æ®µé”åè®®æ˜¯ä¿è¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å……åˆ†æ¡ä»¶ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯-MVCCï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-MVCCï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ MVCCï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ MVCCï¼Ÿ</h3><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMulti-Version Concurrency Control, MVCCï¼‰ï¼ŒMVCCåœ¨æ¯è¡Œè®°å½•åé¢éƒ½ä¿å­˜æœ‰ä¸¤ä¸ªéšè—çš„åˆ—ï¼Œç”¨æ¥å­˜å‚¨<strong>åˆ›å»ºç‰ˆæœ¬å·</strong>å’Œ<strong>åˆ é™¤ç‰ˆæœ¬å·</strong>ã€‚</p>
<ul>
<li>åˆ›å»ºç‰ˆæœ¬å·ï¼šåˆ›å»ºä¸€ä¸ªæ•°æ®è¡Œæ—¶çš„äº‹åŠ¡ç‰ˆæœ¬å·ï¼ˆ<strong>äº‹åŠ¡ç‰ˆæœ¬å·</strong>ï¼šäº‹åŠ¡å¼€å§‹æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼›ç³»ç»Ÿç‰ˆæœ¬å·ï¼šæ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·å°±ä¼šè‡ªåŠ¨é€’å¢ï¼‰ï¼›</li>
<li>åˆ é™¤ç‰ˆæœ¬å·ï¼šåˆ é™¤æ“ä½œæ—¶çš„äº‹åŠ¡ç‰ˆæœ¬å·ï¼›</li>
<li>å„ç§æ“ä½œï¼š<ul>
<li>æ’å…¥æ“ä½œæ—¶ï¼Œè®°å½•åˆ›å»ºç‰ˆæœ¬å·ï¼›</li>
<li>åˆ é™¤æ“ä½œæ—¶ï¼Œè®°å½•åˆ é™¤ç‰ˆæœ¬å·ï¼›</li>
<li>æ›´æ–°æ“ä½œæ—¶ï¼Œå…ˆè®°å½•åˆ é™¤ç‰ˆæœ¬å·ï¼Œå†æ–°å¢ä¸€è¡Œè®°å½•åˆ›å»ºç‰ˆæœ¬å·ï¼›</li>
<li>æŸ¥è¯¢æ“ä½œæ—¶ï¼Œè¦ç¬¦åˆä»¥ä¸‹æ¡ä»¶æ‰èƒ½è¢«æŸ¥è¯¢å‡ºæ¥ï¼šåˆ é™¤ç‰ˆæœ¬å·æœªå®šä¹‰æˆ–å¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ï¼ˆåˆ é™¤æ“ä½œæ˜¯åœ¨å½“å‰äº‹åŠ¡å¯åŠ¨ä¹‹ååšçš„ï¼‰ï¼›åˆ›å»ºç‰ˆæœ¬å·å°äºæˆ–ç­‰äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ï¼ˆåˆ›å»ºæ“ä½œæ˜¯äº‹åŠ¡å®Œæˆæˆ–è€…åœ¨äº‹åŠ¡å¯åŠ¨ä¹‹å‰å®Œæˆï¼‰</li>
</ul>
</li>
</ul>
<p>é€šè¿‡ç‰ˆæœ¬å·å‡å°‘äº†é”çš„äº‰ç”¨ï¼Œ<strong>æé«˜äº†ç³»ç»Ÿæ€§èƒ½</strong>ï¼›å¯ä»¥å®ç°<strong>æäº¤è¯»</strong>å’Œ<strong>å¯é‡å¤è¯»</strong>ä¸¤ç§éš”ç¦»çº§åˆ«ï¼Œæœªæäº¤è¯»æ— éœ€ä½¿ç”¨MVCC</p>
<p>ä½¿ç”¨ MVCC è¯»å–çš„æ˜¯å¿«ç…§ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å‡å°‘åŠ é”æ‰€å¸¦æ¥çš„å¼€é”€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from table ...;</span><br></pre></td></tr></table></figure>
<p>å½“å‰è¯»è¯»å–çš„æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œéœ€è¦åŠ é”ã€‚ä»¥ä¸‹ç¬¬ä¸€ä¸ªè¯­å¥éœ€è¦åŠ  S é”ï¼Œå…¶å®ƒéƒ½éœ€è¦åŠ  X é”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from table where ? lock in share mode;</span><br><span class="line">select * from table where ? for update;</span><br><span class="line">insert;</span><br><span class="line">update;</span><br><span class="line">delete;</span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®åº“çš„èŒƒå¼ï¼Ÿ"><a href="#æ•°æ®åº“çš„èŒƒå¼ï¼Ÿ" class="headerlink" title="æ•°æ®åº“çš„èŒƒå¼ï¼Ÿ"></a>æ•°æ®åº“çš„èŒƒå¼ï¼Ÿ</h3><ul>
<li><p><strong>ç¬¬ä¸€èŒƒå¼</strong>ï¼ˆ1NFï¼ŒNormal Formï¼‰ï¼š<strong>å±æ€§ä¸åº”è¯¥æ˜¯å¯åˆ†çš„</strong>ã€‚ä¸¾ä¾‹ï¼šå¦‚æœå°†â€œç”µè¯â€ä½œä¸ºä¸€ä¸ªå±æ€§ï¼ˆä¸€åˆ—ï¼‰ï¼Œæ˜¯ä¸ç¬¦åˆ1NFçš„ï¼Œå› ä¸ºç”µè¯è¿™ä¸ªå±æ€§å¯ä»¥åˆ†è§£ä¸ºå®¶åº­ç”µè¯å’Œç§»åŠ¨ç”µè¯â€¦å¦‚æœå°†â€œç§»åŠ¨ç”µè¯â€ä½œä¸ºä¸€ä¸ªå±æ€§ï¼Œå°±ç¬¦åˆ1NFï¼›</p>
</li>
<li><p><strong>ç¬¬äºŒèŒƒå¼</strong> 2NFï¼šæ¯ä¸ªéä¸»å±æ€§<strong>å®Œå…¨ä¾èµ–</strong>äºä¸»å±æ€§é›†ï¼ˆå€™é€‰é”®é›†ï¼‰ï¼›</p>
<ul>
<li>Bå®Œå…¨ä¾èµ–äºAï¼Œå°±æ˜¯è¯´Aä¸­çš„æ‰€æœ‰å±æ€§å”¯ä¸€å†³å®šBï¼Œå±æ€§å°‘äº†å°±ä¸èƒ½å”¯ä¸€å†³å®šï¼Œå±æ€§å¤šäº†åˆ™æœ‰å†—ä½™ï¼ˆå«ä¾èµ–ä¸å«å®Œå…¨ä¾èµ–ï¼‰ã€‚ä¸¾ä¾‹ï¼šï¼ˆå­¦å·ï¼Œè¯¾ç¨‹åï¼‰è¿™ä¸ªä¸»å±æ€§é›†å¯ä»¥å”¯ä¸€å†³å®šæˆç»©ï¼Œä½†æ˜¯å¯¹äºå­¦ç”Ÿå§“åè¿™ä¸ªå±æ€§ï¼Œï¼ˆå­¦å·ï¼Œè¯¾ç¨‹åï¼‰è¿™ä¸ªå±æ€§é›†å°±æ˜¯å†—ä½™çš„ï¼Œæ‰€ä»¥å­¦ç”Ÿå§“åä¸å®Œå…¨ä¾èµ–äºï¼ˆå­¦å·ï¼Œè¯¾ç¨‹åï¼‰è¿™ä¸€å±æ€§é›†ï¼›</li>
<li>ä¸»å±æ€§é›†/å€™é€‰ç é›†ï¼šæŸä¸€ç»„å±æ€§èƒ½å¤Ÿå”¯ä¸€ç¡®å®šå…¶å®ƒçš„å±æ€§ï¼ˆä¸»é”®å°±æ˜¯ä»å€™é€‰é”®é›†ä¸­é€‰çš„ä¸€ä¸ªé”®ï¼‰ï¼Œè€Œå…¶å­é›†ä¸èƒ½ï¼Œè¿™æ ·çš„å±æ€§ç»„ä¸­çš„å±æ€§å°±æ˜¯ä¸»å±æ€§ï¼›ä¸åœ¨å€™é€‰ç é›†ä¸­çš„å±æ€§æˆä¸ºéä¸»å±æ€§ï¼›</li>
<li>å¯ä»¥é€šè¿‡åˆ†è§£æ¥æ»¡è¶³ 2NFï¼šå°†ï¼ˆå­¦å·ï¼Œè¯¾ç¨‹åï¼Œæˆç»©ï¼‰åšæˆä¸€å¼ è¡¨ï¼›ï¼ˆå­¦å·ï¼Œå­¦ç”Ÿå§“åï¼‰åšæˆå¦ä¸€å¼ è¡¨ï¼Œé¿å…å¤§é‡çš„æ•°æ®å†—ä½™ï¼›<br>æ»¡è¶³1NFåï¼Œè¦æ±‚è¡¨ä¸­çš„æ‰€æœ‰åˆ—ï¼Œéƒ½å¿…é¡»ä¾èµ–äºä¸»é”®ï¼Œè€Œä¸èƒ½æœ‰ä»»ä½•ä¸€åˆ—ä¸ä¸»é”®æ²¡æœ‰å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªè¡¨åªæè¿°ä¸€ä»¶äº‹æƒ…ï¼›</li>
</ul>
</li>
<li><p><strong>ç¬¬ä¸‰èŒƒå¼</strong> 3NFï¼šåœ¨ 2NF çš„åŸºç¡€ä¸Šï¼Œéä¸»å±æ€§<strong>ä¸ä¼ é€’ä¾èµ–</strong>äºä¸»å±æ€§</p>
<ul>
<li>ä¼ é€’ä¾èµ–ï¼šå¦‚æœCä¾èµ–äºBï¼ŒBä¾èµ–äºAï¼Œé‚£ä¹ˆCä¼ é€’ä¾èµ–äºAï¼›</li>
<li>3NFåœ¨2NFçš„åŸºç¡€ä¸Šï¼Œæ¶ˆé™¤äº†éä¸»å±æ€§ä¹‹é—´çš„ä¾èµ–ï¼›æ¯”å¦‚ä¸€ä¸ªè¡¨ä¸­ï¼Œä¸»å±æ€§æœ‰ï¼ˆå­¦å·ï¼‰ï¼Œéä¸»å±æ€§æœ‰ï¼ˆå§“åï¼Œé™¢ç³»ï¼Œé™¢é•¿åï¼‰ï¼Œå¯ä»¥çœ‹åˆ°é™¢é•¿åè¿™ä¸ªéä¸»å±æ€§ä¾èµ–äºé™¢ç³»ï¼Œä¼ é€’ä¾èµ–äºå­¦å·ã€‚æ¶ˆé™¤çš„åŠæ³•æ˜¯åˆ†è§£ã€‚<br>å¿…é¡»å…ˆæ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼Œè¦æ±‚ï¼šè¡¨ä¸­çš„æ¯ä¸€åˆ—åªä¸ä¸»é”®ç›´æ¥ç›¸å…³è€Œä¸æ˜¯é—´æ¥ç›¸å…³ï¼Œï¼ˆè¡¨ä¸­çš„æ¯ä¸€åˆ—åªèƒ½ä¾èµ–äºä¸»é”®ï¼‰ï¼›</li>
</ul>
</li>
<li><p>å†—ä½™æ•°æ®ï¼šæŸäº›åŒæ ·çš„æ•°æ®å¤šæ¬¡å‡ºç°ï¼ˆå¦‚å­¦ç”Ÿå§“åï¼‰ï¼›</p>
</li>
<li><p>ä¿®æ”¹å¼‚å¸¸ï¼šä¿®æ”¹äº†ä¸€ä¸ªè®°å½•ä¸­çš„ä¿¡æ¯ï¼Œå¦ä¸€ä¸ªè®°å½•ä¸­ç›¸åŒçš„ä¿¡æ¯å´æ²¡æœ‰ä¿®æ”¹ï¼›</p>
</li>
<li><p>åˆ é™¤å¼‚å¸¸ï¼šåˆ é™¤ä¸€ä¸ªä¿¡æ¯ï¼Œé‚£ä¹ˆä¹Ÿä¼šä¸¢å¤±å…¶å®ƒä¿¡æ¯ï¼ˆåˆ é™¤ä¸€ä¸ªè¯¾ç¨‹ï¼Œä¸¢å¤±äº†ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼‰ï¼›</p>
</li>
<li><p>æ’å…¥å¼‚å¸¸ï¼šæ— æ³•æ’å…¥ï¼ˆæ’å…¥ä¸€ä¸ªè¿˜æ²¡æœ‰è¯¾ç¨‹ä¿¡æ¯çš„å­¦ç”Ÿï¼‰</p>
</li>
</ul>
<h3 id="åˆ—ä¸¾å‡ ç§è¡¨è¿æ¥æ–¹å¼ï¼Ÿ"><a href="#åˆ—ä¸¾å‡ ç§è¡¨è¿æ¥æ–¹å¼ï¼Ÿ" class="headerlink" title="åˆ—ä¸¾å‡ ç§è¡¨è¿æ¥æ–¹å¼ï¼Ÿ"></a>åˆ—ä¸¾å‡ ç§è¡¨è¿æ¥æ–¹å¼ï¼Ÿ</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628085012977-cccccdf6-0f16-4343-8cd4-68631fb6b78a.png"></p>
<ul>
<li>å†…è¿æ¥ï¼ˆInner Joinï¼‰ï¼šä»…å°†ä¸¤ä¸ªè¡¨ä¸­æ»¡è¶³è¿æ¥æ¡ä»¶çš„è¡Œç»„åˆèµ·æ¥ä½œä¸ºç»“æœé›†<ul>
<li>è‡ªç„¶è¿æ¥ï¼šåªè€ƒè™‘å±æ€§ç›¸åŒçš„å…ƒç»„å¯¹ï¼›</li>
<li>ç­‰å€¼è¿æ¥ï¼šç»™å®šæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢</li>
</ul>
</li>
</ul>
<ul>
<li>å¤–è¿æ¥ï¼ˆOuter Joinï¼‰<ul>
<li>å·¦è¿æ¥ï¼šå·¦è¾¹è¡¨çš„æ‰€æœ‰æ•°æ®éƒ½æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œå³è¾¹çš„è¡¨æ•°æ®åªæ˜¾ç¤ºå…±åŒæœ‰çš„é‚£éƒ¨åˆ†ï¼Œæ²¡æœ‰å¯¹åº”çš„éƒ¨åˆ†è¡¥NULLï¼›</li>
<li>å³è¿æ¥ï¼šå’Œå·¦è¿æ¥ç›¸åï¼›</li>
<li>å…¨å¤–è¿æ¥ï¼ˆFull Outer Joinï¼‰ï¼šæŸ¥è¯¢å‡ºå·¦è¡¨å’Œå³è¡¨æ‰€æœ‰æ•°æ®ï¼Œä½†æ˜¯å»é™¤ä¸¤è¡¨çš„é‡å¤æ•°æ®</li>
</ul>
</li>
</ul>
<ul>
<li>äº¤å‰è¿æ¥ï¼ˆCross Joinï¼‰ï¼šè¿”å›ä¸¤è¡¨çš„ç¬›å¡å°”ç§¯ï¼ˆå¯¹äºæ‰€å«æ•°æ®åˆ†åˆ«ä¸ºmã€nçš„è¡¨ï¼Œè¿”å›m*nçš„ç»“æœï¼‰</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ</h3><p>å­˜å‚¨è¿‡ç¨‹æ˜¯äº‹å…ˆç»è¿‡ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¸€æ®µSQLè¯­å¥çš„é›†åˆã€‚æƒ³è¦å®ç°ç›¸åº”çš„åŠŸèƒ½æ—¶ï¼Œåªéœ€è¦è°ƒç”¨è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹å°±è¡Œäº†ï¼ˆç±»ä¼¼äºå‡½æ•°ï¼Œè¾“å…¥å…·æœ‰è¾“å‡ºå‚æ•°ï¼‰ã€‚<br>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>é¢„å…ˆç¼–è¯‘ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡è¿è¡Œæ—¶ç¼–è¯‘ï¼Œæé«˜äº†æ•°æ®åº“æ‰§è¡Œ<strong>æ•ˆç‡</strong>ï¼›</li>
<li>å°è£…äº†ä¸€ç³»åˆ—æ“ä½œï¼Œå¯¹äºä¸€äº›æ•°æ®äº¤äº’æ¯”è¾ƒå¤šçš„æ“ä½œï¼Œç›¸æ¯”äºå•ç‹¬æ‰§è¡ŒSQLè¯­å¥ï¼Œå¯ä»¥<strong>å‡å°‘ç½‘ç»œé€šä¿¡é‡</strong>ï¼›</li>
<li>å…·æœ‰<strong>å¯å¤ç”¨æ€§</strong>ï¼Œå‡å°‘äº†æ•°æ®åº“å¼€å‘çš„å·¥ä½œé‡ï¼›</li>
<li><strong>å®‰å…¨æ€§é«˜</strong>ï¼Œå¯ä»¥è®©æ²¡æœ‰æƒé™çš„ç”¨æˆ·é€šè¿‡å­˜å‚¨è¿‡ç¨‹é—´æ¥æ“ä½œæ•°æ®åº“ï¼›</li>
<li>æ›´<strong>æ˜“äºç»´æŠ¤</strong></li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><strong>å¯ç§»æ¤æ€§å·®</strong>ï¼Œå­˜å‚¨è¿‡ç¨‹å°†åº”ç”¨ç¨‹åºç»‘å®šåˆ°äº†æ•°æ®åº“ä¸Šï¼›</li>
<li><strong>å¼€å‘è°ƒè¯•å¤æ‚</strong>ï¼šæ²¡æœ‰å¥½çš„IDEï¼›</li>
<li><strong>ä¿®æ”¹å¤æ‚</strong>ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ï¼Œæœ‰æ—¶è¿˜éœ€è¦æ›´æ–°ç¨‹åºä¸­çš„ä»£ç ä»¥æ›´æ–°è°ƒç”¨</li>
</ul>
<h3 id="Drop-Delete-Truncateçš„åŒºåˆ«ï¼Ÿ"><a href="#Drop-Delete-Truncateçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="Drop/Delete/Truncateçš„åŒºåˆ«ï¼Ÿ"></a>Drop/Delete/Truncateçš„åŒºåˆ«ï¼Ÿ</h3><ul>
<li><strong>Delete</strong>ç”¨æ¥åˆ é™¤è¡¨çš„å…¨éƒ¨æˆ–è€…<strong>éƒ¨åˆ†æ•°æ®</strong>ï¼Œæ‰§è¡Œdeleteä¹‹åï¼Œç”¨æˆ·<strong>éœ€è¦æäº¤</strong>ä¹‹åæ‰ä¼šæ‰§è¡Œï¼Œä¼šè§¦å‘è¡¨ä¸Šçš„DELETE<strong>è§¦å‘å™¨</strong>ï¼ˆåŒ…å«ä¸€ä¸ªOLDçš„è™šæ‹Ÿè¡¨ï¼Œå¯ä»¥åªè¯»è®¿é—®è¢«åˆ é™¤çš„æ•°æ®ï¼‰ï¼ŒDELETEä¹‹åè¡¨ç»“æ„è¿˜åœ¨ï¼Œåˆ é™¤å¾ˆæ…¢ï¼Œä¸€è¡Œä¸€è¡Œåœ°åˆ ï¼Œå› ä¸ºä¼šè®°å½•æ—¥å¿—ï¼Œå¯ä»¥åˆ©ç”¨æ—¥å¿—è¿˜åŸæ•°æ®ï¼›</li>
<li><strong>Truncate</strong>åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œè¿™ä¸ªæ“ä½œ<strong>ä¸èƒ½å›æ»š</strong>ï¼Œä¹Ÿä¸ä¼šè§¦å‘è¿™ä¸ªè¡¨ä¸Šçš„è§¦å‘å™¨ã€‚æ“ä½œæ¯”DELETEå¿«å¾ˆå¤šï¼ˆç›´æ¥æŠŠè¡¨dropæ‰ï¼Œå†åˆ›å»ºä¸€ä¸ªæ–°è¡¨ï¼Œåˆ é™¤çš„æ•°æ®ä¸èƒ½æ‰¾å›ï¼‰ã€‚å¦‚æœè¡¨ä¸­æœ‰è‡ªå¢ï¼ˆAUTO_INCREMENTï¼‰åˆ—ï¼Œåˆ™é‡ç½®ä¸º1ï¼›</li>
<li><strong>Drop</strong>å‘½ä»¤ä»æ•°æ®åº“ä¸­<strong>åˆ é™¤è¡¨</strong>ï¼Œæ‰€æœ‰çš„æ•°æ®è¡Œï¼Œç´¢å¼•å’Œçº¦æŸéƒ½ä¼šè¢«åˆ é™¤ï¼›ä¸èƒ½å›æ»šï¼Œä¸ä¼šè§¦å‘è§¦å‘å™¨ï¼›</li>
</ul>
<p>è§¦å‘å™¨ï¼ˆTRIGGERï¼‰æ˜¯ç”±äº‹ä»¶ï¼ˆæ¯”å¦‚INSERT/UPDATE/DELETEï¼‰æ¥è§¦å‘è¿è¡Œçš„æ“ä½œï¼ˆä¸èƒ½è¢«ç›´æ¥è°ƒç”¨ï¼Œä¸èƒ½æ¥æ”¶å‚æ•°ï¼‰ã€‚åœ¨æ•°æ®åº“é‡Œä»¥ç‹¬ç«‹çš„å¯¹è±¡å­˜å‚¨ï¼Œç”¨äº<strong>ä¿è¯æ•°æ®å®Œæ•´æ€§</strong>ï¼ˆæ¯”å¦‚å¯ä»¥æ£€éªŒæˆ–è½¬æ¢æ•°æ®ï¼‰ã€‚</p>
<p>çº¦æŸï¼ˆConstraintï¼‰ç±»å‹ï¼šä¸»é”®ï¼ˆPrimary Keyï¼‰çº¦æŸï¼Œå”¯ä¸€çº¦æŸï¼ˆUniqueï¼‰ï¼Œæ£€æŸ¥çº¦æŸï¼Œéç©ºçº¦æŸï¼Œå¤–é”®ï¼ˆForeign Keyï¼‰çº¦æŸã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ</h3><ul>
<li>è§†å›¾ï¼šä»æ•°æ®åº“çš„åŸºæœ¬è¡¨ä¸­é€šè¿‡æŸ¥è¯¢é€‰å–å‡ºæ¥çš„æ•°æ®ç»„æˆçš„<strong>è™šæ‹Ÿè¡¨</strong>ï¼ˆæ•°æ®åº“ä¸­å­˜æ”¾è§†å›¾çš„å®šä¹‰ï¼‰ã€‚å¯ä»¥å¯¹å…¶è¿›è¡Œå¢/åˆ /æ”¹/æŸ¥ç­‰æ“ä½œã€‚è§†å›¾æ˜¯å¯¹è‹¥å¹²å¼ åŸºæœ¬è¡¨çš„å¼•ç”¨ï¼Œä¸€å¼ è™šè¡¨ï¼ŒæŸ¥è¯¢è¯­å¥æ‰§è¡Œçš„ç»“æœï¼Œä¸å­˜å‚¨å…·ä½“çš„æ•°æ®ï¼ˆåŸºæœ¬è¡¨æ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼Œè§†å›¾ä¹Ÿä¼šè·Ÿç€æ”¹å˜ï¼‰ï¼›å¯ä»¥è·ŸåŸºæœ¬è¡¨ä¸€æ ·ï¼Œè¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œ(ps:å¢åˆ æ”¹æ“ä½œæœ‰æ¡ä»¶é™åˆ¶)ï¼›å¦‚è¿è¡¨æŸ¥è¯¢äº§ç”Ÿçš„è§†å›¾æ— æ³•è¿›è¡Œï¼Œå¯¹è§†å›¾çš„å¢åˆ æ”¹ä¼šå½±å“åŸè¡¨çš„æ•°æ®ã€‚å¥½å¤„ï¼š<ul>
<li>é€šè¿‡åªç»™ç”¨æˆ·è®¿é—®è§†å›¾çš„æƒé™ï¼Œä¿è¯æ•°æ®çš„<strong>å®‰å…¨æ€§</strong>ï¼›</li>
<li><strong>ç®€åŒ–</strong>å¤æ‚çš„SQLæ“ä½œï¼Œéšè—æ•°æ®çš„å¤æ‚æ€§ï¼ˆæ¯”å¦‚å¤æ‚çš„è¿æ¥ï¼‰ï¼›</li>
</ul>
</li>
<li>æ¸¸æ ‡ï¼ˆCursorï¼‰ï¼šç”¨äºå®šä½åœ¨æŸ¥è¯¢è¿”å›çš„<strong>ç»“æœé›†çš„ç‰¹å®šè¡Œ</strong>ï¼Œä»¥å¯¹ç‰¹å®šè¡Œè¿›è¡Œæ“ä½œã€‚ä½¿ç”¨æ¸¸æ ‡å¯ä»¥æ–¹ä¾¿åœ°å¯¹ç»“æœé›†è¿›è¡Œç§»åŠ¨éå†ï¼Œæ ¹æ®éœ€è¦æ»šåŠ¨æˆ–å¯¹æµè§ˆ/ä¿®æ”¹ä»»æ„è¡Œä¸­çš„æ•°æ®ã€‚ä¸»è¦ç”¨äºäº¤äº’å¼åº”ç”¨ã€‚<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h3 id="æ•°æ®åº“ç´¢å¼•çš„å®ç°åŸç†ï¼ˆB-æ ‘ï¼‰"><a href="#æ•°æ®åº“ç´¢å¼•çš„å®ç°åŸç†ï¼ˆB-æ ‘ï¼‰" class="headerlink" title="æ•°æ®åº“ç´¢å¼•çš„å®ç°åŸç†ï¼ˆB+æ ‘ï¼‰"></a>æ•°æ®åº“ç´¢å¼•çš„å®ç°åŸç†ï¼ˆB+æ ‘ï¼‰</h3></li>
</ul>
<p>è§<a href="https://github.com/wolverinn/Iridescent/blob/master/Data%20Structure.md#b%E6%A0%91">æ•°æ®ç»“æ„éƒ¨åˆ†ï¼šBæ ‘ï¼ŒB+æ ‘</a></p>
<h5 id="ä½¿ç”¨Bæ ‘å’ŒB-æ ‘çš„æ¯”è¾ƒ"><a href="#ä½¿ç”¨Bæ ‘å’ŒB-æ ‘çš„æ¯”è¾ƒ" class="headerlink" title="ä½¿ç”¨Bæ ‘å’ŒB+æ ‘çš„æ¯”è¾ƒ"></a>ä½¿ç”¨Bæ ‘å’ŒB+æ ‘çš„æ¯”è¾ƒ</h5><p>InnoDBçš„ç´¢å¼•ä½¿ç”¨çš„æ˜¯B+æ ‘å®ç°ï¼ŒB+æ ‘å¯¹æ¯”Bæ ‘çš„å¥½å¤„ï¼š</p>
<ul>
<li>IOæ¬¡æ•°å°‘ï¼šB+æ ‘çš„ä¸­é—´ç»“ç‚¹åªå­˜æ”¾ç´¢å¼•ï¼Œæ•°æ®éƒ½å­˜åœ¨å¶ç»“ç‚¹ä¸­ï¼Œå› æ­¤ä¸­é—´ç»“ç‚¹å¯ä»¥å­˜æ›´å¤šçš„æ•°æ®ï¼Œè®©ç´¢å¼•æ ‘æ›´åŠ çŸ®èƒ–ï¼›</li>
<li>èŒƒå›´æŸ¥è¯¢æ•ˆç‡æ›´é«˜ï¼šBæ ‘éœ€è¦ä¸­åºéå†æ•´ä¸ªæ ‘ï¼ŒåªB+æ ‘éœ€è¦éå†å¶ç»“ç‚¹ä¸­çš„é“¾è¡¨ï¼›</li>
<li>æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦ä»æ ¹ç»“ç‚¹åˆ°å¶ç»“ç‚¹ï¼Œè·¯å¾„é•¿åº¦ç›¸åŒï¼Œæ‰€ä»¥æ¯æ¬¡æŸ¥è¯¢çš„æ•ˆç‡éƒ½å·®ä¸å¤š</li>
</ul>
<h5 id="ä½¿ç”¨Bæ ‘ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•çš„æ¯”è¾ƒ"><a href="#ä½¿ç”¨Bæ ‘ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•çš„æ¯”è¾ƒ" class="headerlink" title="ä½¿ç”¨Bæ ‘ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•çš„æ¯”è¾ƒ"></a>ä½¿ç”¨Bæ ‘ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•çš„æ¯”è¾ƒ</h5><p>å“ˆå¸Œç´¢å¼•èƒ½ä»¥ O(1) æ—¶é—´è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†æ˜¯åªæ”¯æŒç²¾ç¡®æŸ¥æ‰¾ï¼Œæ— æ³•ç”¨äºéƒ¨åˆ†æŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾ï¼Œæ— æ³•ç”¨äºæ’åºä¸åˆ†ç»„ï¼›Bæ ‘ç´¢å¼•æ”¯æŒå¤§äºå°äºç­‰äºæŸ¥æ‰¾ï¼ŒèŒƒå›´æŸ¥æ‰¾ã€‚å“ˆå¸Œç´¢å¼•é‡åˆ°å¤§é‡å“ˆå¸Œå€¼ç›¸ç­‰çš„æƒ…å†µåæŸ¥æ‰¾æ•ˆç‡ä¼šé™ä½ã€‚å“ˆå¸Œç´¢å¼•ä¸æ”¯æŒæ•°æ®çš„æ’åºã€‚</p>
<h3 id="ä½¿ç”¨ç´¢å¼•çš„ä¼˜ç‚¹"><a href="#ä½¿ç”¨ç´¢å¼•çš„ä¼˜ç‚¹" class="headerlink" title="ä½¿ç”¨ç´¢å¼•çš„ä¼˜ç‚¹"></a>ä½¿ç”¨ç´¢å¼•çš„ä¼˜ç‚¹</h3><ul>
<li>å¤§å¤§åŠ å¿«äº†æ•°æ®çš„<strong>æ£€ç´¢é€Ÿåº¦</strong>ï¼›</li>
<li>å¯ä»¥æ˜¾è‘—å‡å°‘æŸ¥è¯¢ä¸­<strong>åˆ†ç»„å’Œæ’åº</strong>çš„æ—¶é—´ï¼›</li>
<li>é€šè¿‡åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ï¼›</li>
<li>å°†éšæœº I/O å˜ä¸º<strong>é¡ºåº I/O</strong>ï¼ˆB+Tree ç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œä¼šå°†ç›¸é‚»çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€èµ·ï¼‰</li>
</ul>
<p>ç¼ºç‚¹ï¼šå»ºç«‹å’Œç»´æŠ¤ç´¢å¼•è€—è´¹æ—¶é—´ç©ºé—´ï¼Œæ›´æ–°ç´¢å¼•å¾ˆæ…¢ã€‚</p>
<h3 id="å“ªäº›æƒ…å†µä¸‹ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ"><a href="#å“ªäº›æƒ…å†µä¸‹ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ" class="headerlink" title="å“ªäº›æƒ…å†µä¸‹ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ"></a>å“ªäº›æƒ…å†µä¸‹ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ</h3><ul>
<li>ä»¥â€œ%(è¡¨ç¤ºä»»æ„0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦)â€å¼€å¤´çš„LIKEè¯­å¥ï¼›</li>
<li>ORè¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼•ï¼›</li>
<li>æ•°æ®ç±»å‹å‡ºç°éšå¼è½¬åŒ–ï¼ˆå¦‚varcharä¸åŠ å•å¼•å·çš„è¯å¯èƒ½ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºintå‹ï¼‰ï¼›</li>
<li>å¯¹äºå¤šåˆ—ç´¢å¼•ï¼Œå¿…é¡»æ»¡è¶³ <strong>æœ€å·¦åŒ¹é…åŸåˆ™</strong>/æœ€å·¦å‰ç¼€åŸåˆ™ (æœ€å·¦ä¼˜å…ˆï¼Œegï¼šå¤šåˆ—ç´¢å¼•col1ã€col2å’Œcol3ï¼Œåˆ™ ç´¢å¼•ç”Ÿæ•ˆçš„æƒ…å½¢åŒ…æ‹¬ col1æˆ–col1ï¼Œcol2æˆ–col1ï¼Œcol2ï¼Œcol3)ï¼›</li>
<li>å¦‚æœMySQLä¼°è®¡å…¨è¡¨æ‰«ææ¯”ç´¢å¼•å¿«ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ï¼ˆæ¯”å¦‚éå¸¸å°çš„è¡¨ï¼‰</li>
</ul>
<h3 id="åœ¨å“ªäº›åœ°æ–¹é€‚åˆåˆ›å»ºç´¢å¼•ï¼Ÿ"><a href="#åœ¨å“ªäº›åœ°æ–¹é€‚åˆåˆ›å»ºç´¢å¼•ï¼Ÿ" class="headerlink" title="åœ¨å“ªäº›åœ°æ–¹é€‚åˆåˆ›å»ºç´¢å¼•ï¼Ÿ"></a>åœ¨å“ªäº›åœ°æ–¹é€‚åˆåˆ›å»ºç´¢å¼•ï¼Ÿ</h3><ul>
<li>æŸåˆ—ç»å¸¸ä½œä¸ºæœ€å¤§æœ€å°å€¼ï¼›</li>
<li>ç»å¸¸è¢«æŸ¥è¯¢çš„å­—æ®µï¼›</li>
<li>ç»å¸¸ç”¨ä½œè¡¨è¿æ¥çš„å­—æ®µï¼›</li>
<li>ç»å¸¸å‡ºç°åœ¨ORDER BY/GROUP BY/DISDINCTåé¢çš„å­—æ®µ</li>
</ul>
<h5 id="åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a>åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h5><ul>
<li>åªåº”å»ºç«‹åœ¨<strong>å°å­—æ®µ</strong>ä¸Šï¼Œè€Œä¸è¦å¯¹å¤§æ–‡æœ¬æˆ–å›¾ç‰‡å»ºç«‹ç´¢å¼•ï¼ˆä¸€é¡µå­˜å‚¨çš„æ•°æ®è¶Šå¤šä¸€æ¬¡IOæ“ä½œè·å–çš„æ•°æ®è¶Šå¤§æ•ˆç‡è¶Šé«˜ï¼‰ï¼›</li>
<li>å»ºç«‹ç´¢å¼•çš„å­—æ®µåº”è¯¥<strong>éç©º</strong>ï¼Œåœ¨MySQLä¸­ï¼Œå«æœ‰ç©ºå€¼çš„åˆ—å¾ˆéš¾è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œå› ä¸ºå®ƒä»¬ä½¿å¾—ç´¢å¼•ã€ç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠæ¯”è¾ƒè¿ç®—æ›´åŠ å¤æ‚ã€‚åº”è¯¥ç”¨0ã€ä¸€ä¸ªç‰¹æ®Šçš„å€¼æˆ–è€…ä¸€ä¸ªç©ºä¸²ä»£æ›¿NULLï¼›</li>
<li>é€‰æ‹©<strong>æ•°æ®å¯†åº¦å¤§</strong>ï¼ˆå”¯ä¸€å€¼å æ€»æ•°çš„ç™¾åˆ†æ¯”å¾ˆå¤§ï¼‰çš„å­—æ®µä½œç´¢å¼•</li>
</ul>
<h3 id="ç´¢å¼•çš„åˆ†ç±»ï¼Ÿ"><a href="#ç´¢å¼•çš„åˆ†ç±»ï¼Ÿ" class="headerlink" title="ç´¢å¼•çš„åˆ†ç±»ï¼Ÿ"></a>ç´¢å¼•çš„åˆ†ç±»ï¼Ÿ</h3><ul>
<li>æ™®é€šç´¢å¼•</li>
<li>å”¯ä¸€ç´¢å¼• UNIQUEï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ï¼›</li>
<li>ä¸»é”®ç´¢å¼• PRIMARY KEYï¼šå¿…é¡»å”¯ä¸€ï¼Œä¸å…è®¸ç©ºå€¼ï¼ˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼›MySQLåˆ›å»ºä¸»é”®æ—¶é»˜è®¤ä¸ºèšé›†ç´¢å¼•ï¼Œä½†ä¸»é”®ä¹Ÿå¯ä»¥æ˜¯éèšé›†ç´¢å¼•ï¼‰ï¼›</li>
<li>å•åˆ—ç´¢å¼•å’Œå¤šåˆ—ç´¢å¼•/å¤åˆç´¢å¼•ï¼ˆCompositeï¼‰ï¼šç´¢å¼•çš„åˆ—æ•°ï¼›</li>
<li>è¦†ç›–ï¼ˆCoveringï¼‰ç´¢å¼•ï¼šç´¢å¼•åŒ…å«äº†æ‰€æœ‰æ»¡è¶³æŸ¥è¯¢æ‰€éœ€è¦çš„æ•°æ®ï¼ŒæŸ¥è¯¢çš„æ—¶å€™åªéœ€è¦è¯»å–ç´¢å¼•è€Œä¸éœ€è¦å›è¡¨è¯»å–æ•°æ®ï¼›</li>
<li>èšé›†ï¼ˆClusteredï¼‰ç´¢å¼•/éèšé›†ç´¢å¼•ï¼šå¯¹ç£ç›˜ä¸Šå­˜æ”¾æ•°æ®çš„ç‰©ç†åœ°å€é‡æ–°ç»„ç»‡ä»¥ä½¿è¿™äº›æ•°æ®æŒ‰ç…§æŒ‡å®šè§„åˆ™æ’åºçš„ä¸€ç§ç´¢å¼•ï¼ˆæ•°æ®çš„ç‰©ç†æ’åˆ—é¡ºåºå’Œç´¢å¼•æ’åˆ—é¡ºåºä¸€è‡´ï¼‰ã€‚å› æ­¤æ¯å¼ è¡¨åªèƒ½åˆ›å»ºä¸€ä¸ªèšé›†ç´¢å¼•ï¼ˆå› ä¸ºè¦æ”¹å˜ç‰©ç†å­˜å‚¨é¡ºåºï¼‰ã€‚ä¼˜ç‚¹æ˜¯æŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥æŒ‰ç…§é¡ºåºå¾—åˆ°éœ€è¦æ•°æ®çš„ç‰©ç†åœ°å€ã€‚ç¼ºç‚¹æ˜¯è¿›è¡Œä¿®æ”¹çš„é€Ÿåº¦è¾ƒæ…¢ã€‚å¯¹äºéœ€è¦ç»å¸¸æœç´¢èŒƒå›´çš„å€¼å¾ˆæœ‰æ•ˆã€‚éèšé›†ç´¢å¼•åªè®°å½•é€»è¾‘é¡ºåºï¼Œå¹¶ä¸æ”¹å˜ç‰©ç†é¡ºåºï¼›</li>
<li>åˆ†åŒºç´¢å¼•ï¼ˆï¼Ÿï¼‰</li>
<li>è™šæ‹Ÿç´¢å¼•ï¼ˆVirtualï¼‰ï¼šæ¨¡æ‹Ÿç´¢å¼•çš„å­˜åœ¨è€Œä¸ç”¨çœŸæ­£åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œç”¨äºå¿«é€Ÿæµ‹è¯•åˆ›å»ºç´¢å¼•å¯¹æ‰§è¡Œè®¡åˆ’çš„å½±å“ã€‚æ²¡æœ‰ç›¸å…³çš„ç´¢å¼•æ®µï¼Œä¸å¢åŠ å­˜å‚¨ç©ºé—´çš„ä½¿ç”¨</li>
</ul>
<h3 id="MySQLçš„ä¸¤ç§å­˜å‚¨å¼•æ“-InnoDB-å’Œ-MyISAM-çš„åŒºåˆ«ï¼Ÿ"><a href="#MySQLçš„ä¸¤ç§å­˜å‚¨å¼•æ“-InnoDB-å’Œ-MyISAM-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="MySQLçš„ä¸¤ç§å­˜å‚¨å¼•æ“ InnoDB å’Œ MyISAM çš„åŒºåˆ«ï¼Ÿ"></a>MySQLçš„ä¸¤ç§å­˜å‚¨å¼•æ“ InnoDB å’Œ MyISAM çš„åŒºåˆ«ï¼Ÿ</h3><ul>
<li><p>InnoDB<strong>æ”¯æŒäº‹åŠ¡</strong>ï¼Œå¯ä»¥è¿›è¡ŒCommitå’ŒRollbackï¼›</p>
</li>
<li><p>MyISAM åªæ”¯æŒè¡¨çº§é”ï¼Œè€Œ InnoDB è¿˜<strong>æ”¯æŒè¡Œçº§é”</strong>ï¼Œæé«˜äº†å¹¶å‘æ“ä½œçš„æ€§èƒ½ï¼›</p>
</li>
<li><p>InnoDB <strong>æ”¯æŒå¤–é”®</strong>ï¼›</p>
</li>
<li><p>MyISAM <strong>å´©æºƒ</strong>åå‘ç”ŸæŸåçš„æ¦‚ç‡æ¯” InnoDB é«˜å¾ˆå¤šï¼Œè€Œä¸”<strong>æ¢å¤çš„é€Ÿåº¦</strong>ä¹Ÿæ›´æ…¢ï¼›</p>
</li>
<li><p>MyISAM æ”¯æŒ<strong>å‹ç¼©</strong>è¡¨å’Œç©ºé—´æ•°æ®ç´¢å¼•ï¼ŒInnoDBéœ€è¦æ›´å¤šçš„å†…å­˜å’Œå­˜å‚¨ï¼›</p>
</li>
<li><p>InnoDB æ”¯æŒåœ¨çº¿<strong>çƒ­å¤‡ä»½</strong></p>
</li>
<li><p><strong>MyISAM</strong> ç®¡ç†éäº‹åŠ¡è¡¨ã€‚å®ƒæä¾›é«˜é€Ÿå­˜å‚¨å’Œæ£€ç´¢ï¼ˆMyISAMå¼ºè°ƒçš„æ˜¯æ€§èƒ½ï¼Œæ¯æ¬¡æŸ¥è¯¢å…·æœ‰åŸå­æ€§ï¼Œå…¶æ‰§è¡Œé€Ÿåº¦æ¯”InnoDBæ›´å¿«ï¼‰ï¼Œä»¥åŠå…¨æ–‡æœç´¢èƒ½åŠ›ã€‚å¦‚æœè¡¨æ¯”è¾ƒå°ï¼Œæˆ–è€…æ˜¯åªè¯»æ•°æ®ï¼ˆæœ‰å¤§é‡çš„SELECTï¼‰ï¼Œè¿˜æ˜¯å¯ä»¥ä½¿ç”¨MyISAMï¼›</p>
</li>
<li><p><strong>InnoDB</strong> æ”¯æŒäº‹åŠ¡ï¼Œå¹¶å‘æƒ…å†µä¸‹æœ‰å¾ˆå¥½çš„æ€§èƒ½ï¼ŒåŸºæœ¬å¯ä»¥æ›¿ä»£MyISAM</p>
</li>
<li><p>çƒ­å¤‡ä»½ï¼šåœ¨æ•°æ®åº“è¿è¡Œçš„æƒ…å†µä¸‹å¤‡ä»½çš„æ–¹æ³•ã€‚ä¼˜ç‚¹ï¼šå¯æŒ‰è¡¨æˆ–ç”¨æˆ·å¤‡ä»½ï¼Œå¤‡ä»½æ—¶æ•°æ®åº“ä»å¯ä½¿ç”¨ï¼Œå¯æ¢å¤è‡³ä»»ä¸€æ—¶é—´ç‚¹ã€‚ä½†æ˜¯ä¸èƒ½å‡ºé”™</p>
</li>
<li><p>å†·å¤‡ä»½ï¼šæ•°æ®åº“æ­£å¸¸å…³é—­åï¼Œå°†å…³é”®æ€§æ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€ä½ç½®çš„å¤‡ä»½æ–¹å¼ã€‚ä¼˜ç‚¹ï¼šæ“ä½œç®€å•å¿«é€Ÿï¼Œæ¢å¤ç®€å•</p>
</li>
</ul>
<p>æ›´è¯¦ç»†çš„å¯ä»¥å‚è€ƒï¼š<a href="https://imageslr.github.io/2020/db-engine.html">MySQL æ•°æ®åº“çš„å­˜å‚¨å¼•æ“ä¸é€‚ç”¨åœºæ™¯ - Images</a></p>
<h3 id="å¦‚ä½•ä¼˜åŒ–æ•°æ®åº“ï¼Ÿ"><a href="#å¦‚ä½•ä¼˜åŒ–æ•°æ®åº“ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–æ•°æ®åº“ï¼Ÿ"></a>å¦‚ä½•ä¼˜åŒ–æ•°æ®åº“ï¼Ÿ</h3><blockquote>
<p>åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•äº†åœ¨MySQLä¸­å“åº”æ—¶é—´è¶…è¿‡é˜€å€¼long_query_timeçš„SQLè¯­å¥ï¼Œé€šè¿‡æ—¥å¿—å»æ‰¾å‡ºIOå¤§çš„SQLä»¥åŠå‘ç°æœªå‘½ä¸­ç´¢å¼•çš„SQL</p>
</blockquote>
<blockquote>
<p>ä½¿ç”¨ Explain è¿›è¡Œåˆ†æï¼šé€šè¿‡explainå‘½ä»¤å¯ä»¥å¾—åˆ°è¡¨çš„è¯»å–é¡ºåºã€æ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹ã€å“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨ã€<strong>å“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨</strong>ã€è¡¨ä¹‹é—´çš„å¼•ç”¨ä»¥åŠ<strong>è¢«æ‰«æçš„è¡Œæ•°</strong>ç­‰é—®é¢˜ï¼›</p>
</blockquote>
<ul>
<li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨<code>!=</code>ã€<code>&lt;</code>ã€<code>&gt;</code>æ“ä½œç¬¦æˆ–å¯¹å­—æ®µè¿›è¡Œnullå€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼›</li>
<li>åªè¿”å›å¿…è¦çš„åˆ—ï¼šæœ€å¥½ä¸è¦ä½¿ç”¨ SELECT * è¯­å¥ï¼›</li>
<li>åªè¿”å›å¿…è¦çš„è¡Œï¼šä½¿ç”¨ LIMIT è¯­å¥æ¥é™åˆ¶è¿”å›çš„æ•°æ®ï¼›</li>
<li>å°†ä¸€ä¸ªå¤§è¿æ¥æŸ¥è¯¢åˆ†è§£æˆå¯¹æ¯ä¸€ä¸ªè¡¨è¿›è¡Œä¸€æ¬¡å•è¡¨æŸ¥è¯¢ï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œå…³è”ï¼Œè¿™æ ·åšçš„å¥½å¤„æœ‰ï¼š<ul>
<li>è®©ç¼“å­˜æ›´é«˜æ•ˆã€‚å¯¹äºè¿æ¥æŸ¥è¯¢ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè¡¨å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ•´ä¸ªæŸ¥è¯¢ç¼“å­˜å°±æ— æ³•ä½¿ç”¨ã€‚è€Œåˆ†è§£åçš„å¤šä¸ªæŸ¥è¯¢ï¼Œå³ä½¿å…¶ä¸­ä¸€ä¸ªè¡¨å‘ç”Ÿå˜åŒ–ï¼Œå¯¹å…¶å®ƒè¡¨çš„æŸ¥è¯¢ç¼“å­˜ä¾ç„¶å¯ä»¥ä½¿ç”¨ï¼›</li>
<li>åˆ†è§£æˆå¤šä¸ªå•è¡¨æŸ¥è¯¢ï¼Œè¿™äº›å•è¡¨æŸ¥è¯¢çš„ç¼“å­˜ç»“æœæ›´å¯èƒ½è¢«å…¶å®ƒæŸ¥è¯¢ä½¿ç”¨åˆ°ï¼Œä»è€Œå‡å°‘å†—ä½™çš„æŸ¥è¯¢ï¼›</li>
<li>å‡å°‘é”ç«äº‰</li>
</ul>
</li>
</ul>
<p>æ³¨æ„ä¼šå¼•èµ·ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼Œä»¥åŠåœ¨é€‚åˆçš„åœ°æ–¹å»ºç«‹ç´¢å¼•</p>
<ul>
<li><p>è®¾è®¡è¡¨æ—¶éµå¾ª<strong>ä¸‰å¤§èŒƒå¼</strong>ï¼›</p>
</li>
<li><p>é€‰æ‹©åˆé€‚çš„<strong>æ•°æ®ç±»å‹</strong>ï¼šå°½å¯èƒ½ä¸è¦å­˜å‚¨NULLå­—æ®µï¼›ä½¿ç”¨ç®€å•çš„æ•°æ®ç±»å‹ï¼ˆint, varchar/ textï¼‰ï¼›</p>
</li>
<li><p>è¡¨çš„<strong>æ°´å¹³åˆ‡åˆ†</strong>ï¼ˆShardingï¼‰ï¼šå°†åŒä¸€ä¸ªè¡¨ä¸­çš„è®°å½•æ‹†åˆ†åˆ°å¤šä¸ªç»“æ„ç›¸åŒçš„è¡¨ä¸­ï¼ˆç­–ç•¥ï¼šå“ˆå¸Œå–æ¨¡ï¼›æ ¹æ®IDèŒƒå›´æ¥åˆ†ï¼‰ã€‚å½“ä¸€ä¸ªè¡¨çš„æ•°æ®ä¸æ–­å¢å¤šæ—¶ï¼ŒSharding æ˜¯å¿…ç„¶çš„é€‰æ‹©ï¼Œå®ƒå¯ä»¥å°†æ•°æ®åˆ†å¸ƒåˆ°é›†ç¾¤çš„ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œä»è€Œç¼“è§£å•ä¸ªæ•°æ®åº“çš„å‹åŠ›ï¼›</p>
</li>
<li><p>è¡¨çš„<strong>å‚ç›´åˆ‡åˆ†</strong>ï¼šå°†ä¸€å¼ è¡¨æŒ‰åˆ—åˆ‡åˆ†æˆå¤šä¸ªè¡¨ã€‚å¯ä»¥å°†ä¸å¸¸ç”¨çš„å­—æ®µå•ç‹¬æ”¾åœ¨åŒä¸€ä¸ªè¡¨ä¸­ï¼›æŠŠå¤§å­—æ®µç‹¬ç«‹æ”¾å…¥ä¸€ä¸ªè¡¨ä¸­ï¼›æˆ–è€…æŠŠç»å¸¸ä½¿ç”¨çš„å­—æ®µï¼ˆå…³ç³»å¯†åˆ‡çš„ï¼‰æ”¾åœ¨ä¸€å¼ è¡¨ä¸­ã€‚å‚ç›´åˆ‡åˆ†ä¹‹åä¸šåŠ¡æ›´åŠ æ¸…æ™°ï¼Œç³»ç»Ÿä¹‹é—´æ•´åˆæˆ–æ‰©å±•å®¹æ˜“ï¼Œæ•°æ®ç»´æŠ¤ç®€å•</p>
</li>
<li><p>æ“ä½œç³»ç»Ÿï¼šå¢åŠ TCPæ”¯æŒçš„é˜Ÿåˆ—æ•°ï¼›</p>
</li>
<li><p>MySQLé…ç½®æ–‡ä»¶ä¼˜åŒ–ï¼šç¼“å­˜æ± å¤§å°å’Œä¸ªæ•°è®¾ç½®</p>
</li>
<li><p>ç£ç›˜æ€§èƒ½ï¼šå›ºæ€ç¡¬ç›˜ï¼›</p>
</li>
<li><p>CPUï¼šå¤šæ ¸ä¸”é«˜é¢‘ï¼›</p>
</li>
<li><p>å†…å­˜ï¼šå¢å¤§å†…å­˜</p>
</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯ä¸»ä»å¤åˆ¶ï¼Ÿå®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸»ä»å¤åˆ¶ï¼Ÿå®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸»ä»å¤åˆ¶ï¼Ÿå®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸»ä»å¤åˆ¶ï¼Ÿå®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ä¸»ä»å¤åˆ¶ï¼ˆReplicationï¼‰æ˜¯æŒ‡æ•°æ®å¯ä»¥ä»ä¸€ä¸ªMySQLæ•°æ®åº“ä¸»æœåŠ¡å™¨å¤åˆ¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨å¯ä»¥å¤åˆ¶ä¸»æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰æ•°æ®åº“æˆ–è€…ç‰¹å®šçš„æ•°æ®åº“ï¼Œæˆ–è€…ç‰¹å®šçš„è¡¨ã€‚é»˜è®¤é‡‡ç”¨å¼‚æ­¥æ¨¡å¼ã€‚</p>
<p>å®ç°åŸç†ï¼š</p>
<ul>
<li>ä¸»æœåŠ¡å™¨ <strong>binary log dump çº¿ç¨‹</strong>ï¼šå°†ä¸»æœåŠ¡å™¨ä¸­çš„æ•°æ®æ›´æ”¹ï¼ˆå¢åˆ æ”¹ï¼‰æ—¥å¿—å†™å…¥ Binary log ä¸­ï¼›</li>
<li>ä»æœåŠ¡å™¨ <strong>I/O çº¿ç¨‹</strong>ï¼šè´Ÿè´£ä»ä¸»æœåŠ¡å™¨è¯»å–binary logï¼Œå¹¶å†™å…¥æœ¬åœ°çš„ Relay logï¼›</li>
<li>ä»æœåŠ¡å™¨ <strong>SQL çº¿ç¨‹</strong>ï¼šè´Ÿè´£è¯»å– Relay logï¼Œè§£æå‡ºä¸»æœåŠ¡å™¨å·²ç»æ‰§è¡Œçš„æ•°æ®æ›´æ”¹ï¼Œå¹¶åœ¨ä»æœåŠ¡å™¨ä¸­é‡æ–°æ‰§è¡Œï¼ˆReplayï¼‰ï¼Œä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§</li>
</ul>
<h5 id="ä¸ºä»€ä¹ˆè¦ä¸»ä»å¤åˆ¶ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä¸»ä»å¤åˆ¶ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä¸»ä»å¤åˆ¶ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä¸»ä»å¤åˆ¶ï¼Ÿ</h5><ul>
<li>è¯»å†™åˆ†ç¦»ï¼šä¸»æœåŠ¡å™¨è´Ÿè´£å†™ï¼Œä»æœåŠ¡å™¨è´Ÿè´£è¯»<ul>
<li>ç¼“è§£äº†é”çš„äº‰ç”¨ï¼Œå³ä½¿ä¸»æœåŠ¡å™¨ä¸­åŠ äº†é”ï¼Œä¾ç„¶å¯ä»¥è¿›è¡Œè¯»æ“ä½œï¼›</li>
<li>ä»æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ MyISAMï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ä»¥åŠèŠ‚çº¦ç³»ç»Ÿå¼€é”€ï¼›</li>
<li>å¢åŠ å†—ä½™ï¼Œæé«˜å¯ç”¨æ€§</li>
</ul>
</li>
<li>æ•°æ®å®æ—¶å¤‡ä»½ï¼Œå½“ç³»ç»Ÿä¸­æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ•…éšœåˆ‡æ¢</li>
<li>é™ä½å•ä¸ªæœåŠ¡å™¨ç£ç›˜I/Oè®¿é—®çš„é¢‘ç‡ï¼Œæé«˜å•ä¸ªæœºå™¨çš„I/Oæ€§èƒ½</li>
</ul>
<h1 id="NoSQL-Redis"><a href="#NoSQL-Redis" class="headerlink" title="NoSQL/Redis"></a>NoSQL/Redis</h1><ul>
<li><a href="https://blog.csdn.net/Butterfly_resting/article/details/89668661">å‡ ç‡å¤§çš„Redisé¢è¯•é¢˜ï¼ˆå«ç­”æ¡ˆï¼‰ - CSDN</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Redis.md">CyC2018</a></li>
<li><a href="https://www.jianshu.com/p/65765dd10671">Redisé¢è¯•é¢˜æ€»ç»“ - ç®€ä¹¦</a></li>
<li><a href="https://www.cnblogs.com/jasontec/p/9699242.html">Rediså¸¸è§é¢è¯•é¢˜ - åšå®¢å›­</a></li>
<li><a href="https://github.com/0voice/interview_internal_reference#10">0voice/interview_internal_reference</a></li>
</ul>
<p>æ–‡ç« å†…å®¹æ¬è¿è‡ªæœ¬äºº<a href="https://www.yuque.com/docs/share/c6097254-4f08-4d0f-b9c0-550c9274e6be">è¯­é›€</a></p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>æ•°æ®åº“</category>
        <category>NoSQL</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
        <tag>NoSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢è¯•å…«è‚¡æ–‡ï¼ˆäºŒï¼‰â€”â€” æ“ä½œç³»ç»Ÿ</title>
    <url>/2021/09/22/%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<meta name="referrer" content="no-referrer" />

<h1 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h1><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>è¿›ç¨‹å’Œçº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ul>
<li>è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹ï¼ˆThreadï¼‰æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼›</li>
<li>çº¿ç¨‹ä¾èµ–äºè¿›ç¨‹è€Œå­˜åœ¨ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼›</li>
<li>è¿›ç¨‹æœ‰è‡ªå·±çš„ç‹¬ç«‹åœ°å€ç©ºé—´ï¼Œçº¿ç¨‹å…±äº«æ‰€å±è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼›</li>
<li>è¿›ç¨‹æ˜¯æ‹¥æœ‰ç³»ç»Ÿèµ„æºçš„ä¸€ä¸ªç‹¬ç«‹å•ä½ï¼Œè€Œçº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œåªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨,ä¸€ç»„å¯„å­˜å™¨å’Œæ ˆ)ï¼Œå’Œå…¶ä»–çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„ç›¸å…³èµ„æºå¦‚å†…å­˜ã€I/Oã€cpuç­‰ï¼›</li>
<li>åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ¶‰åŠåˆ°æ•´ä¸ªå½“å‰è¿›ç¨‹CPUç¯å¢ƒçš„ä¿å­˜ç¯å¢ƒçš„è®¾ç½®ä»¥åŠæ–°è¢«è°ƒåº¦è¿è¡Œçš„CPUç¯å¢ƒçš„è®¾ç½®ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢åªéœ€ä¿å­˜å’Œè®¾ç½®å°‘é‡çš„å¯„å­˜å™¨çš„å†…å®¹ï¼Œå¹¶ä¸æ¶‰åŠå­˜å‚¨å™¨ç®¡ç†æ–¹é¢çš„æ“ä½œï¼Œå¯è§ï¼Œè¿›ç¨‹åˆ‡æ¢çš„å¼€é”€è¿œå¤§äºçº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼›</li>
<li>çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ›´æ–¹ä¾¿ï¼ŒåŒä¸€è¿›ç¨‹ä¸‹çš„çº¿ç¨‹å…±äº«å…¨å±€å˜é‡ç­‰æ•°æ®ï¼Œè€Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡éœ€è¦ä»¥è¿›ç¨‹é—´é€šä¿¡(IPC)çš„æ–¹å¼è¿›è¡Œï¼›</li>
<li>å¤šçº¿ç¨‹ç¨‹åºåªè¦æœ‰ä¸€ä¸ªçº¿ç¨‹å´©æºƒï¼Œæ•´ä¸ªç¨‹åºå°±å´©æºƒäº†ï¼Œä½†å¤šè¿›ç¨‹ç¨‹åºä¸­ä¸€ä¸ªè¿›ç¨‹å´©æºƒå¹¶ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹é€ æˆå½±å“ï¼Œå› ä¸ºè¿›ç¨‹æœ‰è‡ªå·±çš„ç‹¬ç«‹åœ°å€ç©ºé—´ï¼Œå› æ­¤å¤šè¿›ç¨‹æ›´åŠ å¥å£®</li>
</ul>
<p>è¿›ç¨‹æ“ä½œä»£ç å®ç°ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017628290184064">å¤šè¿›ç¨‹ - å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™</a></p>
<h5 id="åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹å¯ä»¥å…±äº«å“ªäº›æ•°æ®ï¼Ÿ"><a href="#åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹å¯ä»¥å…±äº«å“ªäº›æ•°æ®ï¼Ÿ" class="headerlink" title="åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹å¯ä»¥å…±äº«å“ªäº›æ•°æ®ï¼Ÿ"></a>åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹å¯ä»¥å…±äº«å“ªäº›æ•°æ®ï¼Ÿ</h5><ul>
<li>è¿›ç¨‹ä»£ç æ®µ</li>
<li>è¿›ç¨‹çš„å…¬æœ‰æ•°æ®ï¼ˆå…¨å±€å˜é‡ã€é™æ€å˜é‡â€¦ï¼‰</li>
<li>è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦</li>
<li>è¿›ç¨‹çš„å½“å‰ç›®å½•</li>
<li>ä¿¡å·å¤„ç†å™¨/ä¿¡å·å¤„ç†å‡½æ•°ï¼šå¯¹æ”¶åˆ°çš„ä¿¡å·çš„å¤„ç†æ–¹å¼</li>
<li>è¿›ç¨‹IDä¸è¿›ç¨‹ç»„ID</li>
</ul>
<h5 id="çº¿ç¨‹ç‹¬å å“ªäº›èµ„æºï¼Ÿ"><a href="#çº¿ç¨‹ç‹¬å å“ªäº›èµ„æºï¼Ÿ" class="headerlink" title="çº¿ç¨‹ç‹¬å å“ªäº›èµ„æºï¼Ÿ"></a>çº¿ç¨‹ç‹¬å å“ªäº›èµ„æºï¼Ÿ</h5><ul>
<li>çº¿ç¨‹ID</li>
<li>ä¸€ç»„å¯„å­˜å™¨çš„å€¼</li>
<li>çº¿ç¨‹è‡ªèº«çš„æ ˆï¼ˆå †æ˜¯å…±äº«çš„ï¼‰</li>
<li>é”™è¯¯è¿”å›ç ï¼šçº¿ç¨‹å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„é”™è¯¯è¿”å›ç ï¼Œä¸€ä¸ªçº¿ç¨‹çš„é”™è¯¯è¿”å›ç ä¸åº”è¯¥è¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹ï¼›</li>
<li>ä¿¡å·æ©ç /ä¿¡å·å±è”½å­—(Signal mask)ï¼šè¡¨ç¤ºæ˜¯å¦å±è”½/é˜»å¡ç›¸åº”çš„ä¿¡å·ï¼ˆSIGKILL,SIGSTOPé™¤å¤–ï¼‰</li>
</ul>
<h3 id="è¿›ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"><a href="#è¿›ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿ" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"></a>è¿›ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</h3><ol>
<li>ç®¡é“(Pipe)</li>
</ol>
<ul>
<li>ç®¡é“æ˜¯åŠåŒå·¥çš„ï¼Œæ•°æ®åªèƒ½å‘ä¸€ä¸ªæ–¹å‘æµåŠ¨ï¼›éœ€è¦åŒæ–¹é€šä¿¡æ—¶ï¼Œéœ€è¦å»ºç«‹èµ·ä¸¤ä¸ªç®¡é“ï¼›</li>
<li>ä¸€ä¸ªè¿›ç¨‹å‘ç®¡é“ä¸­å†™çš„å†…å®¹è¢«ç®¡é“å¦ä¸€ç«¯çš„è¿›ç¨‹è¯»å‡ºã€‚å†™å…¥çš„å†…å®¹æ¯æ¬¡éƒ½æ·»åŠ åœ¨ç®¡é“ç¼“å†²åŒºçš„æœ«å°¾ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½æ˜¯ä»ç¼“å†²åŒºçš„å¤´éƒ¨è¯»å‡ºæ•°æ®ï¼›</li>
<li>åªèƒ½ç”¨äºçˆ¶å­è¿›ç¨‹æˆ–è€…å…„å¼Ÿè¿›ç¨‹ä¹‹é—´(å…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹)</li>
</ul>
<ol start="2">
<li>å‘½åç®¡é“</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>ä¿¡å·(Signal)</li>
<li>å…±äº«å†…å­˜</li>
<li>ä¿¡å·é‡(Semaphore)ï¼šåˆå§‹åŒ–æ“ä½œã€Pæ“ä½œã€Væ“ä½œï¼›Pæ“ä½œï¼šä¿¡å·é‡-1ï¼Œæ£€æµ‹æ˜¯å¦å°äº0ï¼Œå°äºåˆ™è¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼›Væ“ä½œï¼šä¿¡å·é‡+1ï¼Œè‹¥å°äºç­‰äº0ï¼Œåˆ™ä»é˜Ÿåˆ—ä¸­å”¤é†’ä¸€ä¸ªç­‰å¾…çš„è¿›ç¨‹è¿›å…¥å°±ç»ªæ€</li>
<li>å¥—æ¥å­—(Socket)</li>
</ol>
<p>æ›´è¯¦ç»†çš„å¯ä»¥å‚è€ƒï¼š</p>
<ul>
<li><a href="https://imageslr.github.io/2020/02/26/ipc.html">https://imageslr.github.io/2020/02/26/ipc.html</a></li>
<li><a href="https://www.jianshu.com/p/c1015f5ffa74">https://www.jianshu.com/p/c1015f5ffa74</a></li>
</ul>
<h3 id="è¿›ç¨‹åŒæ­¥é—®é¢˜"><a href="#è¿›ç¨‹åŒæ­¥é—®é¢˜" class="headerlink" title="è¿›ç¨‹åŒæ­¥é—®é¢˜"></a>è¿›ç¨‹åŒæ­¥é—®é¢˜</h3><blockquote>
<p>è¿›ç¨‹çš„åŒæ­¥æ˜¯ç›®çš„ï¼Œè€Œè¿›ç¨‹é—´é€šä¿¡æ˜¯å®ç°è¿›ç¨‹åŒæ­¥çš„æ‰‹æ®µ</p>
</blockquote>
<p>ç®¡ç¨‹å°†å…±äº«å˜é‡ä»¥åŠå¯¹è¿™äº›å…±äº«å˜é‡çš„æ“ä½œå°è£…èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå…·æœ‰ä¸€å®šæ¥å£çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿™æ ·åªèƒ½é€šè¿‡ç®¡ç¨‹æä¾›çš„æŸä¸ªè¿‡ç¨‹æ‰èƒ½è®¿é—®ç®¡ç¨‹ä¸­çš„èµ„æºã€‚è¿›ç¨‹åªèƒ½äº’æ–¥åœ°ä½¿ç”¨ç®¡ç¨‹ï¼Œä½¿ç”¨å®Œä¹‹åå¿…é¡»é‡Šæ”¾ç®¡ç¨‹å¹¶å”¤é†’å…¥å£ç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ã€‚<br>å½“ä¸€ä¸ªè¿›ç¨‹è¯•å›¾è¿›å…¥ç®¡ç¨‹æ—¶ï¼Œåœ¨<strong>å…¥å£ç­‰å¾…é˜Ÿåˆ—</strong>ç­‰å¾…ã€‚è‹¥Pè¿›ç¨‹å”¤é†’äº†Qè¿›ç¨‹ï¼Œåˆ™Qè¿›ç¨‹å…ˆæ‰§è¡Œï¼ŒPåœ¨<strong>ç´§æ€¥ç­‰å¾…é˜Ÿåˆ—</strong>ä¸­ç­‰å¾…ã€‚ï¼ˆ<strong>HOAREç®¡ç¨‹</strong>ï¼‰<br>waitæ“ä½œï¼šæ‰§è¡Œwaitæ“ä½œçš„è¿›ç¨‹è¿›å…¥æ¡ä»¶å˜é‡é“¾æœ«å°¾ï¼Œå”¤é†’ç´§æ€¥ç­‰å¾…é˜Ÿåˆ—æˆ–è€…å…¥å£é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ï¼›signalæ“ä½œï¼šå”¤é†’æ¡ä»¶å˜é‡é“¾ä¸­çš„è¿›ç¨‹ï¼Œè‡ªå·±è¿›å…¥ç´§æ€¥ç­‰å¾…é˜Ÿåˆ—ï¼Œè‹¥æ¡ä»¶å˜é‡é“¾ä¸ºç©ºï¼Œåˆ™ç»§ç»­æ‰§è¡Œã€‚ï¼ˆ<strong>HOAREç®¡ç¨‹</strong>ï¼‰<br><strong>MESAç®¡ç¨‹</strong>ï¼šå°†HOAREä¸­çš„signalæ¢æˆäº†notifyï¼ˆæˆ–è€…broadcasté€šçŸ¥æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ï¼‰ï¼Œè¿›è¡Œé€šçŸ¥è€Œä¸æ˜¯ç«‹é©¬äº¤æ¢ç®¡ç¨‹çš„ä½¿ç”¨æƒï¼Œåœ¨åˆé€‚çš„æ—¶å€™ï¼Œæ¡ä»¶é˜Ÿåˆ—é¦–ä½çš„è¿›ç¨‹å¯ä»¥è¿›å…¥ï¼Œè¿›å…¥ä¹‹å‰å¿…é¡»ç”¨whileæ£€æŸ¥æ¡ä»¶æ˜¯å¦åˆé€‚ã€‚ä¼˜ç‚¹ï¼šæ²¡æœ‰é¢å¤–çš„è¿›ç¨‹åˆ‡æ¢</p>
<blockquote>
<p>é—®é¢˜æè¿°ï¼šä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºæ¥å­˜æ”¾æ•°æ®ï¼Œåªæœ‰ç¼“å†²åŒºæ²¡æœ‰æ»¡ï¼Œç”Ÿäº§è€…æ‰å¯ä»¥å†™å…¥æ•°æ®ï¼›åªæœ‰ç¼“å†²åŒºä¸ä¸ºç©ºï¼Œæ¶ˆè´¹è€…æ‰å¯ä»¥è¯»å‡ºæ•°æ®</p>
</blockquote>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç æè¿° </span></span><br><span class="line"><span class="comment">// å®šä¹‰ä¿¡å·é‡ fullè®°å½•ç¼“å†²åŒºç‰©å“æ•°é‡ emptyä»£è¡¨ç¼“å†²åŒºç©ºä½æ•°é‡ mutexä¸ºäº’æ–¥é‡</span></span><br><span class="line">semaphore full = <span class="number">0</span>, empty = n, mutex = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿäº§è€…è¿›ç¨‹</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">producer</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="keyword">do</span>&#123;</span><br><span class="line">   	  P(empty);</span><br><span class="line">	  P(mutex);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// ç”Ÿäº§è€…è¿›è¡Œç”Ÿäº§</span></span><br><span class="line">   	</span><br><span class="line">   	  V(mutex);</span><br><span class="line">   	  V(full);</span><br><span class="line"> 	&#125; <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">consumer</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="keyword">do</span>&#123;</span><br><span class="line">	  P(full);</span><br><span class="line">	  P(mutex);</span><br><span class="line"></span><br><span class="line">    	<span class="comment">// æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line"></span><br><span class="line">	  V(mutex);</span><br><span class="line">	  V(empty);</span><br><span class="line"> 	&#125; <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>é—®é¢˜æè¿°ï¼šæœ‰äº”ä½å“²å­¦å®¶å›´ç»•ç€é¤æ¡Œåï¼Œæ¯ä¸€ä½å“²å­¦å®¶è¦ä¹ˆæ€è€ƒï¼Œè¦ä¹ˆåƒé¥­ã€‚ä¸ºäº†åƒé¥­ï¼Œå“²å­¦å®¶å¿…é¡»æ‹¿èµ·ä¸¤åŒç­·å­ï¼ˆåˆ†åˆ«æ”¾äºå·¦å³ä¸¤ç«¯ï¼‰ä¸å¹¸çš„æ˜¯ï¼Œç­·å­çš„æ•°é‡å’Œå“²å­¦å®¶ç›¸ç­‰ï¼Œæ‰€ä»¥æ¯åªç­·å­å¿…é¡»ç”±ä¸¤ä½å“²å­¦å®¶å…±äº«ã€‚</p>
</blockquote>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> N 5  <span class="comment">// number of philosopher</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LEFT (i + N - 1)%N <span class="comment">// number of i&#x27;s left neighbors</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RIGHT (i + 1)%N <span class="comment">// number of i&#x27;s right neighbors</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> THINKING 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HUNGRY 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EATING 2</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> semaphore;</span><br><span class="line"><span class="type">int</span> state[N]; <span class="comment">// array to keep track of everyone&#x27;s state</span></span><br><span class="line">semaphore mutex = <span class="number">1</span>; <span class="comment">// mutual exclusion of critical region</span></span><br><span class="line">semaphore s[N]; </span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">philosopher</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">	<span class="keyword">while</span> (TRUE) &#123;</span><br><span class="line">		think();</span><br><span class="line">		take_forks(i);</span><br><span class="line">		eat();</span><br><span class="line">		put_forks(i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">take_forks</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">	down(&amp;mutex); <span class="comment">// enter critical region</span></span><br><span class="line">	state[i] = HUNGRY; <span class="comment">// record that i is hungry</span></span><br><span class="line">	test_forks(i); <span class="comment">// try to acquire two forks</span></span><br><span class="line">	up(&amp;mutex); <span class="comment">// exit critical region</span></span><br><span class="line">	down(&amp;s[i]); <span class="comment">// block if forks are not acquired</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">put_forks</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">	down(&amp;mutex); <span class="comment">// enter critical region</span></span><br><span class="line">	state[i] = THINKING; <span class="comment">// record that has finished eating</span></span><br><span class="line">	test_forks(LEFT); <span class="comment">// see if left neighbor can now eat</span></span><br><span class="line">	test_forks(RIGHT); <span class="comment">// see if right neighbor can now eat</span></span><br><span class="line">	up(&amp;mutex); <span class="comment">// exit critical region</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">test_forks</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (state[i] == HUNGRY &amp;&amp; state[LEFT] != EATING &amp;&amp; state[RIGHT] != EATING) &#123;</span><br><span class="line">		state[i] = EATING;</span><br><span class="line">		up(&amp;s[i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ä¸´ç•ŒåŒºçš„æ¦‚å¿µï¼Ÿ"><a href="#ä¸´ç•ŒåŒºçš„æ¦‚å¿µï¼Ÿ" class="headerlink" title="ä¸´ç•ŒåŒºçš„æ¦‚å¿µï¼Ÿ"></a>ä¸´ç•ŒåŒºçš„æ¦‚å¿µï¼Ÿ</h5><p>å„ä¸ªè¿›ç¨‹ä¸­å¯¹ä¸´ç•Œèµ„æºï¼ˆäº’æ–¥èµ„æº/å…±äº«å˜é‡ï¼Œä¸€æ¬¡åªèƒ½ç»™ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼‰è¿›è¡Œæ“ä½œçš„ç¨‹åºç‰‡æ®µ</p>
<h5 id="åŒæ­¥ä¸äº’æ–¥çš„æ¦‚å¿µï¼Ÿ"><a href="#åŒæ­¥ä¸äº’æ–¥çš„æ¦‚å¿µï¼Ÿ" class="headerlink" title="åŒæ­¥ä¸äº’æ–¥çš„æ¦‚å¿µï¼Ÿ"></a>åŒæ­¥ä¸äº’æ–¥çš„æ¦‚å¿µï¼Ÿ</h5><ul>
<li>åŒæ­¥ï¼šå¤šä¸ªè¿›ç¨‹å› ä¸ºåˆä½œè€Œä½¿å¾—è¿›ç¨‹çš„æ‰§è¡Œæœ‰ä¸€å®šçš„å…ˆåé¡ºåºã€‚æ¯”å¦‚æŸä¸ªè¿›ç¨‹éœ€è¦å¦ä¸€ä¸ªè¿›ç¨‹æä¾›çš„æ¶ˆæ¯ï¼Œè·å¾—æ¶ˆæ¯ä¹‹å‰è¿›å…¥é˜»å¡æ€ï¼›</li>
<li>äº’æ–¥ï¼šå¤šä¸ªè¿›ç¨‹åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½è¿›å…¥ä¸´ç•ŒåŒº</li>
</ul>
<h5 id="å¹¶å‘ã€å¹¶è¡Œã€å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿ"><a href="#å¹¶å‘ã€å¹¶è¡Œã€å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="å¹¶å‘ã€å¹¶è¡Œã€å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿ"></a>å¹¶å‘ã€å¹¶è¡Œã€å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿ</h5><p>å¹¶å‘ï¼šåœ¨ä¸€ä¸ªæ—¶é—´æ®µä¸­åŒæ—¶æœ‰å¤šä¸ªç¨‹åºåœ¨è¿è¡Œï¼Œä½†å…¶å®ä»»ä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªç¨‹åºåœ¨CPUä¸Šè¿è¡Œï¼Œå®è§‚ä¸Šçš„å¹¶å‘æ˜¯é€šè¿‡ä¸æ–­çš„åˆ‡æ¢å®ç°çš„ï¼›<br>å¤šçº¿ç¨‹ï¼šå¹¶å‘è¿è¡Œçš„ä¸€æ®µä»£ç ã€‚æ˜¯å®ç°å¼‚æ­¥çš„æ‰‹æ®µ<br>å¹¶è¡Œï¼ˆå’Œä¸²è¡Œç›¸æ¯”ï¼‰ï¼šåœ¨å¤šCPUç³»ç»Ÿä¸­ï¼Œå¤šä¸ªç¨‹åºæ— è®ºå®è§‚è¿˜æ˜¯å¾®è§‚ä¸Šéƒ½æ˜¯åŒæ—¶æ‰§è¡Œçš„<br>å¼‚æ­¥ï¼ˆå’ŒåŒæ­¥ç›¸æ¯”ï¼‰ï¼šåŒæ­¥æ˜¯é¡ºåºæ‰§è¡Œï¼Œå¼‚æ­¥æ˜¯åœ¨ç­‰å¾…æŸä¸ªèµ„æºçš„æ—¶å€™ç»§ç»­åšè‡ªå·±çš„äº‹</p>
<h3 id="è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€ï¼Ÿ"><a href="#è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€ï¼Ÿ" class="headerlink" title="è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€ï¼Ÿ"></a>è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€ï¼Ÿ</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1431305/1628085394606-49204b73-729e-4f57-97bc-d43ad01ec54b.png"></p>
<ul>
<li>å°±ç»ªçŠ¶æ€ï¼šè¿›ç¨‹å·²è·å¾—é™¤å¤„ç†æœºä»¥å¤–çš„æ‰€éœ€èµ„æºï¼Œç­‰å¾…åˆ†é…å¤„ç†æœºèµ„æº</li>
<li>è¿è¡ŒçŠ¶æ€ï¼šå ç”¨å¤„ç†æœºèµ„æºè¿è¡Œï¼Œå¤„äºæ­¤çŠ¶æ€çš„è¿›ç¨‹æ•°å°äºç­‰äºCPUæ•°</li>
<li>é˜»å¡çŠ¶æ€ï¼š è¿›ç¨‹ç­‰å¾…æŸç§æ¡ä»¶ï¼Œåœ¨æ¡ä»¶æ»¡è¶³ä¹‹å‰æ— æ³•æ‰§è¡Œ</li>
</ul>
<h3 id="è¿›ç¨‹è°ƒåº¦ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><a href="#è¿›ç¨‹è°ƒåº¦ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="è¿›ç¨‹è°ƒåº¦ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"></a>è¿›ç¨‹è°ƒåº¦ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h3><ol>
<li><strong>æ‰¹å¤„ç†ç³»ç»Ÿ</strong>ï¼š<br>æŒ‰ç…§è¯·æ±‚çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚éæŠ¢å å¼ï¼Œå¼€é”€å°ï¼Œæ— é¥¥é¥¿é—®é¢˜ï¼Œå“åº”æ—¶é—´ä¸ç¡®å®šï¼ˆå¯èƒ½å¾ˆæ…¢ï¼‰ï¼›<br>å¯¹çŸ­è¿›ç¨‹ä¸åˆ©ï¼Œå¯¹IOå¯†é›†å‹è¿›ç¨‹ä¸åˆ©ã€‚</li>
</ol>
<p>æŒ‰ä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚éæŠ¢å å¼ï¼Œååé‡é«˜ï¼Œå¼€é”€å¯èƒ½è¾ƒå¤§ï¼Œå¯èƒ½å¯¼è‡´é¥¥é¥¿é—®é¢˜ï¼›<br>å¯¹çŸ­è¿›ç¨‹æä¾›å¥½çš„å“åº”æ—¶é—´ï¼Œå¯¹é•¿è¿›ç¨‹ä¸åˆ©ã€‚</p>
<p>æŒ‰å‰©ä½™è¿è¡Œæ—¶é—´çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚(æœ€çŸ­ä½œä¸šä¼˜å…ˆçš„æŠ¢å å¼ç‰ˆæœ¬)ã€‚ååé‡é«˜ï¼Œå¼€é”€å¯èƒ½è¾ƒå¤§ï¼Œæä¾›å¥½çš„å“åº”æ—¶é—´ï¼›<br>å¯èƒ½å¯¼è‡´é¥¥é¥¿é—®é¢˜ï¼Œå¯¹é•¿è¿›ç¨‹ä¸åˆ©ã€‚</p>
<p>å“åº”æ¯” = 1+ ç­‰å¾…æ—¶é—´/å¤„ç†æ—¶é—´ã€‚åŒæ—¶è€ƒè™‘äº†ç­‰å¾…æ—¶é—´çš„é•¿çŸ­å’Œä¼°è®¡éœ€è¦çš„æ‰§è¡Œæ—¶é—´é•¿çŸ­ï¼Œå¾ˆå¥½çš„å¹³è¡¡äº†é•¿çŸ­è¿›ç¨‹ã€‚éæŠ¢å ï¼Œååé‡é«˜ï¼Œå¼€é”€å¯èƒ½è¾ƒå¤§ï¼Œæä¾›å¥½çš„å“åº”æ—¶é—´ï¼Œæ— é¥¥é¥¿é—®é¢˜ã€‚</p>
<ol start="2">
<li><strong>äº¤äº’å¼ç³»ç»Ÿ</strong><br>äº¤äº’å¼ç³»ç»Ÿæœ‰å¤§é‡çš„ç”¨æˆ·äº¤äº’æ“ä½œï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­è°ƒåº¦ç®—æ³•çš„ç›®æ ‡æ˜¯å¿«é€Ÿåœ°è¿›è¡Œå“åº”ã€‚</li>
</ol>
<p>å°†æ‰€æœ‰å°±ç»ªè¿›ç¨‹æŒ‰ FCFS çš„åŸåˆ™æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨å®Œæ—¶é—´ç‰‡çš„è¿›ç¨‹æ’åˆ°é˜Ÿåˆ—æœ€åã€‚æŠ¢å å¼ï¼ˆæ—¶é—´ç‰‡ç”¨å®Œæ—¶ï¼‰ï¼Œå¼€é”€å°ï¼Œæ— é¥¥é¥¿é—®é¢˜ï¼Œä¸ºçŸ­è¿›ç¨‹æä¾›å¥½çš„å“åº”æ—¶é—´ï¼›<br>è‹¥æ—¶é—´ç‰‡å°ï¼Œè¿›ç¨‹åˆ‡æ¢é¢‘ç¹ï¼Œååé‡ä½ï¼›è‹¥æ—¶é—´ç‰‡å¤ªé•¿ï¼Œå®æ—¶æ€§å¾—ä¸åˆ°ä¿è¯ã€‚</p>
<p>ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªä¼˜å…ˆçº§ï¼ŒæŒ‰ä¼˜å…ˆçº§è¿›è¡Œè°ƒåº¦ã€‚ä¸ºäº†é˜²æ­¢ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æ°¸è¿œç­‰ä¸åˆ°è°ƒåº¦ï¼Œå¯ä»¥éšç€æ—¶é—´çš„æ¨ç§»å¢åŠ ç­‰å¾…è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚</p>
<p>è®¾ç½®å¤šä¸ªå°±ç»ªé˜Ÿåˆ—1ã€2ã€3â€¦ï¼Œä¼˜å…ˆçº§é€’å‡ï¼Œæ—¶é—´ç‰‡é€’å¢ã€‚åªæœ‰ç­‰åˆ°ä¼˜å…ˆçº§æ›´é«˜çš„é˜Ÿåˆ—ä¸ºç©ºæ—¶æ‰ä¼šè°ƒåº¦å½“å‰é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ã€‚å¦‚æœè¿›ç¨‹ç”¨å®Œäº†å½“å‰é˜Ÿåˆ—çš„æ—¶é—´ç‰‡è¿˜æœªæ‰§è¡Œå®Œï¼Œåˆ™ä¼šè¢«ç§»åˆ°ä¸‹ä¸€é˜Ÿåˆ—ã€‚<br>æŠ¢å å¼ï¼ˆæ—¶é—´ç‰‡ç”¨å®Œæ—¶ï¼‰ï¼Œå¼€é”€å¯èƒ½è¾ƒå¤§ï¼Œå¯¹IOå‹è¿›ç¨‹æœ‰åˆ©ï¼Œå¯èƒ½ä¼šå‡ºç°é¥¥é¥¿é—®é¢˜ã€‚</p>
<h5 id="ä»€ä¹ˆå«ä¼˜å…ˆçº§åè½¬ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#ä»€ä¹ˆå«ä¼˜å…ˆçº§åè½¬ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆå«ä¼˜å…ˆçº§åè½¬ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"></a>ä»€ä¹ˆå«ä¼˜å…ˆçº§åè½¬ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h5><p>é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ç­‰å¾…è¢«ä¸€ä¸ªä½ä¼˜å…ˆçº§è¿›ç¨‹å ç”¨çš„èµ„æºæ—¶ï¼Œå°±ä¼šå‡ºç°ä¼˜å…ˆçº§åè½¬ï¼Œå³ä¼˜å…ˆçº§è¾ƒä½çš„è¿›ç¨‹æ¯”ä¼˜å…ˆçº§è¾ƒé«˜çš„è¿›ç¨‹å…ˆæ‰§è¡Œã€‚æ­¤å¤„è¯¦ç»†è§£é‡Šä¼˜å…ˆçº§åè½¬å¸¦æ¥çš„é—®é¢˜ï¼šå¦‚æœæœ‰ä¸€ä¸ªä¸­ç­‰ä¼˜å…ˆçº§çš„è¿›ç¨‹å°†ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æŠ¢å ï¼Œé‚£ä¹ˆæ­¤æ—¶ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æ— æ³•æ­£å¸¸è¿›è¡Œå¹¶åœ¨åç»­é‡Šæ”¾è¢«å ç”¨çš„èµ„æºï¼Œå¯¼è‡´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¸€ç›´è¢«æŒ‚èµ·ï¼Œç›´åˆ°ä¸­ç­‰ä¼˜å…ˆçº§çš„è¿›ç¨‹å®Œæˆåï¼Œä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æ‰å¯ä»¥ç»§ç»­å¹¶åœ¨åç»­é‡Šæ”¾å ç”¨çš„èµ„æºï¼Œæœ€åé«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹æ‰å¯ä»¥æ‰§è¡Œã€‚å¯¼è‡´çš„é—®é¢˜å°±æ˜¯é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹åœ¨ä¸­ç­‰ä¼˜å…ˆçº§çš„è¿›ç¨‹è°ƒåº¦ä¹‹åã€‚<br>è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li>ä¼˜å…ˆçº§å¤©èŠ±æ¿(priority ceiling)ï¼šå½“ä»»åŠ¡ç”³è¯·æŸèµ„æºæ—¶ï¼ŒæŠŠè¯¥ä»»åŠ¡çš„ä¼˜å…ˆçº§æå‡åˆ°å¯è®¿é—®è¿™ä¸ªèµ„æºçš„æ‰€æœ‰ä»»åŠ¡ä¸­çš„æœ€é«˜ä¼˜å…ˆçº§ï¼Œè¿™ä¸ªä¼˜å…ˆçº§ç§°ä¸ºè¯¥èµ„æºçš„ä¼˜å…ˆçº§å¤©èŠ±æ¿ã€‚ç®€å•æ˜“è¡Œã€‚</li>
<li>ä¼˜å…ˆçº§ç»§æ‰¿(priority inheritance)ï¼šå½“ä»»åŠ¡Aç”³è¯·å…±äº«èµ„æºSæ—¶ï¼Œå¦‚æœSæ­£åœ¨è¢«ä»»åŠ¡Cä½¿ç”¨ï¼Œé€šè¿‡æ¯”è¾ƒä»»åŠ¡Cä¸è‡ªèº«çš„ä¼˜å…ˆçº§ï¼Œå¦‚å‘ç°ä»»åŠ¡Cçš„ä¼˜å…ˆçº§å°äºè‡ªèº«çš„ä¼˜å…ˆçº§ï¼Œåˆ™å°†ä»»åŠ¡Cçš„ä¼˜å…ˆçº§æå‡åˆ°è‡ªèº«çš„ä¼˜å…ˆçº§ï¼Œä»»åŠ¡Cé‡Šæ”¾èµ„æºSåï¼Œå†æ¢å¤ä»»åŠ¡Cçš„åŸä¼˜å…ˆçº§ã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åƒµå°¸è¿›ç¨‹ï¼Ÿ</h3><p>ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸåï¼Œå®ƒçš„çˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰ç­‰å¾…å®ƒï¼ˆè°ƒç”¨waitæˆ–è€…waitpidï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå­è¿›ç¨‹å°†æˆä¸ºä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚åƒµå°¸è¿›ç¨‹æ˜¯ä¸€ä¸ªå·²ç»æ­»äº¡çš„è¿›ç¨‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰çœŸæ­£è¢«é”€æ¯ã€‚å®ƒå·²ç»æ”¾å¼ƒäº†å‡ ä¹æ‰€æœ‰å†…å­˜ç©ºé—´ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä¹Ÿä¸èƒ½è¢«è°ƒåº¦ï¼Œä»…ä»…åœ¨è¿›ç¨‹è¡¨ä¸­ä¿ç•™ä¸€ä¸ªä½ç½®ï¼Œè®°è½½è¯¥è¿›ç¨‹çš„è¿›ç¨‹IDã€ç»ˆæ­¢çŠ¶æ€ä»¥åŠèµ„æºåˆ©ç”¨ä¿¡æ¯(CPUæ—¶é—´ï¼Œå†…å­˜ä½¿ç”¨é‡ç­‰ç­‰)ä¾›çˆ¶è¿›ç¨‹æ”¶é›†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œåƒµå°¸è¿›ç¨‹ä¸å†å æœ‰ä»»ä½•å†…å­˜ç©ºé—´ã€‚è¿™ä¸ªåƒµå°¸è¿›ç¨‹å¯èƒ½ä¼šä¸€ç›´ç•™åœ¨ç³»ç»Ÿä¸­ç›´åˆ°ç³»ç»Ÿé‡å¯ã€‚</p>
<p>å±å®³ï¼šå ç”¨è¿›ç¨‹å·ï¼Œè€Œç³»ç»Ÿæ‰€èƒ½ä½¿ç”¨çš„è¿›ç¨‹å·æ˜¯æœ‰é™çš„ï¼›å ç”¨å†…å­˜ã€‚</p>
<p>ä»¥ä¸‹æƒ…å†µä¸ä¼šäº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼š</p>
<ul>
<li>è¯¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å…ˆç»“æŸäº†ã€‚æ¯ä¸ªè¿›ç¨‹ç»“æŸçš„æ—¶å€™ï¼Œç³»ç»Ÿéƒ½ä¼šæ‰«ææ˜¯å¦å­˜åœ¨å­è¿›ç¨‹ï¼Œå¦‚æœæœ‰åˆ™ç”¨Initè¿›ç¨‹æ¥ç®¡ï¼Œæˆä¸ºè¯¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œå¹¶ä¸”ä¼šè°ƒç”¨waitç­‰å¾…å…¶ç»“æŸã€‚</li>
<li>çˆ¶è¿›ç¨‹è°ƒç”¨waitæˆ–è€…waitpidç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼ˆéœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´æŸ¥è¯¢å­è¿›ç¨‹æ˜¯å¦ç»“æŸï¼‰ã€‚waitç³»ç»Ÿè°ƒç”¨ä¼šä½¿çˆ¶è¿›ç¨‹æš‚åœæ‰§è¡Œï¼Œç›´åˆ°å®ƒçš„ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸä¸ºæ­¢ã€‚waitpidåˆ™å¯ä»¥åŠ å…¥<code>WNOHANG</code>(wait-no-hang)é€‰é¡¹ï¼Œå¦‚æœæ²¡æœ‰å‘ç°ç»“æŸçš„å­è¿›ç¨‹ï¼Œå°±ä¼šç«‹å³è¿”å›ï¼Œä¸ä¼šå°†è°ƒç”¨waitpidçš„è¿›ç¨‹é˜»å¡ã€‚åŒæ—¶ï¼Œwaitpidè¿˜å¯ä»¥é€‰æ‹©æ˜¯ç­‰å¾…ä»»ä¸€å­è¿›ç¨‹ï¼ˆåŒwaitï¼‰ï¼Œè¿˜æ˜¯ç­‰å¾…æŒ‡å®špidçš„å­è¿›ç¨‹ï¼Œè¿˜æ˜¯ç­‰å¾…åŒä¸€è¿›ç¨‹ç»„ä¸‹çš„ä»»ä¸€å­è¿›ç¨‹ï¼Œè¿˜æ˜¯ç­‰å¾…ç»„IDç­‰äºpidçš„ä»»ä¸€å­è¿›ç¨‹ï¼›</li>
<li>å­è¿›ç¨‹ç»“æŸæ—¶ï¼Œç³»ç»Ÿä¼šäº§ç”Ÿ<code>SIGCHLD</code>(signal-child)ä¿¡å·ï¼Œå¯ä»¥æ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œåœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨waitpidï¼Œç­‰å¾…æ‰€æœ‰ç»“æŸçš„å­è¿›ç¨‹ï¼ˆæ³¨æ„ï¼šä¸€èˆ¬éƒ½éœ€è¦å¾ªç¯è°ƒç”¨waitpidï¼Œå› ä¸ºåœ¨ä¿¡å·å¤„ç†å‡½æ•°å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œå¯èƒ½å·²ç»æœ‰å¤šä¸ªå­è¿›ç¨‹ç»“æŸäº†ï¼Œè€Œä¿¡å·å¤„ç†å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥è¦å¾ªç¯è°ƒç”¨å°†æ‰€æœ‰ç»“æŸçš„å­è¿›ç¨‹å›æ”¶ï¼‰ï¼›</li>
<li>ä¹Ÿå¯ä»¥ç”¨<code>signal(SIGCLD, SIG_IGN)</code>(signal-ignore)é€šçŸ¥å†…æ ¸ï¼Œè¡¨ç¤ºå¿½ç•¥<code>SIGCHLD</code>ä¿¡å·ï¼Œé‚£ä¹ˆå­è¿›ç¨‹ç»“æŸåï¼Œå†…æ ¸ä¼šè¿›è¡Œå›æ”¶ã€‚</li>
</ul>
<h5 id="ä»€ä¹ˆæ˜¯å­¤å„¿è¿›ç¨‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å­¤å„¿è¿›ç¨‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å­¤å„¿è¿›ç¨‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å­¤å„¿è¿›ç¨‹ï¼Ÿ</h5><p>ä¸€ä¸ªçˆ¶è¿›ç¨‹å·²ç»ç»“æŸäº†ï¼Œä½†æ˜¯å®ƒçš„å­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆè¿™äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹ä¼šè¢«Initï¼ˆè¿›ç¨‹IDä¸º1ï¼‰æ¥ç®¡ï¼Œå½“è¿™äº›å­¤å„¿è¿›ç¨‹ç»“æŸæ—¶ç”±Initå®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚</p>
<h3 id="çº¿ç¨‹åŒæ­¥æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"><a href="#çº¿ç¨‹åŒæ­¥æœ‰å“ªäº›æ–¹å¼ï¼Ÿ" class="headerlink" title="çº¿ç¨‹åŒæ­¥æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"></a>çº¿ç¨‹åŒæ­¥æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</h3><blockquote>
<p>ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹åŒæ­¥ï¼šçº¿ç¨‹æœ‰æ—¶å€™ä¼šå’Œå…¶ä»–çº¿ç¨‹å…±äº«ä¸€äº›èµ„æºï¼Œæ¯”å¦‚å†…å­˜ã€æ•°æ®åº“ç­‰ã€‚å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä»½å…±äº«èµ„æºçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå†²çªã€‚å› æ­¤éœ€è¦çº¿ç¨‹çš„åŒæ­¥ï¼Œå¤šä¸ªçº¿ç¨‹æŒ‰é¡ºåºè®¿é—®èµ„æºã€‚</p>
</blockquote>
<ul>
<li><strong>äº’æ–¥é‡</strong> Mutexï¼šäº’æ–¥é‡æ˜¯å†…æ ¸å¯¹è±¡ï¼Œåªæœ‰æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹æ‰æœ‰è®¿é—®äº’æ–¥èµ„æºçš„æƒé™ã€‚å› ä¸ºäº’æ–¥å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯äº’æ–¥èµ„æºä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼›å½“å‰æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹å¤„ç†å®Œä»»åŠ¡åå¿…é¡»å°†äº’æ–¥å¯¹è±¡äº¤å‡ºï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹è®¿é—®è¯¥èµ„æºï¼›</li>
<li><strong>ä¿¡å·é‡</strong> Semaphoreï¼šä¿¡å·é‡æ˜¯å†…æ ¸å¯¹è±¡ï¼Œå®ƒå…è®¸åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºï¼Œä½†æ˜¯éœ€è¦æ§åˆ¶åŒä¸€æ—¶åˆ»è®¿é—®æ­¤èµ„æºçš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚ä¿¡å·é‡å¯¹è±¡ä¿å­˜äº†<strong>æœ€å¤§èµ„æºè®¡æ•°</strong>å’Œ<strong>å½“å‰å¯ç”¨èµ„æºè®¡æ•°</strong>ï¼Œæ¯å¢åŠ ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œå½“å‰å¯ç”¨èµ„æºè®¡æ•°å°±å‡1ï¼Œåªè¦å½“å‰å¯ç”¨èµ„æºè®¡æ•°å¤§äº0ï¼Œå°±å¯ä»¥å‘å‡ºä¿¡å·é‡ä¿¡å·ï¼Œå¦‚æœä¸º0ï¼Œåˆ™å°†çº¿ç¨‹æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚çº¿ç¨‹å¤„ç†å®Œå…±äº«èµ„æºåï¼Œåº”åœ¨ç¦»å¼€çš„åŒæ—¶é€šè¿‡<code>ReleaseSemaphore</code>å‡½æ•°å°†å½“å‰å¯ç”¨èµ„æºæ•°åŠ 1ã€‚å¦‚æœä¿¡å·é‡çš„å–å€¼åªèƒ½ä¸º0æˆ–1ï¼Œé‚£ä¹ˆä¿¡å·é‡å°±æˆä¸ºäº†äº’æ–¥é‡ï¼›</li>
<li><strong>äº‹ä»¶</strong> Eventï¼šå…è®¸ä¸€ä¸ªçº¿ç¨‹åœ¨å¤„ç†å®Œä¸€ä¸ªä»»åŠ¡åï¼Œä¸»åŠ¨å”¤é†’å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚äº‹ä»¶åˆ†ä¸ºæ‰‹åŠ¨é‡ç½®äº‹ä»¶å’Œè‡ªåŠ¨é‡ç½®äº‹ä»¶ã€‚æ‰‹åŠ¨é‡ç½®äº‹ä»¶è¢«è®¾ç½®ä¸ºæ¿€å‘çŠ¶æ€åï¼Œä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œè€Œä¸”ä¸€ç›´ä¿æŒä¸ºæ¿€å‘çŠ¶æ€ï¼Œç›´åˆ°ç¨‹åºé‡æ–°æŠŠå®ƒè®¾ç½®ä¸ºæœªæ¿€å‘çŠ¶æ€ã€‚è‡ªåŠ¨é‡ç½®äº‹ä»¶è¢«è®¾ç½®ä¸ºæ¿€å‘çŠ¶æ€åï¼Œä¼šå”¤é†’<strong>ä¸€ä¸ª</strong>ç­‰å¾…ä¸­çš„çº¿ç¨‹ï¼Œç„¶åè‡ªåŠ¨æ¢å¤ä¸ºæœªæ¿€å‘çŠ¶æ€ã€‚</li>
<li><strong>ä¸´ç•ŒåŒº</strong> Critical Sectionï¼šä»»æ„æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å¯¹ä¸´ç•Œèµ„æºè¿›è¡Œè®¿é—®ã€‚æ‹¥æœ‰ä¸´ç•ŒåŒºå¯¹è±¡çš„çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥ä¸´ç•Œèµ„æºï¼Œå…¶å®ƒè¯•å›¾è®¿é—®è¯¥èµ„æºçš„çº¿ç¨‹å°†è¢«æŒ‚èµ·ï¼Œç›´åˆ°ä¸´ç•ŒåŒºå¯¹è±¡è¢«é‡Šæ”¾ã€‚</li>
</ul>
<h5 id="äº’æ–¥é‡å’Œä¸´ç•ŒåŒºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#äº’æ–¥é‡å’Œä¸´ç•ŒåŒºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="äº’æ–¥é‡å’Œä¸´ç•ŒåŒºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>äº’æ–¥é‡å’Œä¸´ç•ŒåŒºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h5><p>äº’æ–¥é‡æ˜¯å¯ä»¥å‘½åçš„ï¼Œå¯ä»¥ç”¨äºä¸åŒè¿›ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼›è€Œä¸´ç•ŒåŒºåªèƒ½ç”¨äºåŒä¸€è¿›ç¨‹ä¸­çº¿ç¨‹çš„åŒæ­¥ã€‚åˆ›å»ºäº’æ–¥é‡éœ€è¦çš„èµ„æºæ›´å¤šï¼Œå› æ­¤ä¸´ç•ŒåŒºçš„ä¼˜åŠ¿æ˜¯é€Ÿåº¦å¿«ï¼ŒèŠ‚çœèµ„æºã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ</h3><p>åç¨‹æ˜¯ä¸€ç§ç”¨æˆ·æ€çš„è½»é‡çº§çº¿ç¨‹ï¼Œåç¨‹çš„è°ƒåº¦å®Œå…¨ç”±ç”¨æˆ·æ§åˆ¶ã€‚åç¨‹æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚åç¨‹è°ƒåº¦åˆ‡æ¢æ—¶ï¼Œå°†å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆä¿å­˜åˆ°å…¶ä»–åœ°æ–¹ï¼Œåœ¨åˆ‡å›æ¥çš„æ—¶å€™ï¼Œæ¢å¤å…ˆå‰ä¿å­˜çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆï¼Œç›´æ¥æ“ä½œæ ˆåˆ™åŸºæœ¬æ²¡æœ‰å†…æ ¸åˆ‡æ¢çš„å¼€é”€ï¼Œå¯ä»¥ä¸åŠ é”çš„è®¿é—®å…¨å±€å˜é‡ï¼Œæ‰€ä»¥ä¸Šä¸‹æ–‡çš„åˆ‡æ¢éå¸¸å¿«ã€‚</p>
<h5 id="åç¨‹å¤šä¸çº¿ç¨‹è¿›è¡Œæ¯”è¾ƒï¼Ÿ"><a href="#åç¨‹å¤šä¸çº¿ç¨‹è¿›è¡Œæ¯”è¾ƒï¼Ÿ" class="headerlink" title="åç¨‹å¤šä¸çº¿ç¨‹è¿›è¡Œæ¯”è¾ƒï¼Ÿ"></a>åç¨‹å¤šä¸çº¿ç¨‹è¿›è¡Œæ¯”è¾ƒï¼Ÿ</h5><ol>
<li>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªåç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¹Ÿå¯ä»¥å•ç‹¬æ‹¥æœ‰å¤šä¸ªåç¨‹ï¼Œè¿™æ ·pythonä¸­åˆ™èƒ½ä½¿ç”¨å¤šæ ¸CPUã€‚</li>
<li>çº¿ç¨‹è¿›ç¨‹éƒ½æ˜¯åŒæ­¥æœºåˆ¶ï¼Œè€Œåç¨‹åˆ™æ˜¯å¼‚æ­¥</li>
<li>åç¨‹èƒ½ä¿ç•™ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶çš„çŠ¶æ€ï¼Œæ¯æ¬¡è¿‡ç¨‹é‡å…¥æ—¶ï¼Œå°±ç›¸å½“äºè¿›å…¥ä¸Šä¸€æ¬¡è°ƒç”¨çš„çŠ¶æ€</li>
</ol>
<h3 id="è¿›ç¨‹çš„å¼‚å¸¸æ§åˆ¶æµï¼šé™·é˜±ã€ä¸­æ–­ã€å¼‚å¸¸å’Œä¿¡å·"><a href="#è¿›ç¨‹çš„å¼‚å¸¸æ§åˆ¶æµï¼šé™·é˜±ã€ä¸­æ–­ã€å¼‚å¸¸å’Œä¿¡å·" class="headerlink" title="è¿›ç¨‹çš„å¼‚å¸¸æ§åˆ¶æµï¼šé™·é˜±ã€ä¸­æ–­ã€å¼‚å¸¸å’Œä¿¡å·"></a>è¿›ç¨‹çš„å¼‚å¸¸æ§åˆ¶æµï¼šé™·é˜±ã€ä¸­æ–­ã€å¼‚å¸¸å’Œä¿¡å·</h3><p>é™·é˜±æ˜¯<strong>æœ‰æ„</strong>é€ æˆçš„â€œå¼‚å¸¸â€ï¼Œæ˜¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤çš„ç»“æœã€‚é™·é˜±æ˜¯åŒæ­¥çš„ã€‚é™·é˜±çš„ä¸»è¦ä½œç”¨æ˜¯å®ç°<strong>ç³»ç»Ÿè°ƒç”¨</strong>ã€‚æ¯”å¦‚ï¼Œè¿›ç¨‹å¯ä»¥æ‰§è¡Œ <code>syscall n</code> æŒ‡ä»¤å‘å†…æ ¸è¯·æ±‚æœåŠ¡ã€‚å½“è¿›ç¨‹æ‰§è¡Œè¿™æ¡æŒ‡ä»¤åï¼Œä¼šä¸­æ–­å½“å‰çš„æ§åˆ¶æµï¼Œ<strong>é™·å…¥</strong>åˆ°å†…æ ¸æ€ï¼Œæ‰§è¡Œç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨ã€‚å†…æ ¸çš„å¤„ç†ç¨‹åºåœ¨æ‰§è¡Œç»“æŸåï¼Œä¼šå°†ç»“æœè¿”å›ç»™è¿›ç¨‹ï¼ŒåŒæ—¶é€€å›åˆ°ç”¨æˆ·æ€ã€‚è¿›ç¨‹æ­¤æ—¶ç»§ç»­æ‰§è¡Œ<strong>ä¸‹ä¸€æ¡æŒ‡ä»¤</strong>ã€‚</p>
<p>ä¸­æ–­ç”±å¤„ç†å™¨<strong>å¤–éƒ¨</strong>çš„<strong>ç¡¬ä»¶</strong>äº§ç”Ÿï¼Œä¸æ˜¯æ‰§è¡ŒæŸæ¡æŒ‡ä»¤çš„ç»“æœï¼Œä¹Ÿæ— æ³•é¢„æµ‹å‘ç”Ÿæ—¶æœºã€‚ç”±äºä¸­æ–­ç‹¬ç«‹äºå½“å‰æ‰§è¡Œçš„ç¨‹åºï¼Œå› æ­¤ä¸­æ–­æ˜¯å¼‚æ­¥äº‹ä»¶ã€‚ä¸­æ–­åŒ…æ‹¬ I/O è®¾å¤‡å‘å‡ºçš„ I/O ä¸­æ–­ã€å„ç§å®šæ—¶å™¨å¼•èµ·çš„æ—¶é’Ÿä¸­æ–­ã€è°ƒè¯•ç¨‹åºä¸­è®¾ç½®çš„æ–­ç‚¹ç­‰å¼•èµ·çš„è°ƒè¯•ä¸­æ–­ç­‰ã€‚</p>
<p>å¼‚å¸¸æ˜¯ä¸€ç§é”™è¯¯æƒ…å†µï¼Œæ˜¯æ‰§è¡Œå½“å‰æŒ‡ä»¤çš„ç»“æœï¼Œå¯èƒ½è¢«é”™è¯¯å¤„ç†ç¨‹åºä¿®æ­£ï¼Œä¹Ÿå¯èƒ½ç›´æ¥ç»ˆæ­¢åº”ç”¨ç¨‹åºã€‚å¼‚å¸¸æ˜¯åŒæ­¥çš„ã€‚è¿™é‡Œç‰¹æŒ‡å› ä¸ºæ‰§è¡Œå½“å‰æŒ‡ä»¤è€Œäº§ç”Ÿçš„<strong>é”™è¯¯æƒ…å†µ</strong>ï¼Œæ¯”å¦‚é™¤æ³•å¼‚å¸¸ã€ç¼ºé¡µå¼‚å¸¸ç­‰ã€‚æœ‰äº›ä¹¦ä¸Šä¸ºäº†åŒºåˆ†ï¼Œä¹Ÿå°†è¿™ç±»â€œå¼‚å¸¸â€ç§°ä¸º<strong>â€œæ•…éšœâ€</strong>ã€‚</p>
<p>ä¿¡å·æ˜¯ä¸€ç§<strong>æ›´é«˜å±‚çš„</strong>è½¯ä»¶å½¢å¼çš„å¼‚å¸¸ï¼ŒåŒæ ·ä¼šä¸­æ–­è¿›ç¨‹çš„æ§åˆ¶æµï¼Œå¯ä»¥ç”±è¿›ç¨‹è¿›è¡Œå¤„ç†ã€‚ä¸€ä¸ªä¿¡å·ä»£è¡¨äº†ä¸€ä¸ªæ¶ˆæ¯ã€‚ä¿¡å·çš„ä½œç”¨æ˜¯ç”¨æ¥<strong>é€šçŸ¥è¿›ç¨‹</strong>å‘ç”Ÿäº†æŸç§ç³»ç»Ÿäº‹ä»¶ã€‚</p>
<p>æ›´è¯¦ç»†çš„å¯ä»¥å‚è€ƒï¼š<a href="https://imageslr.github.io/2020/07/09/trap-interrupt-exception.html">https://imageslr.github.io/2020/07/09/trap-interrupt-exception.html</a></p>
<h3 id="ä»€ä¹ˆæ˜¯IOå¤šè·¯å¤ç”¨ï¼Ÿæ€ä¹ˆå®ç°ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯IOå¤šè·¯å¤ç”¨ï¼Ÿæ€ä¹ˆå®ç°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯IOå¤šè·¯å¤ç”¨ï¼Ÿæ€ä¹ˆå®ç°ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯IOå¤šè·¯å¤ç”¨ï¼Ÿæ€ä¹ˆå®ç°ï¼Ÿ</h3><p>IOå¤šè·¯å¤ç”¨ï¼ˆIO Multiplexingï¼‰æ˜¯æŒ‡å•ä¸ªè¿›ç¨‹/çº¿ç¨‹å°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªIOè¯·æ±‚ã€‚</p>
<p>å®ç°åŸç†ï¼šç”¨æˆ·å°†æƒ³è¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorï¼‰æ·»åŠ åˆ°select/poll/epollå‡½æ•°ä¸­ï¼Œç”±å†…æ ¸ç›‘è§†ï¼Œå‡½æ•°é˜»å¡ã€‚ä¸€æ—¦æœ‰æ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼ˆè¯»å°±ç»ªæˆ–å†™å°±ç»ªï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆè®¾ç½®timeoutï¼‰ï¼Œå‡½æ•°å°±ä¼šè¿”å›ï¼Œç„¶åè¯¥è¿›ç¨‹å¯ä»¥è¿›è¡Œç›¸åº”çš„è¯»/å†™æ“ä½œã€‚</p>
<ul>
<li><code>select</code>ï¼šå°†æ–‡ä»¶æè¿°ç¬¦æ”¾å…¥ä¸€ä¸ªé›†åˆä¸­ï¼Œè°ƒç”¨selectæ—¶ï¼Œå°†è¿™ä¸ªé›†åˆä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼ˆç¼ºç‚¹1ï¼šæ¯æ¬¡éƒ½è¦å¤åˆ¶ï¼Œ<strong>å¼€é”€å¤§</strong>ï¼‰ï¼Œç”±å†…æ ¸æ ¹æ®å°±ç»ªçŠ¶æ€ä¿®æ”¹è¯¥é›†åˆçš„å†…å®¹ã€‚ï¼ˆç¼ºç‚¹2ï¼‰<strong>é›†åˆå¤§å°æœ‰é™åˆ¶</strong>ï¼Œ32ä½æœºé»˜è®¤æ˜¯1024ï¼ˆ64ä½ï¼š2048ï¼‰ï¼›é‡‡ç”¨æ°´å¹³è§¦å‘æœºåˆ¶ã€‚selectå‡½æ•°è¿”å›åï¼Œéœ€è¦é€šè¿‡éå†è¿™ä¸ªé›†åˆï¼Œæ‰¾åˆ°å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆç¼ºç‚¹3ï¼š<strong>è½®è¯¢çš„æ–¹å¼æ•ˆç‡è¾ƒä½</strong>ï¼‰ï¼Œå½“æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å¢åŠ æ—¶ï¼Œæ•ˆç‡ä¼šçº¿æ€§ä¸‹é™ï¼›</li>
<li><code>poll</code>ï¼šå’Œselectå‡ ä¹æ²¡æœ‰åŒºåˆ«ï¼ŒåŒºåˆ«åœ¨äºæ–‡ä»¶æè¿°ç¬¦çš„å­˜å‚¨æ–¹å¼ä¸åŒï¼Œpollé‡‡ç”¨é“¾è¡¨çš„æ–¹å¼å­˜å‚¨ï¼Œæ²¡æœ‰æœ€å¤§å­˜å‚¨æ•°é‡çš„é™åˆ¶ï¼›</li>
<li><code>epoll</code>ï¼šé€šè¿‡å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å…±äº«å†…å­˜ï¼Œé¿å…äº†ä¸æ–­å¤åˆ¶çš„é—®é¢˜ï¼›æ”¯æŒçš„åŒæ—¶è¿æ¥æ•°ä¸Šé™å¾ˆé«˜ï¼ˆ1Gå·¦å³çš„å†…å­˜æ”¯æŒ10Wå·¦å³çš„è¿æ¥æ•°ï¼‰ï¼›æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶ï¼Œé‡‡ç”¨å›è°ƒæœºåˆ¶ï¼Œé¿å…äº†è½®è¯¢ï¼ˆå›è°ƒå‡½æ•°å°†å°±ç»ªçš„æè¿°ç¬¦æ·»åŠ åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œæ‰§è¡Œepoll_waitæ—¶ï¼Œè¿”å›è¿™ä¸ªé“¾è¡¨ï¼‰ï¼›æ”¯æŒæ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œé‡‡ç”¨è¾¹ç¼˜è§¦å‘æœºåˆ¶æ—¶ï¼Œåªæœ‰æ´»è·ƒçš„æè¿°ç¬¦æ‰ä¼šè§¦å‘å›è°ƒå‡½æ•°ã€‚</li>
</ul>
<p>æ€»ç»“ï¼ŒåŒºåˆ«ä¸»è¦åœ¨äºï¼š</p>
<ul>
<li>ä¸€ä¸ªçº¿ç¨‹/è¿›ç¨‹æ‰€èƒ½æ‰“å¼€çš„æœ€å¤§è¿æ¥æ•°</li>
<li>æ–‡ä»¶æè¿°ç¬¦ä¼ é€’æ–¹å¼ï¼ˆæ˜¯å¦å¤åˆ¶ï¼‰</li>
<li>æ°´å¹³è§¦å‘ or è¾¹ç¼˜è§¦å‘</li>
<li>æŸ¥è¯¢å°±ç»ªçš„æè¿°ç¬¦æ—¶çš„æ•ˆç‡ï¼ˆæ˜¯å¦è½®è¯¢ï¼‰</li>
</ul>
<p>å½“è¿æ¥æ•°è¾ƒå¤šå¹¶ä¸”æœ‰å¾ˆå¤šçš„ä¸æ´»è·ƒè¿æ¥æ—¶ï¼Œepollçš„æ•ˆç‡æ¯”å…¶å®ƒä¸¤è€…é«˜å¾ˆå¤šï¼›ä½†æ˜¯å½“è¿æ¥æ•°è¾ƒå°‘å¹¶ä¸”éƒ½ååˆ†æ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œç”±äºepolléœ€è¦å¾ˆå¤šå›è°ƒï¼Œå› æ­¤æ€§èƒ½å¯èƒ½ä½äºå…¶å®ƒä¸¤è€…ã€‚</p>
<p>æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚<br>å†…æ ¸é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®æ–‡ä»¶ã€‚æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶ã€‚</p>
<h5 id="ä»€ä¹ˆæ˜¯æ°´å¹³è§¦å‘ï¼Ÿä»€ä¹ˆæ˜¯è¾¹ç¼˜è§¦å‘ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ°´å¹³è§¦å‘ï¼Ÿä»€ä¹ˆæ˜¯è¾¹ç¼˜è§¦å‘ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ°´å¹³è§¦å‘ï¼Ÿä»€ä¹ˆæ˜¯è¾¹ç¼˜è§¦å‘ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ°´å¹³è§¦å‘ï¼Ÿä»€ä¹ˆæ˜¯è¾¹ç¼˜è§¦å‘ï¼Ÿ</h5><ul>
<li>æ°´å¹³è§¦å‘ï¼ˆLTï¼ŒLevel Triggerï¼‰æ¨¡å¼ä¸‹ï¼Œåªè¦ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œå°±ä¼šè§¦å‘é€šçŸ¥ï¼Œå¦‚æœç”¨æˆ·ç¨‹åºæ²¡æœ‰ä¸€æ¬¡æ€§æŠŠæ•°æ®è¯»å†™å®Œï¼Œä¸‹æ¬¡è¿˜ä¼šé€šçŸ¥ï¼›</li>
<li>è¾¹ç¼˜è§¦å‘ï¼ˆETï¼ŒEdge Triggerï¼‰æ¨¡å¼ä¸‹ï¼Œå½“æè¿°ç¬¦ä»æœªå°±ç»ªå˜ä¸ºå°±ç»ªæ—¶é€šçŸ¥ä¸€æ¬¡ï¼Œä¹‹åä¸ä¼šå†é€šçŸ¥ï¼Œç›´åˆ°å†æ¬¡ä»æœªå°±ç»ªå˜ä¸ºå°±ç»ªï¼ˆç¼“å†²åŒºä»ä¸å¯è¯»/å†™å˜ä¸ºå¯è¯»/å†™ï¼‰ã€‚</li>
<li>åŒºåˆ«ï¼šè¾¹ç¼˜è§¦å‘æ•ˆç‡æ›´é«˜ï¼Œå‡å°‘äº†è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå‡½æ•°ä¸ä¼šè¿”å›å¤§é‡ç”¨æˆ·ç¨‹åºå¯èƒ½ä¸éœ€è¦çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
<li>ä¸ºä»€ä¹ˆè¾¹ç¼˜è§¦å‘ä¸€å®šè¦ç”¨éé˜»å¡ï¼ˆnon-blockï¼‰IOï¼šé¿å…ç”±äºä¸€ä¸ªæè¿°ç¬¦çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œè®©å¤„ç†å…¶å®ƒæè¿°ç¬¦çš„ä»»åŠ¡å‡ºç°é¥¥é¥¿çŠ¶æ€ã€‚</li>
</ul>
<h5 id="æœ‰å“ªäº›å¸¸è§çš„IOæ¨¡å‹ï¼Ÿ"><a href="#æœ‰å“ªäº›å¸¸è§çš„IOæ¨¡å‹ï¼Ÿ" class="headerlink" title="æœ‰å“ªäº›å¸¸è§çš„IOæ¨¡å‹ï¼Ÿ"></a>æœ‰å“ªäº›å¸¸è§çš„IOæ¨¡å‹ï¼Ÿ</h5><ul>
<li>åŒæ­¥é˜»å¡IOï¼ˆBlocking IOï¼‰ï¼šç”¨æˆ·çº¿ç¨‹å‘èµ·IOè¯»/å†™æ“ä½œä¹‹åï¼Œçº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°å¯ä»¥å¼€å§‹å¤„ç†æ•°æ®ï¼›å¯¹CPUèµ„æºçš„åˆ©ç”¨ç‡ä¸å¤Ÿï¼›</li>
<li>åŒæ­¥éé˜»å¡IOï¼ˆNon-blocking IOï¼‰ï¼šå‘èµ·IOè¯·æ±‚ä¹‹åå¯ä»¥ç«‹å³è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å°±ç»ªçš„æ•°æ®ï¼Œéœ€è¦ä¸æ–­åœ°å‘èµ·IOè¯·æ±‚ç›´åˆ°æ•°æ®å°±ç»ªï¼›ä¸æ–­é‡å¤è¯·æ±‚æ¶ˆè€—äº†å¤§é‡çš„CPUèµ„æºï¼›</li>
<li>IOå¤šè·¯å¤ç”¨</li>
<li>å¼‚æ­¥IOï¼ˆAsynchronous IOï¼‰ï¼šç”¨æˆ·çº¿ç¨‹å‘å‡ºIOè¯·æ±‚ä¹‹åï¼Œç»§ç»­æ‰§è¡Œï¼Œç”±å†…æ ¸è¿›è¡Œæ•°æ®çš„è¯»å–å¹¶æ”¾åœ¨ç”¨æˆ·æŒ‡å®šçš„ç¼“å†²åŒºå†…ï¼Œåœ¨IOå®Œæˆä¹‹åé€šçŸ¥ç”¨æˆ·çº¿ç¨‹ç›´æ¥ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ</h3><p>ä¸ºäº†é™åˆ¶ä¸åŒç¨‹åºçš„è®¿é—®èƒ½åŠ›ï¼Œé˜²æ­¢ä¸€äº›ç¨‹åºè®¿é—®å…¶å®ƒç¨‹åºçš„å†…å­˜æ•°æ®ï¼ŒCPUåˆ’åˆ†äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¸¤ä¸ªæƒé™ç­‰çº§ã€‚</p>
<ul>
<li>ç”¨æˆ·æ€åªèƒ½å—é™åœ°è®¿é—®å†…å­˜ï¼Œä¸”ä¸å…è®¸è®¿é—®å¤–å›´è®¾å¤‡ï¼Œæ²¡æœ‰å ç”¨CPUçš„èƒ½åŠ›ï¼ŒCPUèµ„æºå¯ä»¥è¢«å…¶å®ƒç¨‹åºè·å–ï¼›</li>
<li>å†…æ ¸æ€å¯ä»¥è®¿é—®å†…å­˜æ‰€æœ‰æ•°æ®ä»¥åŠå¤–å›´è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œç¨‹åºçš„åˆ‡æ¢ã€‚</li>
</ul>
<p>æ‰€æœ‰ç”¨æˆ·ç¨‹åºéƒ½è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œä½†æœ‰æ—¶éœ€è¦è¿›è¡Œä¸€äº›å†…æ ¸æ€çš„æ“ä½œï¼Œæ¯”å¦‚ä»ç¡¬ç›˜æˆ–è€…é”®ç›˜è¯»æ•°æ®ï¼Œè¿™æ—¶å°±éœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œä½¿ç”¨<strong>é™·é˜±æŒ‡ä»¤</strong>ï¼ŒCPUåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œæ‰§è¡Œç›¸åº”çš„æœåŠ¡ï¼Œå†åˆ‡æ¢ä¸ºç”¨æˆ·æ€å¹¶è¿”å›ç³»ç»Ÿè°ƒç”¨çš„ç»“æœã€‚</p>
<h5 id="ä¸ºä»€ä¹ˆè¦åˆ†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦åˆ†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åˆ†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦åˆ†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ</h5><ul>
<li>å®‰å…¨æ€§ï¼šé˜²æ­¢ç”¨æˆ·ç¨‹åºæ¶æ„æˆ–è€…ä¸å°å¿ƒç ´åç³»ç»Ÿ/å†…å­˜/ç¡¬ä»¶èµ„æºï¼›</li>
<li>å°è£…æ€§ï¼šç”¨æˆ·ç¨‹åºä¸éœ€è¦å®ç°æ›´åŠ åº•å±‚çš„ä»£ç ï¼›</li>
<li>åˆ©äºè°ƒåº¦ï¼šå¦‚æœå¤šä¸ªç”¨æˆ·ç¨‹åºéƒ½åœ¨ç­‰å¾…é”®ç›˜è¾“å…¥ï¼Œè¿™æ—¶å°±éœ€è¦è¿›è¡Œè°ƒåº¦ï¼›ç»Ÿä¸€äº¤ç»™æ“ä½œç³»ç»Ÿè°ƒåº¦æ›´åŠ æ–¹ä¾¿ã€‚</li>
</ul>
<h5 id="å¦‚ä½•ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Ÿ"><a href="#å¦‚ä½•ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Ÿ"></a>å¦‚ä½•ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Ÿ</h5><ul>
<li>ç³»ç»Ÿè°ƒç”¨ï¼šæ¯”å¦‚è¯»å–å‘½ä»¤è¡Œè¾“å…¥ã€‚æœ¬è´¨ä¸Šè¿˜æ˜¯é€šè¿‡ä¸­æ–­å®ç°</li>
<li>ç”¨æˆ·ç¨‹åºå‘ç”Ÿå¼‚å¸¸æ—¶ï¼šæ¯”å¦‚ç¼ºé¡µå¼‚å¸¸</li>
<li>å¤–å›´è®¾å¤‡çš„ä¸­æ–­ï¼šå¤–å›´è®¾å¤‡å®Œæˆç”¨æˆ·è¯·æ±‚çš„æ“ä½œä¹‹åï¼Œä¼šå‘CPUå‘å‡ºä¸­æ–­ä¿¡å·ï¼Œè¿™æ—¶CPUä¼šè½¬å»å¤„ç†å¯¹åº”çš„ä¸­æ–­å¤„ç†ç¨‹åº</li>
</ul>
<h1 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h1><h3 id="ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ</h3><p>åœ¨ä¸¤ä¸ªæˆ–è€…å¤šä¸ªå¹¶å‘è¿›ç¨‹ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹æŒæœ‰æŸç§èµ„æºè€Œåˆç­‰å¾…å…¶å®ƒè¿›ç¨‹é‡Šæ”¾å®ƒä»¬ç°åœ¨ä¿æŒç€çš„èµ„æºï¼Œåœ¨æœªæ”¹å˜è¿™ç§çŠ¶æ€ä¹‹å‰éƒ½ä¸èƒ½å‘å‰æ¨è¿›ï¼Œç§°è¿™ä¸€ç»„è¿›ç¨‹äº§ç”Ÿäº†æ­»é”(deadlock)ã€‚</p>
<h3 id="æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶ï¼Ÿ"><a href="#æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶ï¼Ÿ" class="headerlink" title="æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶ï¼Ÿ"></a>æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶ï¼Ÿ</h3><ul>
<li><strong>äº’æ–¥</strong>ï¼šä¸€ä¸ªèµ„æºä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼›</li>
<li><strong>å æœ‰å¹¶ç­‰å¾…</strong>ï¼šä¸€ä¸ªè¿›ç¨‹è‡³å°‘å æœ‰ä¸€ä¸ªèµ„æºï¼Œå¹¶åœ¨ç­‰å¾…å¦ä¸€ä¸ªè¢«å…¶å®ƒè¿›ç¨‹å ç”¨çš„èµ„æºï¼›</li>
<li><strong>éæŠ¢å </strong>ï¼šå·²ç»åˆ†é…ç»™ä¸€ä¸ªè¿›ç¨‹çš„èµ„æºä¸èƒ½è¢«å¼ºåˆ¶æ€§æŠ¢å ï¼Œåªèƒ½ç”±è¿›ç¨‹å®Œæˆä»»åŠ¡ä¹‹åè‡ªæ„¿é‡Šæ”¾ï¼›</li>
<li><strong>å¾ªç¯ç­‰å¾…</strong>ï¼šè‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„ç¯å½¢ç­‰å¾…èµ„æºå…³ç³»ï¼Œè¯¥ç¯è·¯ä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰çš„èµ„æºã€‚</li>
</ul>
<h3 id="æ­»é”æœ‰å“ªäº›å¤„ç†æ–¹æ³•ï¼Ÿ"><a href="#æ­»é”æœ‰å“ªäº›å¤„ç†æ–¹æ³•ï¼Ÿ" class="headerlink" title="æ­»é”æœ‰å“ªäº›å¤„ç†æ–¹æ³•ï¼Ÿ"></a>æ­»é”æœ‰å“ªäº›å¤„ç†æ–¹æ³•ï¼Ÿ</h3><p>ç›´æ¥å¿½ç•¥æ­»é”ã€‚å› ä¸ºè§£å†³æ­»é”é—®é¢˜çš„ä»£ä»·å¾ˆé«˜ï¼Œå› æ­¤é¸µé¸Ÿç­–ç•¥è¿™ç§ä¸é‡‡å–ä»»åŠ¡æªæ–½çš„æ–¹æ¡ˆä¼šè·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚å½“å‘ç”Ÿæ­»é”æ—¶ä¸ä¼šå¯¹ç”¨æˆ·é€ æˆå¤šå¤§å½±å“ï¼Œæˆ–å‘ç”Ÿæ­»é”çš„æ¦‚ç‡å¾ˆä½ï¼Œå¯ä»¥é‡‡ç”¨é¸µé¸Ÿç­–ç•¥ã€‚</p>
<p>åŸºæœ¬æ€æƒ³æ˜¯ç ´åå½¢æˆæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</p>
<ul>
<li>ç ´åäº’æ–¥æ¡ä»¶ï¼šå…è®¸æŸäº›èµ„æºåŒæ—¶è¢«å¤šä¸ªè¿›ç¨‹è®¿é—®ã€‚ä½†æ˜¯æœ‰äº›èµ„æºæœ¬èº«å¹¶ä¸å…·æœ‰è¿™ç§å±æ€§ï¼Œå› æ­¤è¿™ç§æ–¹æ¡ˆå®ç”¨æ€§æœ‰é™ï¼›</li>
<li>ç ´åå æœ‰å¹¶ç­‰å¾…æ¡ä»¶ï¼š<ul>
<li>å®è¡Œèµ„æºé¢„å…ˆåˆ†é…ç­–ç•¥ï¼ˆå½“ä¸€ä¸ªè¿›ç¨‹å¼€å§‹è¿è¡Œä¹‹å‰ï¼Œå¿…é¡»ä¸€æ¬¡æ€§å‘ç³»ç»Ÿç”³è¯·å®ƒæ‰€éœ€è¦çš„å…¨éƒ¨èµ„æºï¼Œå¦åˆ™ä¸è¿è¡Œï¼‰ï¼›</li>
<li>æˆ–è€…åªå…è®¸è¿›ç¨‹åœ¨æ²¡æœ‰å ç”¨èµ„æºçš„æ—¶å€™æ‰èƒ½ç”³è¯·èµ„æºï¼ˆç”³è¯·èµ„æºå‰å…ˆé‡Šæ”¾å æœ‰çš„èµ„æºï¼‰ï¼›</li>
<li>ç¼ºç‚¹ï¼šå¾ˆå¤šæ—¶å€™æ— æ³•é¢„çŸ¥ä¸€ä¸ªè¿›ç¨‹æ‰€éœ€çš„å…¨éƒ¨èµ„æºï¼›åŒæ—¶ï¼Œä¼šé™ä½èµ„æºåˆ©ç”¨ç‡ï¼Œé™ä½ç³»ç»Ÿçš„å¹¶å‘æ€§ï¼›</li>
</ul>
</li>
<li>ç ´åéæŠ¢å æ¡ä»¶ï¼šå…è®¸è¿›ç¨‹å¼ºè¡ŒæŠ¢å è¢«å…¶å®ƒè¿›ç¨‹å æœ‰çš„èµ„æºã€‚ä¼šé™ä½ç³»ç»Ÿæ€§èƒ½ï¼›</li>
<li>ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šå¯¹æ‰€æœ‰èµ„æºç»Ÿä¸€ç¼–å·ï¼Œæ‰€æœ‰è¿›ç¨‹å¯¹èµ„æºçš„è¯·æ±‚å¿…é¡»æŒ‰ç…§åºå·é€’å¢çš„é¡ºåºæå‡ºï¼Œå³åªæœ‰å æœ‰äº†ç¼–å·è¾ƒå°çš„èµ„æºæ‰èƒ½ç”³è¯·ç¼–å·è¾ƒå¤§çš„èµ„æºã€‚è¿™æ ·é¿å…äº†å æœ‰å¤§å·èµ„æºçš„è¿›ç¨‹å»ç”³è¯·å°å·èµ„æºã€‚</li>
</ul>
<p>åŠ¨æ€åœ°æ£€æµ‹èµ„æºåˆ†é…çŠ¶æ€ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ï¼Œåªæœ‰å¤„äºå®‰å…¨çŠ¶æ€æ—¶æ‰ä¼šè¿›è¡Œèµ„æºçš„åˆ†é…ã€‚æ‰€è°“å®‰å…¨çŠ¶æ€æ˜¯æŒ‡ï¼šå³ä½¿æ‰€æœ‰è¿›ç¨‹çªç„¶è¯·æ±‚éœ€è¦çš„æ‰€æœ‰èµ„æºï¼Œä¹Ÿèƒ½å­˜åœ¨æŸç§å¯¹è¿›ç¨‹çš„èµ„æºåˆ†é…é¡ºåºï¼Œä½¿å¾—æ¯ä¸€ä¸ªè¿›ç¨‹è¿è¡Œå®Œæ¯•ã€‚</p>
<blockquote>
<p>é“¶è¡Œå®¶ç®—æ³•<br>å¦‚ä½•æ£€æµ‹æ­»é”ï¼šæ£€æµ‹æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯ï¼›æˆ–è€…ä½¿ç”¨ç±»ä¼¼æ­»é”é¿å…çš„æ£€æµ‹ç®—æ³•ã€‚<br>æ­»é”è§£é™¤çš„æ–¹æ³•ï¼š</p>
</blockquote>
<ul>
<li>åˆ©ç”¨æŠ¢å ï¼šæŒ‚èµ·æŸäº›è¿›ç¨‹ï¼Œå¹¶æŠ¢å å®ƒçš„èµ„æºã€‚ä½†åº”é˜²æ­¢æŸäº›è¿›ç¨‹è¢«é•¿æ—¶é—´æŒ‚èµ·è€Œå¤„äºé¥¥é¥¿çŠ¶æ€ï¼›</li>
<li>åˆ©ç”¨å›æ»šï¼šè®©æŸäº›è¿›ç¨‹å›é€€åˆ°è¶³ä»¥è§£é™¤æ­»é”çš„åœ°æ­¥ï¼Œè¿›ç¨‹å›é€€æ—¶è‡ªæ„¿é‡Šæ”¾èµ„æºã€‚è¦æ±‚ç³»ç»Ÿä¿æŒè¿›ç¨‹çš„å†å²ä¿¡æ¯ï¼Œè®¾ç½®è¿˜åŸç‚¹ï¼›</li>
<li>åˆ©ç”¨æ€æ­»è¿›ç¨‹ï¼šå¼ºåˆ¶æ€æ­»æŸäº›è¿›ç¨‹ç›´åˆ°æ­»é”è§£é™¤ä¸ºæ­¢ï¼Œå¯ä»¥æŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡Œã€‚</li>
</ul>
<h1 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h1><h3 id="åˆ†é¡µå’Œåˆ†æ®µæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#åˆ†é¡µå’Œåˆ†æ®µæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="åˆ†é¡µå’Œåˆ†æ®µæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>åˆ†é¡µå’Œåˆ†æ®µæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ul>
<li>é¡µå¼å­˜å‚¨ï¼šç”¨æˆ·ç©ºé—´åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„éƒ¨åˆ†ç§°ä¸ºé¡µï¼ˆpageï¼‰ï¼Œå†…å­˜ç©ºé—´åˆ’åˆ†ä¸ºåŒæ ·å¤§å°çš„åŒºåŸŸç§°ä¸ºé¡µæ¡†ï¼Œåˆ†é…æ—¶ä»¥é¡µä¸ºå•ä½ï¼ŒæŒ‰è¿›ç¨‹éœ€è¦çš„é¡µæ•°åˆ†é…ï¼Œé€»è¾‘ä¸Šç›¸é‚»çš„é¡µç‰©ç†ä¸Šä¸ä¸€å®šç›¸é‚»ï¼›</li>
<li>æ®µå¼å­˜å‚¨ï¼šç”¨æˆ·è¿›ç¨‹åœ°å€ç©ºé—´æŒ‰ç…§è‡ªèº«é€»è¾‘å…³ç³»åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ®µï¼ˆsegmentï¼‰ï¼ˆå¦‚ä»£ç æ®µï¼Œæ•°æ®æ®µï¼Œå †æ ˆæ®µï¼‰ï¼Œå†…å­˜ç©ºé—´è¢«åŠ¨æ€åˆ’åˆ†ä¸ºé•¿åº¦ä¸åŒçš„åŒºåŸŸï¼Œåˆ†é…æ—¶ä»¥æ®µä¸ºå•ä½ï¼Œæ¯æ®µåœ¨å†…å­˜ä¸­å æ®è¿ç»­ç©ºé—´ï¼Œå„æ®µå¯ä»¥ä¸ç›¸é‚»ï¼›</li>
<li>æ®µé¡µå¼å­˜å‚¨ï¼šç”¨æˆ·è¿›ç¨‹å…ˆæŒ‰æ®µåˆ’åˆ†ï¼Œæ®µå†…å†æŒ‰é¡µåˆ’åˆ†ï¼Œå†…å­˜åˆ’åˆ†å’Œåˆ†é…æŒ‰é¡µã€‚</li>
</ul>
<p>åŒºåˆ«ï¼š</p>
<ul>
<li>ç›®çš„ä¸åŒï¼šåˆ†é¡µçš„ç›®çš„æ˜¯ç®¡ç†å†…å­˜ï¼Œç”¨äºè™šæ‹Ÿå†…å­˜ä»¥è·å¾—æ›´å¤§çš„åœ°å€ç©ºé—´ï¼›åˆ†æ®µçš„ç›®çš„æ˜¯æ»¡è¶³ç”¨æˆ·çš„éœ€è¦ï¼Œä½¿ç¨‹åºå’Œæ•°æ®å¯ä»¥è¢«åˆ’åˆ†ä¸ºé€»è¾‘ä¸Šç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼›</li>
<li>å¤§å°ä¸åŒï¼šæ®µçš„å¤§å°ä¸å›ºå®šï¼Œç”±å…¶æ‰€å®Œæˆçš„åŠŸèƒ½å†³å®šï¼›é¡µçš„å¤§å°å›ºå®šï¼Œç”±ç³»ç»Ÿå†³å®šï¼›</li>
<li>åœ°å€ç©ºé—´ç»´åº¦ä¸åŒï¼šåˆ†æ®µæ˜¯äºŒç»´åœ°å€ç©ºé—´ï¼ˆæ®µå·+æ®µå†…åç§»ï¼‰ï¼Œåˆ†é¡µæ˜¯ä¸€ç»´åœ°å€ç©ºé—´ï¼ˆæ¯ä¸ªè¿›ç¨‹ä¸€ä¸ªé¡µè¡¨/å¤šçº§é¡µè¡¨ï¼Œé€šè¿‡ä¸€ä¸ªé€»è¾‘åœ°å€å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†åœ°å€ï¼‰ï¼›</li>
<li>åˆ†æ®µä¾¿äºä¿¡æ¯çš„ä¿æŠ¤å’Œå…±äº«ï¼›åˆ†é¡µçš„å…±äº«æ”¶åˆ°é™åˆ¶ï¼›</li>
<li>ç¢ç‰‡ï¼šåˆ†æ®µæ²¡æœ‰å†…ç¢ç‰‡ï¼Œä½†ä¼šäº§ç”Ÿå¤–ç¢ç‰‡ï¼›åˆ†é¡µæ²¡æœ‰å¤–ç¢ç‰‡ï¼Œä½†ä¼šäº§ç”Ÿå†…ç¢ç‰‡ï¼ˆä¸€ä¸ªé¡µå¡«ä¸æ»¡ï¼‰</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ï¼Ÿ</h3><p>æ¯ä¸ªç¨‹åºéƒ½æ‹¥æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œè¿™ä¸ªåœ°å€ç©ºé—´è¢«åˆ†æˆå¤§å°ç›¸ç­‰çš„é¡µï¼Œè¿™äº›é¡µè¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼›ä½†ä¸éœ€è¦æ‰€æœ‰çš„é¡µéƒ½åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œå½“ç¨‹åºå¼•ç”¨åˆ°ä¸åœ¨ç‰©ç†å†…å­˜ä¸­çš„é¡µæ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿå°†ç¼ºå¤±çš„éƒ¨åˆ†è£…å…¥ç‰©ç†å†…å­˜ã€‚è¿™æ ·ï¼Œå¯¹äºç¨‹åºæ¥è¯´ï¼Œé€»è¾‘ä¸Šä¼¼ä¹æœ‰å¾ˆå¤§çš„å†…å­˜ç©ºé—´ï¼Œåªæ˜¯å®é™…ä¸Šæœ‰ä¸€éƒ¨åˆ†æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå› æ­¤å«åšè™šæ‹Ÿå†…å­˜ã€‚</p>
<p>è™šæ‹Ÿå†…å­˜çš„ä¼˜ç‚¹æ˜¯è®©ç¨‹åºå¯ä»¥è·å¾—æ›´å¤šçš„å¯ç”¨å†…å­˜ã€‚</p>
<p>è™šæ‹Ÿå†…å­˜çš„å®ç°æ–¹å¼ã€é¡µè¡¨/å¤šçº§é¡µè¡¨ã€ç¼ºé¡µä¸­æ–­ã€ä¸åŒçš„é¡µé¢æ·˜æ±°ç®—æ³•ï¼š<a href="https://imageslr.github.io/2020/07/08/tech-interview.html#virtual-memory">ç­”æ¡ˆ</a>ã€‚</p>
<h5 id="å¦‚ä½•è¿›è¡Œåœ°å€ç©ºé—´åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ï¼Ÿ"><a href="#å¦‚ä½•è¿›è¡Œåœ°å€ç©ºé—´åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¿›è¡Œåœ°å€ç©ºé—´åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ï¼Ÿ"></a>å¦‚ä½•è¿›è¡Œåœ°å€ç©ºé—´åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ï¼Ÿ</h5><p><strong>å†…å­˜ç®¡ç†å•å…ƒ</strong>ï¼ˆMMUï¼‰ç®¡ç†ç€é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€çš„è½¬æ¢ï¼Œå…¶ä¸­çš„é¡µè¡¨ï¼ˆPage tableï¼‰å­˜å‚¨ç€é¡µï¼ˆé€»è¾‘åœ°å€ï¼‰å’Œé¡µæ¡†ï¼ˆç‰©ç†å†…å­˜ç©ºé—´ï¼‰çš„æ˜ å°„è¡¨ï¼Œé¡µè¡¨ä¸­è¿˜åŒ…å«åŒ…å«æœ‰æ•ˆä½ï¼ˆæ˜¯åœ¨å†…å­˜è¿˜æ˜¯ç£ç›˜ï¼‰ã€è®¿é—®ä½ï¼ˆæ˜¯å¦è¢«è®¿é—®è¿‡ï¼‰ã€ä¿®æ”¹ä½ï¼ˆå†…å­˜ä¸­æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼‰ã€ä¿æŠ¤ä½ï¼ˆåªè¯»è¿˜æ˜¯å¯è¯»å†™ï¼‰ã€‚é€»è¾‘åœ°å€ï¼šé¡µå·+é¡µå†…åœ°å€ï¼ˆåç§»ï¼‰ï¼›æ¯ä¸ªè¿›ç¨‹ä¸€ä¸ªé¡µè¡¨ï¼Œæ”¾åœ¨å†…å­˜ï¼Œé¡µè¡¨èµ·å§‹åœ°å€åœ¨PCB/å¯„å­˜å™¨ä¸­ã€‚</p>
<h3 id="æœ‰å“ªäº›é¡µé¢ç½®æ¢ç®—æ³•ï¼Ÿ"><a href="#æœ‰å“ªäº›é¡µé¢ç½®æ¢ç®—æ³•ï¼Ÿ" class="headerlink" title="æœ‰å“ªäº›é¡µé¢ç½®æ¢ç®—æ³•ï¼Ÿ"></a>æœ‰å“ªäº›é¡µé¢ç½®æ¢ç®—æ³•ï¼Ÿ</h3><p>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¦è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜ä¸­ï¼Œå°±å‘ç”Ÿç¼ºé¡µä¸­æ–­ä»è€Œå°†è¯¥é¡µè°ƒå…¥å†…å­˜ä¸­ã€‚æ­¤æ—¶å¦‚æœå†…å­˜å·²æ— ç©ºé—²ç©ºé—´ï¼Œç³»ç»Ÿå¿…é¡»ä»å†…å­˜ä¸­è°ƒå‡ºä¸€ä¸ªé¡µé¢åˆ°ç£ç›˜ä¸­æ¥è…¾å‡ºç©ºé—´ã€‚é¡µé¢ç½®æ¢ç®—æ³•çš„ä¸»è¦ç›®æ ‡æ˜¯ä½¿é¡µé¢ç½®æ¢é¢‘ç‡æœ€ä½ï¼ˆä¹Ÿå¯ä»¥è¯´ç¼ºé¡µç‡æœ€ä½ï¼‰ã€‚</p>
<ul>
<li><p><strong>æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•</strong>OPTï¼ˆOptimal replacement algorithmï¼‰ï¼šç½®æ¢ä»¥åä¸éœ€è¦æˆ–è€…æœ€è¿œçš„å°†æ¥æ‰éœ€è¦çš„é¡µé¢ï¼Œæ˜¯ä¸€ç§ç†è®ºä¸Šçš„ç®—æ³•ï¼Œæ˜¯æœ€ä¼˜ç­–ç•¥ï¼›</p>
</li>
<li><p><strong>å…ˆè¿›å…ˆå‡º</strong>FIFOï¼šç½®æ¢åœ¨å†…å­˜ä¸­é©»ç•™æ—¶é—´æœ€é•¿çš„é¡µé¢ã€‚ç¼ºç‚¹ï¼šæœ‰å¯èƒ½å°†é‚£äº›ç»å¸¸è¢«è®¿é—®çš„é¡µé¢ä¹Ÿè¢«æ¢å‡ºï¼Œä»è€Œä½¿ç¼ºé¡µç‡å‡é«˜ï¼›</p>
</li>
<li><p><strong>ç¬¬äºŒæ¬¡æœºä¼šç®—æ³•</strong>SCRï¼šæŒ‰FIFOé€‰æ‹©æŸä¸€é¡µé¢ï¼Œè‹¥å…¶è®¿é—®ä½ä¸º1ï¼Œç»™ç¬¬äºŒæ¬¡æœºä¼šï¼Œå¹¶å°†è®¿é—®ä½ç½®0ï¼›</p>
</li>
<li><p><strong>æ—¶é’Ÿç®—æ³•</strong> Clockï¼šSCRä¸­éœ€è¦å°†é¡µé¢åœ¨é“¾è¡¨ä¸­ç§»åŠ¨ï¼ˆç¬¬äºŒæ¬¡æœºä¼šçš„æ—¶å€™è¦å°†è¿™ä¸ªé¡µé¢ä»é“¾è¡¨å¤´ç§»åˆ°é“¾è¡¨å°¾ï¼‰ï¼Œæ—¶é’Ÿç®—æ³•ä½¿ç”¨ç¯å½¢é“¾è¡¨ï¼Œå†ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æœ€è€çš„é¡µé¢ï¼Œé¿å…äº†ç§»åŠ¨é¡µé¢çš„å¼€é”€ï¼›</p>
</li>
<li><p><strong>æœ€è¿‘æœªä½¿ç”¨ç®—æ³•</strong>NRUï¼ˆNot Recently Usedï¼‰ï¼šæ£€æŸ¥è®¿é—®ä½Rã€ä¿®æ”¹ä½Mï¼Œä¼˜å…ˆç½®æ¢R=M=0ï¼Œå…¶æ¬¡æ˜¯ï¼ˆR=0, M=1ï¼‰ï¼›</p>
</li>
<li><p><strong>æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•</strong>LRUï¼ˆLeast Recently Usedï¼‰ï¼šç½®æ¢å‡ºæœªä½¿ç”¨æ—¶é—´æœ€é•¿çš„ä¸€é¡µï¼›å®ç°æ–¹å¼ï¼šç»´æŠ¤æ—¶é—´æˆ³ï¼Œæˆ–è€…ç»´æŠ¤ä¸€ä¸ªæ‰€æœ‰é¡µé¢çš„é“¾è¡¨ã€‚å½“ä¸€ä¸ªé¡µé¢è¢«è®¿é—®æ—¶ï¼Œå°†è¿™ä¸ªé¡µé¢ç§»åˆ°é“¾è¡¨è¡¨å¤´ã€‚è¿™æ ·å°±èƒ½ä¿è¯é“¾è¡¨è¡¨å°¾çš„é¡µé¢æ˜¯æœ€è¿‘æœ€ä¹…æœªè®¿é—®çš„ã€‚</p>
</li>
<li><p><strong>æœ€ä¸ç»å¸¸ä½¿ç”¨ç®—æ³•</strong>NFUï¼šç½®æ¢å‡ºè®¿é—®æ¬¡æ•°æœ€å°‘çš„é¡µé¢</p>
</li>
<li><p>æ—¶é—´ä¸Šï¼šæœ€è¿‘è¢«è®¿é—®çš„é¡µåœ¨ä¸ä¹…çš„å°†æ¥è¿˜ä¼šè¢«è®¿é—®ï¼›</p>
</li>
<li><p>ç©ºé—´ä¸Šï¼šå†…å­˜ä¸­è¢«è®¿é—®çš„é¡µå‘¨å›´çš„é¡µä¹Ÿå¾ˆå¯èƒ½è¢«è®¿é—®ã€‚</p>
</li>
</ul>
<p>é¢ ç°¸æœ¬è´¨ä¸Šæ˜¯æŒ‡é¢‘ç¹çš„é¡µè°ƒåº¦è¡Œä¸ºã€‚è¿›ç¨‹å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶å¿…é¡»ç½®æ¢æŸä¸€é¡µã€‚ç„¶è€Œï¼Œå…¶ä»–æ‰€æœ‰çš„é¡µéƒ½åœ¨ä½¿ç”¨ï¼Œå®ƒç½®æ¢ä¸€ä¸ªé¡µï¼Œä½†åˆç«‹åˆ»å†æ¬¡éœ€è¦è¿™ä¸ªé¡µã€‚å› æ­¤ä¼šä¸æ–­äº§ç”Ÿç¼ºé¡µä¸­æ–­ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„æ•ˆç‡æ€¥å‰§ä¸‹é™ï¼Œè¿™ç§ç°è±¡ç§°ä¸ºé¢ ç°¸ã€‚å†…å­˜é¢ ç°¸çš„è§£å†³ç­–ç•¥åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¿®æ”¹é¡µé¢ç½®æ¢ç®—æ³•ï¼›</li>
<li>é™ä½åŒæ—¶è¿è¡Œçš„ç¨‹åºçš„æ•°é‡ï¼›</li>
<li>ç»ˆæ­¢è¯¥è¿›ç¨‹æˆ–å¢åŠ ç‰©ç†å†…å­˜å®¹é‡ã€‚</li>
</ul>
<h3 id="ç¼“å†²åŒºæº¢å‡ºé—®é¢˜"><a href="#ç¼“å†²åŒºæº¢å‡ºé—®é¢˜" class="headerlink" title="ç¼“å†²åŒºæº¢å‡ºé—®é¢˜"></a>ç¼“å†²åŒºæº¢å‡ºé—®é¢˜</h3><p>é˜²èŒƒç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„æœºåˆ¶æœ‰ä¸‰ç§ï¼šéšæœºåŒ–ã€æ ˆä¿æŠ¤å’Œé™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸã€‚</p>
<ul>
<li>éšæœºåŒ–ï¼šåŒ…æ‹¬æ ˆéšæœºåŒ–ï¼ˆç¨‹åºå¼€å§‹æ—¶åœ¨æ ˆä¸Šåˆ†é…ä¸€æ®µéšæœºå¤§å°çš„ç©ºé—´ï¼‰å’Œåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆAddress-Space Layout Randomizationï¼ŒASLRï¼Œå³æ¯æ¬¡è¿è¡Œæ—¶ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ï¼ŒåŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µã€æ ˆã€å †ç­‰éƒ½ä¼šè¢«åŠ è½½åˆ°å†…å­˜ç©ºé—´çš„ä¸åŒåŒºåŸŸï¼‰ï¼Œä½†åªèƒ½å¢åŠ æ”»å‡»ä¸€ä¸ªç³»ç»Ÿçš„éš¾åº¦ï¼Œä¸èƒ½å®Œå…¨ä¿è¯å®‰å…¨ã€‚</li>
<li>æ ˆä¿æŠ¤ï¼šåœ¨æ¯ä¸ªå‡½æ•°çš„æ ˆå¸§çš„å±€éƒ¨å˜é‡å’Œæ ˆçŠ¶æ€ä¹‹é—´å­˜å‚¨ä¸€ä¸ª<strong>éšæœºäº§ç”Ÿçš„</strong>ç‰¹æ®Šçš„å€¼ï¼Œç§°ä¸ºé‡‘ä¸é›€å€¼ï¼ˆcanaryï¼‰ã€‚åœ¨æ¢å¤å¯„å­˜å™¨çŠ¶æ€å’Œå‡½æ•°è¿”å›ä¹‹å‰ï¼Œç¨‹åºæ£€æµ‹è¿™ä¸ªé‡‘ä¸é›€å€¼æ˜¯å¦è¢«æ”¹å˜äº†ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆç¨‹åºå¼‚å¸¸ç»ˆæ­¢ã€‚</li>
<li>é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸï¼šå†…å­˜é¡µçš„è®¿é—®å½¢å¼æœ‰ä¸‰ç§ï¼šå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œï¼Œåªæœ‰ç¼–è¯‘å™¨äº§ç”Ÿçš„é‚£éƒ¨åˆ†ä»£ç æ‰€å¤„çš„å†…å­˜æ‰æ˜¯å¯æ‰§è¡Œçš„ï¼Œå…¶ä»–é¡µé™åˆ¶ä¸ºåªå…è®¸è¯»å’Œå†™ã€‚</li>
</ul>
<p>æ›´è¯¦ç»†çš„å¯ä»¥å‚è€ƒï¼š<a href="https://imageslr.github.io/2020/07/08/tech-interview.html#stackoverflow">https://imageslr.github.io/2020/07/08/tech-interview.html#stackoverflow</a></p>
<h1 id="ç£ç›˜è°ƒåº¦"><a href="#ç£ç›˜è°ƒåº¦" class="headerlink" title="ç£ç›˜è°ƒåº¦"></a>ç£ç›˜è°ƒåº¦</h1><p>è¿‡ç¨‹ï¼šç£å¤´ï¼ˆæ‰¾åˆ°å¯¹åº”çš„ç›˜é¢ï¼‰ï¼›ç£é“ï¼ˆä¸€ä¸ªç›˜é¢ä¸Šçš„åŒå¿ƒåœ†ç¯ï¼Œå¯»é“æ—¶é—´ï¼‰ï¼›æ‰‡åŒºï¼ˆæ—‹è½¬æ—¶é—´ï¼‰ã€‚ä¸ºå‡å°å¯»é“æ—¶é—´çš„è°ƒåº¦ç®—æ³•ï¼š</p>
<ul>
<li>å…ˆæ¥å…ˆæœåŠ¡</li>
<li>æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆ</li>
<li>ç”µæ¢¯ç®—æ³•ï¼šç”µæ¢¯æ€»æ˜¯ä¿æŒä¸€ä¸ªæ–¹å‘è¿è¡Œï¼Œç›´åˆ°è¯¥æ–¹å‘æ²¡æœ‰è¯·æ±‚ä¸ºæ­¢ï¼Œç„¶åæ”¹å˜è¿è¡Œæ–¹å‘ã€‚</li>
</ul>
<h1 id="è¿›ç¨‹é—´é€šä¿¡IPC"><a href="#è¿›ç¨‹é—´é€šä¿¡IPC" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡IPC"></a><a href="https://www.jianshu.com/p/c1015f5ffa74">è¿›ç¨‹é—´é€šä¿¡IPC</a></h1><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul>
<li><a href="https://blog.csdn.net/justloveyou_/article/details/78304294">é¢è¯•/ç¬”è¯•ç¬¬äºŒå¼¹ â€”â€” æ“ä½œç³»ç»Ÿé¢è¯•é—®é¢˜é›†é”¦ - CSDNåšå®¢</a></li>
<li><a href="https://segmentfault.com/a/1190000018970361">çº¿ç¨‹åŒæ­¥ä¸å¹¶å‘ - - SegmentFault</a></li>
<li><a href="http://baijiahao.baidu.com/s?id=1641172494287388070&wfr=spider&for=pc">å½»åº•ææ‡‚epollé«˜æ•ˆè¿è¡Œçš„åŸç†</a></li>
<li><a href="https://www.cnblogs.com/lirong21/p/4213028.html">ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</a></li>
</ul>
<p>æ–‡ç« å†…å®¹æ¬è¿è‡ªæœ¬äºº<a href="https://www.yuque.com/docs/share/4137d8f0-4b2e-4a18-a5a3-7a01239affcc">è¯­é›€</a></p>
]]></content>
      <categories>
        <category>å…«è‚¡æ–‡</category>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLå­¦ä¹ ç¬”è®°</title>
    <url>/2021/09/21/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h3 id="ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„"><a href="#ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" class="headerlink" title="ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„"></a>ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> T <span class="keyword">where</span> ID<span class="operator">=</span><span class="number">10</span>ï¼›</span><br></pre></td></tr></table></figure>


<p><img src="https://img-blog.csdnimg.cn/20190410210326412.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=Mnrxq&originHeight=798&originWidth=1086&originalType=binary&ratio=1&status=done&style=none"></p>
<blockquote>
<p>å¤§ä½“æ¥è¯´ï¼ŒMySQLå¯ä»¥åˆ†ä¸º<code>Server</code>å±‚å’Œ<code>å­˜å‚¨å¼•æ“</code>å±‚ä¸¤éƒ¨åˆ†</p>
</blockquote>
<ul>
<li><code>Server</code>å±‚åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›–MySQLçš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰ï¼‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚</li>
<li><code>å­˜å‚¨å¼•æ“å±‚</code>è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚å…¶æ¶æ„æ¨¡å¼æ˜¯æ’ä»¶å¼çš„ï¼Œæ”¯æŒInnoDBã€MyISAMã€Memoryç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ã€‚ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯InnoDBï¼Œå®ƒä»MySQL 5.5.5ç‰ˆæœ¬å¼€å§‹æˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</li>
<li>ä¸åŒçš„å­˜å‚¨å¼•æ“å…±ç”¨ä¸€ä¸ªServerå±‚ï¼Œä¹Ÿå°±æ˜¯ä»è¿æ¥å™¨åˆ°æ‰§è¡Œå™¨çš„éƒ¨åˆ†</li>
<li></li>
</ul>
<p><strong>è¿æ¥å™¨</strong></p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼Œä½ ä¼šå…ˆè¿æ¥åˆ°è¿™ä¸ªæ•°æ®åº“ä¸Šï¼Œè¿™æ—¶å€™æ¥å¾…ä½ çš„å°±æ˜¯è¿æ¥å™¨ã€‚è¿æ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚è¿æ¥å®Œæˆåï¼Œå¦‚æœä½ æ²¡æœ‰åç»­çš„åŠ¨ä½œï¼Œè¿™ä¸ªè¿æ¥å°±å¤„äºç©ºé—²çŠ¶æ€ï¼Œä½ å¯ä»¥åœ¨<code>show processlist</code>å‘½ä»¤ä¸­çœ‹åˆ°å®ƒã€‚å®¢æˆ·ç«¯å¦‚æœå¤ªé•¿æ—¶é—´æ²¡åŠ¨é™ï¼Œè¿æ¥å™¨å°±ä¼šè‡ªåŠ¨å°†å®ƒæ–­å¼€ã€‚è¿™ä¸ªæ—¶é—´æ˜¯ç”±å‚æ•°<code>wait_timeout</code>æ§åˆ¶çš„ï¼Œé»˜è®¤å€¼æ˜¯<code>8</code>å°æ—¶ã€‚æ•°æ®åº“é‡Œé¢ï¼Œé•¿è¿æ¥æ˜¯æŒ‡è¿æ¥æˆåŠŸåï¼Œå¦‚æœå®¢æˆ·ç«¯æŒç»­æœ‰è¯·æ±‚ï¼Œåˆ™ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚çŸ­è¿æ¥åˆ™æ˜¯æŒ‡æ¯æ¬¡æ‰§è¡Œå®Œå¾ˆå°‘çš„å‡ æ¬¡æŸ¥è¯¢å°±æ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡æŸ¥è¯¢å†é‡æ–°å»ºç«‹ä¸€ä¸ªã€‚</li>
</ul>
<p><strong>æŸ¥è¯¢ç¼“å­˜</strong></p>
<ul>
<li>è¿æ¥å»ºç«‹å®Œæˆåï¼Œä½ å°±å¯ä»¥æ‰§è¡Œselectè¯­å¥äº†ã€‚æ‰§è¡Œé€»è¾‘å°±ä¼šæ¥åˆ°ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢ç¼“å­˜ã€‚</li>
<li>MySQLæ‹¿åˆ°ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚åï¼Œä¼šå…ˆåˆ°æŸ¥è¯¢ç¼“å­˜çœ‹çœ‹ï¼Œä¹‹å‰æ˜¯ä¸æ˜¯æ‰§è¡Œè¿‡è¿™æ¡è¯­å¥ã€‚ä¹‹å‰æ‰§è¡Œè¿‡çš„è¯­å¥åŠå…¶ç»“æœå¯èƒ½ä¼šä»¥key-valueå¯¹çš„å½¢å¼ï¼Œè¢«ç›´æ¥ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚keyæ˜¯æŸ¥è¯¢çš„è¯­å¥ï¼Œvalueæ˜¯æŸ¥è¯¢çš„ç»“æœã€‚å¦‚æœä½ çš„æŸ¥è¯¢èƒ½å¤Ÿç›´æ¥åœ¨è¿™ä¸ªç¼“å­˜ä¸­æ‰¾åˆ°keyï¼Œé‚£ä¹ˆè¿™ä¸ªvalueå°±ä¼šè¢«ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li>
<li>å¦‚æœè¯­å¥ä¸åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­ï¼Œå°±ä¼šç»§ç»­åé¢çš„æ‰§è¡Œé˜¶æ®µã€‚æ‰§è¡Œå®Œæˆåï¼Œæ‰§è¡Œç»“æœä¼šè¢«å­˜å…¥æŸ¥è¯¢ç¼“å­˜ä¸­ã€‚</li>
</ul>
<blockquote>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä¼šå»ºè®®ä½ ä¸è¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©ã€‚æŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹ï¼Œåªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚</p>
</blockquote>
<p><strong>åˆ†æå™¨</strong></p>
<ul>
<li>å¦‚æœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå°±è¦å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†ã€‚é¦–å…ˆï¼ŒMySQLéœ€è¦çŸ¥é“ä½ è¦åšä»€ä¹ˆï¼Œå› æ­¤éœ€è¦å¯¹SQLè¯­å¥åšè§£æã€‚åˆ†æå™¨å…ˆä¼šåš<code>â€œè¯æ³•åˆ†æâ€</code>,è¯æ³•åˆ†æå®Œåå°±è¦åš<code>â€œè¯­æ³•åˆ†æâ€</code>ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ªSQLè¯­å¥æ˜¯å¦æ»¡è¶³MySQLè¯­æ³•ã€‚å¦‚æœä½ çš„è¯­å¥ä¸å¯¹ï¼Œå°±ä¼šæ”¶åˆ°â€œYou have an error in your SQL syntaxâ€çš„é”™è¯¯æé†’</li>
</ul>
<p><strong>ä¼˜åŒ–å™¨</strong></p>
<ul>
<li>ç»è¿‡äº†åˆ†æå™¨ï¼ŒMySQLå°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†ã€‚åœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿˜è¦å…ˆç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚</li>
<li>ä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼›æˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¤šè¡¨å…³è”ï¼ˆjoinï¼‰çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåºã€‚</li>
</ul>
<blockquote>
<p>æ¯”å¦‚ä½ æ‰§è¡Œä¸‹é¢è¿™æ ·çš„è¯­å¥ï¼Œè¿™ä¸ªè¯­å¥æ˜¯æ‰§è¡Œä¸¤ä¸ªè¡¨çš„joinï¼š<br><code>mysql&gt; select * from t1 join t2 using(ID) where t1.c=10 and t2.d=20;</code><br>æ—¢å¯ä»¥å…ˆä»è¡¨t1é‡Œé¢å–å‡ºc=10çš„è®°å½•çš„IDå€¼ï¼Œå†æ ¹æ®IDå€¼å…³è”åˆ°è¡¨t2ï¼Œå†åˆ¤æ–­t2é‡Œé¢dçš„å€¼æ˜¯å¦ç­‰äº20ã€‚<br>ä¹Ÿå¯ä»¥å…ˆä»è¡¨t2é‡Œé¢å–å‡ºd=20çš„è®°å½•çš„IDå€¼ï¼Œå†æ ¹æ®IDå€¼å…³è”åˆ°t1ï¼Œå†åˆ¤æ–­t1é‡Œé¢cçš„å€¼æ˜¯å¦ç­‰äº10ã€‚<br>è¿™ä¸¤ç§æ‰§è¡Œæ–¹æ³•çš„é€»è¾‘ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ•ˆç‡ä¼šæœ‰ä¸åŒï¼Œè€Œä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯å†³å®šé€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªæ–¹æ¡ˆã€‚</p>
</blockquote>
<p><strong>æ‰§è¡Œå™¨</strong></p>
<ul>
<li>MySQLé€šè¿‡åˆ†æå™¨çŸ¥é“äº†ä½ è¦åšä»€ä¹ˆï¼Œé€šè¿‡ä¼˜åŒ–å™¨çŸ¥é“äº†è¯¥æ€ä¹ˆåšï¼Œäºæ˜¯å°±è¿›å…¥äº†æ‰§è¡Œå™¨é˜¶æ®µï¼Œå¼€å§‹æ‰§è¡Œè¯­å¥ã€‚</li>
<li>å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦å…ˆåˆ¤æ–­ä¸€ä¸‹ä½ å¯¹è¿™ä¸ªè¡¨Tæœ‰æ²¡æœ‰æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šè¿”å›æ²¡æœ‰æƒé™çš„é”™è¯¯</li>
<li>å¦‚æœæœ‰æƒé™ï¼Œå°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œã€‚æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œå»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£ã€‚</li>
</ul>
<blockquote>
<p><code>mysql&gt; select * from T where ID=10;</code><br>æ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­çš„è¡¨Tä¸­ï¼ŒIDå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ‰§è¡Œå™¨çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š<br>è°ƒç”¨InnoDBå¼•æ“æ¥å£å–è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­IDå€¼æ˜¯ä¸æ˜¯10ï¼Œå¦‚æœä¸æ˜¯åˆ™è·³è¿‡ï¼Œå¦‚æœæ˜¯åˆ™å°†è¿™è¡Œå­˜åœ¨ç»“æœé›†ä¸­ï¼›<br>è°ƒç”¨å¼•æ“æ¥å£å–â€œä¸‹ä¸€è¡Œâ€ï¼Œé‡å¤ç›¸åŒçš„åˆ¤æ–­é€»è¾‘ï¼Œç›´åˆ°å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åä¸€è¡Œã€‚<br>æ‰§è¡Œå™¨å°†ä¸Šè¿°éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œç»„æˆçš„è®°å½•é›†ä½œä¸ºç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
</blockquote>
<ul>
<li>è‡³æ­¤ï¼Œè¿™ä¸ªæ•´ä¸ªè¯­å¥å°±æ‰§è¡Œå®Œæˆäº†ã€‚ä¸€æ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸€èˆ¬æ˜¯ç»è¿‡è¿æ¥å™¨ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰åŠŸèƒ½æ¨¡å—ï¼Œæœ€ååˆ°è¾¾å­˜å‚¨å¼•æ“ã€‚</li>
</ul>
<h3 id="ä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„"><a href="#ä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„" class="headerlink" title="ä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„"></a>ä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> T <span class="keyword">set</span> c<span class="operator">=</span>c<span class="operator">+</span><span class="number">1</span> <span class="keyword">where</span> ID<span class="operator">=</span><span class="number">2</span>;</span><br></pre></td></tr></table></figure>


<ul>
<li>ä¸æŸ¥è¯¢æµç¨‹ä¸ä¸€æ ·çš„æ˜¯ï¼Œæ›´æ–°æµç¨‹è¿˜æ¶‰åŠä¸¤ä¸ªé‡è¦çš„æ—¥å¿—æ¨¡å— <code>redo log</code>ï¼ˆé‡åšæ—¥å¿—ï¼‰å’Œ <code>binlog</code>ï¼ˆå½’æ¡£æ—¥å¿—ï¼‰</li>
<li>æ¯ä¸€æ¬¡çš„æ›´æ–°æ“ä½œéƒ½éœ€è¦å†™è¿›ç£ç›˜ï¼Œç„¶åç£ç›˜ä¹Ÿè¦æ‰¾åˆ°å¯¹åº”çš„é‚£æ¡è®°å½•ï¼Œç„¶åå†æ›´æ–°ï¼Œæ•´ä¸ªè¿‡ç¨‹IOæˆæœ¬ã€æŸ¥æ‰¾æˆæœ¬éƒ½å¾ˆé«˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMySQLçš„è®¾è®¡è€…WALæŠ€æœ¯ï¼ŒWALçš„å…¨ç§°æ˜¯Write-Ahead Loggingï¼Œå®ƒçš„å…³é”®ç‚¹å°±æ˜¯<code>å…ˆå†™æ—¥å¿—</code>ï¼Œ<code>å†å†™ç£ç›˜</code></li>
<li>å½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼ŒInnoDBå¼•æ“å°±ä¼šå…ˆæŠŠè®°å½•å†™åˆ°redo logé‡Œé¢ï¼Œå¹¶æ›´æ–°å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚</li>
<li>åŒæ—¶ï¼Œ<code>InnoDB</code>å¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªæ“ä½œè®°å½•æ›´æ–°åˆ°ç£ç›˜é‡Œé¢ï¼Œè€Œè¿™ä¸ªæ›´æ–°å¾€å¾€æ˜¯åœ¨ç³»ç»Ÿæ¯”è¾ƒç©ºé—²çš„æ—¶å€™åšã€‚ä½†æ˜¯<code>InnoDB</code>çš„<code>redo log</code>æ˜¯å›ºå®šå¤§å°çš„ï¼Œæ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„4ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯1GB,æ€»å…±å°±å¯ä»¥è®°å½•4GBçš„æ“ä½œã€‚ä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾å°±åˆå›åˆ°å¼€å¤´å¾ªç¯å†™ã€‚</li>
<li>åœ¨è¿›è¡Œ<code>redo log</code>å†™å…¥æ—¶ï¼Œæœ‰ä¸¤ä¸ªé‡è¦å‚æ•°çš„write pos(å½“å‰è®°å½•çš„ä½ç½®),<code>checkpoint</code>æ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®<br><img src="https://img-blog.csdnimg.cn/20190410230340406.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=evnl5&originHeight=272&originWidth=884&originalType=binary&ratio=1&status=done&style=none"></li>
<li>ä¸€è¾¹å†™ä¸€è¾¹åç§»ï¼Œå†™åˆ°ç¬¬3å·æ–‡ä»¶æœ«å°¾åå°±å›åˆ°0å·æ–‡ä»¶å¼€å¤´,checkpointä¹Ÿæ˜¯å¾€åæ¨ç§»å¹¶ä¸”å¾ªç¯çš„ï¼Œæ“¦é™¤è®°å½•å‰è¦æŠŠè®°å½•æ›´æ–°åˆ°æ•°æ®æ–‡ä»¶ã€‚write poså’Œcheckpointä¹‹é—´è¿˜ç©ºç€çš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨æ¥è®°å½•æ–°çš„æ“ä½œã€‚</li>
<li>å¦‚æœ<code>write pos</code>è¿½ä¸Š<code>checkpoin</code>ï¼Œè¡¨ç¤º<code>redo log</code>æ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†æ‰§è¡Œæ–°çš„æ›´æ–°ï¼Œå¾—åœä¸‹æ¥å…ˆæ“¦æ‰ä¸€äº›è®°å½•ï¼ŒæŠŠcheckpointæ¨è¿›ä¸€ä¸‹ã€‚</li>
<li>æœ‰äº†redo logï¼ŒInnoDBå°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸ºcrash-safe(å´©æºƒå®‰å…¨()ã€‚</li>
<li>redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„æ—¥å¿—ï¼Œè€ŒServerå±‚ä¹Ÿæœ‰è‡ªå·±çš„æ—¥å¿—ï¼Œç§°ä¸ºbinlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰</li>
<li>æœ€å¼€å§‹MySQLé‡Œå¹¶æ²¡æœ‰<code>InnoDBå¼•æ“</code>ã€‚MySQLè‡ªå¸¦çš„å¼•æ“æ˜¯MyISAMï¼Œä½†æ˜¯MyISAMæ²¡æœ‰crash-safeçš„èƒ½åŠ›ï¼Œbinlogæ—¥å¿—åªèƒ½ç”¨äºå½’æ¡£ã€‚è€ŒInnoDBæ˜¯å¦ä¸€ä¸ªå…¬å¸ä»¥æ’ä»¶å½¢å¼å¼•å…¥MySQLçš„ï¼Œæ—¢ç„¶åªä¾é binlogæ˜¯æ²¡æœ‰crash-safeèƒ½åŠ›çš„ï¼Œæ‰€ä»¥InnoDBä½¿ç”¨å¦å¤–ä¸€å¥—æ—¥å¿—ç³»ç»Ÿâ€”â€”ä¹Ÿå°±æ˜¯redo logæ¥å®ç°crash-safeèƒ½åŠ›ã€‚</li>
</ul>
<blockquote>
<p><code>redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„</code>ï¼›binlogæ˜¯MySQLçš„Serverå±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚<br><code>redo logæ˜¯ç‰©ç†æ—¥å¿—</code>ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›<code>binlogæ˜¯é€»è¾‘æ—¥å¿—</code>ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ID=2è¿™ä¸€è¡Œçš„cå­—æ®µåŠ 1 â€ã€‚<br>r<code>edo logæ˜¯å¾ªç¯å†™çš„</code>ï¼Œ<code>ç©ºé—´å›ºå®š</code>ä¼šç”¨å®Œï¼›<code>binlogæ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„</code>ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡binlogæ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚</p>
</blockquote>
<p><strong>æ‰§è¡Œå™¨å’ŒInnoDBå¼•æ“åœ¨æ‰§è¡Œè¿™ä¸ªç®€å•çš„updateè¯­å¥æ—¶çš„å†…éƒ¨æµç¨‹:</strong></p>
<ul>
<li>æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å–ID=2è¿™ä¸€è¡Œã€‚IDæ˜¯ä¸»é”®ï¼Œå¼•æ“ç›´æ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œã€‚å¦‚æœID=2è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼›å¦åˆ™ï¼Œéœ€è¦å…ˆä»ç£ç›˜è¯»å…¥å†…å­˜ï¼Œç„¶åå†è¿”å›ã€‚</li>
<li>æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼ŒæŠŠè¿™ä¸ªå€¼åŠ ä¸Š1ï¼Œæ¯”å¦‚åŸæ¥æ˜¯Nï¼Œç°åœ¨å°±æ˜¯N+1ï¼Œå¾—åˆ°æ–°çš„ä¸€è¡Œæ•°æ®ï¼Œå†è°ƒç”¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®ã€‚</li>
<li>å¼•æ“å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ°redo logé‡Œé¢ï¼Œæ­¤æ—¶redo logå¤„äºprepareçŠ¶æ€ã€‚ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚</li>
<li>æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„binlogï¼Œå¹¶æŠŠbinlogå†™å…¥ç£ç›˜ã€‚</li>
<li>æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„redo logæ”¹æˆæäº¤ï¼ˆcommitï¼‰çŠ¶æ€ï¼Œæ›´æ–°å®Œæˆã€‚</li>
<li>redo logçš„å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤ï¼šprepareå’Œcommitï¼Œè¿™å°±æ˜¯<code>&quot;ä¸¤é˜¶æ®µæäº¤&quot;</code>ã€‚</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2019041023325625.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=tDmdi&originHeight=1522&originWidth=1142&originalType=binary&ratio=1&status=done&style=none"></p>
<blockquote>
<p><code>1 prepareé˜¶æ®µ 2 å†™binlog 3 commit</code> , å½“åœ¨<code>2ä¹‹å‰å´©æºƒæ—¶</code>,é‡å¯æ¢å¤ï¼šåå‘ç°æ²¡æœ‰commitï¼Œå›æ»šã€‚å¤‡ä»½æ¢å¤ï¼šæ²¡æœ‰binlog ã€‚<br><code>å½“åœ¨3ä¹‹å‰å´©æºƒ</code>,é‡å¯æ¢å¤ï¼šè™½æ²¡æœ‰commitï¼Œä½†æ»¡è¶³prepareå’Œbinlogå®Œæ•´ï¼Œæ‰€ä»¥é‡å¯åä¼šè‡ªåŠ¨commitã€‚å¤‡ä»½ï¼šæœ‰binlog. ä¸€è‡´</p>
</blockquote>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li>Redo logä¸æ˜¯è®°å½•æ•°æ®é¡µâ€œæ›´æ–°ä¹‹åçš„çŠ¶æ€â€ï¼Œè€Œæ˜¯è®°å½•è¿™ä¸ªé¡µ â€œåšäº†ä»€ä¹ˆæ”¹åŠ¨â€ã€‚</li>
<li>Binlogæœ‰ä¸¤ç§æ¨¡å¼ï¼Œstatement æ ¼å¼çš„è¯æ˜¯è®°sqlè¯­å¥ï¼Œ rowæ ¼å¼ä¼šè®°å½•è¡Œçš„å†…å®¹ï¼Œè®°ä¸¤æ¡ï¼Œæ›´æ–°å‰å’Œæ›´æ–°åéƒ½æœ‰ã€‚</li>
</ul>
<h3 id="äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§"><a href="#äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§" class="headerlink" title="äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§"></a>äº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§</h3><ul>
<li>äº‹åŠ¡å°±æ˜¯è¦ä¿è¯ä¸€ç»„æ•°æ®åº“æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åœ¨MySQLä¸­ï¼Œäº‹åŠ¡æ”¯æŒæ˜¯åœ¨å¼•æ“å±‚å®ç°çš„ã€‚MySQLé»˜è®¤çš„<code>MyISAM</code>å¼•æ“å°±ä¸æ”¯æŒäº‹åŠ¡ï¼Œè¿™ä¹Ÿæ˜¯<code>MyISAM</code>è¢«<code>InnoDB</code>å–ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚</li>
<li>äº‹åŠ¡çš„ç‰¹æ€§ï¼š<code>ACID</code>å³åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å¯èƒ½å‡ºç°<code>è„è¯»</code>ï¼Œ<code>ä¸å¯é‡å¤è¯»</code>ï¼Œ<code>å¹»è¯»</code>ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå°±æœ‰äº†â€œ<code>éš”ç¦»çº§åˆ«</code>â€çš„æ¦‚å¿µã€‚ä½†æ˜¯éš”ç¦»å¾—è¶Šä¸¥å®ï¼Œæ•ˆç‡å°±ä¼šè¶Šä½</li>
<li>SQLæ ‡å‡†çš„äº‹åŠ¡éš”ç¦»çº§åˆ«åŒ…æ‹¬ï¼š<code>è¯»æœªæäº¤</code>ï¼ˆread uncommittedï¼‰ã€<code>è¯»æäº¤</code>ï¼ˆread committedï¼‰ã€<code>å¯é‡å¤è¯»</code>ï¼ˆrepeatable readï¼‰å’Œ<code>ä¸²è¡ŒåŒ–</code>ï¼ˆserializable ï¼‰</li>
</ul>
<blockquote>
<p>è¯»æœªæäº¤æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚<br>è¯»æäº¤æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ã€‚<br>å¯é‡å¤è¯»æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚æœªæäº¤çš„æ›´æ”¹å¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„<br>ä¸²è¡ŒåŒ–:å¯¹åº”ä¸€ä¸ªè®°å½•ä¼šåŠ è¯»å†™é”ï¼Œå‡ºç°å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆæ‰èƒ½ç»§ç»­æ‰§è¡Œ</p>
</blockquote>
<ul>
<li>åœ¨å®ç°ä¸Šï¼Œæ•°æ®åº“é‡Œé¢ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œè®¿é—®çš„æ—¶å€™ä»¥è§†å›¾çš„é€»è¾‘ç»“æœä¸ºå‡†ã€‚åœ¨â€œ<code>å¯é‡å¤è¯»</code>â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œæ•´ä¸ªäº‹åŠ¡å­˜åœ¨æœŸé—´éƒ½ç”¨è¿™ä¸ªè§†å›¾ã€‚åœ¨<code>â€œè¯»æäº¤â€</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨æ¯ä¸ªSQLè¯­å¥å¼€å§‹æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºçš„ã€‚<code>â€œè¯»æœªæäº¤â€</code>éš”ç¦»çº§åˆ«ä¸‹ç›´æ¥è¿”å›è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œæ²¡æœ‰è§†å›¾æ¦‚å¿µã€‚<code>ä¸²è¡ŒåŒ–</code>â€éš”ç¦»çº§åˆ«ä¸‹ç›´æ¥ç”¨åŠ é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®</li>
<li>æŸ¥çœ‹æ•°æ®åº“çš„å®ç‰©éš”ç¦»çº§åˆ«ï¼š<code>show variables like &#39;%isolation%&#39;;</code></li>
<li>äº‹åŠ¡éš”ç¦»çš„å®ç°ï¼šåœ¨MySQLä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚</li>
</ul>
<p>å‡è®¾ä¸€ä¸ªå€¼ä»1è¢«æŒ‰é¡ºåºæ”¹æˆäº†2ã€3ã€4ï¼Œåœ¨å›æ»šæ—¥å¿—é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•ã€‚ä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„read-viewï¼ŒåŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ<code>MVCC</code>ï¼‰<br><img src="https://img-blog.csdnimg.cn/20190411130916709.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=AC58n&originHeight=407&originWidth=973&originalType=binary&ratio=1&status=done&style=none"></p>
<ul>
<li>å›æ»šæ—¥å¿—æ€»ä¸èƒ½ä¸€ç›´ä¿ç•™å§ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œåœ¨ä¸éœ€è¦çš„æ—¶å€™æ‰åˆ é™¤ã€‚ç³»ç»Ÿä¼šåˆ¤æ–­ï¼Œå½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ã€‚ä»€ä¹ˆæ—¶å€™æ‰ä¸éœ€è¦äº†å‘¢ï¼Ÿå°±æ˜¯å½“ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”è¿™ä¸ªå›æ»šæ—¥å¿—æ›´æ—©çš„read-viewçš„æ—¶å€™ã€‚</li>
<li>ä¸ºä»€ä¹ˆå°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ã€‚é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå›æ»šè®°å½•éƒ½è¦ä¿ç•™ï¼Œè¿™ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œå¯èƒ½ä¼šæ‹–å®åº“ã€‚</li>
<li>äº‹åŠ¡å¯åŠ¨æ–¹å¼ï¼šä¸€ã€æ˜¾å¼å¯åŠ¨äº‹åŠ¡è¯­å¥ï¼Œ<code>begin</code>æˆ–è€…<code>start transaction</code>,æäº¤<code>commit</code>ï¼Œå›æ»š<code>rollback</code>ï¼›äºŒã€<code>set autocommit=0</code>ï¼Œè¯¥å‘½ä»¤ä¼šæŠŠè¿™ä¸ªçº¿ç¨‹çš„è‡ªåŠ¨æäº¤å…³æ‰ã€‚è¿™æ ·åªè¦æ‰§è¡Œä¸€ä¸ªselectè¯­å¥ï¼Œäº‹åŠ¡å°±å¯åŠ¨ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨æäº¤ï¼Œç›´åˆ°ä¸»åŠ¨æ‰§è¡Œ<code>commit</code>æˆ–<code>rollback</code>æˆ–æ–­å¼€è¿æ¥ã€‚</li>
<li>å»ºè®®ä½¿ç”¨æ–¹æ³•ä¸€ï¼Œå¦‚æœè€ƒè™‘å¤šä¸€æ¬¡äº¤äº’é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨<code>commit work and chain</code>è¯­æ³•ã€‚åœ¨<code>autocommit=1</code>çš„æƒ…å†µä¸‹ç”¨<code>begin</code>æ˜¾å¼å¯åŠ¨äº‹åŠ¡ï¼Œå¦‚æœæ‰§è¡Œ<code>commit</code>åˆ™æäº¤äº‹åŠ¡ã€‚å¦‚æœæ‰§è¡Œ<code>commit work and chain</code>åˆ™æäº¤äº‹åŠ¡å¹¶è‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ªäº‹åŠ¡</li>
</ul>
<h3 id="æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰"><a href="#æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰" class="headerlink" title="æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰"></a>æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰</h3><p><strong>ç´¢å¼•çš„å¸¸è§æ¨¡å‹</strong></p>
<ul>
<li>ç´¢å¼•çš„å‡ºç°æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå¸¸è§çš„ä¸‰ç§ç´¢å¼•æ¨¡å‹åˆ†åˆ«æ˜¯<code>å“ˆå¸Œè¡¨</code>ã€<code>æœ‰åºæ•°ç»„</code>å’Œ<code>æœç´¢æ ‘</code></li>
<li><code>å“ˆå¸Œè¡¨</code>ï¼šä¸€ç§ä»¥<code>key-value</code> å­˜å‚¨æ•°æ®çš„ç»“æ„ï¼Œå“ˆå¸Œçš„æ€è·¯æ˜¯æŠŠå€¼æ”¾åœ¨æ•°ç»„é‡Œï¼Œç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°æŠŠ<code>key</code>æ¢ç®—æˆä¸€ä¸ªç¡®å®šçš„ä½ç½®ï¼Œç„¶åæŠŠ<code>value</code>æ”¾åœ¨æ•°ç»„çš„è¿™ä¸ªä½ç½®ã€‚å“ˆå¸Œå†²çªçš„å¤„ç†åŠæ³•æ˜¯ä½¿ç”¨<code>é“¾è¡¨</code>ã€‚å“ˆå¸Œè¡¨é€‚ç”¨åªæœ‰<code>ç­‰å€¼æŸ¥è¯¢</code>çš„åœºæ™¯</li>
<li><code>æœ‰åºæ•°ç»„</code>ï¼šæŒ‰é¡ºåºå­˜å‚¨ã€‚æŸ¥è¯¢ç”¨äºŒåˆ†æ³•å°±å¯ä»¥å¿«é€ŸæŸ¥è¯¢ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ï¼šO(log(N))ã€‚æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œæ›´æ–°æ•ˆç‡ä½ï¼ˆæ¶‰åŠåˆ°ç§»ä½ï¼‰ã€‚åœ¨ç­‰å€¼æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢åœºæ™¯ä¸­çš„æ€§èƒ½å°±éƒ½éå¸¸ä¼˜ç§€ã€‚æœ‰åºæ•°ç»„ç´¢å¼•åªé€‚ç”¨äºé™æ€å­˜å‚¨å¼•æ“ã€‚</li>
<li>äºŒå‰æœç´¢æ ‘ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å„¿å­å°äºçˆ¶èŠ‚ç‚¹ï¼Œå³å„¿å­å¤§äºçˆ¶èŠ‚ç‚¹ã€‚æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦O(log(N))ï¼Œæ›´æ–°æ—¶é—´å¤æ‚åº¦O(log(N))ã€‚æ•°æ®åº“å­˜å‚¨å¤§å¤šä¸é€‚ç”¨äºŒå‰æ ‘ï¼Œå› ä¸ºæ ‘é«˜è¿‡é«˜ï¼Œä¼šé€‚ç”¨Nå‰æ ‘</li>
</ul>
<p><strong>InnoDB çš„ç´¢å¼•æ¨¡å‹</strong></p>
<ul>
<li><code>InnoDB</code>ä½¿ç”¨äº†<code>B+æ ‘</code>ç´¢å¼•æ¨¡å‹ï¼Œæ‰€ä»¥æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨B+æ ‘ä¸­çš„ã€‚æ¯ä¸€ä¸ªç´¢å¼•åœ¨<code>InnoDB</code>é‡Œé¢å¯¹åº”ä¸€æ£µB+æ ‘ã€‚</li>
<li>ç´¢å¼•ç±»å‹åˆ†ä¸º<code>ä¸»é”®ç´¢å¼•</code>å’Œ<code>éä¸»é”®ç´¢å¼•</code>ã€‚ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•´è¡Œæ•°æ®ã€‚åœ¨InnoDBé‡Œï¼Œä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸º<code>èšç°‡ç´¢å¼•</code>ã€‚éä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼ã€‚åœ¨InnoDBé‡Œï¼Œéä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸º<code>äºŒçº§ç´¢å¼•</code></li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190411164702315.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=GPjHM&originHeight=424&originWidth=1004&originalType=binary&ratio=1&status=done&style=none"></p>
<p><strong>ä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„æŸ¥è¯¢æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p>
<ul>
<li>å¦‚æœè¯­å¥æ˜¯<code>select * from T where ID=500</code>ï¼Œå³ä¸»é”®æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™åªéœ€è¦æœç´¢IDè¿™æ£µB+æ ‘ï¼›</li>
<li>å¦‚æœè¯­å¥æ˜¯<code>select * from T where k=5</code>ï¼Œå³æ™®é€šç´¢å¼•æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™éœ€è¦å…ˆæœç´¢kç´¢å¼•æ ‘ï¼Œå¾—åˆ°IDçš„å€¼ä¸º500ï¼Œå†åˆ°IDç´¢å¼•æ ‘æœç´¢ä¸€æ¬¡ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<code>å›è¡¨</code>ã€‚</li>
<li>åŸºäºéä¸»é”®ç´¢å¼•çš„æŸ¥è¯¢éœ€è¦å¤šæ‰«æä¸€æ£µç´¢å¼•æ ‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸­åº”è¯¥å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢</li>
</ul>
<p><strong>ç´¢å¼•ç»´æŠ¤</strong></p>
<ul>
<li><code>B+æ ‘</code>ä¸ºäº†ç»´æŠ¤ç´¢å¼•æœ‰åºæ€§ï¼Œåœ¨æ’å…¥æ–°å€¼çš„æ—¶å€™éœ€è¦åšå¿…è¦çš„ç»´æŠ¤ã€‚æ¶‰åŠåˆ°æ•°æ®çš„ç§»åŠ¨å’Œæ•°æ®é¡µçš„å¢åŠ å’Œåˆ å‡</li>
<li>ä¸€ä¸ªæ•°æ®é¡µæ»¡äº†ï¼ŒæŒ‰ç…§B+Treeç®—æ³•ï¼Œæ–°å¢åŠ ä¸€ä¸ªæ•°æ®é¡µï¼Œå«åš<code>é¡µåˆ†è£‚</code>ï¼Œä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ç©ºé—´åˆ©ç”¨ç‡é™ä½å¤§æ¦‚50%ã€‚å½“ç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®é¡µåˆ©ç”¨ç‡å¾ˆä½çš„æ—¶å€™ä¼šåš<code>æ•°æ®é¡µåˆå¹¶</code>ï¼Œåˆå¹¶çš„è¿‡ç¨‹æ˜¯åˆ†è£‚è¿‡ç¨‹çš„<code>é€†è¿‡ç¨‹</code>ã€‚</li>
</ul>
<h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li>ç´¢å¼•å¯èƒ½å› ä¸ºåˆ é™¤ï¼Œæˆ–è€…é¡µåˆ†è£‚ç­‰åŸå› ï¼Œå¯¼è‡´æ•°æ®é¡µæœ‰ç©ºæ´ï¼Œé‡å»ºç´¢å¼•çš„è¿‡ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼ŒæŠŠæ•°æ®æŒ‰é¡ºåºæ’å…¥ï¼Œè¿™æ ·é¡µé¢çš„åˆ©ç”¨ç‡æœ€é«˜ï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•æ›´ç´§å‡‘ã€æ›´çœç©ºé—´ã€‚</li>
</ul>
<blockquote>
<p><code>alter table T drop index k</code>; Â  Â  alter table T add index(k);<br>è¦é‡å»ºä¸»é”®ç´¢å¼•<br><code>alter table T drop primary key</code>; Â  Â  Â <code>alter table T add primary key(id)</code>;<br>é‡å»ºç´¢å¼•kçš„åšæ³•æ˜¯åˆç†çš„ï¼Œå¯ä»¥è¾¾åˆ°çœç©ºé—´çš„ç›®çš„ã€‚ä½†æ˜¯ï¼Œé‡å»ºä¸»é”®çš„è¿‡ç¨‹ä¸åˆç†ã€‚ä¸è®ºæ˜¯åˆ é™¤ä¸»é”®è¿˜æ˜¯åˆ›å»ºä¸»é”®ï¼Œéƒ½ä¼šå°†æ•´ä¸ªè¡¨é‡å»ºã€‚æ‰€ä»¥è¿ç€æ‰§è¡Œè¿™ä¸¤ä¸ªè¯­å¥çš„è¯ï¼Œç¬¬ä¸€ä¸ªè¯­å¥å°±ç™½åšäº†ã€‚<br>å¯ä»¥ç”¨è¿™ä¸ªè¯­å¥ä»£æ›¿ ï¼š alter table T engine=InnoDB</p>
</blockquote>
<h3 id="æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰"><a href="#æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰" class="headerlink" title="æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰"></a>æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> T (</span><br><span class="line">ID <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">k <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>, </span><br><span class="line">s <span class="type">varchar</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">index k(k))</span><br><span class="line">engine<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> T <span class="keyword">values</span>(<span class="number">100</span>,<span class="number">1</span>, <span class="string">&#x27;aa&#x27;</span>),(<span class="number">200</span>,<span class="number">2</span>,<span class="string">&#x27;bb&#x27;</span>),(<span class="number">300</span>,<span class="number">3</span>,<span class="string">&#x27;cc&#x27;</span>),(<span class="number">500</span>,<span class="number">5</span>,<span class="string">&#x27;ee&#x27;</span>),(<span class="number">600</span>,<span class="number">6</span>,<span class="string">&#x27;ff&#x27;</span>),(<span class="number">700</span>,<span class="number">7</span>,<span class="string">&#x27;gg&#x27;</span>);</span><br></pre></td></tr></table></figure>


<p><img src="https://img-blog.csdnimg.cn/20190411193509228.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=iQfIH&originHeight=441&originWidth=989&originalType=binary&ratio=1&status=done&style=none"><br>å¦‚æœæˆ‘æ‰§è¡Œ <code>select * from T where k between 3 and 5</code>ï¼Œéœ€è¦æ‰§è¡Œå‡ æ¬¡æ ‘çš„æœç´¢æ“ä½œï¼Œä¼šæ‰«æå¤šå°‘è¡Œï¼Ÿ</p>
<p><strong>SQLæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹ï¼š</strong></p>
<ul>
<li>åœ¨kç´¢å¼•æ ‘ä¸Šæ‰¾åˆ°k=3çš„è®°å½•ï¼Œå–å¾— ID = 300ï¼›</li>
<li>å†åˆ°IDç´¢å¼•æ ‘æŸ¥åˆ°ID=300å¯¹åº”çš„R3ï¼›</li>
<li>åœ¨kç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼k=5ï¼Œå–å¾—ID=500ï¼›</li>
<li>å†å›åˆ°IDç´¢å¼•æ ‘æŸ¥åˆ°ID=500å¯¹åº”çš„R4ï¼›</li>
<li>åœ¨kç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼k=6ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå¾ªç¯ç»“æŸã€‚</li>
<li>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå›åˆ°ä¸»é”®ç´¢å¼•æ ‘æœç´¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¸ºå›è¡¨ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹è¯»äº†kç´¢å¼•æ ‘çš„3æ¡è®°å½•ï¼Œå›è¡¨äº†ä¸¤æ¬¡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºæŸ¥è¯¢ç»“æœæ‰€éœ€è¦çš„æ•°æ®åªåœ¨ä¸»é”®ç´¢å¼•ä¸Šæœ‰ï¼Œæ‰€ä»¥ä¸å¾—ä¸å›è¡¨ã€‚</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹å¼</strong></p>
<ul>
<li>sqlè¯­å¥ä¿®æ”¹ä¸º<code>select ID from T where k between 3 and 5</code>ï¼Œè¿™æ—¶åªéœ€è¦æŸ¥IDçš„å€¼ï¼Œè€ŒIDçš„å€¼å·²ç»åœ¨kç´¢å¼•æ ‘ä¸Šäº†ï¼Œå› æ­¤å¯ä»¥ç›´æ¥æä¾›æŸ¥è¯¢ç»“æœï¼Œä¸éœ€è¦å›è¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢é‡Œé¢ï¼Œç´¢å¼•kå·²ç»â€œè¦†ç›–äº†â€æˆ‘ä»¬çš„æŸ¥è¯¢éœ€æ±‚ï¼Œæˆ‘ä»¬ç§°ä¸º<code>è¦†ç›–ç´¢å¼•</code>ã€‚</li>
<li>ç”±äº<code>è¦†ç›–ç´¢å¼•</code>å¯ä»¥å‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæ‰€ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µã€‚</li>
</ul>
<h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li><code>è¦†ç›–ç´¢å¼•</code>ï¼šå¦‚æœæŸ¥è¯¢æ¡ä»¶ä½¿ç”¨çš„æ˜¯æ™®é€šç´¢å¼•ï¼ˆæˆ–æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦åŸåˆ™å­—æ®µï¼‰ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯è”åˆç´¢å¼•çš„å­—æ®µæˆ–æ˜¯ä¸»é”®ï¼Œä¸ç”¨å›è¡¨æ“ä½œï¼Œç›´æ¥è¿”å›ç»“æœï¼Œå‡å°‘IOç£ç›˜è¯»å†™è¯»å–æ­£è¡Œæ•°æ®</li>
<li><code>æœ€å·¦å‰ç¼€</code>ï¼šè”åˆç´¢å¼•çš„æœ€å·¦ N ä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç´¢å¼•çš„æœ€å·¦ M ä¸ªå­—ç¬¦</li>
<li><code>è”åˆç´¢å¼•</code>ï¼šæ ¹æ®åˆ›å»ºè”åˆç´¢å¼•çš„é¡ºåºï¼Œä»¥æœ€å·¦åŸåˆ™è¿›è¡Œwhereæ£€ç´¢ï¼Œæ¯”å¦‚ï¼ˆageï¼Œnameï¼‰ä»¥age=1 æˆ– age= 1 and name=â€˜å¼ ä¸‰â€™å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œå•ä»¥name=â€˜å¼ ä¸‰â€™ ä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œè€ƒè™‘åˆ°å­˜å‚¨ç©ºé—´çš„é—®é¢˜ï¼Œè¿˜è¯·æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œå°†æŸ¥æ‰¾é¢‘ç¹çš„æ•°æ®è¿›è¡Œé å·¦åˆ›å»ºç´¢å¼•ã€‚</li>
<li>ç´¢å¼•ä¸‹æ¨ï¼š<code>like &#39;hello%â€™and age &gt;10</code> æ£€ç´¢ï¼ŒMySQL5.6ç‰ˆæœ¬ä¹‹å‰ï¼Œä¼šå¯¹åŒ¹é…çš„æ•°æ®è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚5.6ç‰ˆæœ¬åï¼Œä¼šå…ˆè¿‡æ»¤æ‰age&lt;10çš„æ•°æ®ï¼Œå†è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œå‡å°‘å›è¡¨ç‡ï¼Œæå‡æ£€ç´¢é€Ÿåº¦</li>
</ul>
<h3 id="è®²å…¨å±€é”å’Œè¡¨é”ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢"><a href="#è®²å…¨å±€é”å’Œè¡¨é”ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢" class="headerlink" title="è®²å…¨å±€é”å’Œè¡¨é”ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢"></a>è®²å…¨å±€é”å’Œè¡¨é”ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢</h3><blockquote>
<p>æ ¹æ®åŠ é”çš„èŒƒå›´ï¼ŒMySQLé‡Œé¢çš„é”å¤§è‡´å¯ä»¥åˆ†æˆå…¨å±€é”ã€è¡¨çº§é”å’Œè¡Œé”ä¸‰ç±»</p>
</blockquote>
<p><strong>å…¨å±€é”</strong></p>
<ul>
<li>å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ã€‚MySQLæä¾›åŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼š<code>Flush tables with read lock(FTWRL)</code>ã€‚è¿™ä¸ªå‘½ä»¤å¯ä»¥ä½¿æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ã€‚ä½¿ç”¨è¯¥å‘½ä»¤ä¹‹åï¼Œæ•°æ®æ›´æ–°è¯­å¥ã€æ•°æ®å®šä¹‰è¯­å¥å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ç­‰æ“ä½œéƒ½ä¼šè¢«é˜»å¡ã€‚ä½¿ç”¨åœºæ™¯ï¼š<code>å…¨åº“é€»è¾‘å¤‡ä»½</code>ã€‚</li>
<li>é£é™©æ˜¯å¦‚æœåœ¨ä¸»åº“å¤‡ä»½ï¼Œåœ¨å¤‡ä»½æœŸé—´ä¸èƒ½æ›´æ–°ï¼Œä¸šåŠ¡åœæ‘†ã€‚å¦‚æœåœ¨ä»åº“å¤‡ä»½ï¼Œå¤‡ä»½æœŸé—´ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥çš„binlogï¼Œå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚å®˜æ–¹è‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…·<code>mysqldump</code>ï¼Œå½“mysqldumpä½¿ç”¨å‚æ•°<code>--single-transaction</code>çš„æ—¶å€™ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾ã€‚è€Œç”±äº<code>MVCC</code>çš„æ”¯æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥æ­£å¸¸æ›´æ–°çš„ã€‚</li>
<li>ä¸€è‡´æ€§è¯»æ˜¯å¥½ï¼Œä½†æ˜¯å‰ææ˜¯å¼•æ“è¦æ”¯æŒè¿™ä¸ªéš”ç¦»çº§åˆ«ã€‚å¦‚æœè¦å…¨åº“åªè¯»ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨<code>set global readonly=true</code>çš„æ–¹å¼ï¼Ÿåœ¨æœ‰äº›ç³»ç»Ÿä¸­ï¼Œ<code>readonly</code>çš„å€¼ä¼šè¢«ç”¨æ¥åšå…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚åˆ¤æ–­ä¸»å¤‡åº“ã€‚æ‰€ä»¥ä¿®æ”¹globalå˜é‡çš„æ–¹å¼å½±å“å¤ªå¤§ã€‚</li>
<li>åœ¨å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸Šæœ‰å·®å¼‚ã€‚å¦‚æœæ‰§è¡Œ<code>FTWRL</code>å‘½ä»¤ä¹‹åç”±äºå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸æ–­å¼€ï¼Œé‚£ä¹ˆMySQLä¼šè‡ªåŠ¨é‡Šæ”¾è¿™ä¸ªå…¨å±€é”ï¼Œæ•´ä¸ªåº“å›åˆ°å¯ä»¥æ­£å¸¸æ›´æ–°çš„çŠ¶æ€ã€‚è€Œå°†æ•´ä¸ªåº“è®¾ç½®ä¸º<code>readonly</code>ä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ•°æ®åº“å°±ä¼šä¸€ç›´ä¿æŒ<code>readonly</code>çŠ¶æ€ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•´ä¸ªåº“é•¿æ—¶é—´å¤„äºä¸å¯å†™çŠ¶æ€ï¼Œé£é™©è¾ƒé«˜ã€‚</li>
</ul>
<p><strong>è¡¨çº§é”</strong></p>
<ul>
<li>MySQLé‡Œé¢è¡¨çº§é”æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®æ‰€(meta data lock,MDL)ã€‚è¡¨é”çš„è¯­æ³•æ˜¯:l<code>ock tables ... read/write</code></li>
<li>å¯ä»¥ç”¨<code>unlock tables</code>ä¸»åŠ¨é‡Šæ”¾é”ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾ã€‚<code>lock tables</code>è¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡ã€‚</li>
<li>å¯¹äº<code>InnoDB</code>è¿™ç§æ”¯æŒ<code>è¡Œé”</code>çš„å¼•æ“ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨<code>lock tables</code>å‘½ä»¤æ¥æ§åˆ¶å¹¶å‘ï¼Œæ¯•ç«Ÿé”ä½æ•´ä¸ªè¡¨çš„å½±å“é¢è¿˜æ˜¯å¤ªå¤§ã€‚</li>
<li>å¦ä¸€ç±»è¡¨çº§çš„é”æ˜¯<code>MDL</code>ï¼ˆmetadata lock)ã€‚<code>MDLä¸éœ€è¦æ˜¾å¼ä½¿ç”¨</code>ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«<code>è‡ªåŠ¨åŠ ä¸Š</code>ã€‚MDLçš„ä½œç”¨æ˜¯ï¼Œ<code>ä¿è¯è¯»å†™çš„æ­£ç¡®æ€§</code>ã€‚å½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ <code>MDLè¯»é”</code>ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ <code>MDLå†™é”</code>ã€‚<code>è¯»é”ä¹‹é—´ä¸äº’æ–¥</code>ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢åˆ æ”¹æŸ¥ã€‚<code>è¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„</code>ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹è¦åŒæ—¶ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªè¦ç­‰å¦ä¸€ä¸ªæ‰§è¡Œå®Œæ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚</li>
<li><code>MDL</code> ä¼šç›´åˆ°äº‹åŠ¡æäº¤æ‰ä¼šé‡Šæ”¾ï¼Œåœ¨åšè¡¨ç»“æ„å˜æ›´çš„æ—¶å€™ï¼Œä¸€å®šè¦å°å¿ƒä¸è¦å¯¼è‡´é”ä½çº¿ä¸ŠæŸ¥è¯¢å’Œæ›´æ–°ã€‚</li>
</ul>
<p><strong>å¦‚ä½•å®‰å…¨åœ°ç»™è¡¨åŠ å­—æ®µ</strong></p>
<ul>
<li>ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µï¼Œæˆ–è€…ä¿®æ”¹å­—æ®µï¼Œæˆ–è€…åŠ ç´¢å¼•ï¼Œéœ€è¦æ‰«æå…¨è¡¨çš„æ•°æ®ã€‚é¦–å…ˆæˆ‘ä»¬è¦è§£å†³é•¿äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸æäº¤ï¼Œå°±ä¼šä¸€ç›´å ç€MDLé”ã€‚åœ¨MySQLçš„<code>information_schema</code> åº“çš„ <code>innodb_trx</code> è¡¨ä¸­ï¼Œä½ å¯ä»¥æŸ¥åˆ°å½“å‰æ‰§è¡Œä¸­çš„äº‹åŠ¡ã€‚å¦‚æœä½ è¦åš<code>DDL</code>å˜æ›´çš„è¡¨åˆšå¥½æœ‰<code>é•¿äº‹åŠ¡</code>åœ¨æ‰§è¡Œï¼Œè¦è€ƒè™‘å…ˆæš‚åœDDLï¼Œæˆ–è€…<code>kill</code>æ‰è¿™ä¸ªé•¿äº‹åŠ¡ã€‚</li>
<li>å¦‚æœä½ è¦å˜æ›´çš„è¡¨æ˜¯ä¸€ä¸ª<code>çƒ­ç‚¹è¡¨</code>ï¼Œè™½ç„¶æ•°æ®é‡ä¸å¤§ï¼Œä½†æ˜¯ä¸Šé¢çš„è¯·æ±‚å¾ˆé¢‘ç¹ï¼Œè¿™æ—¶å€™killå¯èƒ½æœªå¿…ç®¡ç”¨ï¼Œå› ä¸ºæ–°çš„è¯·æ±‚é©¬ä¸Šå°±æ¥äº†ã€‚æ¯”è¾ƒç†æƒ³çš„æœºåˆ¶æ˜¯ï¼Œåœ¨<code>alter table</code>è¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ°<code>MDLå†™é”</code>æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚ä¹‹åå¼€å‘äººå‘˜æˆ–è€…DBAå†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚</li>
</ul>
<h3 id="è®²è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“"><a href="#è®²è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“" class="headerlink" title="è®²è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“"></a>è®²è¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“</h3><ul>
<li>MySQLçš„<code>è¡Œé”</code>æ˜¯åœ¨å¼•æ“å±‚ç”±å„ä¸ª<code>å¼•æ“è‡ªå·±å®ç°</code>çš„ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒè¡Œé”ï¼Œæ¯”<code>å¦‚MyISAMå¼•æ“å°±ä¸æ”¯æŒè¡Œé”</code>ã€‚ä¸æ”¯æŒè¡Œé”æ„å‘³ç€å¹¶å‘æ§åˆ¶åªèƒ½ä½¿ç”¨è¡¨é”ï¼Œå¯¹äºè¿™ç§å¼•æ“çš„è¡¨ï¼ŒåŒä¸€å¼ è¡¨ä¸Šä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°åœ¨æ‰§è¡Œï¼Œè¿™å°±ä¼šå½±å“åˆ°ä¸šåŠ¡å¹¶å‘åº¦ã€‚<code>InnoDBæ˜¯æ”¯æŒè¡Œé”</code>çš„ï¼Œè¿™ä¹Ÿæ˜¯<code>MyISAM</code>è¢«<code>InnoDB</code>æ›¿ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚</li>
<li><code>ä¸¤é˜¶æ®µé”åè®®</code>ï¼šåœ¨<code>InnoDB</code>äº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚å¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ã€‚</li>
<li><code>æ­»é”</code>ï¼šå½“å¹¶å‘ç³»ç»Ÿä¸­ä¸åŒçº¿ç¨‹å‡ºç°å¾ªç¯èµ„æºä¾èµ–ï¼Œæ¶‰åŠçš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œå°±ä¼šå¯¼è‡´è¿™å‡ ä¸ªçº¿ç¨‹éƒ½è¿›å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€ï¼Œç§°ä¸ºæ­»é”</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190412161554856.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=Enkur&originHeight=585&originWidth=948&originalType=binary&ratio=1&status=done&style=none"></p>
<ul>
<li><code>äº‹åŠ¡A</code>åœ¨ç­‰å¾…<code>äº‹åŠ¡B</code>é‡Šæ”¾id=2çš„è¡Œé”ï¼Œè€Œ<code>äº‹åŠ¡Båœ¨ç­‰å¾…äº‹åŠ¡A</code>é‡Šæ”¾id=1çš„è¡Œé”ã€‚ äº‹åŠ¡Aå’Œäº‹åŠ¡Båœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„èµ„æºé‡Šæ”¾ï¼Œå°±æ˜¯è¿›å…¥äº†<code>æ­»é”çŠ¶æ€</code></li>
</ul>
<p><strong>å‡ºç°æ­»é”ä»¥åï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼š</strong></p>
<ul>
<li>ä¸€ç§ç­–ç•¥æ˜¯ï¼Œ<code>ç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶</code>ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•°<code>innodb_lock_wait_timeout</code>æ¥è®¾ç½®ã€‚åœ¨InnoDBä¸­ï¼Œé»˜è®¤å€¼æ˜¯<code>50s</code></li>
<li>å¦ä¸€ç§ç­–ç•¥æ˜¯ï¼Œ<code>å‘èµ·æ­»é”æ£€æµ‹</code>ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°<code>innodb_deadlock_detectè®¾ç½®ä¸ºon</code>ï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚é»˜è®¤å€¼æœ¬èº«å°±æ˜¯on</li>
<li>æ­£å¸¸æƒ…å†µä¸‹é€‰æ‹©ç¬¬äºŒç§ç­–ç•¥ï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯æœ‰é¢å¤–è´Ÿæ‹…çš„ï¼Œå¦‚æœç¬é—´æœ‰å¤§é‡çº¿ç¨‹è¯·æ±‚ä¼šæ¶ˆè€—æ¶ˆè€—å¤§é‡çš„CPUèµ„æºï¼Œä½†æ˜¯æ¯ç§’å´æ‰§è¡Œä¸äº†å‡ ä¸ªäº‹åŠ¡ï¼Œå› ä¸ºæ¯æ¬¡éƒ½è¦æ£€æµ‹ã€‚</li>
</ul>
<p><strong>æ€ä¹ˆè§£å†³ç”±è¿™ç§çƒ­ç‚¹è¡Œæ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜?</strong></p>
<ul>
<li>é—®é¢˜çš„ç—‡ç»“åœ¨äºï¼Œæ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„CPUèµ„æº</li>
<li>å¦‚æœä½ èƒ½ç¡®ä¿è¿™ä¸ªä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå¯ä»¥ä¸´æ—¶æŠŠæ­»é”æ£€æµ‹å…³æ‰ã€‚ ä¸€èˆ¬ä¸å»ºè®®é‡‡ç”¨</li>
<li>æ§åˆ¶å¹¶å‘åº¦ï¼Œå¯¹åº”ç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿã€‚è¿™æ ·åœ¨InnoDBå†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œäº†ã€‚</li>
<li>å°†çƒ­æ›´æ–°çš„è¡Œæ•°æ®æ‹†åˆ†æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘é”å†²çªï¼Œä½†æ˜¯ä¸šåŠ¡å¤æ‚åº¦å¯èƒ½ä¼šå¤§å¤§æé«˜ã€‚</li>
<li><code>innodbè¡Œçº§é”æ˜¯é€šè¿‡é”ç´¢å¼•è®°å½•å®ç°çš„ï¼Œå¦‚æœæ›´æ–°çš„åˆ—æ²¡å»ºç´¢å¼•æ˜¯ä¼šé”ä½æ•´ä¸ªè¡¨çš„ã€‚</code></li>
</ul>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>å¦‚æœä½ è¦åˆ é™¤ä¸€ä¸ªè¡¨é‡Œé¢çš„å‰10000è¡Œæ•°æ®ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç§ï¼Œç›´æ¥æ‰§è¡Œ     <code>delete from T limit 10000;</code></li>
<li>ç¬¬äºŒç§ï¼Œåœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ20æ¬¡ <code>delete from T limit 500;</code></li>
<li>ç¬¬ä¸‰ç§ï¼Œåœ¨20ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œ    <code>delete from T limit 500</code></li>
</ul>
<p><strong>ä¸‰ç§æ–¹æ¡ˆåˆ†æ</strong></p>
<ul>
<li>æ–¹æ¡ˆä¸€ï¼Œäº‹åŠ¡ç›¸å¯¹è¾ƒé•¿ï¼Œåˆ™å ç”¨é”çš„æ—¶é—´è¾ƒé•¿ï¼Œä¼šå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯ç­‰å¾…èµ„æºæ—¶é—´è¾ƒé•¿ã€‚</li>
<li>æ–¹æ¡ˆäºŒï¼Œä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œå°†ç›¸å¯¹é•¿çš„äº‹åŠ¡åˆ†æˆå¤šæ¬¡ç›¸å¯¹çŸ­çš„äº‹åŠ¡ï¼Œåˆ™æ¯æ¬¡äº‹åŠ¡å ç”¨é”çš„æ—¶é—´ç›¸å¯¹è¾ƒçŸ­ï¼Œå…¶ä»–å®¢æˆ·ç«¯åœ¨ç­‰å¾…ç›¸åº”èµ„æºçš„æ—¶é—´ä¹Ÿè¾ƒçŸ­ã€‚è¿™æ ·çš„æ“ä½œï¼ŒåŒæ—¶ä¹Ÿæ„å‘³ç€å°†èµ„æºåˆ†ç‰‡ä½¿ç”¨ï¼ˆæ¯æ¬¡æ‰§è¡Œä½¿ç”¨ä¸åŒç‰‡æ®µçš„èµ„æºï¼‰ï¼Œå¯ä»¥æé«˜å¹¶å‘æ€§ã€‚</li>
<li>æ–¹æ¡ˆä¸‰ï¼Œäººä¸ºè‡ªå·±åˆ¶é€ é”ç«äº‰ï¼ŒåŠ å‰§å¹¶å‘é‡ã€‚</li>
</ul>
<h3 id="äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„"><a href="#äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„" class="headerlink" title="äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„"></a>äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„</h3><ul>
<li><code>innodb</code>æ”¯æŒ<code>RC(è¯»æäº¤)</code>å’Œ<code>RR(å¯é‡å¤è¯»)</code>éš”ç¦»çº§åˆ«å®ç°æ˜¯ç”¨çš„ä¸€è‡´æ€§è§†å›¾(consistent read view)</li>
<li>.äº‹åŠ¡åœ¨å¯åŠ¨æ—¶ä¼šæ‹ä¸€ä¸ªå¿«ç…§,è¿™ä¸ªå¿«ç…§æ˜¯åŸºäºæ•´ä¸ªåº“çš„ã€‚åŸºäºæ•´ä¸ªåº“çš„æ„æ€å°±æ˜¯è¯´ä¸€ä¸ªäº‹åŠ¡å†…,æ•´ä¸ªåº“çš„ä¿®æ”¹å¯¹äºè¯¥äº‹åŠ¡éƒ½æ˜¯ä¸å¯è§çš„(å¯¹äºå¿«ç…§è¯»çš„æƒ…å†µ)ã€‚å¦‚æœåœ¨äº‹åŠ¡å†…<code>select t</code>è¡¨,å¦å¤–çš„äº‹åŠ¡æ‰§è¡Œäº†<code>DDL t</code>è¡¨,æ ¹æ®å‘ç”Ÿæ—¶é—´,<code>è¦å—é”ä½è¦å˜›æŠ¥é”™</code></li>
</ul>
<p><strong>äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„MVCCå‘¢?</strong></p>
<ul>
<li>æ¯ä¸ªäº‹åŠ¡éƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡ID,å«åš<code>transaction id</code>(ä¸¥æ ¼é€’å¢)</li>
<li>äº‹åŠ¡åœ¨å¯åŠ¨æ—¶,æ‰¾åˆ°å·²æäº¤çš„æœ€å¤§äº‹åŠ¡IDè®°ä¸ºup_limit_idã€‚</li>
<li>äº‹åŠ¡åœ¨æ›´æ–°ä¸€æ¡è¯­å¥æ—¶,æ¯”å¦‚id=1æ”¹ä¸ºäº†id=2.ä¼šæŠŠid=1å’Œè¯¥è¡Œä¹‹å‰çš„<code>row trx_id</code>å†™åˆ°<code>undo log</code>é‡Œã€‚å¹¶ä¸”åœ¨æ•°æ®é¡µä¸ŠæŠŠidçš„å€¼æ”¹ä¸º2,å¹¶ä¸”æŠŠä¿®æ”¹è¿™æ¡è¯­å¥çš„<code>transaction id</code>è®°åœ¨è¯¥è¡Œè¡Œå¤´ã€‚</li>
<li>å†å®šä¸€ä¸ªè§„çŸ©,ä¸€ä¸ªäº‹åŠ¡è¦æŸ¥çœ‹ä¸€æ¡æ•°æ®æ—¶,å¿…é¡»å…ˆç”¨è¯¥äº‹åŠ¡çš„<code>up_limit_id</code>ä¸è¯¥è¡Œçš„<code>transaction id</code>åšæ¯”å¯¹</li>
<li>å¦‚æœ<code>up_limit_id&gt;=transaction id</code>,é‚£ä¹ˆå¯ä»¥çœ‹.å¦‚æœ<code>up_limit_id&lt;transaction id</code>,åˆ™åªèƒ½å»<code>undo log</code>é‡Œå»å–ã€‚å»undo logæŸ¥æ‰¾æ•°æ®çš„æ—¶å€™,ä¹Ÿéœ€è¦åšæ¯”å¯¹,å¿…é¡»<code>up_limit_id&gt;transaction id</code>,æ‰è¿”å›æ•°æ®</li>
</ul>
<p><strong>ä»€ä¹ˆæ˜¯å½“å‰è¯»,</strong></p>
<ul>
<li>ç”±äºå½“å‰è¯»éƒ½æ˜¯å…ˆè¯»åå†™,åªèƒ½è¯»å½“å‰çš„å€¼,æ‰€ä»¥è®¤ä¸ºå½“å‰è¯».ä¼šæ›´æ–°äº‹åŠ¡å†…çš„up_limit_idä¸ºè¯¥äº‹åŠ¡çš„transaction id</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆ</strong><code>**RR**</code><strong>èƒ½å®ç°å¯é‡å¤è¯»è€Œ</strong><code>**RC**</code><strong>ä¸èƒ½,åˆ†ä¸¤ç§æƒ…å†µ</strong></p>
<ul>
<li>å¿«ç…§è¯»çš„æƒ…å†µä¸‹,rr(å¯é‡å¤è¯»)ä¸èƒ½æ›´æ–°äº‹åŠ¡å†…çš„up_limit_id,è€Œ<code>rc(è¯»æäº¤)</code>æ¯æ¬¡ä¼šæŠŠ<code>up_limit_id</code>æ›´æ–°ä¸ºå¿«ç…§è¯»ä¹‹å‰æœ€æ–°å·²æäº¤äº‹åŠ¡çš„<code>transaction id</code>,åˆ™<code>rc(è¯»æäº¤)</code>ä¸èƒ½å¯é‡å¤è¯»</li>
<li>å½“å‰è¯»çš„æƒ…å†µä¸‹,<code>rr(å¯é‡å¤è¯»)</code>æ˜¯åˆ©ç”¨<code>record lock+gap lock</code>æ¥å®ç°çš„,è€Œ<code>rc(è¯»æäº¤)</code>æ²¡æœ‰gap,æ‰€ä»¥rcä¸èƒ½å¯é‡å¤è¯»</li>
</ul>
<h3 id="MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•"><a href="#MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•" class="headerlink" title="MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•"></a>MySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•</h3><ul>
<li>åœ¨MySQLä¸­ä¸€å¼ è¡¨å…¶å®æ˜¯å¯ä»¥æ”¯æŒå¤šä¸ªç´¢å¼•çš„ã€‚ä½†æ˜¯ï¼Œä½ å†™SQLè¯­å¥çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰ä¸»åŠ¨æŒ‡å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨å“ªä¸ªç´¢å¼•æ˜¯ç”±MySQLæ¥ç¡®å®šçš„ã€‚æ‰€ä»¥æœ‰æ—¶å€™ç”±äºMySQLé€‰é”™äº†ç´¢å¼•ï¼Œè€Œå¯¼è‡´æ‰§è¡Œé€Ÿåº¦å˜å¾—å¾ˆæ…¢</li>
</ul>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `a` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `b` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `a` (`a`),</span><br><span class="line">  KEY `b` (`b`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDBï¼›</span><br></pre></td></tr></table></figure>


<p>ç„¶åï¼Œæˆ‘ä»¬å¾€è¡¨tä¸­æ’å…¥10ä¸‡è¡Œè®°å½•ï¼Œå–å€¼æŒ‰æ•´æ•°é€’å¢ï¼Œå³ï¼š(1,1,1)ï¼Œ(2,2,2)ï¼Œ(3,3,3) ç›´åˆ°(100000,100000,100000)ã€‚</p>
<p>åˆ†æä¸€æ¡SQLè¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> a <span class="keyword">between</span> <span class="number">10000</span> <span class="keyword">and</span> <span class="number">20000</span>;</span><br></pre></td></tr></table></figure>


<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œaä¸Šæœ‰ç´¢å¼•ï¼Œè‚¯å®šæ˜¯è¦ä½¿ç”¨ç´¢å¼•açš„ã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/20190414141306715.png#id=OG5aI&originHeight=97&originWidth=1077&originalType=binary&ratio=1&status=done&style=none"><br>ä½†æ˜¯ç‰¹è®¸æƒ…å†µä¸‹å¦‚æœåŒæ—¶æœ‰ä¸¤ä¸ªä»¥ä¸‹ä¸‹æ“ä½œæ‰§è¡Œï¼š</p>
<ul>
<li>å¦‚æœä¸€ä¸ªAè¯·æ±‚é¦–å…ˆå¼€å¯äº†äº‹ç‰©ï¼Œéšåï¼ŒBè¯·æ±‚æŠŠæ•°æ®éƒ½åˆ é™¤åï¼Œåˆæ’å…¥äº†10ä¸‡è¡Œæ•°æ®ã€‚</li>
<li>è¿™æ—¶å€™ï¼Œ Bæ“ä½œçš„æŸ¥è¯¢è¯­å¥<code>select * from t where a between 10000 and 20000</code>å°±ä¸ä¼šå†é€‰æ‹©ç´¢å¼•aäº†ï¼Œä¼šæ‰§è¡Œå…¨è¡¨æ‰«æï¼Œæ‰§è¡Œæ—¶é—´ä¼šæ¯”ä¹‹å‰æ…¢å¾ˆå¤šã€‚<code>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·æƒ…å†µï¼Ÿ</code>å› ä¸ºé€‰æ‹©ç´¢å¼•æ˜¯ä¼˜åŒ–å™¨çš„å·¥ä½œï¼Œè€Œä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•çš„ç›®çš„ï¼Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆï¼Œå¹¶ç”¨æœ€å°çš„ä»£ä»·å»æ‰§è¡Œè¯­å¥ã€‚</li>
<li>MySQLåœ¨çœŸæ­£å¼€å§‹æ‰§è¡Œè¯­å¥ä¹‹å‰ï¼Œå¹¶ä¸èƒ½ç²¾ç¡®åœ°çŸ¥é“æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„è®°å½•æœ‰å¤šå°‘æ¡ï¼Œè€Œåªèƒ½æ ¹æ®ç»Ÿè®¡ä¿¡æ¯æ¥ä¼°ç®—è®°å½•æ•°ã€‚è¿™ä¸ªç»Ÿè®¡ä¿¡æ¯å°±æ˜¯ç´¢å¼•çš„â€œ<code>åŒºåˆ†åº¦</code>â€ã€‚ä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼è¶Šå¤šï¼Œè¿™ä¸ªç´¢å¼•çš„åŒºåˆ†åº¦å°±è¶Šå¥½ã€‚è€Œä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼çš„ä¸ªæ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<code>â€œåŸºæ•°â€</code>ï¼ˆcardinalityï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªåŸºæ•°è¶Šå¤§ï¼Œç´¢å¼•çš„åŒºåˆ†åº¦è¶Šå¥½ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨<code>show index table</code>æ–¹æ³•ï¼Œçœ‹åˆ°ä¸€ä¸ªç´¢å¼•çš„åŸºæ•°</li>
<li>MySQLæ˜¯æ€æ ·å¾—åˆ°ç´¢å¼•çš„åŸºæ•°çš„å‘¢ï¼ŸMySQLé€šè¿‡é‡‡æ ·ç»Ÿè®¡çš„æ–¹æ³•å¾—åˆ°åŸºæ•°</li>
<li>å¦‚æœä½¿ç”¨ç´¢å¼•aï¼Œæ¯æ¬¡ä»ç´¢å¼•aä¸Šæ‹¿åˆ°ä¸€ä¸ªå€¼ï¼Œéƒ½è¦å›åˆ°ä¸»é”®ç´¢å¼•ä¸ŠæŸ¥å‡ºæ•´è¡Œæ•°æ®ï¼Œè¿™ä¸ªä»£ä»·ä¼˜åŒ–å™¨ä¹Ÿè¦ç®—è¿›å»çš„ã€‚è€Œå¦‚æœé€‰æ‹©æ‰«æ10ä¸‡è¡Œï¼Œæ˜¯ç›´æ¥åœ¨ä¸»é”®ç´¢å¼•ä¸Šæ‰«æçš„ï¼Œæ²¡æœ‰é¢å¤–çš„ä»£ä»·ã€‚ä¼˜åŒ–å™¨ä¼šä¼°ç®—è¿™ä¸¤ä¸ªé€‰æ‹©çš„ä»£ä»·ï¼Œä»ç»“æœçœ‹æ¥ï¼Œä¼˜åŒ–å™¨è®¤ä¸ºç›´æ¥æ‰«æä¸»é”®ç´¢å¼•æ›´å¿«ã€‚å½“ç„¶ï¼Œä»æ‰§è¡Œæ—¶é—´çœ‹æ¥ï¼Œè¿™ä¸ªé€‰æ‹©å¹¶ä¸æ˜¯æœ€ä¼˜çš„ã€‚</li>
<li><code>analyze table t</code> å‘½ä»¤å¯ä»¥ç”¨æ¥é‡æ–°ç»Ÿè®¡ç´¢å¼•ä¿¡æ¯</li>
<li>é‡‡ç”¨<code>force index</code>å¼ºè¡Œé€‰æ‹©ä¸€ä¸ªç´¢å¼•ã€‚å¦‚æœforce indexæŒ‡å®šçš„ç´¢å¼•åœ¨å€™é€‰ç´¢å¼•åˆ—è¡¨ä¸­ï¼Œå°±ç›´æ¥é€‰æ‹©è¿™ä¸ªç´¢å¼•ï¼Œä¸å†è¯„ä¼°å…¶ä»–ç´¢å¼•çš„æ‰§è¡Œä»£ä»·ã€‚</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190414141504344.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=LVEvh&originHeight=321&originWidth=921&originalType=binary&ratio=1&status=done&style=none"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> long_query_time<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> a <span class="keyword">between</span> <span class="number">10000</span> <span class="keyword">and</span> <span class="number">20000</span>; <span class="comment">/*Q1*/</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t force index(a) <span class="keyword">where</span> a <span class="keyword">between</span> <span class="number">10000</span> <span class="keyword">and</span> <span class="number">20000</span>;<span class="comment">/*Q2*/</span></span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€å¥ï¼Œæ˜¯å°†æ…¢æŸ¥è¯¢æ—¥å¿—çš„é˜ˆå€¼è®¾ç½®ä¸º<span class="number">0</span>ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿ç¨‹æ¥ä¸‹æ¥çš„è¯­å¥éƒ½ä¼šè¢«è®°å½•å…¥æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼›</span><br><span class="line">ç¬¬äºŒå¥ï¼ŒQ1æ˜¯session BåŸæ¥çš„æŸ¥è¯¢ï¼›</span><br><span class="line">ç¬¬ä¸‰å¥ï¼ŒQ2æ˜¯åŠ äº†force index(a)æ¥å’Œsession BåŸæ¥çš„æŸ¥è¯¢è¯­å¥æ‰§è¡Œæƒ…å†µå¯¹æ¯”ã€‚</span><br></pre></td></tr></table></figure>


<ul>
<li>delete è¯­å¥åˆ æ‰äº†æ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åå†é€šè¿‡call idata()æ’å…¥äº†10ä¸‡è¡Œæ•°æ®ï¼Œçœ‹ä¸Šå»æ˜¯è¦†ç›–äº†åŸæ¥çš„10ä¸‡è¡Œã€‚</li>
<li>ä½†æ˜¯ï¼Œsession Aå¼€å¯äº†äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥ä¹‹å‰æ’å…¥çš„10ä¸‡è¡Œæ•°æ®æ˜¯ä¸èƒ½åˆ é™¤çš„ã€‚è¿™æ ·ï¼Œä¹‹å‰çš„æ•°æ®æ¯ä¸€è¡Œæ•°æ®éƒ½æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ—§ç‰ˆæœ¬æ˜¯deleteä¹‹å‰çš„æ•°æ®ï¼Œæ–°ç‰ˆæœ¬æ˜¯æ ‡è®°ä¸ºdeletedçš„æ•°æ®ã€‚è¿™æ ·ï¼Œç´¢å¼•aä¸Šçš„æ•°æ®å…¶å®å°±æœ‰ä¸¤ä»½</li>
</ul>
<h3 id="æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•"><a href="#æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•" class="headerlink" title="æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•"></a>æ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•</h3><ul>
<li>å‡è®¾ï¼Œä½ ç°åœ¨ç»´æŠ¤ä¸€ä¸ªæ”¯æŒé‚®ç®±ç™»å½•çš„ç³»ç»Ÿï¼Œç”¨æˆ·è¡¨æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> SUser(</span><br><span class="line">ID <span class="type">bigint</span> unsigned <span class="keyword">primary</span> key,</span><br><span class="line">email <span class="type">varchar</span>(<span class="number">64</span>), </span><br><span class="line">... </span><br><span class="line">)engine<span class="operator">=</span>innodb;</span><br></pre></td></tr></table></figure>


<p>ç”±äºè¦ä½¿ç”¨é‚®ç®±ç™»å½•ï¼Œæ‰€ä»¥ä¸šåŠ¡ä»£ç ä¸­ä¸€å®šä¼šå‡ºç°ç±»ä¼¼äºè¿™æ ·çš„è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> f1, f2 <span class="keyword">from</span> SUser <span class="keyword">where</span> email<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>;</span><br></pre></td></tr></table></figure>


<ul>
<li>å¦‚æœemailè¿™ä¸ªå­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯­å¥å°±åªèƒ½åšå…¨è¡¨æ‰«æã€‚åŒæ—¶ï¼ŒMySQLæ˜¯æ”¯æŒå‰ç¼€ç´¢å¼•çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥å®šä¹‰å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ä½œä¸ºç´¢å¼•ã€‚é»˜è®¤åœ°ï¼Œå¦‚æœä½ åˆ›å»ºç´¢å¼•çš„è¯­å¥ä¸æŒ‡å®šå‰ç¼€é•¿åº¦ï¼Œé‚£ä¹ˆç´¢å¼•å°±ä¼šåŒ…å«æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</li>
</ul>
<p>æ¯”å¦‚ï¼Œè¿™ä¸¤ä¸ªåœ¨emailå­—æ®µä¸Šåˆ›å»ºç´¢å¼•çš„è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> SUser <span class="keyword">add</span> index index1(email);</span><br><span class="line">æˆ–</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> SUser <span class="keyword">add</span> index index2(email(<span class="number">6</span>));</span><br></pre></td></tr></table></figure>


<p><img src="https://img-blog.csdnimg.cn/201904142351118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=FFfQd&originHeight=468&originWidth=1000&originalType=binary&ratio=1&status=done&style=none"><br><img src="https://img-blog.csdnimg.cn/20190414235147183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=XF7LV&originHeight=449&originWidth=640&originalType=binary&ratio=1&status=done&style=none"></p>
<ul>
<li>ç¬¬ä¸€ä¸ªè¯­å¥åˆ›å»ºçš„index1ç´¢å¼•é‡Œé¢ï¼ŒåŒ…å«äº†æ¯ä¸ªè®°å½•çš„æ•´ä¸ªå­—ç¬¦ä¸²ï¼›</li>
<li>ç¬¬äºŒä¸ªè¯­å¥åˆ›å»ºçš„index2ç´¢å¼•é‡Œé¢ï¼Œå¯¹äºæ¯ä¸ªè®°å½•éƒ½æ˜¯åªå–å‰6ä¸ªå­—èŠ‚ã€‚ç”±äºemail(6)è¿™ä¸ªç´¢å¼•ç»“æ„ä¸­æ¯ä¸ªé‚®ç®±å­—æ®µéƒ½åªå–å‰6ä¸ªå­—èŠ‚,æ‰€ä»¥å ç”¨çš„ç©ºé—´ä¼šæ›´å°ï¼Œè¿™å°±æ˜¯ä½¿ç”¨å‰ç¼€ç´¢å¼•çš„ä¼˜åŠ¿ã€‚ä½†æ˜¯ å¯èƒ½ä¼šå¢åŠ é¢å¤–çš„è®°å½•æ‰«ææ¬¡æ•°ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨çš„æ˜¯index1çš„æ‰§è¡Œæµç¨‹</strong></p>
<ul>
<li>ä»<code>index1</code>ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯â€™<a href="mailto:&#122;&#104;&#x61;&#x6e;&#103;&#115;&#115;&#x78;&#121;&#x7a;&#x40;&#120;&#120;&#x78;&#46;&#99;&#x6f;&#x6d;">&#122;&#104;&#x61;&#x6e;&#103;&#115;&#115;&#x78;&#121;&#x7a;&#x40;&#120;&#120;&#x78;&#46;&#99;&#x6f;&#x6d;</a>â€™çš„è¿™æ¡è®°å½•ï¼Œå–å¾—ID2çš„å€¼ï¼›</li>
<li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ID2çš„è¡Œï¼Œåˆ¤æ–­emailçš„å€¼æ˜¯æ­£ç¡®çš„ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†ï¼›</li>
<li>å–index1ç´¢å¼•æ ‘ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°å·²ç»ä¸æ»¡è¶³email=â€˜<a href="mailto:&#x7a;&#x68;&#x61;&#x6e;&#103;&#x73;&#115;&#120;&#121;&#x7a;&#64;&#x78;&#120;&#x78;&#46;&#x63;&#111;&#109;">&#x7a;&#x68;&#x61;&#x6e;&#103;&#x73;&#115;&#120;&#121;&#x7a;&#64;&#x78;&#120;&#x78;&#46;&#x63;&#111;&#109;</a>â€™çš„æ¡ä»¶äº†ï¼Œå¾ªç¯ç»“æŸ</li>
<li>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦å›ä¸»é”®ç´¢å¼•å–ä¸€æ¬¡æ•°æ®ï¼Œæ‰€ä»¥ç³»ç»Ÿè®¤ä¸ºåªæ‰«æäº†ä¸€è¡Œã€‚</li>
</ul>
<p><strong>ä½¿ç”¨çš„æ˜¯index2çš„æ‰§è¡Œæµç¨‹</strong></p>
<ul>
<li>ä»<code>index2</code>ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯â€™zhangsâ€™çš„è®°å½•ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ˜¯ID1ï¼›</li>
<li>åˆ°ä¸»é”®ä¸ŠæŸ¥åˆ°ä¸»é”®å€¼æ˜¯ID1çš„è¡Œï¼Œåˆ¤æ–­å‡ºemailçš„å€¼ä¸æ˜¯â€™<a href="mailto:&#122;&#x68;&#97;&#110;&#103;&#115;&#115;&#x78;&#x79;&#122;&#x40;&#120;&#x78;&#120;&#46;&#99;&#x6f;&#109;">&#122;&#x68;&#97;&#110;&#103;&#115;&#115;&#x78;&#x79;&#122;&#x40;&#120;&#x78;&#120;&#46;&#99;&#x6f;&#109;</a>â€™ï¼Œè¿™è¡Œè®°å½•ä¸¢å¼ƒï¼›</li>
<li>å–index2ä¸ŠåˆšåˆšæŸ¥åˆ°çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°ä»ç„¶æ˜¯â€™zhangsâ€™ï¼Œå–å‡ºID2ï¼Œå†åˆ°IDç´¢å¼•ä¸Šå–æ•´è¡Œç„¶ååˆ¤æ–­ï¼Œè¿™æ¬¡å€¼å¯¹äº†ï¼Œå°†è¿™è¡Œè®°å½•åŠ å…¥ç»“æœé›†ï¼›</li>
<li>é‡å¤ä¸Šä¸€æ­¥ï¼Œç›´åˆ°åœ¨idxe2ä¸Šå–åˆ°çš„å€¼ä¸æ˜¯â€™zhangsâ€™æ—¶ï¼Œå¾ªç¯ç»“æŸã€‚</li>
<li>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¦å›ä¸»é”®ç´¢å¼•å–4æ¬¡æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ‰«æäº†4è¡Œã€‚</li>
<li>ä½†æ˜¯ Â å¯¹äºè¿™ä¸ªæŸ¥è¯¢è¯­å¥æ¥è¯´ï¼Œå¦‚æœä½ å®šä¹‰çš„<code>index2</code>ä¸æ˜¯email(6)è€Œæ˜¯email(7ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å–emailå­—æ®µçš„å‰7ä¸ªå­—èŠ‚æ¥æ„å»ºç´¢å¼•çš„è¯ï¼Œå³æ»¡è¶³å‰ç¼€â€™zhangssâ€™çš„è®°å½•åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿèƒ½å¤Ÿç›´æ¥æŸ¥åˆ°ID2ï¼Œåªæ‰«æä¸€è¡Œå°±ç»“æŸäº†ã€‚</li>
<li>ä¹Ÿå°±æ˜¯è¯´<code>ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå®šä¹‰å¥½é•¿åº¦ï¼Œå°±å¯ä»¥åšåˆ°æ—¢èŠ‚çœç©ºé—´ï¼Œåˆä¸ç”¨é¢å¤–å¢åŠ å¤ªå¤šçš„æŸ¥è¯¢æˆæœ¬</code>ã€‚</li>
</ul>
<p><strong>å‰ç¼€ç´¢å¼•å¯¹è¦†ç›–ç´¢å¼•çš„å½±å“</strong></p>
<ul>
<li>ä½¿ç”¨å‰ç¼€ç´¢å¼•å¯èƒ½ä¼šå¢åŠ æ‰«æè¡Œæ•°ï¼Œè¿™ä¼šå½±å“åˆ°æ€§èƒ½ã€‚å…¶å®ï¼Œå‰ç¼€ç´¢å¼•çš„å½±å“ä¸æ­¢å¦‚æ­¤</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#æŸ¥è¯¢<span class="number">1</span> </span><br><span class="line"><span class="keyword">select</span> id,email <span class="keyword">from</span> SUser <span class="keyword">where</span> email<span class="operator">=</span><span class="string">&#x27;zhangssxyz@xxx.com&#x27;</span>;</span><br><span class="line"># æŸ¥è¯¢<span class="number">2</span></span><br><span class="line"><span class="keyword">select</span> id,name,email <span class="keyword">from</span> SUser <span class="keyword">where</span> email<span class="operator">=</span><span class="string">&#x27;zhangssxyz@xxx.com&#x27;</span>;</span><br></pre></td></tr></table></figure>


<ul>
<li>å¦‚æœä½¿ç”¨index1ï¼ˆå³emailæ•´ä¸ªå­—ç¬¦ä¸²çš„ç´¢å¼•ç»“æ„ï¼‰çš„è¯ï¼Œå¯ä»¥åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Œä»index1æŸ¥åˆ°ç»“æœåç›´æ¥å°±è¿”å›äº†ï¼Œä¸éœ€è¦å›åˆ°IDç´¢å¼•å†å»æŸ¥ä¸€æ¬¡ã€‚è€Œå¦‚æœä½¿ç”¨index2ï¼ˆå³email(6)ç´¢å¼•ç»“æ„ï¼‰çš„è¯ï¼Œå°±ä¸å¾—ä¸å›åˆ°IDç´¢å¼•å†å»åˆ¤æ–­emailå­—æ®µçš„å€¼ã€‚</li>
<li>å³ä½¿ä½ å°†index2çš„å®šä¹‰ä¿®æ”¹ä¸ºemail(18)çš„å‰ç¼€ç´¢å¼•ï¼Œè¿™æ—¶å€™è™½ç„¶index2å·²ç»åŒ…å«äº†æ‰€æœ‰çš„ä¿¡æ¯ï¼Œä½†InnoDBè¿˜æ˜¯è¦å›åˆ°idç´¢å¼•å†æŸ¥ä¸€ä¸‹ï¼Œå› ä¸ºç³»ç»Ÿå¹¶ä¸ç¡®å®šå‰ç¼€ç´¢å¼•çš„å®šä¹‰æ˜¯å¦æˆªæ–­äº†å®Œæ•´ä¿¡æ¯ã€‚</li>
<li>ä½¿ç”¨å‰ç¼€ç´¢å¼•å°±ç”¨ä¸ä¸Šè¦†ç›–ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„ä¼˜åŒ–äº†</li>
</ul>
<h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>å¯¹äºç±»ä¼¼äºé‚®ç®±è¿™æ ·çš„å­—æ®µæ¥è¯´ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•çš„æ•ˆæœå¯èƒ½è¿˜ä¸é”™ã€‚ä½†æ˜¯ï¼Œé‡åˆ°å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿå¥½çš„æƒ…å†µæ—¶ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å›½å®¶çš„èº«ä»½è¯å·ï¼Œä¸€å…±18ä½ï¼Œå…¶ä¸­å‰6ä½æ˜¯åœ°å€ç ï¼Œæ‰€ä»¥åŒä¸€ä¸ªå¿çš„äººçš„èº«ä»½è¯å·å‰6ä½ä¸€èˆ¬ä¼šæ˜¯ç›¸åŒçš„ã€‚</p>
<p>å‡è®¾ä½ ç»´æŠ¤çš„æ•°æ®åº“æ˜¯ä¸€ä¸ªå¸‚çš„å…¬æ°‘ä¿¡æ¯ç³»ç»Ÿï¼Œè¿™æ—¶å€™å¦‚æœå¯¹èº«ä»½è¯å·åšé•¿åº¦ä¸º6çš„å‰ç¼€ç´¢å¼•çš„è¯ï¼Œè¿™ä¸ªç´¢å¼•çš„åŒºåˆ†åº¦å°±éå¸¸ä½äº†ã€‚å¯èƒ½ä½ éœ€è¦åˆ›å»ºé•¿åº¦ä¸º12ä»¥ä¸Šçš„å‰ç¼€ç´¢å¼•ï¼Œæ‰èƒ½å¤Ÿæ»¡è¶³åŒºåˆ†åº¦è¦æ±‚ã€‚ä½†æ˜¯ï¼Œ<code>ç´¢å¼•é€‰å–çš„è¶Šé•¿ï¼Œå ç”¨çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤§ï¼Œç›¸åŒçš„æ•°æ®é¡µèƒ½æ”¾ä¸‹çš„ç´¢å¼•å€¼å°±è¶Šå°‘ï¼Œæœç´¢çš„æ•ˆç‡ä¹Ÿå°±ä¼šè¶Šä½</code>ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç¡®å®šä¸šåŠ¡éœ€æ±‚é‡Œé¢åªæœ‰æŒ‰ç…§èº«ä»½è¯è¿›è¡Œç­‰å€¼æŸ¥è¯¢çš„éœ€æ±‚ï¼Œè¿˜æœ‰æ²¡æœ‰åˆ«çš„å¤„ç†æ–¹æ³•å‘¢ï¼Ÿè¿™ç§æ–¹æ³•ï¼Œæ—¢å¯ä»¥å ç”¨æ›´å°çš„ç©ºé—´ï¼Œä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p>ç¬¬ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨<code>å€’åºå­˜å‚¨</code>ã€‚å¦‚æœä½ å­˜å‚¨èº«ä»½è¯å·çš„æ—¶å€™æŠŠå®ƒå€’è¿‡æ¥å­˜ï¼Œæ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™ï¼Œä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> field_list <span class="keyword">from</span> t <span class="keyword">where</span> id_card <span class="operator">=</span> reverse(<span class="string">&#x27;input_id_card_string&#x27;</span>);</span><br></pre></td></tr></table></figure>


<p>ç”±äºèº«ä»½è¯å·çš„æœ€å6ä½æ²¡æœ‰åœ°å€ç è¿™æ ·çš„é‡å¤é€»è¾‘ï¼Œæ‰€ä»¥æœ€åè¿™6ä½å¾ˆå¯èƒ½å°±æä¾›äº†è¶³å¤Ÿçš„åŒºåˆ†åº¦ã€‚</p>
<p>ç¬¬äºŒç§æ–¹å¼æ˜¯<code>ä½¿ç”¨hashå­—æ®µ</code>ã€‚ä½ å¯ä»¥åœ¨è¡¨ä¸Šå†åˆ›å»ºä¸€ä¸ªæ•´æ•°å­—æ®µï¼Œæ¥ä¿å­˜èº«ä»½è¯çš„æ ¡éªŒç ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªå­—æ®µä¸Šåˆ›å»ºç´¢å¼•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> t <span class="keyword">add</span> id_card_crc <span class="type">int</span> unsigned, <span class="keyword">add</span> index(id_card_crc);</span><br></pre></td></tr></table></figure>


<p>ç„¶åæ¯æ¬¡æ’å…¥æ–°è®°å½•çš„æ—¶å€™ï¼Œéƒ½åŒæ—¶ç”¨crc32()è¿™ä¸ªå‡½æ•°å¾—åˆ°æ ¡éªŒç å¡«åˆ°è¿™ä¸ªæ–°å­—æ®µã€‚ç”±äºæ ¡éªŒç å¯èƒ½å­˜åœ¨å†²çªï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªä¸åŒçš„èº«ä»½è¯å·é€šè¿‡crc32()å‡½æ•°å¾—åˆ°çš„ç»“æœå¯èƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ä½ çš„æŸ¥è¯¢è¯­å¥whereéƒ¨åˆ†è¦åˆ¤æ–­id_cardçš„å€¼æ˜¯å¦ç²¾ç¡®ç›¸åŒã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> field_list <span class="keyword">from</span> t <span class="keyword">where</span> id_card_crc<span class="operator">=</span>crc32(<span class="string">&#x27;input_id_card_string&#x27;</span>) <span class="keyword">and</span> id_card<span class="operator">=</span><span class="string">&#x27;input_id_card_string&#x27;</span></span><br></pre></td></tr></table></figure>


<p>è¿™æ ·ï¼Œç´¢å¼•çš„é•¿åº¦å˜æˆäº†4ä¸ªå­—èŠ‚ï¼Œæ¯”åŸæ¥å°äº†å¾ˆå¤šã€‚</p>
<p><strong>ä½¿ç”¨å€’åºå­˜å‚¨å’Œä½¿ç”¨hashå­—æ®µè¿™ä¸¤ç§æ–¹æ³•çš„å¼‚åŒç‚¹</strong></p>
<ul>
<li>é¦–å…ˆï¼Œå®ƒä»¬çš„ç›¸åŒç‚¹æ˜¯ï¼Œéƒ½ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚</li>
<li><code>ä»å ç”¨çš„é¢å¤–ç©ºé—´æ¥çœ‹</code>ï¼Œå€’åºå­˜å‚¨æ–¹å¼åœ¨ä¸»é”®ç´¢å¼•ä¸Šï¼Œä¸ä¼šæ¶ˆè€—é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œhashå­—æ®µæ–¹æ³•éœ€è¦å¢åŠ ä¸€ä¸ªå­—æ®µ</li>
<li><code>åœ¨CPUæ¶ˆè€—æ–¹é¢</code>ï¼Œå€’åºæ–¹å¼æ¯æ¬¡å†™å’Œè¯»çš„æ—¶å€™ï¼Œéƒ½éœ€è¦é¢å¤–è°ƒç”¨ä¸€æ¬¡reverseå‡½æ•°ï¼Œè€Œhashå­—æ®µçš„æ–¹å¼éœ€è¦é¢å¤–è°ƒç”¨ä¸€æ¬¡crc32()å‡½æ•°</li>
<li><code>ä»æŸ¥è¯¢æ•ˆç‡ä¸Šçœ‹</code>ï¼Œä½¿ç”¨hashå­—æ®µæ–¹å¼çš„æŸ¥è¯¢æ€§èƒ½ç›¸å¯¹æ›´ç¨³å®šä¸€äº›ã€‚å› ä¸ºcrc32ç®—å‡ºæ¥çš„å€¼è™½ç„¶æœ‰å†²çªçš„æ¦‚ç‡ï¼Œä½†æ˜¯æ¦‚ç‡éå¸¸å°ï¼Œå¯ä»¥è®¤ä¸ºæ¯æ¬¡æŸ¥è¯¢çš„å¹³å‡æ‰«æè¡Œæ•°æ¥è¿‘1ã€‚è€Œå€’åºå­˜å‚¨æ–¹å¼æ¯•ç«Ÿè¿˜æ˜¯ç”¨çš„å‰ç¼€ç´¢å¼•çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æ˜¯ä¼šå¢åŠ æ‰«æè¡Œæ•°ã€‚</li>
</ul>
<p><strong>å­—ç¬¦ä¸²å­—æ®µåˆ›å»ºç´¢å¼•çš„åœºæ™¯ä½ å¯ä»¥ä½¿ç”¨çš„æ–¹å¼æœ‰ï¼š</strong></p>
<ul>
<li>ç›´æ¥åˆ›å»ºå®Œæ•´ç´¢å¼•ï¼Œè¿™æ ·å¯èƒ½æ¯”è¾ƒå ç”¨ç©ºé—´ï¼›</li>
<li>åˆ›å»ºå‰ç¼€ç´¢å¼•ï¼ŒèŠ‚çœç©ºé—´ï¼Œä½†ä¼šå¢åŠ æŸ¥è¯¢æ‰«ææ¬¡æ•°ï¼Œå¹¶ä¸”ä¸èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼›</li>
<li>å€’åºå­˜å‚¨ï¼Œå†åˆ›å»ºå‰ç¼€ç´¢å¼•ï¼Œç”¨äºç»•è¿‡å­—ç¬¦ä¸²æœ¬èº«å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿçš„é—®é¢˜ï¼›</li>
<li>åˆ›å»ºhashå­—æ®µç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½ç¨³å®šï¼Œæœ‰é¢å¤–çš„å­˜å‚¨å’Œè®¡ç®—æ¶ˆè€—ï¼Œè·Ÿç¬¬ä¸‰ç§æ–¹å¼ä¸€æ ·ï¼Œéƒ½ä¸æ”¯æŒèŒƒå›´æ‰«æã€‚</li>
</ul>
<p><strong>åˆ©ç”¨å­¦å·ä½œä¸ºç™»å½•åç´¢å¼•è®¾è®¡é—®é¢˜ï¼Ÿ</strong></p>
<blockquote>
<p>å¦‚æœä½ åœ¨ç»´æŠ¤ä¸€ä¸ªå­¦æ ¡çš„å­¦ç”Ÿä¿¡æ¯æ•°æ®åº“ï¼Œå­¦ç”Ÿç™»å½•åçš„ç»Ÿä¸€æ ¼å¼æ˜¯â€å­¦å·@gmail.comâ€, è€Œå­¦å·çš„è§„åˆ™æ˜¯ï¼šåäº”ä½çš„æ•°å­—ï¼Œå…¶ä¸­å‰ä¸‰ä½æ˜¯æ‰€åœ¨åŸå¸‚ç¼–å·ã€ç¬¬å››åˆ°ç¬¬å…­ä½æ˜¯å­¦æ ¡ç¼–å·ã€ç¬¬ä¸ƒä½åˆ°ç¬¬åä½æ˜¯å…¥å­¦å¹´ä»½ã€æœ€åäº”ä½æ˜¯é¡ºåºç¼–å·ã€‚<br>ç³»ç»Ÿç™»å½•çš„æ—¶å€™éƒ½éœ€è¦å­¦ç”Ÿè¾“å…¥ç™»å½•åå’Œå¯†ç ï¼ŒéªŒè¯æ­£ç¡®åæ‰èƒ½ç»§ç»­ä½¿ç”¨ç³»ç»Ÿã€‚å°±åªè€ƒè™‘ç™»å½•éªŒè¯è¿™ä¸ªè¡Œä¸ºçš„è¯ï¼Œä½ ä¼šæ€ä¹ˆè®¾è®¡è¿™ä¸ªç™»å½•åçš„ç´¢å¼•å‘¢ï¼Ÿ</p>
</blockquote>
<p><code>**è®¾è®¡æ€è·¯ï¼š**</code></p>
<ul>
<li>ç”±äºè¿™ä¸ªå­¦å·çš„è§„åˆ™ï¼Œæ— è®ºæ˜¯æ­£å‘è¿˜æ˜¯åå‘çš„å‰ç¼€ç´¢å¼•ï¼Œé‡å¤åº¦éƒ½æ¯”è¾ƒé«˜ã€‚å› ä¸ºç»´æŠ¤çš„åªæ˜¯ä¸€ä¸ªå­¦æ ¡çš„ï¼Œå› æ­¤å‰é¢6ä½ï¼ˆå…¶ä¸­ï¼Œå‰ä¸‰ä½æ˜¯æ‰€åœ¨åŸå¸‚ç¼–å·ã€ç¬¬å››åˆ°ç¬¬å…­ä½æ˜¯å­¦æ ¡ç¼–å·ï¼‰å…¶å®æ˜¯å›ºå®šçš„ï¼Œé‚®ç®±åç¼€éƒ½æ˜¯@gamil.comï¼Œå› æ­¤å¯ä»¥åªå­˜å…¥å­¦å¹´ä»½åŠ é¡ºåºç¼–å·ï¼Œå®ƒä»¬çš„é•¿åº¦æ˜¯9ä½ã€‚</li>
<li>è€Œå…¶å®åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯ä»¥ç”¨æ•°å­—ç±»å‹æ¥å­˜è¿™9ä½æ•°å­—ã€‚æ¯”å¦‚201100001ï¼Œè¿™æ ·åªéœ€è¦å 4ä¸ªå­—èŠ‚ã€‚å…¶å®è¿™ä¸ªå°±æ˜¯ä¸€ç§hashï¼Œåªæ˜¯å®ƒç”¨äº†æœ€ç®€å•çš„è½¬æ¢è§„åˆ™ï¼šå­—ç¬¦ä¸²è½¬æ•°å­—çš„è§„åˆ™ï¼Œè€Œåˆšå¥½æˆ‘ä»¬è®¾å®šçš„è¿™ä¸ªèƒŒæ™¯ï¼Œå¯ä»¥ä¿è¯è¿™ä¸ªè½¬æ¢åç»“æœçš„å”¯ä¸€æ€§ã€‚</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆæˆ‘çš„MySQLä¼šâ€œæŠ–â€ä¸€ä¸‹"><a href="#ä¸ºä»€ä¹ˆæˆ‘çš„MySQLä¼šâ€œæŠ–â€ä¸€ä¸‹" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘çš„MySQLä¼šâ€œæŠ–â€ä¸€ä¸‹"></a>ä¸ºä»€ä¹ˆæˆ‘çš„MySQLä¼šâ€œæŠ–â€ä¸€ä¸‹</h3><ul>
<li>ä¸€æ¡SQLè¯­å¥ï¼Œæ­£å¸¸æ‰§è¡Œçš„æ—¶å€™ç‰¹åˆ«å¿«ï¼Œä½†æ˜¯æœ‰æ—¶ä¹Ÿä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œå®ƒå°±ä¼šå˜å¾—ç‰¹åˆ«æ…¢ï¼Œå¹¶ä¸”è¿™æ ·çš„åœºæ™¯å¾ˆéš¾å¤ç°ï¼Œå®ƒä¸åªéšæœºï¼Œè€Œä¸”æŒç»­æ—¶é—´è¿˜å¾ˆçŸ­ã€‚çœ‹ä¸Šå»ï¼Œè¿™å°±åƒæ˜¯æ•°æ®åº“â€œæŠ–â€äº†ä¸€ä¸‹</li>
<li>åœ¨MySQLé‡Œï¼Œå¦‚æœæ¯ä¸€æ¬¡çš„æ›´æ–°æ“ä½œéƒ½éœ€è¦å†™è¿›ç£ç›˜ï¼Œç„¶åç£ç›˜ä¹Ÿè¦æ‰¾åˆ°å¯¹åº”çš„é‚£æ¡è®°å½•ï¼Œç„¶åå†æ›´æ–°ï¼Œæ•´ä¸ªè¿‡ç¨‹IOæˆæœ¬ã€æŸ¥æ‰¾æˆæœ¬éƒ½å¾ˆé«˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMySQLçš„è®¾è®¡è€…ä½¿ç”¨äº†<code>WALæŠ€æœ¯</code>ï¼ŒWALçš„å…¨ç§°æ˜¯Write-Ahead Loggingï¼Œå®ƒçš„å…³é”®ç‚¹å°±æ˜¯<code>å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜</code>ã€‚</li>
<li>åˆ©ç”¨WALæŠ€æœ¯ï¼Œæ•°æ®åº“å°†éšæœºå†™è½¬æ¢æˆäº†é¡ºåºå†™ï¼Œå¤§å¤§æå‡äº†æ•°æ®åº“çš„æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œç”±æ­¤ä¹Ÿå¸¦æ¥äº†å†…å­˜è„é¡µçš„é—®é¢˜ã€‚è„é¡µä¼šè¢«åå°çº¿ç¨‹è‡ªåŠ¨flushï¼Œä¹Ÿä¼šç”±äºæ•°æ®é¡µæ·˜æ±°è€Œè§¦å‘flushï¼Œè€Œåˆ·è„é¡µçš„è¿‡ç¨‹ç”±äºä¼šå ç”¨èµ„æºï¼Œå¯èƒ½ä¼šè®©ä½ çš„æ›´æ–°å’ŒæŸ¥è¯¢è¯­å¥çš„å“åº”æ—¶é—´é•¿ä¸€äº›</li>
<li>å½“å†…å­˜æ•°æ®é¡µè·Ÿç£ç›˜æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå†…å­˜é¡µä¸ºâ€œè„é¡µâ€ã€‚å†…å­˜æ•°æ®å†™å…¥åˆ°ç£ç›˜åï¼Œå†…å­˜å’Œç£ç›˜ä¸Šçš„æ•°æ®é¡µçš„å†…å®¹å°±ä¸€è‡´äº†ï¼Œç§°ä¸ºâ€œå¹²å‡€é¡µâ€ã€‚</li>
<li>å¹³æ—¶æ‰§è¡Œå¾ˆå¿«çš„æ›´æ–°æ“ä½œï¼Œå…¶å®å°±æ˜¯åœ¨å†™å†…å­˜å’Œæ—¥å¿—ï¼Œè€ŒMySQLå¶å°”â€œæŠ–â€ä¸€ä¸‹çš„é‚£ä¸ªç¬é—´ï¼Œå¯èƒ½å°±æ˜¯åœ¨åˆ·è„é¡µï¼ˆ<code>flush</code>ï¼‰ã€‚</li>
</ul>
<p><strong>ä»€ä¹ˆæƒ…å†µä¼šå¼•å‘æ•°æ®åº“çš„flushè¿‡ç¨‹å‘¢ï¼Ÿ</strong></p>
<ul>
<li><code>InnoDB</code>åœ¨å¤„ç†æ›´æ–°è¯­å¥çš„æ—¶å€™ï¼Œåªåšäº†å†™æ—¥å¿—è¿™ä¸€ä¸ªç£ç›˜æ“ä½œã€‚è¿™ä¸ªæ—¥å¿—å«ä½œredo logï¼ˆé‡åšæ—¥å¿—ï¼‰ã€‚åœ¨æ›´æ–°å†…å­˜å†™å®Œ<code>redo log</code>åï¼Œå°±è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæœ¬æ¬¡æ›´æ–°æˆåŠŸã€‚</li>
<li><code>InnoDB</code>çš„<code>redo log</code>(é‡åšæ—¥å¿—)å†™æ»¡äº†ã€‚è¿™æ—¶å€™ç³»ç»Ÿä¼šåœæ­¢æ‰€æœ‰æ›´æ–°æ“ä½œï¼ŒæŠŠ<code>checkpoint(æ£€æŸ¥ç‚¹)</code>å¾€å‰æ¨è¿›ï¼Œ<code>redo log</code>ç•™å‡ºç©ºé—´å¯ä»¥ç»§ç»­å†™</li>
<li>ç¬¬äºŒç§åœºæ™¯æ˜¯ï¼šå¯¹åº”çš„å°±æ˜¯ç³»ç»Ÿå†…å­˜ä¸è¶³ã€‚å½“éœ€è¦æ–°çš„å†…å­˜é¡µï¼Œè€Œå†…å­˜ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå°±è¦æ·˜æ±°ä¸€äº›æ•°æ®é¡µï¼Œç©ºå‡ºå†…å­˜ç»™åˆ«çš„æ•°æ®é¡µä½¿ç”¨ã€‚å¦‚æœæ·˜æ±°çš„æ˜¯â€œè„é¡µâ€ï¼Œå°±è¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜ã€‚</li>
<li>ç¬¬ä¸‰ç§åœºæ™¯å°±æ˜¯<code>MySQL</code>è®¤ä¸ºç³»ç»Ÿ<code>â€œç©ºé—²â€</code>çš„æ—¶å€™ã€‚ä¹Ÿè¦è§ç¼æ’é’ˆåœ°æ‰¾æ—¶é—´ï¼Œåªè¦æœ‰æœºä¼šå°±åˆ·ä¸€ç‚¹<code>â€œè„é¡µâ€</code></li>
<li>ç¬¬å››ç§åœºæ™¯å°±æ˜¯<code>MySQLæ­£å¸¸å…³é—­çš„æƒ…å†µ</code>ã€‚è¿™æ—¶å€™ï¼ŒMySQLä¼šæŠŠå†…å­˜çš„è„é¡µéƒ½flushåˆ°ç£ç›˜ä¸Šï¼Œè¿™æ ·ä¸‹æ¬¡MySQLå¯åŠ¨çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥ä»ç£ç›˜ä¸Šè¯»æ•°æ®ï¼Œå¯åŠ¨é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚</li>
</ul>
<p><strong>åˆ†æä¸€ä¸‹ä¸Šé¢å››ç§åœºæ™¯å¯¹æ€§èƒ½çš„å½±å“</strong></p>
<ul>
<li><code>ç¬¬ä¸€ç§æ˜¯â€œredo logå†™æ»¡äº†ï¼Œè¦flushè„é¡µâ€</code>ï¼Œè¿™ç§æƒ…å†µæ˜¯InnoDBè¦å°½é‡é¿å…çš„ã€‚å› ä¸ºå‡ºç°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¸èƒ½å†æ¥å—æ›´æ–°äº†ï¼Œæ‰€æœ‰çš„æ›´æ–°éƒ½å¿…é¡»å µä½ã€‚å¦‚æœä½ ä»ç›‘æ§ä¸Šçœ‹ï¼Œè¿™æ—¶å€™æ›´æ–°æ•°ä¼šè·Œä¸º0ã€‚</li>
<li><code>ç¬¬äºŒç§æ˜¯â€œå†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œè¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜â€</code>ï¼Œè¿™ç§æƒ…å†µå…¶å®æ˜¯å¸¸æ€ã€‚InnoDBç”¨ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ç®¡ç†å†…å­˜ï¼Œç¼“å†²æ± ä¸­çš„å†…å­˜é¡µæœ‰ä¸‰ç§çŠ¶æ€ï¼šç¬¬ä¸€ç§æ˜¯ï¼Œè¿˜æ²¡æœ‰ä½¿ç”¨çš„ï¼›ç¬¬äºŒç§æ˜¯ï¼Œä½¿ç”¨äº†å¹¶ä¸”æ˜¯å¹²å‡€é¡µï¼›ç¬¬ä¸‰ç§æ˜¯ï¼Œä½¿ç”¨äº†å¹¶ä¸”æ˜¯è„é¡µã€‚InnoDBçš„ç­–ç•¥æ˜¯å°½é‡ä½¿ç”¨å†…å­˜ï¼Œå› æ­¤å¯¹äºä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„åº“æ¥è¯´ï¼Œæœªè¢«ä½¿ç”¨çš„é¡µé¢å¾ˆå°‘ã€‚</li>
<li>è€Œå½“è¦è¯»å…¥çš„æ•°æ®é¡µæ²¡æœ‰åœ¨å†…å­˜çš„æ—¶å€™ï¼Œå°±å¿…é¡»åˆ°ç¼“å†²æ± ä¸­ç”³è¯·ä¸€ä¸ªæ•°æ®é¡µã€‚è¿™æ—¶å€™åªèƒ½æŠŠæœ€ä¹…ä¸ä½¿ç”¨çš„æ•°æ®é¡µä»å†…å­˜ä¸­æ·˜æ±°æ‰ï¼šå¦‚æœè¦æ·˜æ±°çš„æ˜¯ä¸€ä¸ªå¹²å‡€é¡µï¼Œå°±ç›´æ¥é‡Šæ”¾å‡ºæ¥å¤ç”¨ï¼›ä½†å¦‚æœæ˜¯è„é¡µå‘¢ï¼Œå°±å¿…é¡»å°†è„é¡µå…ˆåˆ·åˆ°ç£ç›˜ï¼Œå˜æˆå¹²å‡€é¡µåæ‰èƒ½å¤ç”¨ã€‚</li>
<li>æ‰€ä»¥ï¼Œåˆ·è„é¡µè™½ç„¶æ˜¯å¸¸æ€ï¼Œä½†æ˜¯å‡ºç°ä»¥ä¸‹è¿™ä¸¤ç§æƒ…å†µï¼Œéƒ½æ˜¯ä¼šæ˜æ˜¾å½±å“æ€§èƒ½çš„ï¼šä¸€ä¸ªæŸ¥è¯¢è¦æ·˜æ±°çš„è„é¡µä¸ªæ•°å¤ªå¤šï¼Œä¼šå¯¼è‡´æŸ¥è¯¢çš„å“åº”æ—¶é—´æ˜æ˜¾å˜é•¿ï¼›æ—¥å¿—å†™æ»¡ï¼Œæ›´æ–°å…¨éƒ¨å µä½ï¼Œå†™æ€§èƒ½è·Œä¸º0ï¼Œè¿™ç§æƒ…å†µå¯¹æ•æ„Ÿä¸šåŠ¡æ¥è¯´ï¼Œæ˜¯ä¸èƒ½æ¥å—çš„ã€‚</li>
</ul>
<p><strong>InnoDBåˆ·è„é¡µçš„æ§åˆ¶ç­–ç•¥</strong></p>
<ul>
<li>é¦–å…ˆï¼Œä½ è¦æ­£ç¡®åœ°å‘Šè¯‰<code>InnoDB</code>æ‰€åœ¨ä¸»æœºçš„<code>IOèƒ½åŠ›</code>ï¼Œè¿™æ ·<code>InnoDB</code>æ‰èƒ½çŸ¥é“éœ€è¦å…¨åŠ›åˆ·è„é¡µçš„æ—¶å€™ï¼Œå¯ä»¥åˆ·å¤šå¿«ã€‚è¿™å°±è¦ç”¨åˆ°<code>innodb_io_capacity</code>è¿™ä¸ªå‚æ•°äº†ï¼Œå®ƒä¼šå‘Šè¯‰<code>InnoDB</code>ä½ çš„ç£ç›˜èƒ½åŠ›ã€‚è¿™ä¸ªå€¼æˆ‘å»ºè®®ä½ è®¾ç½®æˆ<code>ç£ç›˜çš„IOPS</code>ã€‚</li>
<li>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼š<code>MySQLçš„å†™å…¥é€Ÿåº¦å¾ˆæ…¢ï¼ŒTPSå¾ˆä½</code>ï¼Œä½†æ˜¯æ•°æ®åº“ä¸»æœºçš„<code>IOå‹åŠ›å¹¶ä¸å¤§</code>ã€‚ä¸»æœºç£ç›˜ç”¨çš„æ˜¯SSDï¼Œä½†æ˜¯<code>innodb_io_capacity</code>çš„å€¼è®¾ç½®çš„æ˜¯<code>300</code>ã€‚äºæ˜¯ï¼ŒInnoDBè®¤ä¸ºè¿™ä¸ªç³»ç»Ÿçš„èƒ½åŠ›å°±è¿™ä¹ˆå·®ï¼Œæ‰€ä»¥åˆ·è„é¡µåˆ·å¾—ç‰¹åˆ«æ…¢ï¼Œç”šè‡³æ¯”è„é¡µç”Ÿæˆçš„é€Ÿåº¦è¿˜æ…¢ï¼Œè¿™æ ·å°±é€ æˆäº†è„é¡µç´¯ç§¯ï¼Œå½±å“äº†æŸ¥è¯¢å’Œæ›´æ–°æ€§èƒ½ã€‚</li>
<li><code>InnoDB</code>çš„åˆ·ç›˜é€Ÿåº¦å°±æ˜¯è¦å‚è€ƒè¿™ä¸¤ä¸ªå› ç´ ï¼šä¸€ä¸ªæ˜¯<code>è„é¡µæ¯”ä¾‹</code>ï¼Œä¸€ä¸ªæ˜¯<code>redo logå†™ç›˜é€Ÿåº¦</code>ã€‚</li>
<li>å‚æ•°<code>innodb_max_dirty_pages_pct</code>æ˜¯<code>è„é¡µæ¯”ä¾‹ä¸Šé™</code>ï¼Œé»˜è®¤å€¼æ˜¯<code>75%</code>ã€‚InnoDBä¼šæ ¹æ®å½“å‰çš„è„é¡µæ¯”ä¾‹ï¼ˆå‡è®¾ä¸ºMï¼‰ï¼Œç®—å‡ºä¸€ä¸ªèŒƒå›´åœ¨0åˆ°100ä¹‹é—´çš„æ•°å­—ã€‚<code>InnoDB</code>æ¯æ¬¡å†™å…¥çš„æ—¥å¿—<code>éƒ½æœ‰ä¸€ä¸ªåºå·</code>ï¼Œå½“å‰å†™å…¥çš„åºå·è·Ÿ<code>checkpoint</code>å¯¹åº”çš„åºå·ä¹‹é—´çš„å·®å€¼ã€‚æˆ‘ä»¬å‡è®¾ä¸ºNã€‚InnoDBä¼šæ ¹æ®è¿™ä¸ªNç®—å‡ºä¸€ä¸ªèŒƒå›´åœ¨0åˆ°100ä¹‹é—´çš„æ•°å­—ï¼Œè¿™ä¸ªè®¡ç®—å…¬å¼å¯ä»¥è®°ä¸ºF2(N)ã€‚F2(N)ç®—æ³•æ¯”è¾ƒå¤æ‚ï¼Œä½ åªè¦çŸ¥é“Nè¶Šå¤§ï¼Œç®—å‡ºæ¥çš„å€¼è¶Šå¤§å°±å¥½äº†ã€‚</li>
<li>ç„¶åï¼Œæ ¹æ®ä¸Šè¿°ç®—å¾—çš„F1(M)å’ŒF2(N)ä¸¤ä¸ªå€¼ï¼Œå–å…¶ä¸­è¾ƒå¤§çš„å€¼è®°ä¸ºRï¼Œä¹‹åå¼•æ“å°±å¯ä»¥æŒ‰ç…§<code>innodb_io_capacity</code>å®šä¹‰çš„èƒ½åŠ›ä¹˜ä»¥<code>R%</code>æ¥æ§åˆ¶åˆ·è„é¡µçš„é€Ÿåº¦ã€‚</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2019041513510966.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=GVQMh&originHeight=1522&originWidth=1142&originalType=binary&ratio=1&status=done&style=none"></p>
<ul>
<li>InnoDBä¼šåœ¨åå°åˆ·è„é¡µï¼Œè€Œåˆ·è„é¡µçš„è¿‡ç¨‹æ˜¯è¦å°†å†…å­˜é¡µå†™å…¥ç£ç›˜ã€‚æ‰€ä»¥ï¼Œæ— è®ºæ˜¯ä½ çš„æŸ¥è¯¢è¯­å¥åœ¨éœ€è¦å†…å­˜çš„æ—¶å€™å¯èƒ½è¦æ±‚æ·˜æ±°ä¸€ä¸ªè„é¡µï¼Œè¿˜æ˜¯ç”±äºåˆ·è„é¡µçš„é€»è¾‘ä¼šå ç”¨IOèµ„æºå¹¶å¯èƒ½å½±å“åˆ°äº†ä½ çš„æ›´æ–°è¯­å¥ï¼Œéƒ½å¯èƒ½æ˜¯é€ æˆä½ ä»ä¸šåŠ¡ç«¯æ„ŸçŸ¥åˆ°MySQLâ€œæŠ–â€äº†ä¸€ä¸‹çš„åŸå› ã€‚</li>
<li>è¦å°½é‡é¿å…è¿™ç§æƒ…å†µï¼Œä½ å°±è¦åˆç†åœ°è®¾ç½®<code>innodb_io_capacityçš„å€¼</code>ï¼Œå¹¶ä¸”å¹³æ—¶è¦å¤šå…³æ³¨è„é¡µæ¯”ä¾‹ï¼Œä¸è¦è®©å®ƒç»å¸¸æ¥è¿‘<code>75%</code>ã€‚</li>
</ul>
<blockquote>
<p>è„é¡µæ¯”ä¾‹æ˜¯é€šè¿‡Innodb_buffer_pool_pages_dirty/Innodb_buffer_pool_pages_totalå¾—åˆ°çš„</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> VARIABLE_VALUE <span class="keyword">into</span> <span class="variable">@a</span> <span class="keyword">from</span> global_status <span class="keyword">where</span> VARIABLE_NAME <span class="operator">=</span> <span class="string">&#x27;Innodb_buffer_pool_pages_dirty&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> VARIABLE_VALUE <span class="keyword">into</span> <span class="variable">@b</span> <span class="keyword">from</span> global_status <span class="keyword">where</span> VARIABLE_NAME <span class="operator">=</span> <span class="string">&#x27;Innodb_buffer_pool_pages_total&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@a</span><span class="operator">/</span><span class="variable">@b</span>;</span><br></pre></td></tr></table></figure>


<ul>
<li>ä¸€æ—¦ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚éœ€è¦åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å…ˆflushæ‰ä¸€ä¸ªè„é¡µæ—¶ï¼Œè¿™ä¸ªæŸ¥è¯¢å°±å¯èƒ½è¦æ¯”å¹³æ—¶æ…¢äº†ã€‚è€ŒMySQLä¸­çš„ä¸€ä¸ªæœºåˆ¶ï¼Œå¯èƒ½è®©ä½ çš„æŸ¥è¯¢ä¼šæ›´æ…¢ï¼šåœ¨å‡†å¤‡åˆ·ä¸€ä¸ªè„é¡µçš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µæ—è¾¹çš„æ•°æ®é¡µåˆšå¥½æ˜¯è„é¡µï¼Œå°±ä¼šæŠŠè¿™ä¸ªâ€œé‚»å±…â€ä¹Ÿå¸¦ç€ä¸€èµ·åˆ·æ‰ï¼›è€Œä¸”è¿™ä¸ªæŠŠâ€œé‚»å±…â€æ‹–ä¸‹æ°´çš„é€»è¾‘è¿˜å¯ä»¥ç»§ç»­è”“å»¶ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæ¯ä¸ªé‚»å±…æ•°æ®é¡µï¼Œå¦‚æœè·Ÿå®ƒç›¸é‚»çš„æ•°æ®é¡µä¹Ÿè¿˜æ˜¯è„é¡µçš„è¯ï¼Œä¹Ÿä¼šè¢«æ”¾åˆ°ä¸€èµ·åˆ·ã€‚</li>
<li>åœ¨InnoDBä¸­ï¼Œ<code>innodb_flush_neighbors</code> å‚æ•°å°±æ˜¯ç”¨æ¥æ§åˆ¶è¿™ä¸ªè¡Œä¸ºçš„ï¼Œ<code>å€¼ä¸º1</code>çš„æ—¶å€™ä¼šæœ‰ä¸Šè¿°çš„<code>â€œè¿åâ€æœºåˆ¶</code>ï¼Œ<code>å€¼ä¸º0æ—¶</code>è¡¨ç¤ºä¸æ‰¾é‚»å±…ï¼Œè‡ªå·±åˆ·è‡ªå·±çš„ã€‚</li>
<li>æ‰¾<code>â€œé‚»å±…â€</code>è¿™ä¸ªä¼˜åŒ–åœ¨<code>æœºæ¢°ç¡¬ç›˜æ—¶ä»£æ˜¯å¾ˆæœ‰æ„ä¹‰</code>çš„ï¼Œå¯ä»¥<code>å‡å°‘å¾ˆå¤šéšæœºIO</code>ã€‚æœºæ¢°ç¡¬ç›˜çš„éšæœº<code>IOPS</code>ä¸€èˆ¬åªæœ‰å‡ ç™¾ï¼Œç›¸åŒçš„é€»è¾‘æ“ä½œå‡å°‘éšæœºIOå°±æ„å‘³ç€ç³»ç»Ÿæ€§èƒ½çš„å¤§å¹…åº¦æå‡ã€‚</li>
<li>è€Œå¦‚æœä½¿ç”¨çš„æ˜¯<code>SSDè¿™ç±»IOPSæ¯”è¾ƒé«˜çš„è®¾å¤‡</code>çš„è¯ï¼Œæˆ‘å°±å»ºè®®ä½ æŠŠ<code>innodb_flush_neighbors</code>çš„å€¼è®¾ç½®æˆ0ã€‚å› ä¸ºè¿™æ—¶å€™<code>IOPS</code>å¾€å¾€ä¸æ˜¯ç“¶é¢ˆï¼Œè€Œ<code>â€œåªåˆ·è‡ªå·±â€</code>ï¼Œå°±èƒ½æ›´å¿«åœ°æ‰§è¡Œå®Œå¿…è¦çš„åˆ·è„é¡µæ“ä½œï¼Œå‡å°‘SQLè¯­å¥å“åº”æ—¶é—´ã€‚</li>
<li>åœ¨MySQL 8.0ä¸­<code>ï¼Œinnodb_flush_neighborså‚æ•°çš„é»˜è®¤å€¼å·²ç»æ˜¯0</code>äº†ã€‚</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜"><a href="#ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜" class="headerlink" title="ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜"></a>ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜</h3><ul>
<li>ä¸€ä¸ªInnoDBè¡¨åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå³ï¼šè¡¨ç»“æ„å®šä¹‰å’Œæ•°æ®ã€‚åœ¨MySQL 8.0ç‰ˆæœ¬ä»¥å‰ï¼Œè¡¨ç»“æ„æ˜¯å­˜åœ¨ä»¥.frmä¸ºåç¼€çš„æ–‡ä»¶é‡Œã€‚</li>
<li>è¡¨æ•°æ®æ—¢å¯ä»¥å­˜åœ¨å…±äº«è¡¨ç©ºé—´é‡Œï¼Œä¹Ÿå¯ä»¥æ˜¯å•ç‹¬çš„æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯ç”±å‚æ•°<code>innodb_file_per_table</code>æ§åˆ¶çš„ï¼Œè®¾ç½®ä¸º<code>OFF</code>è¡¨ç¤ºçš„æ˜¯ï¼Œè¡¨çš„æ•°æ®æ”¾åœ¨<code>ç³»ç»Ÿå…±äº«è¡¨ç©ºé—´</code>ï¼Œä¹Ÿå°±æ˜¯è·Ÿæ•°æ®å­—å…¸æ”¾åœ¨ä¸€èµ·ï¼›è®¾ç½®ä¸º<code>ON</code>è¡¨ç¤ºçš„æ˜¯ï¼Œæ¯ä¸ªInnoDBè¡¨æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªä»¥ <code>.ibd</code>ä¸ºåç¼€çš„æ–‡ä»¶ä¸­ã€‚ä»<code>MySQL 5.6.6</code>ç‰ˆæœ¬å¼€å§‹ï¼Œå®ƒçš„<code>é»˜è®¤å€¼å°±æ˜¯ON</code>äº†</li>
<li>å»ºè®®ä½ ä¸è®ºä½¿ç”¨MySQLçš„å“ªä¸ªç‰ˆæœ¬ï¼Œéƒ½å°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºONã€‚å› ä¸ºï¼Œä¸€ä¸ªè¡¨å•ç‹¬å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡ä»¶æ›´å®¹æ˜“ç®¡ç†ï¼Œè€Œä¸”åœ¨ä½ ä¸éœ€è¦è¿™ä¸ªè¡¨çš„æ—¶å€™ï¼Œé€šè¿‡<code>drop table</code>å‘½ä»¤ï¼Œç³»ç»Ÿå°±ä¼šç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶ã€‚è€Œå¦‚æœæ˜¯æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ï¼Œå³ä½¿è¡¨åˆ æ‰äº†ï¼Œç©ºé—´ä¹Ÿæ˜¯ä¸ä¼šå›æ”¶çš„ã€‚</li>
<li>æˆ‘ä»¬åœ¨åˆ é™¤æ•´ä¸ªè¡¨çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨drop tableå‘½ä»¤å›æ”¶è¡¨ç©ºé—´ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬é‡åˆ°çš„æ›´å¤šçš„åˆ é™¤æ•°æ®çš„åœºæ™¯æ˜¯åˆ é™¤æŸäº›è¡Œï¼Œè¡¨ä¸­çš„æ•°æ®è¢«åˆ é™¤äº†ï¼Œä½†æ˜¯è¡¨ç©ºé—´å´æ²¡æœ‰è¢«å›æ”¶ã€‚</li>
</ul>
<p><strong>æ•°æ®åˆ é™¤æµç¨‹</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20190416104535458.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=roWLU&originHeight=478&originWidth=603&originalType=binary&ratio=1&status=done&style=none"></p>
<ul>
<li>å‡è®¾ï¼Œæˆ‘ä»¬è¦åˆ æ‰R4è¿™ä¸ªè®°å½•ï¼ŒInnoDBå¼•æ“åªä¼šæŠŠR4è¿™ä¸ªè®°å½•æ ‡è®°ä¸ºåˆ é™¤ã€‚å¦‚æœä¹‹åè¦å†æ’å…¥ä¸€ä¸ªIDåœ¨300å’Œ600ä¹‹é—´çš„è®°å½•æ—¶ï¼Œå¯èƒ½ä¼šå¤ç”¨è¿™ä¸ªä½ç½®ã€‚ä½†æ˜¯ï¼Œç£ç›˜æ–‡ä»¶çš„å¤§å°å¹¶ä¸ä¼šç¼©å°ã€‚</li>
<li>InnoDBçš„æ•°æ®æ˜¯æŒ‰é¡µå­˜å‚¨çš„ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬åˆ æ‰äº†ä¸€ä¸ªæ•°æ®é¡µä¸Šçš„æ‰€æœ‰è®°å½•ï¼Œæ•´ä¸ªæ•°æ®é¡µå°±å¯ä»¥è¢«å¤ç”¨äº†ã€‚</li>
<li>ä½†æ˜¯ï¼Œæ•°æ®é¡µçš„å¤ç”¨è·Ÿè®°å½•çš„å¤ç”¨æ˜¯ä¸åŒçš„ã€‚è®°å½•çš„å¤ç”¨ï¼Œåªé™äºç¬¦åˆèŒƒå›´æ¡ä»¶çš„æ•°æ®ï¼Œæ¯”å¦‚R4è¿™æ¡è®°å½•è¢«åˆ é™¤åï¼Œå¦‚æœæ’å…¥ä¸€ä¸ªIDæ˜¯400çš„è¡Œï¼Œå¯ä»¥ç›´æ¥å¤ç”¨è¿™ä¸ªç©ºé—´ã€‚ä½†å¦‚æœæ’å…¥çš„æ˜¯ä¸€ä¸ªIDæ˜¯800çš„è¡Œï¼Œå°±ä¸èƒ½å¤ç”¨è¿™ä¸ªä½ç½®äº†ã€‚</li>
<li>è€Œå½“æ•´ä¸ªé¡µä»B+æ ‘é‡Œé¢æ‘˜æ‰ä»¥åï¼Œå¯ä»¥å¤ç”¨åˆ°ä»»ä½•ä½ç½®ã€‚å¦‚æœç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®é¡µåˆ©ç”¨ç‡éƒ½å¾ˆå°ï¼Œç³»ç»Ÿå°±ä¼šæŠŠè¿™ä¸¤ä¸ªé¡µä¸Šçš„æ•°æ®åˆåˆ°å…¶ä¸­ä¸€ä¸ªé¡µä¸Šï¼Œå¦å¤–ä¸€ä¸ªæ•°æ®é¡µå°±è¢«æ ‡è®°ä¸ºå¯å¤ç”¨ã€‚</li>
<li>æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç”¨deleteå‘½ä»¤æŠŠæ•´ä¸ªè¡¨çš„æ•°æ®åˆ é™¤ï¼Œç»“æœå°±æ˜¯ï¼Œæ‰€æœ‰çš„æ•°æ®é¡µéƒ½ä¼šè¢«æ ‡è®°ä¸ºå¯å¤ç”¨ã€‚ä½†æ˜¯ç£ç›˜ä¸Šï¼Œæ–‡ä»¶ä¸ä¼šå˜å°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡deleteå‘½ä»¤æ˜¯ä¸èƒ½å›æ”¶è¡¨ç©ºé—´çš„ã€‚è¿™äº›å¯ä»¥å¤ç”¨ï¼Œè€Œæ²¡æœ‰è¢«ä½¿ç”¨çš„ç©ºé—´ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯<code>â€œç©ºæ´â€</code>ã€‚</li>
<li>å®é™…ä¸Šï¼Œä¸æ­¢æ˜¯åˆ é™¤æ•°æ®ä¼šé€ æˆç©ºæ´ï¼Œæ’å…¥æ•°æ®ä¹Ÿä¼šã€‚å¦‚æœæ•°æ®æ˜¯æŒ‰ç…§ç´¢å¼•é€’å¢é¡ºåºæ’å…¥çš„ï¼Œé‚£ä¹ˆç´¢å¼•æ˜¯ç´§å‡‘çš„ã€‚ä½†å¦‚æœæ•°æ®æ˜¯éšæœºæ’å…¥çš„ï¼Œå°±å¯èƒ½é€ æˆç´¢å¼•çš„æ•°æ®é¡µåˆ†è£‚ã€‚å¦å¤–ï¼Œæ›´æ–°ç´¢å¼•ä¸Šçš„å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºåˆ é™¤ä¸€ä¸ªæ—§çš„å€¼ï¼Œå†æ’å…¥ä¸€ä¸ªæ–°å€¼ã€‚ä¸éš¾ç†è§£ï¼Œè¿™ä¹Ÿæ˜¯ä¼šé€ æˆç©ºæ´çš„ã€‚</li>
</ul>
<p><strong>é‡å»ºè¡¨</strong></p>
<ul>
<li>é‡å»ºè¡¨å°±æ˜¯æ–°å»ºä¸€ä¸ªä¸è¡¨Aç»“æ„ç›¸åŒçš„è¡¨Bï¼Œç„¶åæŒ‰ç…§ä¸»é”®IDé€’å¢çš„é¡ºåºï¼ŒæŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»è¡¨Aé‡Œè¯»å‡ºæ¥å†æ’å…¥åˆ°è¡¨Bä¸­ã€‚ç”±äºè¡¨Bæ˜¯æ–°å»ºçš„è¡¨ï¼Œæ‰€ä»¥è¡¨Aä¸»é”®ç´¢å¼•ä¸Šçš„ç©ºæ´ï¼Œåœ¨è¡¨Bä¸­å°±éƒ½ä¸å­˜åœ¨äº†ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨<code>alter table A engine=InnoDB</code>å‘½ä»¤æ¥é‡å»ºè¡¨ã€‚MySQL 5.5ä¹‹åä¼šè‡ªåŠ¨å®Œæˆè½¬å­˜æ•°æ®ã€äº¤æ¢è¡¨åã€åˆ é™¤æ—§è¡¨çš„æ“ä½œã€‚</li>
<li>é‡å»ºè¡¨çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸­é€”æœ‰æ–°çš„æ•°æ®è¦å†™å…¥ï¼Œå°±ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥åœ¨æ•´ä¸ª<code>DDL</code>è¿‡ç¨‹ä¸­ï¼Œè¡¨Aä¸­ä¸èƒ½æœ‰æ›´æ–°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªDDLä¸æ˜¯<code>Online</code>çš„ã€‚åœ¨MySQL 5.6ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„<code>Online DDL</code>ï¼Œå¯¹è¿™ä¸ªæ“ä½œæµç¨‹åšäº†ä¼˜åŒ–ã€‚</li>
<li>å¯¹äºå¾ˆå¤§çš„è¡¨æ¥è¯´ï¼Œè¿™ä¸ªæ“ä½œæ˜¯å¾ˆæ¶ˆè€—IOå’ŒCPUèµ„æºçš„ã€‚æƒ³è¦æ¯”è¾ƒå®‰å…¨çš„æ“ä½œçš„è¯ï¼Œæ¨èä½¿ç”¨<code>GitHub</code>å¼€æºçš„<a href="https://github.com/github/gh-ost">gh-ost</a>æ¥åšã€‚</li>
</ul>
<p><strong>MySQLæ‰§è¡ŒDDL()åŸç†</strong></p>
<ul>
<li><code>DML</code>ï¼šå®ƒä»¬æ˜¯SELECTã€UPDATEã€INSERTã€DELETEï¼Œå°±è±¡å®ƒçš„åå­—ä¸€æ ·ï¼Œè¿™4æ¡å‘½ä»¤æ˜¯ç”¨æ¥å¯¹æ•°æ®åº“é‡Œçš„æ•°æ®è¿›è¡Œæ“ä½œçš„è¯­è¨€</li>
<li><code>DDL</code>ï¼šDDLæ¯”DMLè¦å¤šï¼Œä¸»è¦çš„å‘½ä»¤æœ‰CREATEã€ALTERã€DROPç­‰ï¼ŒDDLä¸»è¦æ˜¯ç”¨åœ¨å®šä¹‰æˆ–æ”¹å˜è¡¨(TABLE)çš„ç»“æ„ï¼Œæ•°æ®ç±»å‹ï¼Œè¡¨ä¹‹é—´çš„é“¾æ¥å’Œçº¦æŸç­‰åˆå§‹åŒ–å·¥ä½œä¸Šï¼Œä»–ä»¬å¤§å¤šåœ¨å»ºç«‹è¡¨æ—¶ä½¿ç”¨</li>
<li><code>DCL</code>ï¼šæ˜¯æ•°æ®åº“æ§åˆ¶åŠŸèƒ½ã€‚æ˜¯ç”¨æ¥è®¾ç½®æˆ–æ›´æ”¹æ•°æ®åº“ç”¨æˆ·æˆ–è§’è‰²æƒé™çš„è¯­å¥</li>
<li>MySQLå„ç‰ˆæœ¬ï¼Œå¯¹äºDDLçš„å¤„ç†æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œä¸»è¦æœ‰ä¸‰ç§ï¼š</li>
<li><code>Copy Table</code>æ–¹å¼ï¼šè¿™æ˜¯InnoDBæœ€æ—©æ”¯æŒçš„æ–¹å¼ã€‚é€šè¿‡ä¸´æ—¶è¡¨æ‹·è´çš„æ–¹å¼å®ç°çš„ã€‚æ–°å»ºä¸€ä¸ªå¸¦æœ‰æ–°ç»“æ„çš„ä¸´æ—¶è¡¨ï¼Œå°†åŸè¡¨æ•°æ®å…¨éƒ¨æ‹·è´åˆ°ä¸´æ—¶è¡¨ï¼Œç„¶åRenameï¼Œå®Œæˆåˆ›å»ºæ“ä½œã€‚è¿™ä¸ªæ–¹å¼è¿‡ç¨‹ä¸­ï¼Œ<code>åŸè¡¨æ˜¯å¯è¯»çš„ï¼Œä¸å¯å†™</code>ã€‚ä½†æ˜¯<code>ä¼šæ¶ˆè€—ä¸€å€çš„å­˜å‚¨ç©ºé—´</code>ã€‚</li>
<li><code>Inplace</code>æ–¹å¼ï¼šè¿™æ˜¯åŸç”ŸMySQL 5.5ï¼Œä»¥åŠ<code>innodb_plugin</code>ä¸­æä¾›çš„æ–¹å¼ã€‚æ‰€è°“Inplaceï¼Œä¹Ÿå°±æ˜¯åœ¨<code>åŸè¡¨ä¸Šç›´æ¥è¿›è¡Œï¼Œä¸ä¼šæ‹·è´ä¸´æ—¶è¡¨</code>ã€‚ç›¸å¯¹äºCopy Tableæ–¹å¼ï¼Œè¿™æ¯”è¾ƒé«˜æ•ˆç‡ã€‚<code>åŸè¡¨åŒæ ·å¯è¯»çš„ï¼Œä½†æ˜¯ä¸å¯å†™</code>ã€‚</li>
<li><code>Onlineæ–¹å¼</code>ï¼šMySQL 5.6ä»¥ä¸Šç‰ˆæœ¬ä¸­æä¾›çš„æ–¹å¼ï¼Œæ— è®ºæ˜¯Copy Tableæ–¹å¼ï¼Œè¿˜æ˜¯Inplaceæ–¹å¼ï¼Œ<code>åŸè¡¨åªèƒ½å…è®¸è¯»å–ï¼Œä¸å¯å†™</code>ã€‚å¯¹åº”ç”¨æœ‰è¾ƒå¤§çš„é™åˆ¶ï¼Œå› æ­¤MySQLæœ€æ–°ç‰ˆæœ¬ä¸­ï¼ŒInnoDBæ”¯æŒäº†æ‰€è°“çš„<code>Onlineæ–¹å¼DDL</code>ã€‚ä¸ä»¥ä¸Šä¸¤ç§æ–¹å¼ç›¸æ¯”ï¼Œ<code>onlineæ–¹å¼æ”¯æŒDDLæ—¶ä¸ä»…å¯ä»¥è¯»ï¼Œè¿˜å¯ä»¥å†™</code></li>
</ul>
<h3 id="count-è¯­å¥åˆ°åº•æ˜¯æ€æ ·å®ç°çš„"><a href="#count-è¯­å¥åˆ°åº•æ˜¯æ€æ ·å®ç°çš„" class="headerlink" title="count(*)è¯­å¥åˆ°åº•æ˜¯æ€æ ·å®ç°çš„"></a>count(*)è¯­å¥åˆ°åº•æ˜¯æ€æ ·å®ç°çš„</h3><ul>
<li>åœ¨ä¸åŒçš„MySQLå¼•æ“ä¸­ï¼Œcount(*)æœ‰ä¸åŒçš„å®ç°æ–¹å¼ã€‚</li>
<li><code>MyISAMå¼•æ“</code>æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œ<code>count(*)</code>çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚è¿™é‡Œè®¨è®ºçš„æ˜¯æ²¡æœ‰è¿‡æ»¤æ¡ä»¶çš„count(*)ï¼Œå¦‚æœåŠ äº†where æ¡ä»¶çš„è¯ï¼ŒMyISAMè¡¨ä¹Ÿæ˜¯ä¸èƒ½è¿”å›å¾—è¿™ä¹ˆå¿«çš„ã€‚</li>
<li><code>InnoDBå¼•æ“</code>å°±éº»çƒ¦äº†ï¼Œå®ƒæ‰§è¡Œcount(*)çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶åç´¯ç§¯è®¡æ•°ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆInnoDBä¸è·ŸMyISAMä¸€æ ·ï¼Œä¹ŸæŠŠæ•°å­—å­˜èµ·æ¥å‘¢ï¼Ÿ</strong></p>
<ul>
<li>è¿™æ˜¯å› ä¸ºå³ä½¿æ˜¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»çš„å¤šä¸ªæŸ¥è¯¢ï¼Œç”±äº<code>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</code>ï¼ˆMVCCï¼‰çš„åŸå› ï¼ŒInnoDBè¡¨â€œåº”è¯¥è¿”å›å¤šå°‘è¡Œâ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ã€‚</li>
<li>è¿™å’ŒInnoDBçš„äº‹åŠ¡è®¾è®¡æœ‰å…³ç³»ï¼Œ<code>å¯é‡å¤è¯»æ˜¯å®ƒé»˜è®¤çš„éš”ç¦»çº§åˆ«</code>ï¼Œåœ¨ä»£ç ä¸Šå°±æ˜¯é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯MVCCæ¥å®ç°çš„ã€‚æ¯ä¸€è¡Œè®°å½•éƒ½è¦åˆ¤æ–­è‡ªå·±æ˜¯å¦å¯¹è¿™ä¸ªä¼šè¯å¯è§ï¼Œå› æ­¤å¯¹äºcount(*)è¯·æ±‚æ¥è¯´ï¼ŒInnoDBåªå¥½æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°è¯»å‡ºä¾æ¬¡åˆ¤æ–­ï¼Œå¯è§çš„è¡Œæ‰èƒ½å¤Ÿç”¨äºè®¡ç®—â€œåŸºäºè¿™ä¸ªæŸ¥è¯¢â€çš„è¡¨çš„æ€»è¡Œæ•°ã€‚</li>
<li><code>InnoDBæ˜¯ç´¢å¼•ç»„ç»‡è¡¨</code>ï¼Œ<code>ä¸»é”®ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯æ•°æ®</code>ï¼Œè€Œ<code>æ™®é€šç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸»é”®å€¼</code>ã€‚æ‰€ä»¥ï¼Œæ™®é€šç´¢å¼•æ ‘æ¯”ä¸»é”®ç´¢å¼•æ ‘å°å¾ˆå¤šã€‚å¯¹äºcount(*)è¿™æ ·çš„æ“ä½œï¼Œéå†å“ªä¸ªç´¢å¼•æ ‘å¾—åˆ°çš„ç»“æœé€»è¾‘ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ã€‚å› æ­¤ï¼ŒMySQLä¼˜åŒ–å™¨ä¼šæ‰¾åˆ°æœ€å°çš„é‚£æ£µæ ‘æ¥éå†ã€‚åœ¨ä¿è¯é€»è¾‘æ­£ç¡®çš„å‰æä¸‹ï¼Œå°½é‡å‡å°‘æ‰«æçš„æ•°æ®é‡ï¼Œæ˜¯æ•°æ®åº“ç³»ç»Ÿè®¾è®¡çš„é€šç”¨æ³•åˆ™ä¹‹ä¸€ã€‚</li>
<li>MyISAMè¡¨è™½ç„¶count(<em>)å¾ˆå¿«ï¼Œä½†æ˜¯ä¸æ”¯æŒäº‹åŠ¡ï¼›show table statuså‘½ä»¤è™½ç„¶è¿”å›å¾ˆå¿«ï¼Œä½†æ˜¯ä¸å‡†ç¡®ï¼›InnoDBè¡¨ç›´æ¥count(</em>)ä¼šéå†å…¨è¡¨ï¼Œè™½ç„¶ç»“æœå‡†ç¡®ï¼Œä½†ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</li>
</ul>
<h3 id="ä¸åŒçš„countç”¨æ³•"><a href="#ä¸åŒçš„countç”¨æ³•" class="headerlink" title="ä¸åŒçš„countç”¨æ³•"></a>ä¸åŒçš„countç”¨æ³•</h3><p><code>select count(?) from t</code>è¿™æ ·çš„æŸ¥è¯¢è¯­å¥é‡Œé¢ï¼Œ<code>count(*)ã€count(ä¸»é”®id)ã€count(å­—æ®µ)å’Œcount(1)</code>ç­‰ä¸åŒç”¨æ³•çš„æ€§èƒ½ï¼Œæœ‰å“ªäº›å·®åˆ«ã€‚</p>
<ul>
<li>count()æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå¯¹äºè¿”å›çš„ç»“æœé›†ï¼Œä¸€è¡Œè¡Œåœ°åˆ¤æ–­ï¼Œå¦‚æœcountå‡½æ•°çš„å‚æ•°ä¸æ˜¯NULLï¼Œç´¯è®¡å€¼å°±åŠ 1ï¼Œå¦åˆ™ä¸åŠ ã€‚æœ€åè¿”å›ç´¯è®¡å€¼ã€‚</li>
<li>æ‰€ä»¥ï¼Œcount(*)ã€count(ä¸»é”®id)å’Œcount(1) éƒ½è¡¨ç¤ºè¿”å›æ»¡è¶³æ¡ä»¶çš„ç»“æœé›†çš„æ€»è¡Œæ•°ï¼›è€Œcount(å­—æ®µï¼‰ï¼Œåˆ™è¡¨ç¤ºè¿”å›æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œé‡Œé¢ï¼Œå‚æ•°â€œå­—æ®µâ€ä¸ä¸ºNULLçš„æ€»ä¸ªæ•°ã€‚</li>
<li><code>å¯¹äºcount(ä¸»é”®id)æ¥è¯´</code>ï¼ŒInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„idå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™serverå±‚ã€‚serverå±‚æ‹¿åˆ°idåï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„ï¼Œå°±æŒ‰è¡Œç´¯åŠ ã€‚</li>
<li><code>å¯¹äºcount(1)æ¥è¯´</code>ï¼ŒInnoDBå¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚serverå±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€œ1â€è¿›å»ï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„ï¼ŒæŒ‰è¡Œç´¯åŠ ã€‚</li>
<li><code>å¯¹äºcount(å­—æ®µ)æ¥è¯´</code>ï¼šå¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€æ˜¯å®šä¹‰ä¸ºnot nullçš„è¯ï¼Œä¸€è¡Œè¡Œåœ°ä»è®°å½•é‡Œé¢è¯»å‡ºè¿™ä¸ªå­—æ®µï¼Œåˆ¤æ–­ä¸èƒ½ä¸ºnullï¼ŒæŒ‰è¡Œç´¯åŠ ï¼›å¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€å®šä¹‰å…è®¸ä¸ºnullï¼Œé‚£ä¹ˆæ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­åˆ°æœ‰å¯èƒ½æ˜¯nullï¼Œè¿˜è¦æŠŠå€¼å–å‡ºæ¥å†åˆ¤æ–­ä¸€ä¸‹ï¼Œä¸æ˜¯nullæ‰ç´¯åŠ ã€‚</li>
<li>count(<em>)æ˜¯ä¾‹å¤–ï¼šå¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ã€‚count(</em>)è‚¯å®šä¸æ˜¯nullï¼ŒæŒ‰è¡Œç´¯åŠ ã€‚</li>
<li>æ‰€ä»¥ç»“è®ºæ˜¯ï¼šæŒ‰ç…§æ•ˆç‡æ’åºçš„è¯ï¼Œcount(å­—æ®µ)&lt;count(ä¸»é”®id)&lt;count(1)â‰ˆcount(<em>)ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ ï¼Œå°½é‡ä½¿ç”¨count(</em>)ã€‚</li>
</ul>
<h3 id="order-byæ˜¯æ€ä¹ˆå·¥ä½œçš„"><a href="#order-byæ˜¯æ€ä¹ˆå·¥ä½œçš„" class="headerlink" title="order byæ˜¯æ€ä¹ˆå·¥ä½œçš„"></a>order byæ˜¯æ€ä¹ˆå·¥ä½œçš„</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•è¡¨ Â <code>t_city</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_city` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `city` <span class="type">varchar</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `addr` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `city` (`city`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>


<p>ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ æ·»åŠ 10Wæ¡æµ‹è¯•æ•°æ®</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">delimiter ;;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> idata2()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">declare</span> i <span class="type">int</span>;</span><br><span class="line">  <span class="keyword">set</span> i<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">  while(i<span class="operator">&lt;=</span><span class="number">10000</span>)do</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> t_city <span class="keyword">values</span>(i,<span class="string">&#x27;å¹¿å·&#x27;</span>, i,i,i);</span><br><span class="line">    <span class="keyword">set</span> i<span class="operator">=</span>i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span> while;</span><br><span class="line"><span class="keyword">end</span>;;</span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">call</span> idata2();</span><br></pre></td></tr></table></figure>


<p>æ¯”å¦‚æœ‰å¦‚ä¸‹sqlè¯­å¥ï¼Œä¸ºé¿å…å…¨è¡¨æ‰«æï¼Œå·²ç»åœ¨cityå­—æ®µåŠ ä¸Šç´¢å¼•</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> city,name,age <span class="keyword">from</span> t_city <span class="keyword">where</span> city<span class="operator">=</span><span class="string">&#x27;å¹¿å·&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> name limit <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>


<p>è¿™ä¸ªè¯­å¥çœ‹ä¸Šå»é€»è¾‘å¾ˆæ¸…æ™°ï¼Œ é‚£å—æ•°æ®åº“å†…éƒ¨åˆ°åº•æ˜¯æ€æ ·æ‰§è¡Œçš„äº†ï¼Ÿ</p>
<p>é¦–å…ˆå…ˆç”¨<code>explain</code>çœ‹çœ‹æ‰§è¡Œè®¡åˆ’</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">select</span> city,name,age <span class="keyword">from</span> t_city <span class="keyword">where</span> city<span class="operator">=</span><span class="string">&#x27;å¹¿å·&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> name limit <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>


<p><img src="https://img-blog.csdnimg.cn/20190416172638203.png#id=J8vpw&originHeight=52&originWidth=981&originalType=binary&ratio=1&status=done&style=none"><br><strong>å…ˆçœ‹ä¸‹ä¸ªæ‰§è¡Œè®¡åˆ’å„å‚æ•°çš„å«ä¹‰ï¼š</strong></p>
<ul>
<li><code>select_type</code>ï¼šæ˜¾ ç¤ºæŸ¥è¯¢ä¸­æ¯ä¸ªselectå­å¥çš„ç±»å‹</li>
<li><code>table</code>ï¼š æ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„ï¼Œæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åå­—</li>
<li><code>type</code>ï¼šåœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼ï¼Œåˆç§°â€œè®¿é—®ç±»å‹â€ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼š ALL, index, Â range, ref, eq_ref, const, system, NULLï¼ˆä»å·¦åˆ°å³ï¼Œæ€§èƒ½ä»å·®åˆ°å¥½ï¼‰</li>
<li><code>possible_keys</code>ï¼šæŒ‡å‡ºMySQLèƒ½ä½¿ç”¨å“ªä¸ªç´¢å¼•åœ¨è¡¨ä¸­æ‰¾åˆ°è®°å½•ï¼ŒæŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢ä½¿ç”¨</li>
<li><code>Key</code>ï¼škeyåˆ—æ˜¾ç¤ºMySQLå®é™…å†³å®šä½¿ç”¨çš„é”®ï¼ˆç´¢å¼•ï¼‰</li>
<li><code>key_len</code>ï¼šè¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ï¼Œkey_lenæ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½</li>
<li><code>ref</code>ï¼šè¡¨ç¤ºä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼</li>
<li><code>rows</code>ï¼š è¡¨ç¤ºMySQLæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œä¼°ç®—çš„æ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°</li>
<li><code>Extra</code>ï¼šè¯¥åˆ—åŒ…å«MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯ã€‚Extraè¿™ä¸ªå­—æ®µä¸­çš„<code>â€œUsing filesortâ€è¡¨ç¤ºçš„å°±æ˜¯éœ€è¦æ’åº</code>ï¼ŒMySQLä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ç”¨äºæ’åºï¼Œç§°ä¸º<code>sort_buffer</code>ã€‚</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190416174643103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=qZTfO&originHeight=642&originWidth=655&originalType=binary&ratio=1&status=done&style=none"></p>
<ul>
<li>æŒ‰nameæ’åºâ€è¿™ä¸ªåŠ¨ä½œï¼Œå¯èƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œä¹Ÿå¯èƒ½éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œè¿™å–å†³äºæ’åºæ‰€éœ€çš„å†…å­˜å’Œå‚æ•°<code>sort_buffer_size</code>ã€‚</li>
<li><code>sort_buffer_size</code>å°±æ˜¯MySQLä¸ºæ’åºå¼€è¾Ÿçš„å†…å­˜ï¼ˆ<code>sort_buffer</code>ï¼‰çš„å¤§å°ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®é‡å°äºsort_buffer_sizeï¼Œæ’åºå°±åœ¨å†…å­˜ä¸­å®Œæˆã€‚ä½†å¦‚æœæ’åºæ•°æ®é‡å¤ªå¤§ï¼Œå†…å­˜æ”¾ä¸ä¸‹ï¼Œåˆ™ä¸å¾—ä¸åˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æ’åºã€‚</li>
</ul>
<blockquote>
<p>ç¡®å®šä¸€ä¸ªæ’åºè¯­å¥æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* æ‰“å¼€optimizer_traceï¼Œåªå¯¹æœ¬çº¿ç¨‹æœ‰æ•ˆ */</span></span><br><span class="line"><span class="keyword">SET</span> optimizer_trace<span class="operator">=</span><span class="string">&#x27;enabled=on&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* @aä¿å­˜Innodb_rows_readçš„åˆå§‹å€¼ */</span></span><br><span class="line"><span class="keyword">select</span> VARIABLE_VALUE <span class="keyword">into</span> <span class="variable">@a</span> <span class="keyword">from</span>  performance_schema.session_status <span class="keyword">where</span> variable_name <span class="operator">=</span> <span class="string">&#x27;Innodb_rows_read&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ‰§è¡Œè¯­å¥ */</span></span><br><span class="line"><span class="keyword">select</span> city, name,age <span class="keyword">from</span> t <span class="keyword">where</span> city<span class="operator">=</span><span class="string">&#x27;æ­å·&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> name limit <span class="number">1000</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* æŸ¥çœ‹ OPTIMIZER_TRACE è¾“å‡º */</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `information_schema`.`OPTIMIZER_TRACE`</span><br><span class="line"></span><br><span class="line"><span class="comment">/* @bä¿å­˜Innodb_rows_readçš„å½“å‰å€¼ */</span></span><br><span class="line"><span class="keyword">select</span> VARIABLE_VALUE <span class="keyword">into</span> <span class="variable">@b</span> <span class="keyword">from</span> performance_schema.session_status <span class="keyword">where</span> variable_name <span class="operator">=</span> <span class="string">&#x27;Innodb_rows_read&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è®¡ç®—Innodb_rows_readå·®å€¼ */</span></span><br><span class="line"><span class="keyword">select</span> <span class="variable">@b</span><span class="operator">-</span><span class="variable">@a</span>;</span><br></pre></td></tr></table></figure>


<p>è¿™ä¸ªæ–¹æ³•æ˜¯é€šè¿‡æŸ¥çœ‹ OPTIMIZER_TRACE çš„ç»“æœæ¥ç¡®è®¤çš„ï¼Œä½ å¯ä»¥ä» number_of_tmp_filesä¸­çœ‹åˆ°æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/2019041617592518.png#id=ZWOG8&originHeight=180&originWidth=712&originalType=binary&ratio=1&status=done&style=none"></p>
<ul>
<li><code>number_of_tmp_files</code>è¡¨ç¤ºçš„æ˜¯ï¼Œæ’åºè¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶æ•°ã€‚å†…å­˜æ”¾ä¸ä¸‹æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œå¤–éƒ¨æ’åºä¸€èˆ¬ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•ã€‚ï¼ŒMySQLå°†éœ€è¦æ’åºçš„æ•°æ®åˆ†æˆ12ä»½ï¼Œæ¯ä¸€ä»½å•ç‹¬æ’åºåå­˜åœ¨è¿™äº›ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ç„¶åæŠŠè¿™12ä¸ªæœ‰åºæ–‡ä»¶å†åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„å¤§æ–‡ä»¶ã€‚</li>
<li>å¦‚æœ<code>sort_buffer_size</code>è¶…è¿‡äº†éœ€è¦æ’åºçš„æ•°æ®é‡çš„å¤§å°ï¼Œ<code>number_of_tmp_files</code>å°±æ˜¯0ï¼Œè¡¨ç¤ºæ’åºå¯ä»¥ç›´æ¥åœ¨å†…å­˜ä¸­å®Œæˆã€‚å¦åˆ™å°±éœ€è¦æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­æ’åºã€‚</li>
<li><code>sort_buffer_size</code>è¶Šå°ï¼Œéœ€è¦åˆ†æˆçš„ä»½æ•°è¶Šå¤šï¼Œ<code>number_of_tmp_files</code>çš„å€¼å°±è¶Šå¤§ã€‚</li>
<li><code>sort_mode</code> é‡Œé¢çš„<code>packed_additional_fields</code>çš„æ„æ€æ˜¯ï¼Œæ’åºè¿‡ç¨‹å¯¹å­—ç¬¦ä¸²åšäº†<code>â€œç´§å‡‘â€</code>å¤„ç†ã€‚å³ä½¿nameå­—æ®µçš„å®šä¹‰æ˜¯varchar(16)ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æŒ‰ç…§å®é™…é•¿åº¦æ¥åˆ†é…ç©ºé—´çš„ã€‚</li>
<li>åŒæ—¶ï¼Œæœ€åä¸€ä¸ªæŸ¥è¯¢è¯­å¥select @b-@a çš„è¿”å›ç»“æœæ˜¯4000ï¼Œè¡¨ç¤ºæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹åªæ‰«æäº†4000è¡Œã€‚</li>
<li>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†é¿å…å¯¹ç»“è®ºé€ æˆå¹²æ‰°ï¼Œæˆ‘æŠŠinternal_tmp_disk_storage_engineè®¾ç½®æˆMyISAMã€‚å¦åˆ™ï¼Œselect @b-@açš„ç»“æœä¼šå¤§äº4000</li>
<li>åœ¨ä¸Šé¢è¿™ä¸ªç®—æ³•è¿‡ç¨‹é‡Œé¢ï¼Œåªå¯¹åŸè¡¨çš„æ•°æ®è¯»äº†ä¸€éï¼Œå‰©ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨sort_bufferå’Œä¸´æ—¶æ–‡ä»¶ä¸­æ‰§è¡Œçš„ã€‚ä½†è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæŸ¥è¯¢è¦è¿”å›çš„å­—æ®µå¾ˆå¤šçš„è¯ï¼Œé‚£ä¹ˆsort_bufferé‡Œé¢è¦æ”¾çš„å­—æ®µæ•°å¤ªå¤šï¼Œè¿™æ ·å†…å­˜é‡Œèƒ½å¤ŸåŒæ—¶æ”¾ä¸‹çš„è¡Œæ•°å¾ˆå°‘ï¼Œè¦åˆ†æˆå¾ˆå¤šä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæ’åºçš„æ€§èƒ½ä¼šå¾ˆå·®ã€‚</li>
</ul>
<p><strong>å¦‚æœMySQLè®¤ä¸ºæ’åºçš„å•è¡Œé•¿åº¦å¤ªå¤§ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</strong></p>
<ul>
<li><code>max_length_for_sort_data</code>ï¼Œæ˜¯MySQLä¸­ä¸“é—¨æ§åˆ¶ç”¨äºæ’åºçš„è¡Œæ•°æ®çš„é•¿åº¦çš„ä¸€ä¸ªå‚æ•°ã€‚å®ƒçš„æ„æ€æ˜¯ï¼Œå¦‚æœå•è¡Œçš„é•¿åº¦è¶…è¿‡è¿™ä¸ªå€¼ï¼ŒMySQLå°±è®¤ä¸ºå•è¡Œå¤ªå¤§ï¼Œè¦æ¢ä¸€ä¸ªç®—æ³•ã€‚</li>
</ul>
<h3 id="å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯"><a href="#å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯" class="headerlink" title="å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯"></a>å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯</h3><p>ä»ä¸€ä¸ªå•è¯è¡¨ä¸­éšæœºé€‰å‡ºä¸‰ä¸ªå•è¯</p>
<p>åˆ›å»ºæµ‹è¯•è¡¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `words` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `word` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>


<p>æ·»åŠ æµ‹è¯•æ•°æ®</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">delimiter ;;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> idata3()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">declare</span> i <span class="type">int</span>;</span><br><span class="line">  <span class="keyword">set</span> i<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">  while i<span class="operator">&lt;</span><span class="number">10000</span> do</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> words(word) <span class="keyword">values</span>(concat(<span class="type">char</span>(<span class="number">97</span><span class="operator">+</span>(i div <span class="number">1000</span>)), <span class="type">char</span>(<span class="number">97</span><span class="operator">+</span>(i <span class="operator">%</span> <span class="number">1000</span> div <span class="number">100</span>)), <span class="type">char</span>(<span class="number">97</span><span class="operator">+</span>(i <span class="operator">%</span> <span class="number">100</span> div <span class="number">10</span>)), <span class="type">char</span>(<span class="number">97</span><span class="operator">+</span>(i <span class="operator">%</span> <span class="number">10</span>))));</span><br><span class="line">    <span class="keyword">set</span> i<span class="operator">=</span>i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span> while;</span><br><span class="line"><span class="keyword">end</span>;;</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> idata3();</span><br></pre></td></tr></table></figure>


<p><strong>é¦–å…ˆï¼Œä¼šæƒ³åˆ°ç”¨order by rand()æ¥å®ç°è¿™ä¸ªé€»è¾‘</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span> word <span class="keyword">from</span> words <span class="keyword">order</span> <span class="keyword">by</span> rand() limit <span class="number">3</span>;</span><br></pre></td></tr></table></figure>


<p><img src="https://img-blog.csdnimg.cn/20190416182846114.png#id=IcAaX&originHeight=98&originWidth=1076&originalType=binary&ratio=1&status=done&style=none"></p>
<ul>
<li>Extraå­—æ®µæ˜¾ç¤º<code>Using temporary</code>ï¼Œè¡¨ç¤ºçš„æ˜¯éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨ï¼›<code>Using filesort</code>ï¼Œè¡¨ç¤ºçš„æ˜¯éœ€è¦æ‰§è¡Œæ’åºæ“ä½œã€‚å› æ­¤è¿™ä¸ªExtraçš„æ„æ€å°±æ˜¯ï¼Œéœ€è¦ä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”éœ€è¦åœ¨ä¸´æ—¶è¡¨ä¸Šæ’åº</li>
<li>order by rand()ä½¿ç”¨äº†å†…å­˜ä¸´æ—¶è¡¨ï¼Œå†…å­˜ä¸´æ—¶è¡¨æ’åºçš„æ—¶å€™ä½¿ç”¨äº†rowidæ’åºæ–¹æ³•ã€‚</li>
<li>tmp_table_sizeè¿™ä¸ªé…ç½®é™åˆ¶äº†å†…å­˜ä¸´æ—¶è¡¨çš„å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯16Mã€‚å¦‚æœä¸´æ—¶è¡¨å¤§å°è¶…è¿‡äº†tmp_table_sizeï¼Œé‚£ä¹ˆå†…å­˜ä¸´æ—¶è¡¨å°±ä¼šè½¬æˆç£ç›˜ä¸´æ—¶è¡¨ã€‚</li>
<li>ç£ç›˜ä¸´æ—¶è¡¨ä½¿ç”¨çš„å¼•æ“é»˜è®¤æ˜¯InnoDBï¼Œæ˜¯ç”±å‚æ•°internal_tmp_disk_storage_engineæ§åˆ¶çš„ã€‚å½“ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨çš„æ—¶å€™ï¼Œå¯¹åº”çš„å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰æ˜¾å¼ç´¢å¼•çš„InnoDBè¡¨çš„æ’åºè¿‡ç¨‹ã€‚</li>
</ul>
<h3 id="å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜"><a href="#å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜" class="headerlink" title="å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜"></a>å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜</h3><ul>
<li>å¹»è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨å‰åä¸¤æ¬¡æŸ¥è¯¢åŒä¸€ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œåä¸€æ¬¡æŸ¥è¯¢çœ‹åˆ°äº†å‰ä¸€æ¬¡æŸ¥è¯¢æ²¡æœ‰çœ‹åˆ°çš„è¡Œã€‚</li>
<li>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚å› æ­¤ï¼Œå¹»è¯»åœ¨â€œå½“å‰è¯»â€ä¸‹æ‰ä¼šå‡ºç°ã€‚</li>
</ul>
<p><strong>åˆ›å»ºæµ‹è¯•æ•°æ®</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE `t` (</span><br><span class="line">  `id` int(11) NOT NULL,</span><br><span class="line">  `c` int(11) DEFAULT NULL,</span><br><span class="line">  `d` int(11) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `c` (`c`)</span><br><span class="line">) ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">insert into t values(0,0,0),(5,5,5),</span><br><span class="line">(10,10,10),(15,15,15),(20,20,20),(25,25,25);</span><br></pre></td></tr></table></figure>


<p><strong>ä¸‹é¢çš„è¯­å¥åºåˆ—ï¼Œæ˜¯æ€ä¹ˆåŠ é”çš„ï¼ŒåŠ çš„é”åˆæ˜¯ä»€ä¹ˆæ—¶å€™é‡Šæ”¾çš„å‘¢ï¼Ÿ</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> d<span class="operator">=</span><span class="number">5</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>


<ul>
<li>è¿™ä¸ªè¯­å¥ä¼šå‘½ä¸­d=5çš„è¿™ä¸€è¡Œï¼Œå¯¹åº”çš„ä¸»é”®id=5ï¼Œå› æ­¤åœ¨select è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œid=5è¿™ä¸€è¡Œä¼šåŠ ä¸€ä¸ªå†™é”ï¼Œè€Œä¸”ç”±äºä¸¤é˜¶æ®µé”åè®®ï¼Œè¿™ä¸ªå†™é”ä¼šåœ¨æ‰§è¡Œcommitè¯­å¥çš„æ—¶å€™é‡Šæ”¾ã€‚</li>
<li>ç”±äºå­—æ®µdä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œå› æ­¤è¿™æ¡æŸ¥è¯¢è¯­å¥ä¼šåšå…¨è¡¨æ‰«æã€‚é‚£ä¹ˆï¼Œå…¶ä»–è¢«æ‰«æåˆ°çš„ï¼Œä½†æ˜¯ä¸æ»¡è¶³æ¡ä»¶çš„5è¡Œè®°å½•ä¸Šï¼Œä¼šä¸ä¼šè¢«åŠ é”å‘¢ï¼Ÿ</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190418165218311.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=GPJCV&originHeight=688&originWidth=984&originalType=binary&ratio=1&status=done&style=none"></p>
<ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œsession Aé‡Œæ‰§è¡Œäº†ä¸‰æ¬¡æŸ¥è¯¢ï¼Œåˆ†åˆ«æ˜¯Q1ã€Q2å’ŒQ3ã€‚å®ƒä»¬çš„SQLè¯­å¥ç›¸åŒï¼Œéƒ½æ˜¯select * from t where d=5 for updateã€‚è¿™ä¸ªè¯­å¥çš„æ„æ€ä½ åº”è¯¥å¾ˆæ¸…æ¥šäº†ï¼ŒæŸ¥æ‰€æœ‰d=5çš„è¡Œï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯å½“å‰è¯»ï¼Œå¹¶ä¸”åŠ ä¸Šå†™é”</li>
</ul>
<p><strong>å›¾ä¸­SQLæ‰§è¡Œæµç¨‹</strong></p>
<ul>
<li>Q1åªè¿”å›id=5è¿™ä¸€è¡Œï¼›</li>
<li>åœ¨T2æ—¶åˆ»ï¼Œsession BæŠŠid=0è¿™ä¸€è¡Œçš„då€¼æ”¹æˆäº†5ï¼Œå› æ­¤T3æ—¶åˆ»Q2æŸ¥å‡ºæ¥çš„æ˜¯id=0å’Œid=5è¿™ä¸¤è¡Œï¼›</li>
<li>åœ¨T4æ—¶åˆ»ï¼Œsession Cåˆæ’å…¥ä¸€è¡Œï¼ˆ1,1,5ï¼‰ï¼Œå› æ­¤T5æ—¶åˆ»Q3æŸ¥å‡ºæ¥çš„æ˜¯id=0ã€id=1å’Œid=5çš„è¿™ä¸‰è¡Œã€‚</li>
<li>å…¶ä¸­ï¼ŒQ3è¯»åˆ°id=1è¿™ä¸€è¡Œçš„ç°è±¡ï¼Œè¢«ç§°ä¸º<code>â€œå¹»è¯»â€</code>ã€‚</li>
<li>åœ¨<code>å¯é‡å¤è¯»</code>(InnoDBçš„é»˜è®¤)éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚å› æ­¤ï¼Œ<code>å¹»è¯»åœ¨â€œå½“å‰è¯»â€ä¸‹æ‰ä¼šå‡ºç°ã€‚</code></li>
<li>ä¸Šé¢session Bçš„ä¿®æ”¹ç»“æœï¼Œè¢«session Aä¹‹åçš„selectè¯­å¥ç”¨â€œå½“å‰è¯»â€çœ‹åˆ°ï¼Œä¸èƒ½ç§°ä¸ºå¹»è¯»ã€‚å¹»è¯»ä»…ä¸“æŒ‡â€œæ–°æ’å…¥çš„è¡Œâ€</li>
</ul>
<p>ä»äº‹åŠ¡å¯è§æ€§è§„åˆ™æ¥åˆ†æçš„è¯ï¼Œä¸Šé¢è¿™ä¸‰æ¡SQLè¯­å¥çš„è¿”å›ç»“æœéƒ½æ²¡æœ‰é—®é¢˜ã€‚å› ä¸ºè¿™ä¸‰ä¸ªæŸ¥è¯¢éƒ½æ˜¯åŠ äº†for updateï¼Œéƒ½æ˜¯å½“å‰è¯»ã€‚è€Œå½“å‰è¯»çš„è§„åˆ™ï¼Œå°±æ˜¯è¦èƒ½è¯»åˆ°æ‰€æœ‰å·²ç»æäº¤çš„è®°å½•çš„æœ€æ–°å€¼ã€‚å¹¶ä¸”ï¼Œsession Bå’ŒsessionCçš„ä¸¤æ¡è¯­å¥ï¼Œæ‰§è¡Œåå°±ä¼šæäº¤ï¼Œæ‰€ä»¥Q2å’ŒQ3å°±æ˜¯åº”è¯¥çœ‹åˆ°è¿™ä¸¤ä¸ªäº‹åŠ¡çš„æ“ä½œæ•ˆæœï¼Œè€Œä¸”ä¹Ÿçœ‹åˆ°äº†ï¼Œè¿™è·Ÿäº‹åŠ¡çš„å¯è§æ€§è§„åˆ™å¹¶ä¸çŸ›ç›¾ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸æ˜¯çœŸçš„æ²¡é—®é¢˜å‘¢ï¼Ÿ</p>
<p><strong>å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li>é¦–å…ˆæ˜¯è¯­ä¹‰ä¸Šçš„ã€‚session Aåœ¨T1æ—¶åˆ»å°±å£°æ˜äº†ï¼Œâ€œæˆ‘è¦æŠŠæ‰€æœ‰d=5çš„è¡Œé”ä½ï¼Œä¸å‡†åˆ«çš„äº‹åŠ¡è¿›è¡Œè¯»å†™æ“ä½œâ€ã€‚è€Œå®é™…ä¸Šï¼Œè¿™ä¸ªè¯­ä¹‰è¢«ç ´åäº†ã€‚</li>
</ul>
<p><strong>å…¶æ¬¡ï¼Œæ˜¯æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</strong></p>
<ul>
<li>æˆ‘ä»¬çŸ¥é“ï¼Œé”çš„è®¾è®¡æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚è€Œè¿™ä¸ªä¸€è‡´æ€§ï¼Œä¸æ­¢æ˜¯æ•°æ®åº“å†…éƒ¨æ•°æ®çŠ¶æ€åœ¨æ­¤åˆ»çš„ä¸€è‡´æ€§ï¼Œè¿˜åŒ…å«äº†æ•°æ®å’Œæ—¥å¿—åœ¨é€»è¾‘ä¸Šçš„ä¸€è‡´æ€§</li>
<li>ä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç»™session Aåœ¨T1æ—¶åˆ»å†åŠ ä¸€ä¸ªæ›´æ–°è¯­å¥ï¼Œå³ï¼šupdate t set d=100 where d=5ã€‚<br><img src="https://img-blog.csdnimg.cn/20190418171046246.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=Wyaze&originHeight=551&originWidth=929&originalType=binary&ratio=1&status=done&style=none"><br><strong>ä¸Šé¢çš„æ‰§è¡Œæµç¨‹</strong></li>
<li>ç»è¿‡T1æ—¶åˆ»ï¼Œid=5è¿™ä¸€è¡Œå˜æˆ (5,5,100)ï¼Œå½“ç„¶è¿™ä¸ªç»“æœæœ€ç»ˆæ˜¯åœ¨T6æ—¶åˆ»æ­£å¼æäº¤çš„;</li>
<li>ç»è¿‡T2æ—¶åˆ»ï¼Œid=0è¿™ä¸€è¡Œå˜æˆ(0,5,5);</li>
<li>ç»è¿‡T4æ—¶åˆ»ï¼Œè¡¨é‡Œé¢å¤šäº†ä¸€è¡Œ(1,5,5);</li>
</ul>
<p>è¿™æ ·çœ‹ï¼Œè¿™äº›æ•°æ®ä¹Ÿæ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™æ—¶å€™binlogé‡Œé¢çš„å†…å®¹ã€‚</p>
<ul>
<li>T2æ—¶åˆ»ï¼Œsession Bäº‹åŠ¡æäº¤ï¼Œå†™å…¥äº†ä¸¤æ¡è¯­å¥ï¼›</li>
<li>T4æ—¶åˆ»ï¼Œsession Cäº‹åŠ¡æäº¤ï¼Œå†™å…¥äº†ä¸¤æ¡è¯­å¥ï¼›</li>
<li>T6æ—¶åˆ»ï¼Œsession Aäº‹åŠ¡æäº¤ï¼Œå†™å…¥äº†update t set d=100 where d=5 è¿™æ¡è¯­å¥ã€‚</li>
</ul>
<p>æ”¾åˆ°ä¸€èµ·çš„è¯ï¼Œå°±æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> t <span class="keyword">set</span> d<span class="operator">=</span><span class="number">5</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">0</span>; <span class="comment">/*(0,0,5)*/</span></span><br><span class="line"><span class="keyword">update</span> t <span class="keyword">set</span> c<span class="operator">=</span><span class="number">5</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">0</span>; <span class="comment">/*(0,5,5)*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>); <span class="comment">/*(1,1,5)*/</span></span><br><span class="line"><span class="keyword">update</span> t <span class="keyword">set</span> c<span class="operator">=</span><span class="number">5</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>; <span class="comment">/*(1,5,5)*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t <span class="keyword">set</span> d<span class="operator">=</span><span class="number">100</span> <span class="keyword">where</span> d<span class="operator">=</span><span class="number">5</span>;<span class="comment">/*æ‰€æœ‰d=5çš„è¡Œï¼Œdæ”¹æˆ100*/</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>è¿™ä¸ªè¯­å¥åºåˆ—ï¼Œä¸è®ºæ˜¯æ‹¿åˆ°å¤‡åº“å»æ‰§è¡Œï¼Œè¿˜æ˜¯ä»¥åç”¨binlogæ¥å…‹éš†ä¸€ä¸ªåº“ï¼Œè¿™ä¸‰è¡Œçš„ç»“æœï¼Œéƒ½å˜æˆäº† (0,5,100)ã€(1,5,100)å’Œ(5,5,100)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œid=0å’Œid=1è¿™ä¸¤è¡Œï¼Œå‘ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´ã€‚è¿™ä¸ªé—®é¢˜å¾ˆä¸¥é‡ï¼Œæ˜¯ä¸è¡Œçš„ã€‚</p>
</blockquote>
<p><strong>å¦‚ä½•è§£å†³å¹»è¯»ï¼Ÿ</strong></p>
<ul>
<li>äº§ç”Ÿå¹»è¯»çš„åŸå› æ˜¯ï¼Œè¡Œé”åªèƒ½é”ä½è¡Œï¼Œä½†æ˜¯æ–°æ’å…¥è®°å½•è¿™ä¸ªåŠ¨ä½œï¼Œè¦æ›´æ–°çš„æ˜¯è®°å½•ä¹‹é—´çš„â€œé—´éš™â€ã€‚å› æ­¤ï¼Œä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ï¼ŒInnoDBåªå¥½å¼•å…¥æ–°çš„é”ï¼Œä¹Ÿå°±æ˜¯é—´éš™é”(Gap Lock)ã€‚</li>
<li>é—´éš™é”ï¼Œé”çš„å°±æ˜¯ä¸¤ä¸ªå€¼ä¹‹é—´çš„ç©ºéš™ã€‚æ¯”å¦‚æ–‡ç« å¼€å¤´çš„è¡¨tï¼Œåˆå§‹åŒ–æ’å…¥äº†6ä¸ªè®°å½•ï¼Œè¿™å°±äº§ç”Ÿäº†7ä¸ªé—´éš™ã€‚</li>
<li>è¿™æ ·ï¼Œå½“ä½ æ‰§è¡Œ select * from t where d=5 for updateçš„æ—¶å€™ï¼Œå°±ä¸æ­¢æ˜¯ç»™æ•°æ®åº“ä¸­å·²æœ‰çš„6ä¸ªè®°å½•åŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜åŒæ—¶åŠ äº†7ä¸ªé—´éš™é”ã€‚è¿™æ ·å°±ç¡®ä¿äº†æ— æ³•å†æ’å…¥æ–°çš„è®°å½•ã€‚</li>
<li>ä¹Ÿå°±æ˜¯è¯´è¿™æ—¶å€™ï¼Œåœ¨ä¸€è¡Œè¡Œæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä»…å°†ç»™è¡ŒåŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜ç»™è¡Œä¸¤è¾¹çš„ç©ºéš™ï¼Œä¹ŸåŠ ä¸Šäº†é—´éš™é”ã€‚</li>
<li>é—´éš™é”å­˜åœ¨å†²çªå…³ç³»çš„ï¼Œæ˜¯â€œå¾€è¿™ä¸ªé—´éš™ä¸­æ’å…¥ä¸€ä¸ªè®°å½•â€è¿™ä¸ªæ“ä½œã€‚é—´éš™é”ä¹‹é—´éƒ½ä¸å­˜åœ¨å†²çªå…³ç³»ã€‚</li>
<li>é—´éš™é”å’Œnext-key lockçš„å¼•å…¥ï¼Œå¸®æˆ‘ä»¬è§£å†³äº†å¹»è¯»çš„é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›â€œå›°æ‰°â€</li>
</ul>
<blockquote>
<p>æ¯”å¦‚ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ ä¸šåŠ¡é€»è¾‘è¿™æ ·çš„ï¼šä»»æ„é”ä½ä¸€è¡Œï¼Œå¦‚æœè¿™ä¸€è¡Œä¸å­˜åœ¨çš„è¯å°±æ’å…¥ï¼Œå¦‚æœå­˜åœ¨è¿™ä¸€è¡Œå°±æ›´æ–°å®ƒçš„æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> id<span class="operator">=</span>N <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*å¦‚æœè¡Œä¸å­˜åœ¨*/</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span>(N,N,N);</span><br><span class="line"><span class="comment">/*å¦‚æœè¡Œå­˜åœ¨*/</span></span><br><span class="line"><span class="keyword">update</span> t <span class="keyword">set</span> d<span class="operator">=</span>N <span class="keyword">set</span> id<span class="operator">=</span>N;</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>å¯èƒ½ä½ ä¼šè¯´ï¼Œè¿™ä¸ªä¸æ˜¯<code>insert ... on duplicate key update</code> å°±èƒ½è§£å†³å—ï¼Ÿä½†å…¶å®åœ¨æœ‰å¤šä¸ªå”¯ä¸€é”®çš„æ—¶å€™,è¿™ä¸ªæ–¹æ³•æ˜¯ä¸èƒ½æ»¡è¶³è¦æ±‚çš„ã€‚è¿™ä¸ªé€»è¾‘ä¸€æ—¦æœ‰å¹¶å‘ï¼Œå°±ä¼šç¢°åˆ°æ­»é”ã€‚ä½ ä¸€å®šä¹Ÿè§‰å¾—å¥‡æ€ªï¼Œè¿™ä¸ªé€»è¾‘æ¯æ¬¡æ“ä½œå‰ç”¨for updateé”èµ·æ¥ï¼Œå·²ç»æ˜¯æœ€ä¸¥æ ¼çš„æ¨¡å¼äº†ï¼Œæ€ä¹ˆè¿˜ä¼šæœ‰æ­»é”å‘¢ï¼Ÿ</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190418172853342.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzOTEzNDI=,size_16,color_FFFFFF,t_70#id=n7URX&originHeight=372&originWidth=982&originalType=binary&ratio=1&status=done&style=none"><br>ä½ çœ‹åˆ°äº†ï¼Œå…¶å®éƒ½ä¸éœ€è¦ç”¨åˆ°åé¢çš„updateè¯­å¥ï¼Œå°±å·²ç»å½¢æˆæ­»é”äº†ã€‚æˆ‘ä»¬æŒ‰è¯­å¥æ‰§è¡Œé¡ºåºæ¥åˆ†æä¸€ä¸‹ï¼š</p>
<ul>
<li>session A æ‰§è¡Œselect â€¦ for updateè¯­å¥ï¼Œç”±äºid=9è¿™ä¸€è¡Œå¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤ä¼šåŠ ä¸Šé—´éš™é”(5,10);</li>
<li>session B æ‰§è¡Œselect â€¦ for updateè¯­å¥ï¼ŒåŒæ ·ä¼šåŠ ä¸Šé—´éš™é”(5,10)ï¼Œé—´éš™é”ä¹‹é—´ä¸ä¼šå†²çªï¼Œå› æ­¤è¿™ä¸ªè¯­å¥å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼›</li>
<li>session B è¯•å›¾æ’å…¥ä¸€è¡Œ(9,9,9)ï¼Œè¢«session Açš„é—´éš™é”æŒ¡ä½äº†ï¼Œåªå¥½è¿›å…¥ç­‰å¾…ï¼›</li>
<li>session Aè¯•å›¾æ’å…¥ä¸€è¡Œ(9,9,9)ï¼Œè¢«session Bçš„é—´éš™é”æŒ¡ä½äº†ã€‚</li>
<li>è‡³æ­¤ï¼Œä¸¤ä¸ªsessionè¿›å…¥äº’ç›¸ç­‰å¾…çŠ¶æ€ï¼Œå½¢æˆæ­»é”ã€‚å½“ç„¶ï¼ŒInnoDBçš„æ­»é”æ£€æµ‹é©¬ä¸Šå°±å‘ç°äº†è¿™å¯¹æ­»é”å…³ç³»ï¼Œè®©session Açš„insertè¯­å¥æŠ¥é”™è¿”å›äº†ã€‚</li>
</ul>
<blockquote>
<p><code>é—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„</code>ã€‚æ‰€ä»¥ï¼Œä½ å¦‚æœæŠŠéš”ç¦»çº§åˆ«è®¾ç½®ä¸ºè¯»æäº¤çš„è¯ï¼Œå°±æ²¡æœ‰é—´éš™é”äº†ã€‚ä½†åŒæ—¶ï¼Œä½ è¦è§£å†³å¯èƒ½å‡ºç°çš„æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€è¦æŠŠ<code>binlog</code>æ ¼å¼è®¾ç½®ä¸ºrowã€‚è¿™ï¼Œä¹Ÿæ˜¯ç°åœ¨ä¸å°‘å…¬å¸ä½¿ç”¨çš„é…ç½®ç»„åˆã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
</search>
